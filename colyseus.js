<!DOCTYPE html><html lang="en"><head><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-140352188-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-140352188-1');</script><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><meta name="description" content="The CDN for colyseus.js"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/><meta name="timestamp" content="2024-09-11T13:53:47.787Z"/><link rel="shortcut icon" href="/favicon.ico"/><title>UNPKG - colyseus.js</title><script>window.Promise || document.write('\x3Cscript src="/es6-promise@4.2.5/dist/es6-promise.min.js">\x3C/script>\x3Cscript>ES6Promise.polyfill()\x3C/script>')</script><script>window.fetch || document.write('\x3Cscript src="/whatwg-fetch@3.0.0/dist/fetch.umd.js">\x3C/script>')</script><script>window.__DATA__ = {"packageName":"colyseus.js","packageVersion":"0.15.26","availableVersions":["0.1.3","0.1.4","0.1.5","0.1.6","0.1.7","0.1.8","0.2.0","0.2.1","0.2.2","0.2.3","0.2.4","0.2.5","0.2.6","0.4.0","0.4.1","0.4.2","0.4.4","0.4.5","0.5.0-beta.0","0.5.0","0.5.1","0.5.2","0.6.0-alpha.0","0.6.0-alpha.1","0.6.0-alpha.2","0.6.0-alpha.3","0.6.0","0.7.0-alpha.1","0.7.0-alpha.2","0.7.0-alpha.3","0.7.0-alpha.4","0.7.0-alpha.5","0.7.0","0.7.1","0.7.2-rc1","0.7.2-rc2","0.7.2-rc3","0.7.2-rc4","0.7.2","0.7.3-rc1","0.7.3","0.7.4","0.7.5-alpha.0","0.7.5-alpha.1","0.7.5-alpha.2","0.7.5","0.7.6","0.7.7-alpha.1","0.8.0-alpha.0","0.8.0","0.8.1-alpha.0","0.8.1-alpha.1","0.8.2-alpha.0","0.8.2-alpha.1","0.8.2-alpha.2","0.8.2","0.8.3","0.8.4","0.9.0-alpha.0","0.9.0-alpha.1","0.9.0-alpha.2","0.9.0-alpha.3","0.9.0-alpha.4","0.9.0-alpha.5","0.9.0-alpha.6","0.9.0","0.9.1","0.9.2-alpha.0","0.9.2-alpha.1","0.9.2","0.9.3","0.9.4","0.9.5","0.9.6","0.9.7","0.9.8","0.9.9","0.9.10","0.9.11","0.9.12-alpha.0","0.9.12","0.9.13","0.9.14","0.9.15","0.9.16","0.10.0-alpha.0","0.10.0-alpha.1","0.10.0-alpha-0","0.10.0-alpha-1","0.10.0-alpha-2","0.10.0-alpha-3","0.10.0-alpha-4","0.10.0-alpha-5","0.10.0-alpha-6","0.10.0-alpha-7","0.10.0-alpha-8","0.10.0","0.10.1","0.10.2","0.10.3","0.10.4","0.10.5","0.10.6","0.10.7","0.10.8","0.10.9-alpha.0","0.11.0-alpha.0","0.11.0-alpha.1","0.11.0-alpha.2","0.11.0-alpha.3","0.11.0","0.11.1","0.11.2-alpha.0","0.11.2-alpha.1","0.11.2-alpha.2","0.11.2-alpha.3","0.11.2","0.11.3","0.11.4","0.11.5","0.11.6-beta.0","0.11.6-beta.1","0.11.6-beta.2","0.11.6","0.11.7","0.12.0-alpha.0","0.12.0-alpha.1","0.12.0","0.12.1","0.12.2","0.13.0-alpha.0","0.13.0-alpha.1","0.13.0-alpha.2","0.13.0-alpha.3","0.13.0-alpha.4","0.13.0-alpha.5","0.13.0-alpha.6","0.13.0-alpha.7","0.13.0-alpha.8","0.13.0-alpha.9","0.13.0-alpha.10","0.13.0","0.13.1","0.13.2-alpha.0","0.13.2","0.14.0-alpha.0","0.14.0-alpha.1","0.14.0-alpha.2","0.14.0-alpha.3","0.14.0-alpha.4","0.14.0-alpha.6","0.14.0-alpha.7","0.14.0-alpha.8","0.14.0-alpha.9","0.14.0-alpha.10","0.14.0-alpha.11","0.14.0-alpha.13","0.14.0-alpha.15","0.14.0-alpha.16","0.14.0-alpha.17","0.14.0","0.14.1-1.alpha.0","0.14.1","0.14.2-alpha.0","0.14.2-alpha.1","0.14.2-alpha.2","0.14.2-alpha.3","0.14.2","0.14.3","0.14.4","0.14.5","0.14.6","0.14.7","0.14.8-alpha.0","0.14.8","0.14.9","0.14.10","0.14.11","0.14.12","0.14.13-alpha.0","0.14.13","0.14.15-alpha.0","0.15.0-preview.0","0.15.0-preview.1","0.15.0-preview.2","0.15.0-preview.3","0.15.0-preview.4","0.15.0-preview.5","0.15.0-preview.7","0.15.0","0.15.1","0.15.2","0.15.3","0.15.4","0.15.5","0.15.6","0.15.8","0.15.9","0.15.10","0.15.11","0.15.12-alpha.0","0.15.12-alpha.1","0.15.12","0.15.13","0.15.14","0.15.15-alpha.0","0.15.15-alpha.1","0.15.15-alpha.2","0.15.15-preview.3","0.15.15-preview.4","0.15.15-preview.5","0.15.15-preview.6","0.15.15-preview.7","0.15.15-preview.8","0.15.15-preview.9","0.15.15-preview.10","0.15.15-preview.11","0.15.15-preview.13","0.15.15-preview.14","0.15.15-preview.15","0.15.15-preview.16","0.15.15-preview.17","0.15.15-preview.18","0.15.15-preview.19","0.15.15-preview.20","0.15.15-preview.21","0.15.15-preview.22","0.15.15","0.15.16","0.15.17","0.15.18","0.15.19","0.15.20","0.15.21","0.15.22","0.15.23","0.15.24","0.15.25","0.15.26","0.16.0-preview.0","0.16.0-preview.2","0.16.0-preview.3","0.16.0-preview.4","0.16.0-preview.5","0.16.0-preview.6","0.16.0-preview.7","0.16.0-preview.8","0.16.0-preview.9","0.16.0-preview.10","0.16.0-preview.11","0.16.0-preview.13","0.16.0-preview.14","0.16.0-preview.15","0.16.0-preview.16","0.16.0-preview.17","0.16.0-preview.18","0.16.0-preview.20","0.16.0-preview.21"],"filename":"/dist/colyseus.js","target":{"path":"/dist/colyseus.js","type":"file","details":{"contentType":"application/javascript","integrity":"sha384-l8V1NOdZrS1vrYEbh12oDoFaBRg4w4hAfA7sO9pegt2z8uAikzkj03GlQ9uUrTA9","language":"JavaScript","size":242100,"uri":null,"highlights":["<span class=\"code-comment\">// colyseus.js@0.15.26 (@colyseus/schema 2.0.9)</span>\n","(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">global, factory</span>) </span>{\n","    <span class=\"code-keyword\">typeof</span> exports === <span class=\"code-string\">'object'</span> &amp;&amp; <span class=\"code-keyword\">typeof</span> <span class=\"code-built_in\">module</span> !== <span class=\"code-string\">'undefined'</span> ? factory(exports) :\n","    <span class=\"code-keyword\">typeof</span> define === <span class=\"code-string\">'function'</span> &amp;&amp; define.amd ? define(<span class=\"code-string\">'colyseus.js'</span>, [<span class=\"code-string\">'exports'</span>], factory) :\n","    (global = <span class=\"code-keyword\">typeof</span> globalThis !== <span class=\"code-string\">'undefined'</span> ? globalThis : global || self, factory(global.Colyseus = {}));\n","})(<span class=\"code-keyword\">this</span>, (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">exports</span>) </span>{ <span class=\"code-string\">'use strict'</span>;\n","\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">_mergeNamespaces</span>(<span class=\"code-params\">n, m</span>) </span>{\n","        m.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">e</span>) </span>{\n","            e &amp;&amp; <span class=\"code-keyword\">typeof</span> e !== <span class=\"code-string\">'string'</span> &amp;&amp; !<span class=\"code-built_in\">Array</span>.isArray(e) &amp;&amp; <span class=\"code-built_in\">Object</span>.keys(e).forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">k</span>) </span>{\n","                <span class=\"code-keyword\">if</span> (k !== <span class=\"code-string\">'default'</span> &amp;&amp; !(k <span class=\"code-keyword\">in</span> n)) {\n","                    <span class=\"code-keyword\">var</span> d = <span class=\"code-built_in\">Object</span>.getOwnPropertyDescriptor(e, k);\n","                    <span class=\"code-built_in\">Object</span>.defineProperty(n, k, d.get ? d : {\n","                        enumerable: <span class=\"code-literal\">true</span>,\n","                        <span class=\"code-keyword\">get</span>: function () { <span class=\"code-keyword\">return</span> e[k]; }\n","                    });\n","                }\n","            });\n","        });\n","        <span class=\"code-keyword\">return</span> <span class=\"code-built_in\">Object</span>.freeze(n);\n","    }\n","\n","    <span class=\"code-comment\">//</span>\n","    <span class=\"code-comment\">// Polyfills for legacy environments</span>\n","    <span class=\"code-comment\">//</span>\n","    <span class=\"code-comment\">/*\n</span>","<span class=\"code-comment\">     * Support Android 4.4.x\n</span>","<span class=\"code-comment\">     */</span>\n","    <span class=\"code-keyword\">if</span> (!<span class=\"code-built_in\">ArrayBuffer</span>.isView) {\n","        <span class=\"code-built_in\">ArrayBuffer</span>.isView = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">a</span>) </span>{\n","            <span class=\"code-keyword\">return</span> a !== <span class=\"code-literal\">null</span> &amp;&amp; <span class=\"code-keyword\">typeof</span> (a) === <span class=\"code-string\">'object'</span> &amp;&amp; a.buffer <span class=\"code-keyword\">instanceof</span> <span class=\"code-built_in\">ArrayBuffer</span>;\n","        };\n","    }\n","    <span class=\"code-comment\">// Define globalThis if not available.</span>\n","    <span class=\"code-comment\">// https://github.com/colyseus/colyseus.js/issues/86</span>\n","    <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (globalThis) === <span class=\"code-string\">\"undefined\"</span> &amp;&amp;\n","        <span class=\"code-keyword\">typeof</span> (<span class=\"code-built_in\">window</span>) !== <span class=\"code-string\">\"undefined\"</span>) {\n","        <span class=\"code-comment\">// @ts-ignore</span>\n","        <span class=\"code-built_in\">window</span>[<span class=\"code-string\">'globalThis'</span>] = <span class=\"code-built_in\">window</span>;\n","    }\n","\n","    <span class=\"code-comment\">/******************************************************************************\r\n</span>","<span class=\"code-comment\">    Copyright (c) Microsoft Corporation.\r\n</span>","<span class=\"code-comment\">\r\n</span>","<span class=\"code-comment\">    Permission to use, copy, modify, and/or distribute this software for any\r\n</span>","<span class=\"code-comment\">    purpose with or without fee is hereby granted.\r\n</span>","<span class=\"code-comment\">\r\n</span>","<span class=\"code-comment\">    THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\n</span>","<span class=\"code-comment\">    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\n</span>","<span class=\"code-comment\">    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\n</span>","<span class=\"code-comment\">    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\n</span>","<span class=\"code-comment\">    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\n</span>","<span class=\"code-comment\">    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\n</span>","<span class=\"code-comment\">    PERFORMANCE OF THIS SOFTWARE.\r\n</span>","<span class=\"code-comment\">    ***************************************************************************** */</span>\r\n","    <span class=\"code-comment\">/* global Reflect, Promise */</span>\r\n","\r\n","    <span class=\"code-keyword\">var</span> extendStatics = <span class=\"code-function\"><span class=\"code-keyword\">function</span>(<span class=\"code-params\">d, b</span>) </span>{\r\n","        extendStatics = <span class=\"code-built_in\">Object</span>.setPrototypeOf ||\r\n","            ({ <span class=\"code-attr\">__proto__</span>: [] } <span class=\"code-keyword\">instanceof</span> <span class=\"code-built_in\">Array</span> &amp;&amp; <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">d, b</span>) </span>{ d.__proto__ = b; }) ||\r\n","            <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">d, b</span>) </span>{ <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> p <span class=\"code-keyword\">in</span> b) <span class=\"code-keyword\">if</span> (<span class=\"code-built_in\">Object</span>.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n","        <span class=\"code-keyword\">return</span> extendStatics(d, b);\r\n","    };\r\n","\r\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">__extends</span>(<span class=\"code-params\">d, b</span>) </span>{\r\n","        <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> b !== <span class=\"code-string\">\"function\"</span> &amp;&amp; b !== <span class=\"code-literal\">null</span>)\r\n","            <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">TypeError</span>(<span class=\"code-string\">\"Class extends value \"</span> + <span class=\"code-built_in\">String</span>(b) + <span class=\"code-string\">\" is not a constructor or null\"</span>);\r\n","        extendStatics(d, b);\r\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">__</span>(<span class=\"code-params\"></span>) </span>{ <span class=\"code-keyword\">this</span>.constructor = d; }\r\n","        d.prototype = b === <span class=\"code-literal\">null</span> ? <span class=\"code-built_in\">Object</span>.create(b) : (__.prototype = b.prototype, <span class=\"code-keyword\">new</span> __());\r\n","    }\r\n","\r\n","    <span class=\"code-keyword\">var</span> __assign = <span class=\"code-function\"><span class=\"code-keyword\">function</span>(<span class=\"code-params\"></span>) </span>{\r\n","        __assign = <span class=\"code-built_in\">Object</span>.assign || <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">__assign</span>(<span class=\"code-params\">t</span>) </span>{\r\n","            <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> s, i = <span class=\"code-number\">1</span>, n = <span class=\"code-built_in\">arguments</span>.length; i &lt; n; i++) {\r\n","                s = <span class=\"code-built_in\">arguments</span>[i];\r\n","                <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> p <span class=\"code-keyword\">in</span> s) <span class=\"code-keyword\">if</span> (<span class=\"code-built_in\">Object</span>.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n","            }\r\n","            <span class=\"code-keyword\">return</span> t;\r\n","        };\r\n","        <span class=\"code-keyword\">return</span> __assign.apply(<span class=\"code-keyword\">this</span>, <span class=\"code-built_in\">arguments</span>);\r\n","    };\r\n","\r\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">__awaiter</span>(<span class=\"code-params\">thisArg, _arguments, P, generator</span>) </span>{\r\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">adopt</span>(<span class=\"code-params\">value</span>) </span>{ <span class=\"code-keyword\">return</span> value <span class=\"code-keyword\">instanceof</span> P ? value : <span class=\"code-keyword\">new</span> P(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">resolve</span>) </span>{ resolve(value); }); }\r\n","        <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">new</span> (P || (P = <span class=\"code-built_in\">Promise</span>))(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">resolve, reject</span>) </span>{\r\n","            <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">fulfilled</span>(<span class=\"code-params\">value</span>) </span>{ <span class=\"code-keyword\">try</span> { step(generator.next(value)); } <span class=\"code-keyword\">catch</span> (e) { reject(e); } }\r\n","            <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">rejected</span>(<span class=\"code-params\">value</span>) </span>{ <span class=\"code-keyword\">try</span> { step(generator[<span class=\"code-string\">\"throw\"</span>](value)); } <span class=\"code-keyword\">catch</span> (e) { reject(e); } }\r\n","            <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">step</span>(<span class=\"code-params\">result</span>) </span>{ result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n","            step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n","        });\r\n","    }\r\n","\r\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">__generator</span>(<span class=\"code-params\">thisArg, body</span>) </span>{\r\n","        <span class=\"code-keyword\">var</span> _ = { <span class=\"code-attr\">label</span>: <span class=\"code-number\">0</span>, <span class=\"code-attr\">sent</span>: <span class=\"code-function\"><span class=\"code-keyword\">function</span>(<span class=\"code-params\"></span>) </span>{ <span class=\"code-keyword\">if</span> (t[<span class=\"code-number\">0</span>] &amp; <span class=\"code-number\">1</span>) <span class=\"code-keyword\">throw</span> t[<span class=\"code-number\">1</span>]; <span class=\"code-keyword\">return</span> t[<span class=\"code-number\">1</span>]; }, <span class=\"code-attr\">trys</span>: [], <span class=\"code-attr\">ops</span>: [] }, f, y, t, g;\r\n","        <span class=\"code-keyword\">return</span> g = { <span class=\"code-attr\">next</span>: verb(<span class=\"code-number\">0</span>), <span class=\"code-string\">\"throw\"</span>: verb(<span class=\"code-number\">1</span>), <span class=\"code-string\">\"return\"</span>: verb(<span class=\"code-number\">2</span>) }, <span class=\"code-keyword\">typeof</span> <span class=\"code-built_in\">Symbol</span> === <span class=\"code-string\">\"function\"</span> &amp;&amp; (g[<span class=\"code-built_in\">Symbol</span>.iterator] = <span class=\"code-function\"><span class=\"code-keyword\">function</span>(<span class=\"code-params\"></span>) </span>{ <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>; }), g;\r\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">verb</span>(<span class=\"code-params\">n</span>) </span>{ <span class=\"code-keyword\">return</span> <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">v</span>) </span>{ <span class=\"code-keyword\">return</span> step([n, v]); }; }\r\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">step</span>(<span class=\"code-params\">op</span>) </span>{\r\n","            <span class=\"code-keyword\">if</span> (f) <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">TypeError</span>(<span class=\"code-string\">\"Generator is already executing.\"</span>);\r\n","            <span class=\"code-keyword\">while</span> (g &amp;&amp; (g = <span class=\"code-number\">0</span>, op[<span class=\"code-number\">0</span>] &amp;&amp; (_ = <span class=\"code-number\">0</span>)), _) <span class=\"code-keyword\">try</span> {\r\n","                <span class=\"code-keyword\">if</span> (f = <span class=\"code-number\">1</span>, y &amp;&amp; (t = op[<span class=\"code-number\">0</span>] &amp; <span class=\"code-number\">2</span> ? y[<span class=\"code-string\">\"return\"</span>] : op[<span class=\"code-number\">0</span>] ? y[<span class=\"code-string\">\"throw\"</span>] || ((t = y[<span class=\"code-string\">\"return\"</span>]) &amp;&amp; t.call(y), <span class=\"code-number\">0</span>) : y.next) &amp;&amp; !(t = t.call(y, op[<span class=\"code-number\">1</span>])).done) <span class=\"code-keyword\">return</span> t;\r\n","                <span class=\"code-keyword\">if</span> (y = <span class=\"code-number\">0</span>, t) op = [op[<span class=\"code-number\">0</span>] &amp; <span class=\"code-number\">2</span>, t.value];\r\n","                <span class=\"code-keyword\">switch</span> (op[<span class=\"code-number\">0</span>]) {\r\n","                    <span class=\"code-keyword\">case</span> <span class=\"code-number\">0</span>: <span class=\"code-keyword\">case</span> <span class=\"code-number\">1</span>: t = op; <span class=\"code-keyword\">break</span>;\r\n","                    <span class=\"code-keyword\">case</span> <span class=\"code-number\">4</span>: _.label++; <span class=\"code-keyword\">return</span> { <span class=\"code-attr\">value</span>: op[<span class=\"code-number\">1</span>], <span class=\"code-attr\">done</span>: <span class=\"code-literal\">false</span> };\r\n","                    <span class=\"code-keyword\">case</span> <span class=\"code-number\">5</span>: _.label++; y = op[<span class=\"code-number\">1</span>]; op = [<span class=\"code-number\">0</span>]; <span class=\"code-keyword\">continue</span>;\r\n","                    <span class=\"code-keyword\">case</span> <span class=\"code-number\">7</span>: op = _.ops.pop(); _.trys.pop(); <span class=\"code-keyword\">continue</span>;\r\n","                    <span class=\"code-keyword\">default</span>:\r\n","                        <span class=\"code-keyword\">if</span> (!(t = _.trys, t = t.length &gt; <span class=\"code-number\">0</span> &amp;&amp; t[t.length - <span class=\"code-number\">1</span>]) &amp;&amp; (op[<span class=\"code-number\">0</span>] === <span class=\"code-number\">6</span> || op[<span class=\"code-number\">0</span>] === <span class=\"code-number\">2</span>)) { _ = <span class=\"code-number\">0</span>; <span class=\"code-keyword\">continue</span>; }\r\n","                        <span class=\"code-keyword\">if</span> (op[<span class=\"code-number\">0</span>] === <span class=\"code-number\">3</span> &amp;&amp; (!t || (op[<span class=\"code-number\">1</span>] &gt; t[<span class=\"code-number\">0</span>] &amp;&amp; op[<span class=\"code-number\">1</span>] &lt; t[<span class=\"code-number\">3</span>]))) { _.label = op[<span class=\"code-number\">1</span>]; <span class=\"code-keyword\">break</span>; }\r\n","                        <span class=\"code-keyword\">if</span> (op[<span class=\"code-number\">0</span>] === <span class=\"code-number\">6</span> &amp;&amp; _.label &lt; t[<span class=\"code-number\">1</span>]) { _.label = t[<span class=\"code-number\">1</span>]; t = op; <span class=\"code-keyword\">break</span>; }\r\n","                        <span class=\"code-keyword\">if</span> (t &amp;&amp; _.label &lt; t[<span class=\"code-number\">2</span>]) { _.label = t[<span class=\"code-number\">2</span>]; _.ops.push(op); <span class=\"code-keyword\">break</span>; }\r\n","                        <span class=\"code-keyword\">if</span> (t[<span class=\"code-number\">2</span>]) _.ops.pop();\r\n","                        _.trys.pop(); <span class=\"code-keyword\">continue</span>;\r\n","                }\r\n","                op = body.call(thisArg, _);\r\n","            } <span class=\"code-keyword\">catch</span> (e) { op = [<span class=\"code-number\">6</span>, e]; y = <span class=\"code-number\">0</span>; } <span class=\"code-keyword\">finally</span> { f = t = <span class=\"code-number\">0</span>; }\r\n","            <span class=\"code-keyword\">if</span> (op[<span class=\"code-number\">0</span>] &amp; <span class=\"code-number\">5</span>) <span class=\"code-keyword\">throw</span> op[<span class=\"code-number\">1</span>]; <span class=\"code-keyword\">return</span> { <span class=\"code-attr\">value</span>: op[<span class=\"code-number\">0</span>] ? op[<span class=\"code-number\">1</span>] : <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-attr\">done</span>: <span class=\"code-literal\">true</span> };\r\n","        }\r\n","    }\r\n","\r\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">__classPrivateFieldGet</span>(<span class=\"code-params\">receiver, state, kind, f</span>) </span>{\r\n","        <span class=\"code-keyword\">if</span> (kind === <span class=\"code-string\">\"a\"</span> &amp;&amp; !f) <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">TypeError</span>(<span class=\"code-string\">\"Private accessor was defined without a getter\"</span>);\r\n","        <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> state === <span class=\"code-string\">\"function\"</span> ? receiver !== state || !f : !state.has(receiver)) <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">TypeError</span>(<span class=\"code-string\">\"Cannot read private member from an object whose class did not declare it\"</span>);\r\n","        <span class=\"code-keyword\">return</span> kind === <span class=\"code-string\">\"m\"</span> ? f : kind === <span class=\"code-string\">\"a\"</span> ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n","    }\r\n","\r\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">__classPrivateFieldSet</span>(<span class=\"code-params\">receiver, state, value, kind, f</span>) </span>{\r\n","        <span class=\"code-keyword\">if</span> (kind === <span class=\"code-string\">\"m\"</span>) <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">TypeError</span>(<span class=\"code-string\">\"Private method is not writable\"</span>);\r\n","        <span class=\"code-keyword\">if</span> (kind === <span class=\"code-string\">\"a\"</span> &amp;&amp; !f) <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">TypeError</span>(<span class=\"code-string\">\"Private accessor was defined without a setter\"</span>);\r\n","        <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> state === <span class=\"code-string\">\"function\"</span> ? receiver !== state || !f : !state.has(receiver)) <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">TypeError</span>(<span class=\"code-string\">\"Cannot write private member to an object whose class did not declare it\"</span>);\r\n","        <span class=\"code-keyword\">return</span> (kind === <span class=\"code-string\">\"a\"</span> ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n","    }\n","\n","    <span class=\"code-keyword\">var</span> CloseCode;\n","    (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">CloseCode</span>) </span>{\n","        CloseCode[CloseCode[<span class=\"code-string\">\"CONSENTED\"</span>] = <span class=\"code-number\">4000</span>] = <span class=\"code-string\">\"CONSENTED\"</span>;\n","        CloseCode[CloseCode[<span class=\"code-string\">\"DEVMODE_RESTART\"</span>] = <span class=\"code-number\">4010</span>] = <span class=\"code-string\">\"DEVMODE_RESTART\"</span>;\n","    })(CloseCode || (CloseCode = {}));\n","    <span class=\"code-keyword\">var</span> ServerError = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_super</span>) </span>{\n","        __extends(ServerError, _super);\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">ServerError</span>(<span class=\"code-params\">code, message</span>) </span>{\n","            <span class=\"code-keyword\">var</span> _this = _super.call(<span class=\"code-keyword\">this</span>, message) || <span class=\"code-keyword\">this</span>;\n","            _this.name = <span class=\"code-string\">\"ServerError\"</span>;\n","            _this.code = code;\n","            <span class=\"code-keyword\">return</span> _this;\n","        }\n","        <span class=\"code-keyword\">return</span> ServerError;\n","    }(<span class=\"code-built_in\">Error</span>));\n","\n","    <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">     * Copyright (c) 2014 Ion Drive Software Ltd.\n</span>","<span class=\"code-comment\">     * https://github.com/darrachequesne/notepack/\n</span>","<span class=\"code-comment\">     *\n</span>","<span class=\"code-comment\">     * Permission is hereby granted, free of charge, to any person obtaining a copy\n</span>","<span class=\"code-comment\">     * of this software and associated documentation files (the \"Software\"), to deal\n</span>","<span class=\"code-comment\">     * in the Software without restriction, including without limitation the rights\n</span>","<span class=\"code-comment\">     * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n</span>","<span class=\"code-comment\">     * copies of the Software, and to permit persons to whom the Software is\n</span>","<span class=\"code-comment\">     * furnished to do so, subject to the following conditions:\n</span>","<span class=\"code-comment\">     *\n</span>","<span class=\"code-comment\">     * The above copyright notice and this permission notice shall be included in all\n</span>","<span class=\"code-comment\">     * copies or substantial portions of the Software.\n</span>","<span class=\"code-comment\">     *\n</span>","<span class=\"code-comment\">     * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n</span>","<span class=\"code-comment\">     * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n</span>","<span class=\"code-comment\">     * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n</span>","<span class=\"code-comment\">     * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n</span>","<span class=\"code-comment\">     * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n</span>","<span class=\"code-comment\">     * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n</span>","<span class=\"code-comment\">     * SOFTWARE.\n</span>","<span class=\"code-comment\">     */</span>\n","    <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">     * Patch for Colyseus:\n</span>","<span class=\"code-comment\">     * -------------------\n</span>","<span class=\"code-comment\">     * notepack.io@3.0.1\n</span>","<span class=\"code-comment\">     *\n</span>","<span class=\"code-comment\">     * added `offset` on Decoder constructor, for messages arriving with a code\n</span>","<span class=\"code-comment\">     * before actual msgpack data\n</span>","<span class=\"code-comment\">     */</span>\n","    <span class=\"code-comment\">//</span>\n","    <span class=\"code-comment\">// DECODER</span>\n","    <span class=\"code-comment\">//</span>\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">Decoder</span>(<span class=\"code-params\">buffer, offset</span>) </span>{\n","        <span class=\"code-keyword\">this</span>._offset = offset;\n","        <span class=\"code-keyword\">if</span> (buffer <span class=\"code-keyword\">instanceof</span> <span class=\"code-built_in\">ArrayBuffer</span>) {\n","            <span class=\"code-keyword\">this</span>._buffer = buffer;\n","            <span class=\"code-keyword\">this</span>._view = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">DataView</span>(<span class=\"code-keyword\">this</span>._buffer);\n","        }\n","        <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (<span class=\"code-built_in\">ArrayBuffer</span>.isView(buffer)) {\n","            <span class=\"code-keyword\">this</span>._buffer = buffer.buffer;\n","            <span class=\"code-keyword\">this</span>._view = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">DataView</span>(<span class=\"code-keyword\">this</span>._buffer, buffer.byteOffset, buffer.byteLength);\n","        }\n","        <span class=\"code-keyword\">else</span> {\n","            <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">'Invalid argument'</span>);\n","        }\n","    }\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">utf8Read$1</span>(<span class=\"code-params\">view, offset, length</span>) </span>{\n","        <span class=\"code-keyword\">var</span> string = <span class=\"code-string\">''</span>, chr = <span class=\"code-number\">0</span>;\n","        <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> i = offset, end = offset + length; i &lt; end; i++) {\n","            <span class=\"code-keyword\">var</span> byte = view.getUint8(i);\n","            <span class=\"code-keyword\">if</span> ((byte &amp; <span class=\"code-number\">0x80</span>) === <span class=\"code-number\">0x00</span>) {\n","                string += <span class=\"code-built_in\">String</span>.fromCharCode(byte);\n","                <span class=\"code-keyword\">continue</span>;\n","            }\n","            <span class=\"code-keyword\">if</span> ((byte &amp; <span class=\"code-number\">0xe0</span>) === <span class=\"code-number\">0xc0</span>) {\n","                string += <span class=\"code-built_in\">String</span>.fromCharCode(((byte &amp; <span class=\"code-number\">0x1f</span>) &lt;&lt; <span class=\"code-number\">6</span>) |\n","                    (view.getUint8(++i) &amp; <span class=\"code-number\">0x3f</span>));\n","                <span class=\"code-keyword\">continue</span>;\n","            }\n","            <span class=\"code-keyword\">if</span> ((byte &amp; <span class=\"code-number\">0xf0</span>) === <span class=\"code-number\">0xe0</span>) {\n","                string += <span class=\"code-built_in\">String</span>.fromCharCode(((byte &amp; <span class=\"code-number\">0x0f</span>) &lt;&lt; <span class=\"code-number\">12</span>) |\n","                    ((view.getUint8(++i) &amp; <span class=\"code-number\">0x3f</span>) &lt;&lt; <span class=\"code-number\">6</span>) |\n","                    ((view.getUint8(++i) &amp; <span class=\"code-number\">0x3f</span>) &lt;&lt; <span class=\"code-number\">0</span>));\n","                <span class=\"code-keyword\">continue</span>;\n","            }\n","            <span class=\"code-keyword\">if</span> ((byte &amp; <span class=\"code-number\">0xf8</span>) === <span class=\"code-number\">0xf0</span>) {\n","                chr = ((byte &amp; <span class=\"code-number\">0x07</span>) &lt;&lt; <span class=\"code-number\">18</span>) |\n","                    ((view.getUint8(++i) &amp; <span class=\"code-number\">0x3f</span>) &lt;&lt; <span class=\"code-number\">12</span>) |\n","                    ((view.getUint8(++i) &amp; <span class=\"code-number\">0x3f</span>) &lt;&lt; <span class=\"code-number\">6</span>) |\n","                    ((view.getUint8(++i) &amp; <span class=\"code-number\">0x3f</span>) &lt;&lt; <span class=\"code-number\">0</span>);\n","                <span class=\"code-keyword\">if</span> (chr &gt;= <span class=\"code-number\">0x010000</span>) { <span class=\"code-comment\">// surrogate pair</span>\n","                    chr -= <span class=\"code-number\">0x010000</span>;\n","                    string += <span class=\"code-built_in\">String</span>.fromCharCode((chr &gt;&gt;&gt; <span class=\"code-number\">10</span>) + <span class=\"code-number\">0xD800</span>, (chr &amp; <span class=\"code-number\">0x3FF</span>) + <span class=\"code-number\">0xDC00</span>);\n","                }\n","                <span class=\"code-keyword\">else</span> {\n","                    string += <span class=\"code-built_in\">String</span>.fromCharCode(chr);\n","                }\n","                <span class=\"code-keyword\">continue</span>;\n","            }\n","            <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">'Invalid byte '</span> + byte.toString(<span class=\"code-number\">16</span>));\n","        }\n","        <span class=\"code-keyword\">return</span> string;\n","    }\n","    Decoder.prototype._array = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">length</span>) </span>{\n","        <span class=\"code-keyword\">var</span> value = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Array</span>(length);\n","        <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> i = <span class=\"code-number\">0</span>; i &lt; length; i++) {\n","            value[i] = <span class=\"code-keyword\">this</span>._parse();\n","        }\n","        <span class=\"code-keyword\">return</span> value;\n","    };\n","    Decoder.prototype._map = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">length</span>) </span>{\n","        <span class=\"code-keyword\">var</span> key = <span class=\"code-string\">''</span>, value = {};\n","        <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> i = <span class=\"code-number\">0</span>; i &lt; length; i++) {\n","            key = <span class=\"code-keyword\">this</span>._parse();\n","            value[key] = <span class=\"code-keyword\">this</span>._parse();\n","        }\n","        <span class=\"code-keyword\">return</span> value;\n","    };\n","    Decoder.prototype._str = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">length</span>) </span>{\n","        <span class=\"code-keyword\">var</span> value = utf8Read$<span class=\"code-number\">1</span>(<span class=\"code-keyword\">this</span>._view, <span class=\"code-keyword\">this</span>._offset, length);\n","        <span class=\"code-keyword\">this</span>._offset += length;\n","        <span class=\"code-keyword\">return</span> value;\n","    };\n","    Decoder.prototype._bin = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">length</span>) </span>{\n","        <span class=\"code-keyword\">var</span> value = <span class=\"code-keyword\">this</span>._buffer.slice(<span class=\"code-keyword\">this</span>._offset, <span class=\"code-keyword\">this</span>._offset + length);\n","        <span class=\"code-keyword\">this</span>._offset += length;\n","        <span class=\"code-keyword\">return</span> value;\n","    };\n","    Decoder.prototype._parse = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","        <span class=\"code-keyword\">var</span> prefix = <span class=\"code-keyword\">this</span>._view.getUint8(<span class=\"code-keyword\">this</span>._offset++);\n","        <span class=\"code-keyword\">var</span> value, length = <span class=\"code-number\">0</span>, type = <span class=\"code-number\">0</span>, hi = <span class=\"code-number\">0</span>, lo = <span class=\"code-number\">0</span>;\n","        <span class=\"code-keyword\">if</span> (prefix &lt; <span class=\"code-number\">0xc0</span>) {\n","            <span class=\"code-comment\">// positive fixint</span>\n","            <span class=\"code-keyword\">if</span> (prefix &lt; <span class=\"code-number\">0x80</span>) {\n","                <span class=\"code-keyword\">return</span> prefix;\n","            }\n","            <span class=\"code-comment\">// fixmap</span>\n","            <span class=\"code-keyword\">if</span> (prefix &lt; <span class=\"code-number\">0x90</span>) {\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>._map(prefix &amp; <span class=\"code-number\">0x0f</span>);\n","            }\n","            <span class=\"code-comment\">// fixarray</span>\n","            <span class=\"code-keyword\">if</span> (prefix &lt; <span class=\"code-number\">0xa0</span>) {\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>._array(prefix &amp; <span class=\"code-number\">0x0f</span>);\n","            }\n","            <span class=\"code-comment\">// fixstr</span>\n","            <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>._str(prefix &amp; <span class=\"code-number\">0x1f</span>);\n","        }\n","        <span class=\"code-comment\">// negative fixint</span>\n","        <span class=\"code-keyword\">if</span> (prefix &gt; <span class=\"code-number\">0xdf</span>) {\n","            <span class=\"code-keyword\">return</span> (<span class=\"code-number\">0xff</span> - prefix + <span class=\"code-number\">1</span>) * <span class=\"code-number\">-1</span>;\n","        }\n","        <span class=\"code-keyword\">switch</span> (prefix) {\n","            <span class=\"code-comment\">// nil</span>\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xc0</span>:\n","                <span class=\"code-keyword\">return</span> <span class=\"code-literal\">null</span>;\n","            <span class=\"code-comment\">// false</span>\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xc2</span>:\n","                <span class=\"code-keyword\">return</span> <span class=\"code-literal\">false</span>;\n","            <span class=\"code-comment\">// true</span>\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xc3</span>:\n","                <span class=\"code-keyword\">return</span> <span class=\"code-literal\">true</span>;\n","            <span class=\"code-comment\">// bin</span>\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xc4</span>:\n","                length = <span class=\"code-keyword\">this</span>._view.getUint8(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">1</span>;\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>._bin(length);\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xc5</span>:\n","                length = <span class=\"code-keyword\">this</span>._view.getUint16(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">2</span>;\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>._bin(length);\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xc6</span>:\n","                length = <span class=\"code-keyword\">this</span>._view.getUint32(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">4</span>;\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>._bin(length);\n","            <span class=\"code-comment\">// ext</span>\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xc7</span>:\n","                length = <span class=\"code-keyword\">this</span>._view.getUint8(<span class=\"code-keyword\">this</span>._offset);\n","                type = <span class=\"code-keyword\">this</span>._view.getInt8(<span class=\"code-keyword\">this</span>._offset + <span class=\"code-number\">1</span>);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">2</span>;\n","                <span class=\"code-keyword\">if</span> (type === <span class=\"code-number\">-1</span>) {\n","                    <span class=\"code-comment\">// timestamp 96</span>\n","                    <span class=\"code-keyword\">var</span> ns = <span class=\"code-keyword\">this</span>._view.getUint32(<span class=\"code-keyword\">this</span>._offset);\n","                    hi = <span class=\"code-keyword\">this</span>._view.getInt32(<span class=\"code-keyword\">this</span>._offset + <span class=\"code-number\">4</span>);\n","                    lo = <span class=\"code-keyword\">this</span>._view.getUint32(<span class=\"code-keyword\">this</span>._offset + <span class=\"code-number\">8</span>);\n","                    <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">12</span>;\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Date</span>((hi * <span class=\"code-number\">0x100000000</span> + lo) * <span class=\"code-number\">1e3</span> + ns / <span class=\"code-number\">1e6</span>);\n","                }\n","                <span class=\"code-keyword\">return</span> [type, <span class=\"code-keyword\">this</span>._bin(length)];\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xc8</span>:\n","                length = <span class=\"code-keyword\">this</span>._view.getUint16(<span class=\"code-keyword\">this</span>._offset);\n","                type = <span class=\"code-keyword\">this</span>._view.getInt8(<span class=\"code-keyword\">this</span>._offset + <span class=\"code-number\">2</span>);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">3</span>;\n","                <span class=\"code-keyword\">return</span> [type, <span class=\"code-keyword\">this</span>._bin(length)];\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xc9</span>:\n","                length = <span class=\"code-keyword\">this</span>._view.getUint32(<span class=\"code-keyword\">this</span>._offset);\n","                type = <span class=\"code-keyword\">this</span>._view.getInt8(<span class=\"code-keyword\">this</span>._offset + <span class=\"code-number\">4</span>);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">5</span>;\n","                <span class=\"code-keyword\">return</span> [type, <span class=\"code-keyword\">this</span>._bin(length)];\n","            <span class=\"code-comment\">// float</span>\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xca</span>:\n","                value = <span class=\"code-keyword\">this</span>._view.getFloat32(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">4</span>;\n","                <span class=\"code-keyword\">return</span> value;\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xcb</span>:\n","                value = <span class=\"code-keyword\">this</span>._view.getFloat64(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">8</span>;\n","                <span class=\"code-keyword\">return</span> value;\n","            <span class=\"code-comment\">// uint</span>\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xcc</span>:\n","                value = <span class=\"code-keyword\">this</span>._view.getUint8(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">1</span>;\n","                <span class=\"code-keyword\">return</span> value;\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xcd</span>:\n","                value = <span class=\"code-keyword\">this</span>._view.getUint16(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">2</span>;\n","                <span class=\"code-keyword\">return</span> value;\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xce</span>:\n","                value = <span class=\"code-keyword\">this</span>._view.getUint32(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">4</span>;\n","                <span class=\"code-keyword\">return</span> value;\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xcf</span>:\n","                hi = <span class=\"code-keyword\">this</span>._view.getUint32(<span class=\"code-keyword\">this</span>._offset) * <span class=\"code-built_in\">Math</span>.pow(<span class=\"code-number\">2</span>, <span class=\"code-number\">32</span>);\n","                lo = <span class=\"code-keyword\">this</span>._view.getUint32(<span class=\"code-keyword\">this</span>._offset + <span class=\"code-number\">4</span>);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">8</span>;\n","                <span class=\"code-keyword\">return</span> hi + lo;\n","            <span class=\"code-comment\">// int</span>\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xd0</span>:\n","                value = <span class=\"code-keyword\">this</span>._view.getInt8(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">1</span>;\n","                <span class=\"code-keyword\">return</span> value;\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xd1</span>:\n","                value = <span class=\"code-keyword\">this</span>._view.getInt16(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">2</span>;\n","                <span class=\"code-keyword\">return</span> value;\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xd2</span>:\n","                value = <span class=\"code-keyword\">this</span>._view.getInt32(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">4</span>;\n","                <span class=\"code-keyword\">return</span> value;\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xd3</span>:\n","                hi = <span class=\"code-keyword\">this</span>._view.getInt32(<span class=\"code-keyword\">this</span>._offset) * <span class=\"code-built_in\">Math</span>.pow(<span class=\"code-number\">2</span>, <span class=\"code-number\">32</span>);\n","                lo = <span class=\"code-keyword\">this</span>._view.getUint32(<span class=\"code-keyword\">this</span>._offset + <span class=\"code-number\">4</span>);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">8</span>;\n","                <span class=\"code-keyword\">return</span> hi + lo;\n","            <span class=\"code-comment\">// fixext</span>\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xd4</span>:\n","                type = <span class=\"code-keyword\">this</span>._view.getInt8(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">1</span>;\n","                <span class=\"code-keyword\">if</span> (type === <span class=\"code-number\">0x00</span>) {\n","                    <span class=\"code-comment\">// custom encoding for 'undefined' (kept for backward-compatibility)</span>\n","                    <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">1</span>;\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>;\n","                }\n","                <span class=\"code-keyword\">return</span> [type, <span class=\"code-keyword\">this</span>._bin(<span class=\"code-number\">1</span>)];\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xd5</span>:\n","                type = <span class=\"code-keyword\">this</span>._view.getInt8(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">1</span>;\n","                <span class=\"code-keyword\">return</span> [type, <span class=\"code-keyword\">this</span>._bin(<span class=\"code-number\">2</span>)];\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xd6</span>:\n","                type = <span class=\"code-keyword\">this</span>._view.getInt8(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">1</span>;\n","                <span class=\"code-keyword\">if</span> (type === <span class=\"code-number\">-1</span>) {\n","                    <span class=\"code-comment\">// timestamp 32</span>\n","                    value = <span class=\"code-keyword\">this</span>._view.getUint32(<span class=\"code-keyword\">this</span>._offset);\n","                    <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">4</span>;\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Date</span>(value * <span class=\"code-number\">1e3</span>);\n","                }\n","                <span class=\"code-keyword\">return</span> [type, <span class=\"code-keyword\">this</span>._bin(<span class=\"code-number\">4</span>)];\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xd7</span>:\n","                type = <span class=\"code-keyword\">this</span>._view.getInt8(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">1</span>;\n","                <span class=\"code-keyword\">if</span> (type === <span class=\"code-number\">0x00</span>) {\n","                    <span class=\"code-comment\">// custom date encoding (kept for backward-compatibility)</span>\n","                    hi = <span class=\"code-keyword\">this</span>._view.getInt32(<span class=\"code-keyword\">this</span>._offset) * <span class=\"code-built_in\">Math</span>.pow(<span class=\"code-number\">2</span>, <span class=\"code-number\">32</span>);\n","                    lo = <span class=\"code-keyword\">this</span>._view.getUint32(<span class=\"code-keyword\">this</span>._offset + <span class=\"code-number\">4</span>);\n","                    <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">8</span>;\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Date</span>(hi + lo);\n","                }\n","                <span class=\"code-keyword\">if</span> (type === <span class=\"code-number\">-1</span>) {\n","                    <span class=\"code-comment\">// timestamp 64</span>\n","                    hi = <span class=\"code-keyword\">this</span>._view.getUint32(<span class=\"code-keyword\">this</span>._offset);\n","                    lo = <span class=\"code-keyword\">this</span>._view.getUint32(<span class=\"code-keyword\">this</span>._offset + <span class=\"code-number\">4</span>);\n","                    <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">8</span>;\n","                    <span class=\"code-keyword\">var</span> s = (hi &amp; <span class=\"code-number\">0x3</span>) * <span class=\"code-number\">0x100000000</span> + lo;\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Date</span>(s * <span class=\"code-number\">1e3</span> + (hi &gt;&gt;&gt; <span class=\"code-number\">2</span>) / <span class=\"code-number\">1e6</span>);\n","                }\n","                <span class=\"code-keyword\">return</span> [type, <span class=\"code-keyword\">this</span>._bin(<span class=\"code-number\">8</span>)];\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xd8</span>:\n","                type = <span class=\"code-keyword\">this</span>._view.getInt8(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">1</span>;\n","                <span class=\"code-keyword\">return</span> [type, <span class=\"code-keyword\">this</span>._bin(<span class=\"code-number\">16</span>)];\n","            <span class=\"code-comment\">// str</span>\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xd9</span>:\n","                length = <span class=\"code-keyword\">this</span>._view.getUint8(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">1</span>;\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>._str(length);\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xda</span>:\n","                length = <span class=\"code-keyword\">this</span>._view.getUint16(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">2</span>;\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>._str(length);\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xdb</span>:\n","                length = <span class=\"code-keyword\">this</span>._view.getUint32(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">4</span>;\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>._str(length);\n","            <span class=\"code-comment\">// array</span>\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xdc</span>:\n","                length = <span class=\"code-keyword\">this</span>._view.getUint16(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">2</span>;\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>._array(length);\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xdd</span>:\n","                length = <span class=\"code-keyword\">this</span>._view.getUint32(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">4</span>;\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>._array(length);\n","            <span class=\"code-comment\">// map</span>\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xde</span>:\n","                length = <span class=\"code-keyword\">this</span>._view.getUint16(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">2</span>;\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>._map(length);\n","            <span class=\"code-keyword\">case</span> <span class=\"code-number\">0xdf</span>:\n","                length = <span class=\"code-keyword\">this</span>._view.getUint32(<span class=\"code-keyword\">this</span>._offset);\n","                <span class=\"code-keyword\">this</span>._offset += <span class=\"code-number\">4</span>;\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>._map(length);\n","        }\n","        <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">'Could not parse'</span>);\n","    };\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">decode</span>(<span class=\"code-params\">buffer, offset</span>) </span>{\n","        <span class=\"code-keyword\">if</span> (offset === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { offset = <span class=\"code-number\">0</span>; }\n","        <span class=\"code-keyword\">var</span> decoder = <span class=\"code-keyword\">new</span> Decoder(buffer, offset);\n","        <span class=\"code-keyword\">var</span> value = decoder._parse();\n","        <span class=\"code-keyword\">if</span> (decoder._offset !== buffer.byteLength) {\n","            <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>((buffer.byteLength - decoder._offset) + <span class=\"code-string\">' trailing bytes'</span>);\n","        }\n","        <span class=\"code-keyword\">return</span> value;\n","    }\n","    <span class=\"code-comment\">//</span>\n","    <span class=\"code-comment\">// ENCODER</span>\n","    <span class=\"code-comment\">//</span>\n","    <span class=\"code-keyword\">var</span> TIMESTAMP32_MAX_SEC = <span class=\"code-number\">0x100000000</span> - <span class=\"code-number\">1</span>; <span class=\"code-comment\">// 32-bit unsigned int</span>\n","    <span class=\"code-keyword\">var</span> TIMESTAMP64_MAX_SEC = <span class=\"code-number\">0x400000000</span> - <span class=\"code-number\">1</span>; <span class=\"code-comment\">// 34-bit unsigned int</span>\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">utf8Write</span>(<span class=\"code-params\">view, offset, str</span>) </span>{\n","        <span class=\"code-keyword\">var</span> c = <span class=\"code-number\">0</span>;\n","        <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> i = <span class=\"code-number\">0</span>, l = str.length; i &lt; l; i++) {\n","            c = str.charCodeAt(i);\n","            <span class=\"code-keyword\">if</span> (c &lt; <span class=\"code-number\">0x80</span>) {\n","                view.setUint8(offset++, c);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (c &lt; <span class=\"code-number\">0x800</span>) {\n","                view.setUint8(offset++, <span class=\"code-number\">0xc0</span> | (c &gt;&gt; <span class=\"code-number\">6</span>));\n","                view.setUint8(offset++, <span class=\"code-number\">0x80</span> | (c &amp; <span class=\"code-number\">0x3f</span>));\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (c &lt; <span class=\"code-number\">0xd800</span> || c &gt;= <span class=\"code-number\">0xe000</span>) {\n","                view.setUint8(offset++, <span class=\"code-number\">0xe0</span> | (c &gt;&gt; <span class=\"code-number\">12</span>));\n","                view.setUint8(offset++, <span class=\"code-number\">0x80</span> | (c &gt;&gt; <span class=\"code-number\">6</span>) &amp; <span class=\"code-number\">0x3f</span>);\n","                view.setUint8(offset++, <span class=\"code-number\">0x80</span> | (c &amp; <span class=\"code-number\">0x3f</span>));\n","            }\n","            <span class=\"code-keyword\">else</span> {\n","                i++;\n","                c = <span class=\"code-number\">0x10000</span> + (((c &amp; <span class=\"code-number\">0x3ff</span>) &lt;&lt; <span class=\"code-number\">10</span>) | (str.charCodeAt(i) &amp; <span class=\"code-number\">0x3ff</span>));\n","                view.setUint8(offset++, <span class=\"code-number\">0xf0</span> | (c &gt;&gt; <span class=\"code-number\">18</span>));\n","                view.setUint8(offset++, <span class=\"code-number\">0x80</span> | (c &gt;&gt; <span class=\"code-number\">12</span>) &amp; <span class=\"code-number\">0x3f</span>);\n","                view.setUint8(offset++, <span class=\"code-number\">0x80</span> | (c &gt;&gt; <span class=\"code-number\">6</span>) &amp; <span class=\"code-number\">0x3f</span>);\n","                view.setUint8(offset++, <span class=\"code-number\">0x80</span> | (c &amp; <span class=\"code-number\">0x3f</span>));\n","            }\n","        }\n","    }\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">utf8Length$1</span>(<span class=\"code-params\">str</span>) </span>{\n","        <span class=\"code-keyword\">var</span> c = <span class=\"code-number\">0</span>, length = <span class=\"code-number\">0</span>;\n","        <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> i = <span class=\"code-number\">0</span>, l = str.length; i &lt; l; i++) {\n","            c = str.charCodeAt(i);\n","            <span class=\"code-keyword\">if</span> (c &lt; <span class=\"code-number\">0x80</span>) {\n","                length += <span class=\"code-number\">1</span>;\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (c &lt; <span class=\"code-number\">0x800</span>) {\n","                length += <span class=\"code-number\">2</span>;\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (c &lt; <span class=\"code-number\">0xd800</span> || c &gt;= <span class=\"code-number\">0xe000</span>) {\n","                length += <span class=\"code-number\">3</span>;\n","            }\n","            <span class=\"code-keyword\">else</span> {\n","                i++;\n","                length += <span class=\"code-number\">4</span>;\n","            }\n","        }\n","        <span class=\"code-keyword\">return</span> length;\n","    }\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">_encode</span>(<span class=\"code-params\">bytes, defers, value</span>) </span>{\n","        <span class=\"code-keyword\">var</span> type = <span class=\"code-keyword\">typeof</span> value, i = <span class=\"code-number\">0</span>, l = <span class=\"code-number\">0</span>, hi = <span class=\"code-number\">0</span>, lo = <span class=\"code-number\">0</span>, length = <span class=\"code-number\">0</span>, size = <span class=\"code-number\">0</span>;\n","        <span class=\"code-keyword\">if</span> (type === <span class=\"code-string\">'string'</span>) {\n","            length = utf8Length$<span class=\"code-number\">1</span>(value);\n","            <span class=\"code-comment\">// fixstr</span>\n","            <span class=\"code-keyword\">if</span> (length &lt; <span class=\"code-number\">0x20</span>) {\n","                bytes.push(length | <span class=\"code-number\">0xa0</span>);\n","                size = <span class=\"code-number\">1</span>;\n","            }\n","            <span class=\"code-comment\">// str 8</span>\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (length &lt; <span class=\"code-number\">0x100</span>) {\n","                bytes.push(<span class=\"code-number\">0xd9</span>, length);\n","                size = <span class=\"code-number\">2</span>;\n","            }\n","            <span class=\"code-comment\">// str 16</span>\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (length &lt; <span class=\"code-number\">0x10000</span>) {\n","                bytes.push(<span class=\"code-number\">0xda</span>, length &gt;&gt; <span class=\"code-number\">8</span>, length);\n","                size = <span class=\"code-number\">3</span>;\n","            }\n","            <span class=\"code-comment\">// str 32</span>\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (length &lt; <span class=\"code-number\">0x100000000</span>) {\n","                bytes.push(<span class=\"code-number\">0xdb</span>, length &gt;&gt; <span class=\"code-number\">24</span>, length &gt;&gt; <span class=\"code-number\">16</span>, length &gt;&gt; <span class=\"code-number\">8</span>, length);\n","                size = <span class=\"code-number\">5</span>;\n","            }\n","            <span class=\"code-keyword\">else</span> {\n","                <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">'String too long'</span>);\n","            }\n","            defers.push({ <span class=\"code-attr\">_str</span>: value, <span class=\"code-attr\">_length</span>: length, <span class=\"code-attr\">_offset</span>: bytes.length });\n","            <span class=\"code-keyword\">return</span> size + length;\n","        }\n","        <span class=\"code-keyword\">if</span> (type === <span class=\"code-string\">'number'</span>) {\n","            <span class=\"code-comment\">// <span class=\"code-doctag\">TODO:</span> encode to float 32?</span>\n","            <span class=\"code-comment\">// float 64</span>\n","            <span class=\"code-keyword\">if</span> (<span class=\"code-built_in\">Math</span>.floor(value) !== value || !<span class=\"code-built_in\">isFinite</span>(value)) {\n","                bytes.push(<span class=\"code-number\">0xcb</span>);\n","                defers.push({ <span class=\"code-attr\">_float</span>: value, <span class=\"code-attr\">_length</span>: <span class=\"code-number\">8</span>, <span class=\"code-attr\">_offset</span>: bytes.length });\n","                <span class=\"code-keyword\">return</span> <span class=\"code-number\">9</span>;\n","            }\n","            <span class=\"code-keyword\">if</span> (value &gt;= <span class=\"code-number\">0</span>) {\n","                <span class=\"code-comment\">// positive fixnum</span>\n","                <span class=\"code-keyword\">if</span> (value &lt; <span class=\"code-number\">0x80</span>) {\n","                    bytes.push(value);\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-number\">1</span>;\n","                }\n","                <span class=\"code-comment\">// uint 8</span>\n","                <span class=\"code-keyword\">if</span> (value &lt; <span class=\"code-number\">0x100</span>) {\n","                    bytes.push(<span class=\"code-number\">0xcc</span>, value);\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-number\">2</span>;\n","                }\n","                <span class=\"code-comment\">// uint 16</span>\n","                <span class=\"code-keyword\">if</span> (value &lt; <span class=\"code-number\">0x10000</span>) {\n","                    bytes.push(<span class=\"code-number\">0xcd</span>, value &gt;&gt; <span class=\"code-number\">8</span>, value);\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-number\">3</span>;\n","                }\n","                <span class=\"code-comment\">// uint 32</span>\n","                <span class=\"code-keyword\">if</span> (value &lt; <span class=\"code-number\">0x100000000</span>) {\n","                    bytes.push(<span class=\"code-number\">0xce</span>, value &gt;&gt; <span class=\"code-number\">24</span>, value &gt;&gt; <span class=\"code-number\">16</span>, value &gt;&gt; <span class=\"code-number\">8</span>, value);\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-number\">5</span>;\n","                }\n","                <span class=\"code-comment\">// uint 64</span>\n","                hi = (value / <span class=\"code-built_in\">Math</span>.pow(<span class=\"code-number\">2</span>, <span class=\"code-number\">32</span>)) &gt;&gt; <span class=\"code-number\">0</span>;\n","                lo = value &gt;&gt;&gt; <span class=\"code-number\">0</span>;\n","                bytes.push(<span class=\"code-number\">0xcf</span>, hi &gt;&gt; <span class=\"code-number\">24</span>, hi &gt;&gt; <span class=\"code-number\">16</span>, hi &gt;&gt; <span class=\"code-number\">8</span>, hi, lo &gt;&gt; <span class=\"code-number\">24</span>, lo &gt;&gt; <span class=\"code-number\">16</span>, lo &gt;&gt; <span class=\"code-number\">8</span>, lo);\n","                <span class=\"code-keyword\">return</span> <span class=\"code-number\">9</span>;\n","            }\n","            <span class=\"code-keyword\">else</span> {\n","                <span class=\"code-comment\">// negative fixnum</span>\n","                <span class=\"code-keyword\">if</span> (value &gt;= <span class=\"code-number\">-0x20</span>) {\n","                    bytes.push(value);\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-number\">1</span>;\n","                }\n","                <span class=\"code-comment\">// int 8</span>\n","                <span class=\"code-keyword\">if</span> (value &gt;= <span class=\"code-number\">-0x80</span>) {\n","                    bytes.push(<span class=\"code-number\">0xd0</span>, value);\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-number\">2</span>;\n","                }\n","                <span class=\"code-comment\">// int 16</span>\n","                <span class=\"code-keyword\">if</span> (value &gt;= <span class=\"code-number\">-0x8000</span>) {\n","                    bytes.push(<span class=\"code-number\">0xd1</span>, value &gt;&gt; <span class=\"code-number\">8</span>, value);\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-number\">3</span>;\n","                }\n","                <span class=\"code-comment\">// int 32</span>\n","                <span class=\"code-keyword\">if</span> (value &gt;= <span class=\"code-number\">-0x80000000</span>) {\n","                    bytes.push(<span class=\"code-number\">0xd2</span>, value &gt;&gt; <span class=\"code-number\">24</span>, value &gt;&gt; <span class=\"code-number\">16</span>, value &gt;&gt; <span class=\"code-number\">8</span>, value);\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-number\">5</span>;\n","                }\n","                <span class=\"code-comment\">// int 64</span>\n","                hi = <span class=\"code-built_in\">Math</span>.floor(value / <span class=\"code-built_in\">Math</span>.pow(<span class=\"code-number\">2</span>, <span class=\"code-number\">32</span>));\n","                lo = value &gt;&gt;&gt; <span class=\"code-number\">0</span>;\n","                bytes.push(<span class=\"code-number\">0xd3</span>, hi &gt;&gt; <span class=\"code-number\">24</span>, hi &gt;&gt; <span class=\"code-number\">16</span>, hi &gt;&gt; <span class=\"code-number\">8</span>, hi, lo &gt;&gt; <span class=\"code-number\">24</span>, lo &gt;&gt; <span class=\"code-number\">16</span>, lo &gt;&gt; <span class=\"code-number\">8</span>, lo);\n","                <span class=\"code-keyword\">return</span> <span class=\"code-number\">9</span>;\n","            }\n","        }\n","        <span class=\"code-keyword\">if</span> (type === <span class=\"code-string\">'object'</span>) {\n","            <span class=\"code-comment\">// nil</span>\n","            <span class=\"code-keyword\">if</span> (value === <span class=\"code-literal\">null</span>) {\n","                bytes.push(<span class=\"code-number\">0xc0</span>);\n","                <span class=\"code-keyword\">return</span> <span class=\"code-number\">1</span>;\n","            }\n","            <span class=\"code-keyword\">if</span> (<span class=\"code-built_in\">Array</span>.isArray(value)) {\n","                length = value.length;\n","                <span class=\"code-comment\">// fixarray</span>\n","                <span class=\"code-keyword\">if</span> (length &lt; <span class=\"code-number\">0x10</span>) {\n","                    bytes.push(length | <span class=\"code-number\">0x90</span>);\n","                    size = <span class=\"code-number\">1</span>;\n","                }\n","                <span class=\"code-comment\">// array 16</span>\n","                <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (length &lt; <span class=\"code-number\">0x10000</span>) {\n","                    bytes.push(<span class=\"code-number\">0xdc</span>, length &gt;&gt; <span class=\"code-number\">8</span>, length);\n","                    size = <span class=\"code-number\">3</span>;\n","                }\n","                <span class=\"code-comment\">// array 32</span>\n","                <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (length &lt; <span class=\"code-number\">0x100000000</span>) {\n","                    bytes.push(<span class=\"code-number\">0xdd</span>, length &gt;&gt; <span class=\"code-number\">24</span>, length &gt;&gt; <span class=\"code-number\">16</span>, length &gt;&gt; <span class=\"code-number\">8</span>, length);\n","                    size = <span class=\"code-number\">5</span>;\n","                }\n","                <span class=\"code-keyword\">else</span> {\n","                    <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">'Array too large'</span>);\n","                }\n","                <span class=\"code-keyword\">for</span> (i = <span class=\"code-number\">0</span>; i &lt; length; i++) {\n","                    size += _encode(bytes, defers, value[i]);\n","                }\n","                <span class=\"code-keyword\">return</span> size;\n","            }\n","            <span class=\"code-keyword\">if</span> (value <span class=\"code-keyword\">instanceof</span> <span class=\"code-built_in\">Date</span>) {\n","                <span class=\"code-keyword\">var</span> ms = value.getTime();\n","                <span class=\"code-keyword\">var</span> s = <span class=\"code-built_in\">Math</span>.floor(ms / <span class=\"code-number\">1e3</span>);\n","                <span class=\"code-keyword\">var</span> ns = (ms - s * <span class=\"code-number\">1e3</span>) * <span class=\"code-number\">1e6</span>;\n","                <span class=\"code-keyword\">if</span> (s &gt;= <span class=\"code-number\">0</span> &amp;&amp; ns &gt;= <span class=\"code-number\">0</span> &amp;&amp; s &lt;= TIMESTAMP64_MAX_SEC) {\n","                    <span class=\"code-keyword\">if</span> (ns === <span class=\"code-number\">0</span> &amp;&amp; s &lt;= TIMESTAMP32_MAX_SEC) {\n","                        <span class=\"code-comment\">// timestamp 32</span>\n","                        bytes.push(<span class=\"code-number\">0xd6</span>, <span class=\"code-number\">0xff</span>, s &gt;&gt; <span class=\"code-number\">24</span>, s &gt;&gt; <span class=\"code-number\">16</span>, s &gt;&gt; <span class=\"code-number\">8</span>, s);\n","                        <span class=\"code-keyword\">return</span> <span class=\"code-number\">6</span>;\n","                    }\n","                    <span class=\"code-keyword\">else</span> {\n","                        <span class=\"code-comment\">// timestamp 64</span>\n","                        hi = s / <span class=\"code-number\">0x100000000</span>;\n","                        lo = s &amp; <span class=\"code-number\">0xffffffff</span>;\n","                        bytes.push(<span class=\"code-number\">0xd7</span>, <span class=\"code-number\">0xff</span>, ns &gt;&gt; <span class=\"code-number\">22</span>, ns &gt;&gt; <span class=\"code-number\">14</span>, ns &gt;&gt; <span class=\"code-number\">6</span>, hi, lo &gt;&gt; <span class=\"code-number\">24</span>, lo &gt;&gt; <span class=\"code-number\">16</span>, lo &gt;&gt; <span class=\"code-number\">8</span>, lo);\n","                        <span class=\"code-keyword\">return</span> <span class=\"code-number\">10</span>;\n","                    }\n","                }\n","                <span class=\"code-keyword\">else</span> {\n","                    <span class=\"code-comment\">// timestamp 96</span>\n","                    hi = <span class=\"code-built_in\">Math</span>.floor(s / <span class=\"code-number\">0x100000000</span>);\n","                    lo = s &gt;&gt;&gt; <span class=\"code-number\">0</span>;\n","                    bytes.push(<span class=\"code-number\">0xc7</span>, <span class=\"code-number\">0x0c</span>, <span class=\"code-number\">0xff</span>, ns &gt;&gt; <span class=\"code-number\">24</span>, ns &gt;&gt; <span class=\"code-number\">16</span>, ns &gt;&gt; <span class=\"code-number\">8</span>, ns, hi &gt;&gt; <span class=\"code-number\">24</span>, hi &gt;&gt; <span class=\"code-number\">16</span>, hi &gt;&gt; <span class=\"code-number\">8</span>, hi, lo &gt;&gt; <span class=\"code-number\">24</span>, lo &gt;&gt; <span class=\"code-number\">16</span>, lo &gt;&gt; <span class=\"code-number\">8</span>, lo);\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-number\">15</span>;\n","                }\n","            }\n","            <span class=\"code-keyword\">if</span> (value <span class=\"code-keyword\">instanceof</span> <span class=\"code-built_in\">ArrayBuffer</span>) {\n","                length = value.byteLength;\n","                <span class=\"code-comment\">// bin 8</span>\n","                <span class=\"code-keyword\">if</span> (length &lt; <span class=\"code-number\">0x100</span>) {\n","                    bytes.push(<span class=\"code-number\">0xc4</span>, length);\n","                    size = <span class=\"code-number\">2</span>;\n","                }\n","                <span class=\"code-keyword\">else</span> \n","                <span class=\"code-comment\">// bin 16</span>\n","                <span class=\"code-keyword\">if</span> (length &lt; <span class=\"code-number\">0x10000</span>) {\n","                    bytes.push(<span class=\"code-number\">0xc5</span>, length &gt;&gt; <span class=\"code-number\">8</span>, length);\n","                    size = <span class=\"code-number\">3</span>;\n","                }\n","                <span class=\"code-keyword\">else</span> \n","                <span class=\"code-comment\">// bin 32</span>\n","                <span class=\"code-keyword\">if</span> (length &lt; <span class=\"code-number\">0x100000000</span>) {\n","                    bytes.push(<span class=\"code-number\">0xc6</span>, length &gt;&gt; <span class=\"code-number\">24</span>, length &gt;&gt; <span class=\"code-number\">16</span>, length &gt;&gt; <span class=\"code-number\">8</span>, length);\n","                    size = <span class=\"code-number\">5</span>;\n","                }\n","                <span class=\"code-keyword\">else</span> {\n","                    <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">'Buffer too large'</span>);\n","                }\n","                defers.push({ <span class=\"code-attr\">_bin</span>: value, <span class=\"code-attr\">_length</span>: length, <span class=\"code-attr\">_offset</span>: bytes.length });\n","                <span class=\"code-keyword\">return</span> size + length;\n","            }\n","            <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> value.toJSON === <span class=\"code-string\">'function'</span>) {\n","                <span class=\"code-keyword\">return</span> _encode(bytes, defers, value.toJSON());\n","            }\n","            <span class=\"code-keyword\">var</span> keys = [], key = <span class=\"code-string\">''</span>;\n","            <span class=\"code-keyword\">var</span> allKeys = <span class=\"code-built_in\">Object</span>.keys(value);\n","            <span class=\"code-keyword\">for</span> (i = <span class=\"code-number\">0</span>, l = allKeys.length; i &lt; l; i++) {\n","                key = allKeys[i];\n","                <span class=\"code-keyword\">if</span> (value[key] !== <span class=\"code-literal\">undefined</span> &amp;&amp; <span class=\"code-keyword\">typeof</span> value[key] !== <span class=\"code-string\">'function'</span>) {\n","                    keys.push(key);\n","                }\n","            }\n","            length = keys.length;\n","            <span class=\"code-comment\">// fixmap</span>\n","            <span class=\"code-keyword\">if</span> (length &lt; <span class=\"code-number\">0x10</span>) {\n","                bytes.push(length | <span class=\"code-number\">0x80</span>);\n","                size = <span class=\"code-number\">1</span>;\n","            }\n","            <span class=\"code-comment\">// map 16</span>\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (length &lt; <span class=\"code-number\">0x10000</span>) {\n","                bytes.push(<span class=\"code-number\">0xde</span>, length &gt;&gt; <span class=\"code-number\">8</span>, length);\n","                size = <span class=\"code-number\">3</span>;\n","            }\n","            <span class=\"code-comment\">// map 32</span>\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (length &lt; <span class=\"code-number\">0x100000000</span>) {\n","                bytes.push(<span class=\"code-number\">0xdf</span>, length &gt;&gt; <span class=\"code-number\">24</span>, length &gt;&gt; <span class=\"code-number\">16</span>, length &gt;&gt; <span class=\"code-number\">8</span>, length);\n","                size = <span class=\"code-number\">5</span>;\n","            }\n","            <span class=\"code-keyword\">else</span> {\n","                <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">'Object too large'</span>);\n","            }\n","            <span class=\"code-keyword\">for</span> (i = <span class=\"code-number\">0</span>; i &lt; length; i++) {\n","                key = keys[i];\n","                size += _encode(bytes, defers, key);\n","                size += _encode(bytes, defers, value[key]);\n","            }\n","            <span class=\"code-keyword\">return</span> size;\n","        }\n","        <span class=\"code-comment\">// false/true</span>\n","        <span class=\"code-keyword\">if</span> (type === <span class=\"code-string\">'boolean'</span>) {\n","            bytes.push(value ? <span class=\"code-number\">0xc3</span> : <span class=\"code-number\">0xc2</span>);\n","            <span class=\"code-keyword\">return</span> <span class=\"code-number\">1</span>;\n","        }\n","        <span class=\"code-keyword\">if</span> (type === <span class=\"code-string\">'undefined'</span>) {\n","            bytes.push(<span class=\"code-number\">0xc0</span>);\n","            <span class=\"code-keyword\">return</span> <span class=\"code-number\">1</span>;\n","        }\n","        <span class=\"code-comment\">// custom types like BigInt (typeof value === 'bigint')</span>\n","        <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> value.toJSON === <span class=\"code-string\">'function'</span>) {\n","            <span class=\"code-keyword\">return</span> _encode(bytes, defers, value.toJSON());\n","        }\n","        <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">'Could not encode'</span>);\n","    }\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">encode</span>(<span class=\"code-params\">value</span>) </span>{\n","        <span class=\"code-keyword\">var</span> bytes = [];\n","        <span class=\"code-keyword\">var</span> defers = [];\n","        <span class=\"code-keyword\">var</span> size = _encode(bytes, defers, value);\n","        <span class=\"code-keyword\">var</span> buf = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">ArrayBuffer</span>(size);\n","        <span class=\"code-keyword\">var</span> view = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">DataView</span>(buf);\n","        <span class=\"code-keyword\">var</span> deferIndex = <span class=\"code-number\">0</span>;\n","        <span class=\"code-keyword\">var</span> deferWritten = <span class=\"code-number\">0</span>;\n","        <span class=\"code-keyword\">var</span> nextOffset = <span class=\"code-number\">-1</span>;\n","        <span class=\"code-keyword\">if</span> (defers.length &gt; <span class=\"code-number\">0</span>) {\n","            nextOffset = defers[<span class=\"code-number\">0</span>]._offset;\n","        }\n","        <span class=\"code-keyword\">var</span> defer, deferLength = <span class=\"code-number\">0</span>, offset = <span class=\"code-number\">0</span>;\n","        <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> i = <span class=\"code-number\">0</span>, l = bytes.length; i &lt; l; i++) {\n","            view.setUint8(deferWritten + i, bytes[i]);\n","            <span class=\"code-keyword\">if</span> (i + <span class=\"code-number\">1</span> !== nextOffset) {\n","                <span class=\"code-keyword\">continue</span>;\n","            }\n","            defer = defers[deferIndex];\n","            deferLength = defer._length;\n","            offset = deferWritten + nextOffset;\n","            <span class=\"code-keyword\">if</span> (defer._bin) {\n","                <span class=\"code-keyword\">var</span> bin = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Uint8Array</span>(defer._bin);\n","                <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> j = <span class=\"code-number\">0</span>; j &lt; deferLength; j++) {\n","                    view.setUint8(offset + j, bin[j]);\n","                }\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (defer._str) {\n","                utf8Write(view, offset, defer._str);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (defer._float !== <span class=\"code-literal\">undefined</span>) {\n","                view.setFloat64(offset, defer._float);\n","            }\n","            deferIndex++;\n","            deferWritten += deferLength;\n","            <span class=\"code-keyword\">if</span> (defers[deferIndex]) {\n","                nextOffset = defers[deferIndex]._offset;\n","            }\n","        }\n","        <span class=\"code-keyword\">return</span> buf;\n","    }\n","\n","    <span class=\"code-keyword\">var</span> browser = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","      <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(\n","        <span class=\"code-string\">'ws does not work in the browser. Browser clients must use the native '</span> +\n","          <span class=\"code-string\">'WebSocket object'</span>\n","      );\n","    };\n","\n","    <span class=\"code-keyword\">var</span> WebSocket = globalThis.WebSocket || browser;\n","    <span class=\"code-keyword\">var</span> WebSocketTransport = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">WebSocketTransport</span>(<span class=\"code-params\">events</span>) </span>{\n","            <span class=\"code-keyword\">this</span>.events = events;\n","        }\n","        WebSocketTransport.prototype.send = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">data</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (data <span class=\"code-keyword\">instanceof</span> <span class=\"code-built_in\">ArrayBuffer</span>) {\n","                <span class=\"code-keyword\">this</span>.ws.send(data);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (<span class=\"code-built_in\">Array</span>.isArray(data)) {\n","                <span class=\"code-keyword\">this</span>.ws.send((<span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Uint8Array</span>(data)).buffer);\n","            }\n","        };\n","        WebSocketTransport.prototype.connect = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">url</span>) </span>{\n","            <span class=\"code-keyword\">this</span>.ws = <span class=\"code-keyword\">new</span> WebSocket(url, <span class=\"code-keyword\">this</span>.protocols);\n","            <span class=\"code-keyword\">this</span>.ws.binaryType = <span class=\"code-string\">'arraybuffer'</span>;\n","            <span class=\"code-keyword\">this</span>.ws.onopen = <span class=\"code-keyword\">this</span>.events.onopen;\n","            <span class=\"code-keyword\">this</span>.ws.onmessage = <span class=\"code-keyword\">this</span>.events.onmessage;\n","            <span class=\"code-keyword\">this</span>.ws.onclose = <span class=\"code-keyword\">this</span>.events.onclose;\n","            <span class=\"code-keyword\">this</span>.ws.onerror = <span class=\"code-keyword\">this</span>.events.onerror;\n","        };\n","        WebSocketTransport.prototype.close = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">code, reason</span>) </span>{\n","            <span class=\"code-keyword\">this</span>.ws.close(code, reason);\n","        };\n","        <span class=\"code-built_in\">Object</span>.defineProperty(WebSocketTransport.prototype, <span class=\"code-string\">\"isOpen\"</span>, {\n","            <span class=\"code-keyword\">get</span>: function () {\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.ws.readyState === WebSocket.OPEN;\n","            },\n","            enumerable: <span class=\"code-literal\">false</span>,\n","            configurable: <span class=\"code-literal\">true</span>\n","        });\n","        <span class=\"code-keyword\">return</span> WebSocketTransport;\n","    }());\n","\n","    <span class=\"code-keyword\">var</span> Connection = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">Connection</span>(<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-keyword\">this</span>.events = {};\n","            <span class=\"code-keyword\">this</span>.transport = <span class=\"code-keyword\">new</span> WebSocketTransport(<span class=\"code-keyword\">this</span>.events);\n","        }\n","        Connection.prototype.send = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">data</span>) </span>{\n","            <span class=\"code-keyword\">this</span>.transport.send(data);\n","        };\n","        Connection.prototype.connect = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">url</span>) </span>{\n","            <span class=\"code-keyword\">this</span>.transport.connect(url);\n","        };\n","        Connection.prototype.close = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">code, reason</span>) </span>{\n","            <span class=\"code-keyword\">this</span>.transport.close(code, reason);\n","        };\n","        <span class=\"code-built_in\">Object</span>.defineProperty(Connection.prototype, <span class=\"code-string\">\"isOpen\"</span>, {\n","            <span class=\"code-keyword\">get</span>: function () {\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.transport.isOpen;\n","            },\n","            enumerable: <span class=\"code-literal\">false</span>,\n","            configurable: <span class=\"code-literal\">true</span>\n","        });\n","        <span class=\"code-keyword\">return</span> Connection;\n","    }());\n","\n","    <span class=\"code-comment\">// Use codes between 0~127 for lesser throughput (1 byte)</span>\n","    exports.Protocol = <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>;\n","    (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">Protocol</span>) </span>{\n","        <span class=\"code-comment\">// Room-related (10~19)</span>\n","        Protocol[Protocol[<span class=\"code-string\">\"HANDSHAKE\"</span>] = <span class=\"code-number\">9</span>] = <span class=\"code-string\">\"HANDSHAKE\"</span>;\n","        Protocol[Protocol[<span class=\"code-string\">\"JOIN_ROOM\"</span>] = <span class=\"code-number\">10</span>] = <span class=\"code-string\">\"JOIN_ROOM\"</span>;\n","        Protocol[Protocol[<span class=\"code-string\">\"ERROR\"</span>] = <span class=\"code-number\">11</span>] = <span class=\"code-string\">\"ERROR\"</span>;\n","        Protocol[Protocol[<span class=\"code-string\">\"LEAVE_ROOM\"</span>] = <span class=\"code-number\">12</span>] = <span class=\"code-string\">\"LEAVE_ROOM\"</span>;\n","        Protocol[Protocol[<span class=\"code-string\">\"ROOM_DATA\"</span>] = <span class=\"code-number\">13</span>] = <span class=\"code-string\">\"ROOM_DATA\"</span>;\n","        Protocol[Protocol[<span class=\"code-string\">\"ROOM_STATE\"</span>] = <span class=\"code-number\">14</span>] = <span class=\"code-string\">\"ROOM_STATE\"</span>;\n","        Protocol[Protocol[<span class=\"code-string\">\"ROOM_STATE_PATCH\"</span>] = <span class=\"code-number\">15</span>] = <span class=\"code-string\">\"ROOM_STATE_PATCH\"</span>;\n","        Protocol[Protocol[<span class=\"code-string\">\"ROOM_DATA_SCHEMA\"</span>] = <span class=\"code-number\">16</span>] = <span class=\"code-string\">\"ROOM_DATA_SCHEMA\"</span>;\n","        Protocol[Protocol[<span class=\"code-string\">\"ROOM_DATA_BYTES\"</span>] = <span class=\"code-number\">17</span>] = <span class=\"code-string\">\"ROOM_DATA_BYTES\"</span>;\n","    })(exports.Protocol || (exports.Protocol = {}));\n","    exports.ErrorCode = <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>;\n","    (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">ErrorCode</span>) </span>{\n","        ErrorCode[ErrorCode[<span class=\"code-string\">\"MATCHMAKE_NO_HANDLER\"</span>] = <span class=\"code-number\">4210</span>] = <span class=\"code-string\">\"MATCHMAKE_NO_HANDLER\"</span>;\n","        ErrorCode[ErrorCode[<span class=\"code-string\">\"MATCHMAKE_INVALID_CRITERIA\"</span>] = <span class=\"code-number\">4211</span>] = <span class=\"code-string\">\"MATCHMAKE_INVALID_CRITERIA\"</span>;\n","        ErrorCode[ErrorCode[<span class=\"code-string\">\"MATCHMAKE_INVALID_ROOM_ID\"</span>] = <span class=\"code-number\">4212</span>] = <span class=\"code-string\">\"MATCHMAKE_INVALID_ROOM_ID\"</span>;\n","        ErrorCode[ErrorCode[<span class=\"code-string\">\"MATCHMAKE_UNHANDLED\"</span>] = <span class=\"code-number\">4213</span>] = <span class=\"code-string\">\"MATCHMAKE_UNHANDLED\"</span>;\n","        ErrorCode[ErrorCode[<span class=\"code-string\">\"MATCHMAKE_EXPIRED\"</span>] = <span class=\"code-number\">4214</span>] = <span class=\"code-string\">\"MATCHMAKE_EXPIRED\"</span>;\n","        ErrorCode[ErrorCode[<span class=\"code-string\">\"AUTH_FAILED\"</span>] = <span class=\"code-number\">4215</span>] = <span class=\"code-string\">\"AUTH_FAILED\"</span>;\n","        ErrorCode[ErrorCode[<span class=\"code-string\">\"APPLICATION_ERROR\"</span>] = <span class=\"code-number\">4216</span>] = <span class=\"code-string\">\"APPLICATION_ERROR\"</span>;\n","    })(exports.ErrorCode || (exports.ErrorCode = {}));\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">utf8Read</span>(<span class=\"code-params\">view, offset</span>) </span>{\n","        <span class=\"code-keyword\">var</span> length = view[offset++];\n","        <span class=\"code-keyword\">var</span> string = <span class=\"code-string\">''</span>, chr = <span class=\"code-number\">0</span>;\n","        <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> i = offset, end = offset + length; i &lt; end; i++) {\n","            <span class=\"code-keyword\">var</span> byte = view[i];\n","            <span class=\"code-keyword\">if</span> ((byte &amp; <span class=\"code-number\">0x80</span>) === <span class=\"code-number\">0x00</span>) {\n","                string += <span class=\"code-built_in\">String</span>.fromCharCode(byte);\n","                <span class=\"code-keyword\">continue</span>;\n","            }\n","            <span class=\"code-keyword\">if</span> ((byte &amp; <span class=\"code-number\">0xe0</span>) === <span class=\"code-number\">0xc0</span>) {\n","                string += <span class=\"code-built_in\">String</span>.fromCharCode(((byte &amp; <span class=\"code-number\">0x1f</span>) &lt;&lt; <span class=\"code-number\">6</span>) |\n","                    (view[++i] &amp; <span class=\"code-number\">0x3f</span>));\n","                <span class=\"code-keyword\">continue</span>;\n","            }\n","            <span class=\"code-keyword\">if</span> ((byte &amp; <span class=\"code-number\">0xf0</span>) === <span class=\"code-number\">0xe0</span>) {\n","                string += <span class=\"code-built_in\">String</span>.fromCharCode(((byte &amp; <span class=\"code-number\">0x0f</span>) &lt;&lt; <span class=\"code-number\">12</span>) |\n","                    ((view[++i] &amp; <span class=\"code-number\">0x3f</span>) &lt;&lt; <span class=\"code-number\">6</span>) |\n","                    ((view[++i] &amp; <span class=\"code-number\">0x3f</span>) &lt;&lt; <span class=\"code-number\">0</span>));\n","                <span class=\"code-keyword\">continue</span>;\n","            }\n","            <span class=\"code-keyword\">if</span> ((byte &amp; <span class=\"code-number\">0xf8</span>) === <span class=\"code-number\">0xf0</span>) {\n","                chr = ((byte &amp; <span class=\"code-number\">0x07</span>) &lt;&lt; <span class=\"code-number\">18</span>) |\n","                    ((view[++i] &amp; <span class=\"code-number\">0x3f</span>) &lt;&lt; <span class=\"code-number\">12</span>) |\n","                    ((view[++i] &amp; <span class=\"code-number\">0x3f</span>) &lt;&lt; <span class=\"code-number\">6</span>) |\n","                    ((view[++i] &amp; <span class=\"code-number\">0x3f</span>) &lt;&lt; <span class=\"code-number\">0</span>);\n","                <span class=\"code-keyword\">if</span> (chr &gt;= <span class=\"code-number\">0x010000</span>) { <span class=\"code-comment\">// surrogate pair</span>\n","                    chr -= <span class=\"code-number\">0x010000</span>;\n","                    string += <span class=\"code-built_in\">String</span>.fromCharCode((chr &gt;&gt;&gt; <span class=\"code-number\">10</span>) + <span class=\"code-number\">0xD800</span>, (chr &amp; <span class=\"code-number\">0x3FF</span>) + <span class=\"code-number\">0xDC00</span>);\n","                }\n","                <span class=\"code-keyword\">else</span> {\n","                    string += <span class=\"code-built_in\">String</span>.fromCharCode(chr);\n","                }\n","                <span class=\"code-keyword\">continue</span>;\n","            }\n","            <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">'Invalid byte '</span> + byte.toString(<span class=\"code-number\">16</span>));\n","        }\n","        <span class=\"code-keyword\">return</span> string;\n","    }\n","    <span class=\"code-comment\">// Faster for short strings than Buffer.byteLength</span>\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">utf8Length</span>(<span class=\"code-params\">str</span>) </span>{\n","        <span class=\"code-keyword\">if</span> (str === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { str = <span class=\"code-string\">''</span>; }\n","        <span class=\"code-keyword\">var</span> c = <span class=\"code-number\">0</span>;\n","        <span class=\"code-keyword\">var</span> length = <span class=\"code-number\">0</span>;\n","        <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> i = <span class=\"code-number\">0</span>, l = str.length; i &lt; l; i++) {\n","            c = str.charCodeAt(i);\n","            <span class=\"code-keyword\">if</span> (c &lt; <span class=\"code-number\">0x80</span>) {\n","                length += <span class=\"code-number\">1</span>;\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (c &lt; <span class=\"code-number\">0x800</span>) {\n","                length += <span class=\"code-number\">2</span>;\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (c &lt; <span class=\"code-number\">0xd800</span> || c &gt;= <span class=\"code-number\">0xe000</span>) {\n","                length += <span class=\"code-number\">3</span>;\n","            }\n","            <span class=\"code-keyword\">else</span> {\n","                i++;\n","                length += <span class=\"code-number\">4</span>;\n","            }\n","        }\n","        <span class=\"code-keyword\">return</span> length + <span class=\"code-number\">1</span>;\n","    }\n","\n","    <span class=\"code-keyword\">var</span> serializers = {};\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">registerSerializer</span>(<span class=\"code-params\">id, serializer</span>) </span>{\n","        serializers[id] = serializer;\n","    }\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">getSerializer</span>(<span class=\"code-params\">id</span>) </span>{\n","        <span class=\"code-keyword\">var</span> serializer = serializers[id];\n","        <span class=\"code-keyword\">if</span> (!serializer) {\n","            <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">\"missing serializer: \"</span> + id);\n","        }\n","        <span class=\"code-keyword\">return</span> serializer;\n","    }\n","\n","    <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">     * The MIT License (MIT)\n</span>","<span class=\"code-comment\">     *\n</span>","<span class=\"code-comment\">     * Copyright 2016 Andrey Sitnik &lt;andrey@sitnik.ru&gt;\n</span>","<span class=\"code-comment\">     *\n</span>","<span class=\"code-comment\">     * Permission is hereby granted, free of charge, to any person obtaining a copy of\n</span>","<span class=\"code-comment\">     * this software and associated documentation files (the \"Software\"), to deal in\n</span>","<span class=\"code-comment\">     * the Software without restriction, including without limitation the rights to\n</span>","<span class=\"code-comment\">     * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of\n</span>","<span class=\"code-comment\">     * the Software, and to permit persons to whom the Software is furnished to do so,\n</span>","<span class=\"code-comment\">     * subject to the following conditions:\n</span>","<span class=\"code-comment\">     *\n</span>","<span class=\"code-comment\">     * The above copyright notice and this permission notice shall be included in all\n</span>","<span class=\"code-comment\">     * copies or substantial portions of the Software.\n</span>","<span class=\"code-comment\">     *\n</span>","<span class=\"code-comment\">     * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n</span>","<span class=\"code-comment\">     * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\n</span>","<span class=\"code-comment\">     * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n</span>","<span class=\"code-comment\">     * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\n</span>","<span class=\"code-comment\">     * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\n</span>","<span class=\"code-comment\">     * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n</span>","<span class=\"code-comment\">     */</span>\n","    <span class=\"code-keyword\">var</span> createNanoEvents = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{ <span class=\"code-keyword\">return</span> ({\n","        emit: <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">event</span>) </span>{\n","            <span class=\"code-keyword\">var</span> args = [];\n","            <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> _i = <span class=\"code-number\">1</span>; _i &lt; <span class=\"code-built_in\">arguments</span>.length; _i++) {\n","                args[_i - <span class=\"code-number\">1</span>] = <span class=\"code-built_in\">arguments</span>[_i];\n","            }\n","            <span class=\"code-keyword\">var</span> callbacks = <span class=\"code-keyword\">this</span>.events[event] || [];\n","            <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> i = <span class=\"code-number\">0</span>, length_1 = callbacks.length; i &lt; length_1; i++) {\n","                callbacks[i].apply(callbacks, args);\n","            }\n","        },\n","        events: {},\n","        on: <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">event, cb</span>) </span>{\n","            <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","            <span class=\"code-keyword\">var</span> _a;\n","            ((_a = <span class=\"code-keyword\">this</span>.events[event]) === <span class=\"code-literal\">null</span> || _a === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _a.push(cb)) || (<span class=\"code-keyword\">this</span>.events[event] = [cb]);\n","            <span class=\"code-keyword\">return</span> <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> _a;\n","                _this.events[event] = (_a = _this.events[event]) === <span class=\"code-literal\">null</span> || _a === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _a.filter(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">i</span>) </span>{ <span class=\"code-keyword\">return</span> cb !== i; });\n","            };\n","        }\n","    }); };\n","\n","    <span class=\"code-keyword\">var</span> EventEmitter = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">EventEmitter</span>(<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-keyword\">this</span>.handlers = [];\n","        }\n","        EventEmitter.prototype.register = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">cb, once</span>) </span>{\n","            <span class=\"code-keyword\">this</span>.handlers.push(cb);\n","            <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>;\n","        };\n","        EventEmitter.prototype.invoke = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","            <span class=\"code-keyword\">var</span> args = [];\n","            <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> _i = <span class=\"code-number\">0</span>; _i &lt; <span class=\"code-built_in\">arguments</span>.length; _i++) {\n","                args[_i] = <span class=\"code-built_in\">arguments</span>[_i];\n","            }\n","            <span class=\"code-keyword\">this</span>.handlers.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">handler</span>) </span>{ <span class=\"code-keyword\">return</span> handler.apply(_this, args); });\n","        };\n","        EventEmitter.prototype.invokeAsync = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","            <span class=\"code-keyword\">var</span> args = [];\n","            <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> _i = <span class=\"code-number\">0</span>; _i &lt; <span class=\"code-built_in\">arguments</span>.length; _i++) {\n","                args[_i] = <span class=\"code-built_in\">arguments</span>[_i];\n","            }\n","            <span class=\"code-keyword\">return</span> <span class=\"code-built_in\">Promise</span>.all(<span class=\"code-keyword\">this</span>.handlers.map(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">handler</span>) </span>{ <span class=\"code-keyword\">return</span> handler.apply(_this, args); }));\n","        };\n","        EventEmitter.prototype.remove = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">cb</span>) </span>{\n","            <span class=\"code-keyword\">var</span> index = <span class=\"code-keyword\">this</span>.handlers.indexOf(cb);\n","            <span class=\"code-keyword\">this</span>.handlers[index] = <span class=\"code-keyword\">this</span>.handlers[<span class=\"code-keyword\">this</span>.handlers.length - <span class=\"code-number\">1</span>];\n","            <span class=\"code-keyword\">this</span>.handlers.pop();\n","        };\n","        EventEmitter.prototype.clear = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-keyword\">this</span>.handlers = [];\n","        };\n","        <span class=\"code-keyword\">return</span> EventEmitter;\n","    }());\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">createSignal</span>(<span class=\"code-params\"></span>) </span>{\n","        <span class=\"code-keyword\">var</span> emitter = <span class=\"code-keyword\">new</span> EventEmitter();\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">register</span>(<span class=\"code-params\">cb</span>) </span>{\n","            <span class=\"code-keyword\">return</span> emitter.register(cb, <span class=\"code-keyword\">this</span> === <span class=\"code-literal\">null</span>);\n","        }\n","        register.once = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">cb</span>) </span>{\n","            <span class=\"code-keyword\">var</span> callback = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> args = [];\n","                <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> _i = <span class=\"code-number\">0</span>; _i &lt; <span class=\"code-built_in\">arguments</span>.length; _i++) {\n","                    args[_i] = <span class=\"code-built_in\">arguments</span>[_i];\n","                }\n","                cb.apply(<span class=\"code-keyword\">this</span>, args);\n","                emitter.remove(callback);\n","            };\n","            emitter.register(callback);\n","        };\n","        register.remove = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">cb</span>) </span>{ <span class=\"code-keyword\">return</span> emitter.remove(cb); };\n","        register.invoke = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-keyword\">var</span> args = [];\n","            <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> _i = <span class=\"code-number\">0</span>; _i &lt; <span class=\"code-built_in\">arguments</span>.length; _i++) {\n","                args[_i] = <span class=\"code-built_in\">arguments</span>[_i];\n","            }\n","            <span class=\"code-keyword\">return</span> emitter.invoke.apply(emitter, args);\n","        };\n","        register.invokeAsync = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-keyword\">var</span> args = [];\n","            <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> _i = <span class=\"code-number\">0</span>; _i &lt; <span class=\"code-built_in\">arguments</span>.length; _i++) {\n","                args[_i] = <span class=\"code-built_in\">arguments</span>[_i];\n","            }\n","            <span class=\"code-keyword\">return</span> emitter.invokeAsync.apply(emitter, args);\n","        };\n","        register.clear = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{ <span class=\"code-keyword\">return</span> emitter.clear(); };\n","        <span class=\"code-keyword\">return</span> register;\n","    }\n","\n","    <span class=\"code-keyword\">var</span> commonjsGlobal = <span class=\"code-keyword\">typeof</span> globalThis !== <span class=\"code-string\">'undefined'</span> ? globalThis : <span class=\"code-keyword\">typeof</span> <span class=\"code-built_in\">window</span> !== <span class=\"code-string\">'undefined'</span> ? <span class=\"code-built_in\">window</span> : <span class=\"code-keyword\">typeof</span> global !== <span class=\"code-string\">'undefined'</span> ? global : <span class=\"code-keyword\">typeof</span> self !== <span class=\"code-string\">'undefined'</span> ? self : {};\n","\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">createCommonjsModule</span>(<span class=\"code-params\">fn</span>) </span>{\n","      <span class=\"code-keyword\">var</span> <span class=\"code-built_in\">module</span> = { <span class=\"code-attr\">exports</span>: {} };\n","    \t<span class=\"code-keyword\">return</span> fn(<span class=\"code-built_in\">module</span>, <span class=\"code-built_in\">module</span>.exports), <span class=\"code-built_in\">module</span>.exports;\n","    }\n","\n","    <span class=\"code-keyword\">var</span> umd = createCommonjsModule(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">module, exports</span>) </span>{\n","    (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">global, factory</span>) </span>{\n","        factory(exports) ;\n","    })(commonjsGlobal, (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">exports</span>) </span>{\n","        <span class=\"code-comment\">/******************************************************************************\r\n</span>","<span class=\"code-comment\">        Copyright (c) Microsoft Corporation.\r\n</span>","<span class=\"code-comment\">\r\n</span>","<span class=\"code-comment\">        Permission to use, copy, modify, and/or distribute this software for any\r\n</span>","<span class=\"code-comment\">        purpose with or without fee is hereby granted.\r\n</span>","<span class=\"code-comment\">\r\n</span>","<span class=\"code-comment\">        THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\n</span>","<span class=\"code-comment\">        REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\n</span>","<span class=\"code-comment\">        AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\n</span>","<span class=\"code-comment\">        INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\n</span>","<span class=\"code-comment\">        LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\n</span>","<span class=\"code-comment\">        OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\n</span>","<span class=\"code-comment\">        PERFORMANCE OF THIS SOFTWARE.\r\n</span>","<span class=\"code-comment\">        ***************************************************************************** */</span>\r\n","        <span class=\"code-comment\">/* global Reflect, Promise */</span>\r\n","\r\n","        <span class=\"code-keyword\">var</span> extendStatics = <span class=\"code-function\"><span class=\"code-keyword\">function</span>(<span class=\"code-params\">d, b</span>) </span>{\r\n","            extendStatics = <span class=\"code-built_in\">Object</span>.setPrototypeOf ||\r\n","                ({ <span class=\"code-attr\">__proto__</span>: [] } <span class=\"code-keyword\">instanceof</span> <span class=\"code-built_in\">Array</span> &amp;&amp; <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">d, b</span>) </span>{ d.__proto__ = b; }) ||\r\n","                <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">d, b</span>) </span>{ <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> p <span class=\"code-keyword\">in</span> b) <span class=\"code-keyword\">if</span> (<span class=\"code-built_in\">Object</span>.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n","            <span class=\"code-keyword\">return</span> extendStatics(d, b);\r\n","        };\r\n","\r\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">__extends</span>(<span class=\"code-params\">d, b</span>) </span>{\r\n","            <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> b !== <span class=\"code-string\">\"function\"</span> &amp;&amp; b !== <span class=\"code-literal\">null</span>)\r\n","                <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">TypeError</span>(<span class=\"code-string\">\"Class extends value \"</span> + <span class=\"code-built_in\">String</span>(b) + <span class=\"code-string\">\" is not a constructor or null\"</span>);\r\n","            extendStatics(d, b);\r\n","            <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">__</span>(<span class=\"code-params\"></span>) </span>{ <span class=\"code-keyword\">this</span>.constructor = d; }\r\n","            d.prototype = b === <span class=\"code-literal\">null</span> ? <span class=\"code-built_in\">Object</span>.create(b) : (__.prototype = b.prototype, <span class=\"code-keyword\">new</span> __());\r\n","        }\r\n","\r\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">__decorate</span>(<span class=\"code-params\">decorators, target, key, desc</span>) </span>{\r\n","            <span class=\"code-keyword\">var</span> c = <span class=\"code-built_in\">arguments</span>.length, r = c &lt; <span class=\"code-number\">3</span> ? target : desc === <span class=\"code-literal\">null</span> ? desc = <span class=\"code-built_in\">Object</span>.getOwnPropertyDescriptor(target, key) : desc, d;\r\n","            <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> <span class=\"code-built_in\">Reflect</span> === <span class=\"code-string\">\"object\"</span> &amp;&amp; <span class=\"code-keyword\">typeof</span> <span class=\"code-built_in\">Reflect</span>.decorate === <span class=\"code-string\">\"function\"</span>) r = <span class=\"code-built_in\">Reflect</span>.decorate(decorators, target, key, desc);\r\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> i = decorators.length - <span class=\"code-number\">1</span>; i &gt;= <span class=\"code-number\">0</span>; i--) <span class=\"code-keyword\">if</span> (d = decorators[i]) r = (c &lt; <span class=\"code-number\">3</span> ? d(r) : c &gt; <span class=\"code-number\">3</span> ? d(target, key, r) : d(target, key)) || r;\r\n","            <span class=\"code-keyword\">return</span> c &gt; <span class=\"code-number\">3</span> &amp;&amp; r &amp;&amp; <span class=\"code-built_in\">Object</span>.defineProperty(target, key, r), r;\r\n","        }\r\n","\r\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">__spreadArray</span>(<span class=\"code-params\">to, from, pack</span>) </span>{\r\n","            <span class=\"code-keyword\">if</span> (pack || <span class=\"code-built_in\">arguments</span>.length === <span class=\"code-number\">2</span>) <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> i = <span class=\"code-number\">0</span>, l = <span class=\"code-keyword\">from</span>.length, ar; i &lt; l; i++) {\r\n","                <span class=\"code-keyword\">if</span> (ar || !(i <span class=\"code-keyword\">in</span> <span class=\"code-keyword\">from</span>)) {\r\n","                    <span class=\"code-keyword\">if</span> (!ar) ar = <span class=\"code-built_in\">Array</span>.prototype.slice.call(<span class=\"code-keyword\">from</span>, <span class=\"code-number\">0</span>, i);\r\n","                    ar[i] = <span class=\"code-keyword\">from</span>[i];\r\n","                }\r\n","            }\r\n","            <span class=\"code-keyword\">return</span> to.concat(ar || <span class=\"code-built_in\">Array</span>.prototype.slice.call(<span class=\"code-keyword\">from</span>));\r\n","        }\n","\n","        <span class=\"code-comment\">// export const SWITCH_TO_STRUCTURE = 193; (easily collides with DELETE_AND_ADD + fieldIndex = 2)</span>\n","        <span class=\"code-keyword\">var</span> SWITCH_TO_STRUCTURE = <span class=\"code-number\">255</span>; <span class=\"code-comment\">// (decoding collides with DELETE_AND_ADD + fieldIndex = 63)</span>\n","        <span class=\"code-keyword\">var</span> TYPE_ID = <span class=\"code-number\">213</span>;\n","        <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">         * Encoding Schema field operations.\n</span>","<span class=\"code-comment\">         */</span>\n","        exports.OPERATION = <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>;\n","        (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">OPERATION</span>) </span>{\n","            <span class=\"code-comment\">// add new structure/primitive</span>\n","            OPERATION[OPERATION[<span class=\"code-string\">\"ADD\"</span>] = <span class=\"code-number\">128</span>] = <span class=\"code-string\">\"ADD\"</span>;\n","            <span class=\"code-comment\">// replace structure/primitive</span>\n","            OPERATION[OPERATION[<span class=\"code-string\">\"REPLACE\"</span>] = <span class=\"code-number\">0</span>] = <span class=\"code-string\">\"REPLACE\"</span>;\n","            <span class=\"code-comment\">// delete field</span>\n","            OPERATION[OPERATION[<span class=\"code-string\">\"DELETE\"</span>] = <span class=\"code-number\">64</span>] = <span class=\"code-string\">\"DELETE\"</span>;\n","            <span class=\"code-comment\">// DELETE field, followed by an ADD</span>\n","            OPERATION[OPERATION[<span class=\"code-string\">\"DELETE_AND_ADD\"</span>] = <span class=\"code-number\">192</span>] = <span class=\"code-string\">\"DELETE_AND_ADD\"</span>;\n","            <span class=\"code-comment\">// TOUCH is used to determine hierarchy of nested Schema structures during serialization.</span>\n","            <span class=\"code-comment\">// touches are NOT encoded.</span>\n","            OPERATION[OPERATION[<span class=\"code-string\">\"TOUCH\"</span>] = <span class=\"code-number\">1</span>] = <span class=\"code-string\">\"TOUCH\"</span>;\n","            <span class=\"code-comment\">// MapSchema Operations</span>\n","            OPERATION[OPERATION[<span class=\"code-string\">\"CLEAR\"</span>] = <span class=\"code-number\">10</span>] = <span class=\"code-string\">\"CLEAR\"</span>;\n","        })(exports.OPERATION || (exports.OPERATION = {}));\n","        <span class=\"code-comment\">// export enum OPERATION {</span>\n","        <span class=\"code-comment\">//     // add new structure/primitive</span>\n","        <span class=\"code-comment\">//     // (128)</span>\n","        <span class=\"code-comment\">//     ADD = 128, // 10000000,</span>\n","        <span class=\"code-comment\">//     // replace structure/primitive</span>\n","        <span class=\"code-comment\">//     REPLACE = 1,// 00000001</span>\n","        <span class=\"code-comment\">//     // delete field</span>\n","        <span class=\"code-comment\">//     DELETE = 192, // 11000000</span>\n","        <span class=\"code-comment\">//     // DELETE field, followed by an ADD</span>\n","        <span class=\"code-comment\">//     DELETE_AND_ADD = 224, // 11100000</span>\n","        <span class=\"code-comment\">//     // TOUCH is used to determine hierarchy of nested Schema structures during serialization.</span>\n","        <span class=\"code-comment\">//     // touches are NOT encoded.</span>\n","        <span class=\"code-comment\">//     TOUCH = 0, // 00000000</span>\n","        <span class=\"code-comment\">//     // MapSchema Operations</span>\n","        <span class=\"code-comment\">//     CLEAR = 10,</span>\n","        <span class=\"code-comment\">// }</span>\n","\n","        <span class=\"code-keyword\">var</span> ChangeTree = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">ChangeTree</span>(<span class=\"code-params\">ref, parent, root</span>) </span>{\n","                <span class=\"code-keyword\">this</span>.changed = <span class=\"code-literal\">false</span>;\n","                <span class=\"code-keyword\">this</span>.changes = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Map</span>();\n","                <span class=\"code-keyword\">this</span>.allChanges = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Set</span>();\n","                <span class=\"code-comment\">// cached indexes for filtering</span>\n","                <span class=\"code-keyword\">this</span>.caches = {};\n","                <span class=\"code-keyword\">this</span>.currentCustomOperation = <span class=\"code-number\">0</span>;\n","                <span class=\"code-keyword\">this</span>.ref = ref;\n","                <span class=\"code-keyword\">this</span>.setParent(parent, root);\n","            }\n","            ChangeTree.prototype.setParent = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">parent, root, parentIndex</span>) </span>{\n","                <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","                <span class=\"code-keyword\">if</span> (!<span class=\"code-keyword\">this</span>.indexes) {\n","                    <span class=\"code-keyword\">this</span>.indexes = (<span class=\"code-keyword\">this</span>.ref <span class=\"code-keyword\">instanceof</span> Schema)\n","                        ? <span class=\"code-keyword\">this</span>.ref[<span class=\"code-string\">'_definition'</span>].indexes\n","                        : {};\n","                }\n","                <span class=\"code-keyword\">this</span>.parent = parent;\n","                <span class=\"code-keyword\">this</span>.parentIndex = parentIndex;\n","                <span class=\"code-comment\">// avoid setting parents with empty `root`</span>\n","                <span class=\"code-keyword\">if</span> (!root) {\n","                    <span class=\"code-keyword\">return</span>;\n","                }\n","                <span class=\"code-keyword\">this</span>.root = root;\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-comment\">// assign same parent on child structures</span>\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">this</span>.ref <span class=\"code-keyword\">instanceof</span> Schema) {\n","                    <span class=\"code-keyword\">var</span> definition = <span class=\"code-keyword\">this</span>.ref[<span class=\"code-string\">'_definition'</span>];\n","                    <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> field <span class=\"code-keyword\">in</span> definition.schema) {\n","                        <span class=\"code-keyword\">var</span> value = <span class=\"code-keyword\">this</span>.ref[field];\n","                        <span class=\"code-keyword\">if</span> (value &amp;&amp; value[<span class=\"code-string\">'$changes'</span>]) {\n","                            <span class=\"code-keyword\">var</span> parentIndex_1 = definition.indexes[field];\n","                            value[<span class=\"code-string\">'$changes'</span>].setParent(<span class=\"code-keyword\">this</span>.ref, root, parentIndex_1);\n","                        }\n","                    }\n","                }\n","                <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (<span class=\"code-keyword\">this</span>.ref) === <span class=\"code-string\">\"object\"</span>) {\n","                    <span class=\"code-keyword\">this</span>.ref.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">value, key</span>) </span>{\n","                        <span class=\"code-keyword\">if</span> (value <span class=\"code-keyword\">instanceof</span> Schema) {\n","                            <span class=\"code-keyword\">var</span> changeTreee = value[<span class=\"code-string\">'$changes'</span>];\n","                            <span class=\"code-keyword\">var</span> parentIndex_2 = _this.ref[<span class=\"code-string\">'$changes'</span>].indexes[key];\n","                            changeTreee.setParent(_this.ref, _this.root, parentIndex_2);\n","                        }\n","                    });\n","                }\n","            };\n","            ChangeTree.prototype.operation = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">op</span>) </span>{\n","                <span class=\"code-keyword\">this</span>.changes.set(--<span class=\"code-keyword\">this</span>.currentCustomOperation, op);\n","            };\n","            ChangeTree.prototype.change = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">fieldName, operation</span>) </span>{\n","                <span class=\"code-keyword\">if</span> (operation === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { operation = exports.OPERATION.ADD; }\n","                <span class=\"code-keyword\">var</span> index = (<span class=\"code-keyword\">typeof</span> (fieldName) === <span class=\"code-string\">\"number\"</span>)\n","                    ? fieldName\n","                    : <span class=\"code-keyword\">this</span>.indexes[fieldName];\n","                <span class=\"code-keyword\">this</span>.assertValidIndex(index, fieldName);\n","                <span class=\"code-keyword\">var</span> previousChange = <span class=\"code-keyword\">this</span>.changes.get(index);\n","                <span class=\"code-keyword\">if</span> (!previousChange ||\n","                    previousChange.op === exports.OPERATION.DELETE ||\n","                    previousChange.op === exports.OPERATION.TOUCH <span class=\"code-comment\">// (mazmorra.io's BattleAction issue)</span>\n","                ) {\n","                    <span class=\"code-keyword\">this</span>.changes.set(index, {\n","                        op: (!previousChange)\n","                            ? operation\n","                            : (previousChange.op === exports.OPERATION.DELETE)\n","                                ? exports.OPERATION.DELETE_AND_ADD\n","                                : operation,\n","                        <span class=\"code-comment\">// : OPERATION.REPLACE,</span>\n","                        index: index\n","                    });\n","                }\n","                <span class=\"code-keyword\">this</span>.allChanges.add(index);\n","                <span class=\"code-keyword\">this</span>.changed = <span class=\"code-literal\">true</span>;\n","                <span class=\"code-keyword\">this</span>.touchParents();\n","            };\n","            ChangeTree.prototype.touch = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">fieldName</span>) </span>{\n","                <span class=\"code-keyword\">var</span> index = (<span class=\"code-keyword\">typeof</span> (fieldName) === <span class=\"code-string\">\"number\"</span>)\n","                    ? fieldName\n","                    : <span class=\"code-keyword\">this</span>.indexes[fieldName];\n","                <span class=\"code-keyword\">this</span>.assertValidIndex(index, fieldName);\n","                <span class=\"code-keyword\">if</span> (!<span class=\"code-keyword\">this</span>.changes.has(index)) {\n","                    <span class=\"code-keyword\">this</span>.changes.set(index, { <span class=\"code-attr\">op</span>: exports.OPERATION.TOUCH, <span class=\"code-attr\">index</span>: index });\n","                }\n","                <span class=\"code-keyword\">this</span>.allChanges.add(index);\n","                <span class=\"code-comment\">// ensure touch is placed until the $root is found.</span>\n","                <span class=\"code-keyword\">this</span>.touchParents();\n","            };\n","            ChangeTree.prototype.touchParents = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">this</span>.parent) {\n","                    <span class=\"code-keyword\">this</span>.parent[<span class=\"code-string\">'$changes'</span>].touch(<span class=\"code-keyword\">this</span>.parentIndex);\n","                }\n","            };\n","            ChangeTree.prototype.getType = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index</span>) </span>{\n","                <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">this</span>.ref[<span class=\"code-string\">'_definition'</span>]) {\n","                    <span class=\"code-keyword\">var</span> definition = <span class=\"code-keyword\">this</span>.ref[<span class=\"code-string\">'_definition'</span>];\n","                    <span class=\"code-keyword\">return</span> definition.schema[definition.fieldsByIndex[index]];\n","                }\n","                <span class=\"code-keyword\">else</span> {\n","                    <span class=\"code-keyword\">var</span> definition = <span class=\"code-keyword\">this</span>.parent[<span class=\"code-string\">'_definition'</span>];\n","                    <span class=\"code-keyword\">var</span> parentType = definition.schema[definition.fieldsByIndex[<span class=\"code-keyword\">this</span>.parentIndex]];\n","                    <span class=\"code-comment\">//</span>\n","                    <span class=\"code-comment\">// Get the child type from parent structure.</span>\n","                    <span class=\"code-comment\">// - [\"string\"] =&gt; \"string\"</span>\n","                    <span class=\"code-comment\">// - { map: \"string\" } =&gt; \"string\"</span>\n","                    <span class=\"code-comment\">// - { set: \"string\" } =&gt; \"string\"</span>\n","                    <span class=\"code-comment\">//</span>\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-built_in\">Object</span>.values(parentType)[<span class=\"code-number\">0</span>];\n","                }\n","            };\n","            ChangeTree.prototype.getChildrenFilter = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> childFilters = <span class=\"code-keyword\">this</span>.parent[<span class=\"code-string\">'_definition'</span>].childFilters;\n","                <span class=\"code-keyword\">return</span> childFilters &amp;&amp; childFilters[<span class=\"code-keyword\">this</span>.parentIndex];\n","            };\n","            <span class=\"code-comment\">//</span>\n","            <span class=\"code-comment\">// used during `.encode()`</span>\n","            <span class=\"code-comment\">//</span>\n","            ChangeTree.prototype.getValue = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.ref[<span class=\"code-string\">'getByIndex'</span>](index);\n","            };\n","            ChangeTree.prototype.delete = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">fieldName</span>) </span>{\n","                <span class=\"code-keyword\">var</span> index = (<span class=\"code-keyword\">typeof</span> (fieldName) === <span class=\"code-string\">\"number\"</span>)\n","                    ? fieldName\n","                    : <span class=\"code-keyword\">this</span>.indexes[fieldName];\n","                <span class=\"code-keyword\">if</span> (index === <span class=\"code-literal\">undefined</span>) {\n","                    <span class=\"code-built_in\">console</span>.warn(<span class=\"code-string\">\"@colyseus/schema \"</span>.concat(<span class=\"code-keyword\">this</span>.ref.constructor.name, <span class=\"code-string\">\": trying to delete non-existing index: \"</span>).concat(fieldName, <span class=\"code-string\">\" (\"</span>).concat(index, <span class=\"code-string\">\")\"</span>));\n","                    <span class=\"code-keyword\">return</span>;\n","                }\n","                <span class=\"code-keyword\">var</span> previousValue = <span class=\"code-keyword\">this</span>.getValue(index);\n","                <span class=\"code-comment\">// console.log(\"$changes.delete =&gt;\", { fieldName, index, previousValue });</span>\n","                <span class=\"code-keyword\">this</span>.changes.set(index, { <span class=\"code-attr\">op</span>: exports.OPERATION.DELETE, <span class=\"code-attr\">index</span>: index });\n","                <span class=\"code-keyword\">this</span>.allChanges.delete(index);\n","                <span class=\"code-comment\">// delete cache</span>\n","                <span class=\"code-keyword\">delete</span> <span class=\"code-keyword\">this</span>.caches[index];\n","                <span class=\"code-comment\">// remove `root` reference</span>\n","                <span class=\"code-keyword\">if</span> (previousValue &amp;&amp; previousValue[<span class=\"code-string\">'$changes'</span>]) {\n","                    previousValue[<span class=\"code-string\">'$changes'</span>].parent = <span class=\"code-literal\">undefined</span>;\n","                }\n","                <span class=\"code-keyword\">this</span>.changed = <span class=\"code-literal\">true</span>;\n","                <span class=\"code-keyword\">this</span>.touchParents();\n","            };\n","            ChangeTree.prototype.discard = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">changed, discardAll</span>) </span>{\n","                <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","                <span class=\"code-keyword\">if</span> (changed === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { changed = <span class=\"code-literal\">false</span>; }\n","                <span class=\"code-keyword\">if</span> (discardAll === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { discardAll = <span class=\"code-literal\">false</span>; }\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-comment\">// Map, Array, etc:</span>\n","                <span class=\"code-comment\">// Remove cached key to ensure ADD operations is unsed instead of</span>\n","                <span class=\"code-comment\">// REPLACE in case same key is used on next patches.</span>\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-comment\">// <span class=\"code-doctag\">TODO:</span> refactor this. this is not relevant for Collection and Set.</span>\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-keyword\">if</span> (!(<span class=\"code-keyword\">this</span>.ref <span class=\"code-keyword\">instanceof</span> Schema)) {\n","                    <span class=\"code-keyword\">this</span>.changes.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">change</span>) </span>{\n","                        <span class=\"code-keyword\">if</span> (change.op === exports.OPERATION.DELETE) {\n","                            <span class=\"code-keyword\">var</span> index = _this.ref[<span class=\"code-string\">'getIndex'</span>](change.index);\n","                            <span class=\"code-keyword\">delete</span> _this.indexes[index];\n","                        }\n","                    });\n","                }\n","                <span class=\"code-keyword\">this</span>.changes.clear();\n","                <span class=\"code-keyword\">this</span>.changed = changed;\n","                <span class=\"code-keyword\">if</span> (discardAll) {\n","                    <span class=\"code-keyword\">this</span>.allChanges.clear();\n","                }\n","                <span class=\"code-comment\">// re-set `currentCustomOperation`</span>\n","                <span class=\"code-keyword\">this</span>.currentCustomOperation = <span class=\"code-number\">0</span>;\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Recursively discard all changes from this, and child structures.\n</span>","<span class=\"code-comment\">             */</span>\n","            ChangeTree.prototype.discardAll = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","                <span class=\"code-keyword\">this</span>.changes.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">change</span>) </span>{\n","                    <span class=\"code-keyword\">var</span> value = _this.getValue(change.index);\n","                    <span class=\"code-keyword\">if</span> (value &amp;&amp; value[<span class=\"code-string\">'$changes'</span>]) {\n","                        value[<span class=\"code-string\">'$changes'</span>].discardAll();\n","                    }\n","                });\n","                <span class=\"code-keyword\">this</span>.discard();\n","            };\n","            <span class=\"code-comment\">// cache(field: number, beginIndex: number, endIndex: number) {</span>\n","            ChangeTree.prototype.cache = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">field, cachedBytes</span>) </span>{\n","                <span class=\"code-keyword\">this</span>.caches[field] = cachedBytes;\n","            };\n","            ChangeTree.prototype.clone = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">new</span> ChangeTree(<span class=\"code-keyword\">this</span>.ref, <span class=\"code-keyword\">this</span>.parent, <span class=\"code-keyword\">this</span>.root);\n","            };\n","            ChangeTree.prototype.ensureRefId = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-comment\">// skip if refId is already set.</span>\n","                <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">this</span>.refId !== <span class=\"code-literal\">undefined</span>) {\n","                    <span class=\"code-keyword\">return</span>;\n","                }\n","                <span class=\"code-keyword\">this</span>.refId = <span class=\"code-keyword\">this</span>.root.getNextUniqueId();\n","            };\n","            ChangeTree.prototype.assertValidIndex = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index, fieldName</span>) </span>{\n","                <span class=\"code-keyword\">if</span> (index === <span class=\"code-literal\">undefined</span>) {\n","                    <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">\"ChangeTree: missing index for field \\\"\"</span>.concat(fieldName, <span class=\"code-string\">\"\\\"\"</span>));\n","                }\n","            };\n","            <span class=\"code-keyword\">return</span> ChangeTree;\n","        }());\n","\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">addCallback</span>(<span class=\"code-params\">$callbacks, op, callback, existing</span>) </span>{\n","            <span class=\"code-comment\">// initialize list of callbacks</span>\n","            <span class=\"code-keyword\">if</span> (!$callbacks[op]) {\n","                $callbacks[op] = [];\n","            }\n","            $callbacks[op].push(callback);\n","            <span class=\"code-comment\">//</span>\n","            <span class=\"code-comment\">// Trigger callback for existing elements</span>\n","            <span class=\"code-comment\">// - OPERATION.ADD</span>\n","            <span class=\"code-comment\">// - OPERATION.REPLACE</span>\n","            <span class=\"code-comment\">//</span>\n","            existing === <span class=\"code-literal\">null</span> || existing === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : existing.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">item, key</span>) </span>{ <span class=\"code-keyword\">return</span> callback(item, key); });\n","            <span class=\"code-keyword\">return</span> <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{ <span class=\"code-keyword\">return</span> spliceOne($callbacks[op], $callbacks[op].indexOf(callback)); };\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">removeChildRefs</span>(<span class=\"code-params\">changes</span>) </span>{\n","            <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","            <span class=\"code-keyword\">var</span> needRemoveRef = (<span class=\"code-keyword\">typeof</span> (<span class=\"code-keyword\">this</span>.$changes.getType()) !== <span class=\"code-string\">\"string\"</span>);\n","            <span class=\"code-keyword\">this</span>.$items.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">item, key</span>) </span>{\n","                changes.push({\n","                    refId: _this.$changes.refId,\n","                    op: exports.OPERATION.DELETE,\n","                    field: key,\n","                    value: <span class=\"code-literal\">undefined</span>,\n","                    previousValue: item\n","                });\n","                <span class=\"code-keyword\">if</span> (needRemoveRef) {\n","                    _this.$changes.root.removeRef(item[<span class=\"code-string\">'$changes'</span>].refId);\n","                }\n","            });\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">spliceOne</span>(<span class=\"code-params\">arr, index</span>) </span>{\n","            <span class=\"code-comment\">// manually splice an array</span>\n","            <span class=\"code-keyword\">if</span> (index === <span class=\"code-number\">-1</span> || index &gt;= arr.length) {\n","                <span class=\"code-keyword\">return</span> <span class=\"code-literal\">false</span>;\n","            }\n","            <span class=\"code-keyword\">var</span> len = arr.length - <span class=\"code-number\">1</span>;\n","            <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> i = index; i &lt; len; i++) {\n","                arr[i] = arr[i + <span class=\"code-number\">1</span>];\n","            }\n","            arr.length = len;\n","            <span class=\"code-keyword\">return</span> <span class=\"code-literal\">true</span>;\n","        }\n","\n","        <span class=\"code-keyword\">var</span> DEFAULT_SORT = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">a, b</span>) </span>{\n","            <span class=\"code-keyword\">var</span> A = a.toString();\n","            <span class=\"code-keyword\">var</span> B = b.toString();\n","            <span class=\"code-keyword\">if</span> (A &lt; B)\n","                <span class=\"code-keyword\">return</span> <span class=\"code-number\">-1</span>;\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (A &gt; B)\n","                <span class=\"code-keyword\">return</span> <span class=\"code-number\">1</span>;\n","            <span class=\"code-keyword\">else</span>\n","                <span class=\"code-keyword\">return</span> <span class=\"code-number\">0</span>;\n","        };\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">getArrayProxy</span>(<span class=\"code-params\">value</span>) </span>{\n","            value[<span class=\"code-string\">'$proxy'</span>] = <span class=\"code-literal\">true</span>;\n","            <span class=\"code-comment\">//</span>\n","            <span class=\"code-comment\">// compatibility with @colyseus/schema 0.5.x</span>\n","            <span class=\"code-comment\">// - allow `map[\"key\"]`</span>\n","            <span class=\"code-comment\">// - allow `map[\"key\"] = \"xxx\"`</span>\n","            <span class=\"code-comment\">// - allow `delete map[\"key\"]`</span>\n","            <span class=\"code-comment\">//</span>\n","            value = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Proxy</span>(value, {\n","                <span class=\"code-keyword\">get</span>: function (obj, prop) {\n","                    <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (prop) !== <span class=\"code-string\">\"symbol\"</span> &amp;&amp;\n","                        !<span class=\"code-built_in\">isNaN</span>(prop) <span class=\"code-comment\">// https://stackoverflow.com/a/175787/892698</span>\n","                    ) {\n","                        <span class=\"code-keyword\">return</span> obj.at(prop);\n","                    }\n","                    <span class=\"code-keyword\">else</span> {\n","                        <span class=\"code-keyword\">return</span> obj[prop];\n","                    }\n","                },\n","                <span class=\"code-keyword\">set</span>: function (obj, prop, setValue) {\n","                    <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (prop) !== <span class=\"code-string\">\"symbol\"</span> &amp;&amp;\n","                        !<span class=\"code-built_in\">isNaN</span>(prop)) {\n","                        <span class=\"code-keyword\">var</span> indexes = <span class=\"code-built_in\">Array</span>.from(obj[<span class=\"code-string\">'$items'</span>].keys());\n","                        <span class=\"code-keyword\">var</span> key = <span class=\"code-built_in\">parseInt</span>(indexes[prop] || prop);\n","                        <span class=\"code-keyword\">if</span> (setValue === <span class=\"code-literal\">undefined</span> || setValue === <span class=\"code-literal\">null</span>) {\n","                            obj.deleteAt(key);\n","                        }\n","                        <span class=\"code-keyword\">else</span> {\n","                            obj.setAt(key, setValue);\n","                        }\n","                    }\n","                    <span class=\"code-keyword\">else</span> {\n","                        obj[prop] = setValue;\n","                    }\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-literal\">true</span>;\n","                },\n","                deleteProperty: <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">obj, prop</span>) </span>{\n","                    <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (prop) === <span class=\"code-string\">\"number\"</span>) {\n","                        obj.deleteAt(prop);\n","                    }\n","                    <span class=\"code-keyword\">else</span> {\n","                        <span class=\"code-keyword\">delete</span> obj[prop];\n","                    }\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-literal\">true</span>;\n","                },\n","            });\n","            <span class=\"code-keyword\">return</span> value;\n","        }\n","        <span class=\"code-keyword\">var</span> ArraySchema = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">ArraySchema</span>(<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> items = [];\n","                <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> _i = <span class=\"code-number\">0</span>; _i &lt; <span class=\"code-built_in\">arguments</span>.length; _i++) {\n","                    items[_i] = <span class=\"code-built_in\">arguments</span>[_i];\n","                }\n","                <span class=\"code-keyword\">this</span>.$changes = <span class=\"code-keyword\">new</span> ChangeTree(<span class=\"code-keyword\">this</span>);\n","                <span class=\"code-keyword\">this</span>.$items = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Map</span>();\n","                <span class=\"code-keyword\">this</span>.$indexes = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Map</span>();\n","                <span class=\"code-keyword\">this</span>.$refId = <span class=\"code-number\">0</span>;\n","                <span class=\"code-keyword\">this</span>.push.apply(<span class=\"code-keyword\">this</span>, items);\n","            }\n","            ArraySchema.prototype.onAdd = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback, triggerAll</span>) </span>{\n","                <span class=\"code-keyword\">if</span> (triggerAll === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { triggerAll = <span class=\"code-literal\">true</span>; }\n","                <span class=\"code-keyword\">return</span> addCallback((<span class=\"code-keyword\">this</span>.$callbacks || (<span class=\"code-keyword\">this</span>.$callbacks = [])), exports.OPERATION.ADD, callback, (triggerAll)\n","                    ? <span class=\"code-keyword\">this</span>.$items\n","                    : <span class=\"code-literal\">undefined</span>);\n","            };\n","            ArraySchema.prototype.onRemove = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback</span>) </span>{ <span class=\"code-keyword\">return</span> addCallback(<span class=\"code-keyword\">this</span>.$callbacks || (<span class=\"code-keyword\">this</span>.$callbacks = []), exports.OPERATION.DELETE, callback); };\n","            ArraySchema.prototype.onChange = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback</span>) </span>{ <span class=\"code-keyword\">return</span> addCallback(<span class=\"code-keyword\">this</span>.$callbacks || (<span class=\"code-keyword\">this</span>.$callbacks = []), exports.OPERATION.REPLACE, callback); };\n","            ArraySchema.is = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">type</span>) </span>{\n","                <span class=\"code-keyword\">return</span> (\n","                <span class=\"code-comment\">// type format: [\"string\"]</span>\n","                <span class=\"code-built_in\">Array</span>.isArray(type) ||\n","                    <span class=\"code-comment\">// type format: { array: \"string\" }</span>\n","                    (type[<span class=\"code-string\">'array'</span>] !== <span class=\"code-literal\">undefined</span>));\n","            };\n","            <span class=\"code-built_in\">Object</span>.defineProperty(ArraySchema.prototype, <span class=\"code-string\">\"length\"</span>, {\n","                <span class=\"code-keyword\">get</span>: function () {\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.size;\n","                },\n","                <span class=\"code-keyword\">set</span>: function (value) {\n","                    <span class=\"code-keyword\">if</span> (value === <span class=\"code-number\">0</span>) {\n","                        <span class=\"code-keyword\">this</span>.clear();\n","                    }\n","                    <span class=\"code-keyword\">else</span> {\n","                        <span class=\"code-keyword\">this</span>.splice(value, <span class=\"code-keyword\">this</span>.length - value);\n","                    }\n","                },\n","                enumerable: <span class=\"code-literal\">false</span>,\n","                configurable: <span class=\"code-literal\">true</span>\n","            });\n","            ArraySchema.prototype.push = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","                <span class=\"code-keyword\">var</span> values = [];\n","                <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> _i = <span class=\"code-number\">0</span>; _i &lt; <span class=\"code-built_in\">arguments</span>.length; _i++) {\n","                    values[_i] = <span class=\"code-built_in\">arguments</span>[_i];\n","                }\n","                <span class=\"code-keyword\">var</span> lastIndex;\n","                values.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">value</span>) </span>{\n","                    <span class=\"code-comment\">// set \"index\" for reference.</span>\n","                    lastIndex = _this.$refId++;\n","                    _this.setAt(lastIndex, value);\n","                });\n","                <span class=\"code-keyword\">return</span> lastIndex;\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Removes the last element from an array and returns it.\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.pop = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> key = <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$indexes.values()).pop();\n","                <span class=\"code-keyword\">if</span> (key === <span class=\"code-literal\">undefined</span>) {\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-literal\">undefined</span>;\n","                }\n","                <span class=\"code-keyword\">this</span>.$changes.delete(key);\n","                <span class=\"code-keyword\">this</span>.$indexes.delete(key);\n","                <span class=\"code-keyword\">var</span> value = <span class=\"code-keyword\">this</span>.$items.get(key);\n","                <span class=\"code-keyword\">this</span>.$items.delete(key);\n","                <span class=\"code-keyword\">return</span> value;\n","            };\n","            ArraySchema.prototype.at = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index</span>) </span>{\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-comment\">// <span class=\"code-doctag\">FIXME:</span> this should be O(1)</span>\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-keyword\">var</span> key = <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.keys())[index];\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.get(key);\n","            };\n","            ArraySchema.prototype.setAt = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index, value</span>) </span>{\n","                <span class=\"code-keyword\">var</span> _a, _b;\n","                <span class=\"code-keyword\">if</span> (value[<span class=\"code-string\">'$changes'</span>] !== <span class=\"code-literal\">undefined</span>) {\n","                    value[<span class=\"code-string\">'$changes'</span>].setParent(<span class=\"code-keyword\">this</span>, <span class=\"code-keyword\">this</span>.$changes.root, index);\n","                }\n","                <span class=\"code-keyword\">var</span> operation = (_b = (_a = <span class=\"code-keyword\">this</span>.$changes.indexes[index]) === <span class=\"code-literal\">null</span> || _a === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _a.op) !== <span class=\"code-literal\">null</span> &amp;&amp; _b !== <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? _b : exports.OPERATION.ADD;\n","                <span class=\"code-keyword\">this</span>.$changes.indexes[index] = index;\n","                <span class=\"code-keyword\">this</span>.$indexes.set(index, index);\n","                <span class=\"code-keyword\">this</span>.$items.set(index, value);\n","                <span class=\"code-keyword\">this</span>.$changes.change(index, operation);\n","            };\n","            ArraySchema.prototype.deleteAt = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index</span>) </span>{\n","                <span class=\"code-keyword\">var</span> key = <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.keys())[index];\n","                <span class=\"code-keyword\">if</span> (key === <span class=\"code-literal\">undefined</span>) {\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-literal\">false</span>;\n","                }\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$deleteAt(key);\n","            };\n","            ArraySchema.prototype.$deleteAt = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index</span>) </span>{\n","                <span class=\"code-comment\">// delete at internal index</span>\n","                <span class=\"code-keyword\">this</span>.$changes.delete(index);\n","                <span class=\"code-keyword\">this</span>.$indexes.delete(index);\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.delete(index);\n","            };\n","            ArraySchema.prototype.clear = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">changes</span>) </span>{\n","                <span class=\"code-comment\">// discard previous operations.</span>\n","                <span class=\"code-keyword\">this</span>.$changes.discard(<span class=\"code-literal\">true</span>, <span class=\"code-literal\">true</span>);\n","                <span class=\"code-keyword\">this</span>.$changes.indexes = {};\n","                <span class=\"code-comment\">// clear previous indexes</span>\n","                <span class=\"code-keyword\">this</span>.$indexes.clear();\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-comment\">// When decoding:</span>\n","                <span class=\"code-comment\">// - enqueue items for DELETE callback.</span>\n","                <span class=\"code-comment\">// - flag child items for garbage collection.</span>\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-keyword\">if</span> (changes) {\n","                    removeChildRefs.call(<span class=\"code-keyword\">this</span>, changes);\n","                }\n","                <span class=\"code-comment\">// clear items</span>\n","                <span class=\"code-keyword\">this</span>.$items.clear();\n","                <span class=\"code-keyword\">this</span>.$changes.operation({ <span class=\"code-attr\">index</span>: <span class=\"code-number\">0</span>, <span class=\"code-attr\">op</span>: exports.OPERATION.CLEAR });\n","                <span class=\"code-comment\">// touch all structures until reach root</span>\n","                <span class=\"code-keyword\">this</span>.$changes.touchParents();\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Combines two or more arrays.\n</span>","<span class=\"code-comment\">             * @param items Additional items to add to the end of array1.\n</span>","<span class=\"code-comment\">             */</span>\n","            <span class=\"code-comment\">// @ts-ignore</span>\n","            ArraySchema.prototype.concat = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> _a;\n","                <span class=\"code-keyword\">var</span> items = [];\n","                <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> _i = <span class=\"code-number\">0</span>; _i &lt; <span class=\"code-built_in\">arguments</span>.length; _i++) {\n","                    items[_i] = <span class=\"code-built_in\">arguments</span>[_i];\n","                }\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">new</span> (ArraySchema.bind.apply(ArraySchema, __spreadArray([<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>], (_a = <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values())).concat.apply(_a, items), <span class=\"code-literal\">false</span>)))();\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Adds all the elements of an array separated by the specified separator string.\n</span>","<span class=\"code-comment\">             * @param separator A string used to separate one element of an array from the next in the resulting String. If omitted, the array elements are separated with a comma.\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.join = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">separator</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values()).join(separator);\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Reverses the elements in an Array.\n</span>","<span class=\"code-comment\">             */</span>\n","            <span class=\"code-comment\">// @ts-ignore</span>\n","            ArraySchema.prototype.reverse = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","                <span class=\"code-keyword\">var</span> indexes = <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.keys());\n","                <span class=\"code-keyword\">var</span> reversedItems = <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values()).reverse();\n","                reversedItems.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">item, i</span>) </span>{\n","                    _this.setAt(indexes[i], item);\n","                });\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>;\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Removes the first element from an array and returns it.\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.shift = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> indexes = <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.keys());\n","                <span class=\"code-keyword\">var</span> shiftAt = indexes.shift();\n","                <span class=\"code-keyword\">if</span> (shiftAt === <span class=\"code-literal\">undefined</span>) {\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-literal\">undefined</span>;\n","                }\n","                <span class=\"code-keyword\">var</span> value = <span class=\"code-keyword\">this</span>.$items.get(shiftAt);\n","                <span class=\"code-keyword\">this</span>.$deleteAt(shiftAt);\n","                <span class=\"code-keyword\">return</span> value;\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Returns a section of an array.\n</span>","<span class=\"code-comment\">             * @param start The beginning of the specified portion of the array.\n</span>","<span class=\"code-comment\">             * @param end The end of the specified portion of the array. This is exclusive of the element at the index 'end'.\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.slice = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">start, end</span>) </span>{\n","                <span class=\"code-keyword\">var</span> sliced = <span class=\"code-keyword\">new</span> ArraySchema();\n","                sliced.push.apply(sliced, <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values()).slice(start, end));\n","                <span class=\"code-keyword\">return</span> sliced;\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Sorts an array.\n</span>","<span class=\"code-comment\">             * @param compareFn Function used to determine the order of the elements. It is expected to return\n</span>","<span class=\"code-comment\">             * a negative value if first argument is less than second argument, zero if they're equal and a positive\n</span>","<span class=\"code-comment\">             * value otherwise. If omitted, the elements are sorted in ascending, ASCII character order.\n</span>","<span class=\"code-comment\">             * ```ts\n</span>","<span class=\"code-comment\">             * [11,2,22,1].sort((a, b) =&gt; a - b)\n</span>","<span class=\"code-comment\">             * ```\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.sort = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">compareFn</span>) </span>{\n","                <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","                <span class=\"code-keyword\">if</span> (compareFn === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { compareFn = DEFAULT_SORT; }\n","                <span class=\"code-keyword\">var</span> indexes = <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.keys());\n","                <span class=\"code-keyword\">var</span> sortedItems = <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values()).sort(compareFn);\n","                sortedItems.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">item, i</span>) </span>{\n","                    _this.setAt(indexes[i], item);\n","                });\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>;\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Removes elements from an array and, if necessary, inserts new elements in their place, returning the deleted elements.\n</span>","<span class=\"code-comment\">             * @param start The zero-based location in the array from which to start removing elements.\n</span>","<span class=\"code-comment\">             * @param deleteCount The number of elements to remove.\n</span>","<span class=\"code-comment\">             * @param items Elements to insert into the array in place of the deleted elements.\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.splice = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">start, deleteCount</span>) </span>{\n","                <span class=\"code-keyword\">if</span> (deleteCount === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { deleteCount = <span class=\"code-keyword\">this</span>.length - start; }\n","                <span class=\"code-keyword\">var</span> indexes = <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.keys());\n","                <span class=\"code-keyword\">var</span> removedItems = [];\n","                <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> i = start; i &lt; start + deleteCount; i++) {\n","                    removedItems.push(<span class=\"code-keyword\">this</span>.$items.get(indexes[i]));\n","                    <span class=\"code-keyword\">this</span>.$deleteAt(indexes[i]);\n","                }\n","                <span class=\"code-keyword\">return</span> removedItems;\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Inserts new elements at the start of an array.\n</span>","<span class=\"code-comment\">             * @param items  Elements to insert at the start of the Array.\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.unshift = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","                <span class=\"code-keyword\">var</span> items = [];\n","                <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> _i = <span class=\"code-number\">0</span>; _i &lt; <span class=\"code-built_in\">arguments</span>.length; _i++) {\n","                    items[_i] = <span class=\"code-built_in\">arguments</span>[_i];\n","                }\n","                <span class=\"code-keyword\">var</span> length = <span class=\"code-keyword\">this</span>.length;\n","                <span class=\"code-keyword\">var</span> addedLength = items.length;\n","                <span class=\"code-comment\">// const indexes = Array.from(this.$items.keys());</span>\n","                <span class=\"code-keyword\">var</span> previousValues = <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values());\n","                items.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">item, i</span>) </span>{\n","                    _this.setAt(i, item);\n","                });\n","                previousValues.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">previousValue, i</span>) </span>{\n","                    _this.setAt(addedLength + i, previousValue);\n","                });\n","                <span class=\"code-keyword\">return</span> length + addedLength;\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Returns the index of the first occurrence of a value in an array.\n</span>","<span class=\"code-comment\">             * @param searchElement The value to locate in the array.\n</span>","<span class=\"code-comment\">             * @param fromIndex The array index at which to begin the search. If fromIndex is omitted, the search starts at index 0.\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.indexOf = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">searchElement, fromIndex</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values()).indexOf(searchElement, fromIndex);\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Returns the index of the last occurrence of a specified value in an array.\n</span>","<span class=\"code-comment\">             * @param searchElement The value to locate in the array.\n</span>","<span class=\"code-comment\">             * @param fromIndex The array index at which to begin the search. If fromIndex is omitted, the search starts at the last index in the array.\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.lastIndexOf = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">searchElement, fromIndex</span>) </span>{\n","                <span class=\"code-keyword\">if</span> (fromIndex === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { fromIndex = <span class=\"code-keyword\">this</span>.length - <span class=\"code-number\">1</span>; }\n","                <span class=\"code-keyword\">return</span> <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values()).lastIndexOf(searchElement, fromIndex);\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Determines whether all the members of an array satisfy the specified test.\n</span>","<span class=\"code-comment\">             * @param callbackfn A function that accepts up to three arguments. The every method calls\n</span>","<span class=\"code-comment\">             * the callbackfn function for each element in the array until the callbackfn returns a value\n</span>","<span class=\"code-comment\">             * which is coercible to the Boolean value false, or until the end of the array.\n</span>","<span class=\"code-comment\">             * @param thisArg An object to which the this keyword can refer in the callbackfn function.\n</span>","<span class=\"code-comment\">             * If thisArg is omitted, undefined is used as the this value.\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.every = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callbackfn, thisArg</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values()).every(callbackfn, thisArg);\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Determines whether the specified callback function returns true for any element of an array.\n</span>","<span class=\"code-comment\">             * @param callbackfn A function that accepts up to three arguments. The some method calls\n</span>","<span class=\"code-comment\">             * the callbackfn function for each element in the array until the callbackfn returns a value\n</span>","<span class=\"code-comment\">             * which is coercible to the Boolean value true, or until the end of the array.\n</span>","<span class=\"code-comment\">             * @param thisArg An object to which the this keyword can refer in the callbackfn function.\n</span>","<span class=\"code-comment\">             * If thisArg is omitted, undefined is used as the this value.\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.some = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callbackfn, thisArg</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values()).some(callbackfn, thisArg);\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Performs the specified action for each element in an array.\n</span>","<span class=\"code-comment\">             * @param callbackfn  A function that accepts up to three arguments. forEach calls the callbackfn function one time for each element in the array.\n</span>","<span class=\"code-comment\">             * @param thisArg  An object to which the this keyword can refer in the callbackfn function. If thisArg is omitted, undefined is used as the this value.\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.forEach = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callbackfn, thisArg</span>) </span>{\n","                <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values()).forEach(callbackfn, thisArg);\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Calls a defined callback function on each element of an array, and returns an array that contains the results.\n</span>","<span class=\"code-comment\">             * @param callbackfn A function that accepts up to three arguments. The map method calls the callbackfn function one time for each element in the array.\n</span>","<span class=\"code-comment\">             * @param thisArg An object to which the this keyword can refer in the callbackfn function. If thisArg is omitted, undefined is used as the this value.\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.map = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callbackfn, thisArg</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values()).map(callbackfn, thisArg);\n","            };\n","            ArraySchema.prototype.filter = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callbackfn, thisArg</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values()).filter(callbackfn, thisArg);\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Calls the specified callback function for all the elements in an array. The return value of the callback function is the accumulated result, and is provided as an argument in the next call to the callback function.\n</span>","<span class=\"code-comment\">             * @param callbackfn A function that accepts up to four arguments. The reduce method calls the callbackfn function one time for each element in the array.\n</span>","<span class=\"code-comment\">             * @param initialValue If initialValue is specified, it is used as the initial value to start the accumulation. The first call to the callbackfn function provides this value as an argument instead of an array value.\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.reduce = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callbackfn, initialValue</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-built_in\">Array</span>.prototype.reduce.apply(<span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values()), <span class=\"code-built_in\">arguments</span>);\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Calls the specified callback function for all the elements in an array, in descending order. The return value of the callback function is the accumulated result, and is provided as an argument in the next call to the callback function.\n</span>","<span class=\"code-comment\">             * @param callbackfn A function that accepts up to four arguments. The reduceRight method calls the callbackfn function one time for each element in the array.\n</span>","<span class=\"code-comment\">             * @param initialValue If initialValue is specified, it is used as the initial value to start the accumulation. The first call to the callbackfn function provides this value as an argument instead of an array value.\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.reduceRight = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callbackfn, initialValue</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-built_in\">Array</span>.prototype.reduceRight.apply(<span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values()), <span class=\"code-built_in\">arguments</span>);\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Returns the value of the first element in the array where predicate is true, and undefined\n</span>","<span class=\"code-comment\">             * otherwise.\n</span>","<span class=\"code-comment\">             * @param predicate find calls predicate once for each element of the array, in ascending\n</span>","<span class=\"code-comment\">             * order, until it finds one where predicate returns true. If such an element is found, find\n</span>","<span class=\"code-comment\">             * immediately returns that element value. Otherwise, find returns undefined.\n</span>","<span class=\"code-comment\">             * @param thisArg If provided, it will be used as the this value for each invocation of\n</span>","<span class=\"code-comment\">             * predicate. If it is not provided, undefined is used instead.\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.find = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">predicate, thisArg</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values()).find(predicate, thisArg);\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Returns the index of the first element in the array where predicate is true, and -1\n</span>","<span class=\"code-comment\">             * otherwise.\n</span>","<span class=\"code-comment\">             * @param predicate find calls predicate once for each element of the array, in ascending\n</span>","<span class=\"code-comment\">             * order, until it finds one where predicate returns true. If such an element is found,\n</span>","<span class=\"code-comment\">             * findIndex immediately returns that element index. Otherwise, findIndex returns -1.\n</span>","<span class=\"code-comment\">             * @param thisArg If provided, it will be used as the this value for each invocation of\n</span>","<span class=\"code-comment\">             * predicate. If it is not provided, undefined is used instead.\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.findIndex = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">predicate, thisArg</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values()).findIndex(predicate, thisArg);\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Returns the this object after filling the section identified by start and end with value\n</span>","<span class=\"code-comment\">             * @param value value to fill array section with\n</span>","<span class=\"code-comment\">             * @param start index to start filling the array at. If start is negative, it is treated as\n</span>","<span class=\"code-comment\">             * length+start where length is the length of the array.\n</span>","<span class=\"code-comment\">             * @param end index to stop filling the array at. If end is negative, it is treated as\n</span>","<span class=\"code-comment\">             * length+end.\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.fill = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">value, start, end</span>) </span>{\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-comment\">// TODO</span>\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">\"ArraySchema#fill() not implemented\"</span>);\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Returns the this object after copying a section of the array identified by start and end\n</span>","<span class=\"code-comment\">             * to the same array starting at position target\n</span>","<span class=\"code-comment\">             * @param target If target is negative, it is treated as length+target where length is the\n</span>","<span class=\"code-comment\">             * length of the array.\n</span>","<span class=\"code-comment\">             * @param start If start is negative, it is treated as length+start. If end is negative, it\n</span>","<span class=\"code-comment\">             * is treated as length+end.\n</span>","<span class=\"code-comment\">             * @param end If not specified, length of the this object is used as its default value.\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.copyWithin = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">target, start, end</span>) </span>{\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-comment\">// TODO</span>\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">\"ArraySchema#copyWithin() not implemented\"</span>);\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Returns a string representation of an array.\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.toString = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{ <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.toString(); };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Returns a string representation of an array. The elements are converted to string using their toLocalString methods.\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.toLocaleString = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{ <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.toLocaleString(); };\n","            <span class=\"code-comment\">/** Iterator */</span>\n","            ArraySchema.prototype[<span class=\"code-built_in\">Symbol</span>.iterator] = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values())[<span class=\"code-built_in\">Symbol</span>.iterator]();\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Returns an iterable of key, value pairs for every entry in the array\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.entries = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{ <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.entries(); };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Returns an iterable of keys in the array\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.keys = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{ <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.keys(); };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Returns an iterable of values in the array\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.values = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{ <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.values(); };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Determines whether an array includes a certain element, returning true or false as appropriate.\n</span>","<span class=\"code-comment\">             * @param searchElement The element to search for.\n</span>","<span class=\"code-comment\">             * @param fromIndex The position in this array at which to begin searching for searchElement.\n</span>","<span class=\"code-comment\">             */</span>\n","            ArraySchema.prototype.includes = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">searchElement, fromIndex</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values()).includes(searchElement, fromIndex);\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Calls a defined callback function on each element of an array. Then, flattens the result into\n</span>","<span class=\"code-comment\">             * a new array.\n</span>","<span class=\"code-comment\">             * This is identical to a map followed by flat with depth 1.\n</span>","<span class=\"code-comment\">             *\n</span>","<span class=\"code-comment\">             * @param callback A function that accepts up to three arguments. The flatMap method calls the\n</span>","<span class=\"code-comment\">             * callback function one time for each element in the array.\n</span>","<span class=\"code-comment\">             * @param thisArg An object to which the this keyword can refer in the callback function. If\n</span>","<span class=\"code-comment\">             * thisArg is omitted, undefined is used as the this value.\n</span>","<span class=\"code-comment\">             */</span>\n","            <span class=\"code-comment\">// @ts-ignore</span>\n","            ArraySchema.prototype.flatMap = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback, thisArg</span>) </span>{\n","                <span class=\"code-comment\">// @ts-ignore</span>\n","                <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">\"ArraySchema#flatMap() is not supported.\"</span>);\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Returns a new array with all sub-array elements concatenated into it recursively up to the\n</span>","<span class=\"code-comment\">             * specified depth.\n</span>","<span class=\"code-comment\">             *\n</span>","<span class=\"code-comment\">             * @param depth The maximum recursion depth\n</span>","<span class=\"code-comment\">             */</span>\n","            <span class=\"code-comment\">// @ts-ignore</span>\n","            ArraySchema.prototype.flat = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">depth</span>) </span>{\n","                <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">\"ArraySchema#flat() is not supported.\"</span>);\n","            };\n","            ArraySchema.prototype.findLast = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> arr = <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values());\n","                <span class=\"code-comment\">// @ts-ignore</span>\n","                <span class=\"code-keyword\">return</span> arr.findLast.apply(arr, <span class=\"code-built_in\">arguments</span>);\n","            };\n","            ArraySchema.prototype.findLastIndex = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> arr = <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values());\n","                <span class=\"code-comment\">// @ts-ignore</span>\n","                <span class=\"code-keyword\">return</span> arr.findLastIndex.apply(arr, <span class=\"code-built_in\">arguments</span>);\n","            };\n","            <span class=\"code-comment\">// get size () {</span>\n","            <span class=\"code-comment\">//     return this.$items.size;</span>\n","            <span class=\"code-comment\">// }</span>\n","            ArraySchema.prototype.setIndex = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index, key</span>) </span>{\n","                <span class=\"code-keyword\">this</span>.$indexes.set(index, key);\n","            };\n","            ArraySchema.prototype.getIndex = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$indexes.get(index);\n","            };\n","            ArraySchema.prototype.getByIndex = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.get(<span class=\"code-keyword\">this</span>.$indexes.get(index));\n","            };\n","            ArraySchema.prototype.deleteByIndex = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index</span>) </span>{\n","                <span class=\"code-keyword\">var</span> key = <span class=\"code-keyword\">this</span>.$indexes.get(index);\n","                <span class=\"code-keyword\">this</span>.$items.delete(key);\n","                <span class=\"code-keyword\">this</span>.$indexes.delete(index);\n","            };\n","            ArraySchema.prototype.toArray = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values());\n","            };\n","            ArraySchema.prototype.toJSON = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.toArray().map(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">value</span>) </span>{\n","                    <span class=\"code-keyword\">return</span> (<span class=\"code-keyword\">typeof</span> (value[<span class=\"code-string\">'toJSON'</span>]) === <span class=\"code-string\">\"function\"</span>)\n","                        ? value[<span class=\"code-string\">'toJSON'</span>]()\n","                        : value;\n","                });\n","            };\n","            <span class=\"code-comment\">//</span>\n","            <span class=\"code-comment\">// Decoding utilities</span>\n","            <span class=\"code-comment\">//</span>\n","            ArraySchema.prototype.clone = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">isDecoding</span>) </span>{\n","                <span class=\"code-keyword\">var</span> cloned;\n","                <span class=\"code-keyword\">if</span> (isDecoding) {\n","                    cloned = <span class=\"code-keyword\">new</span> (ArraySchema.bind.apply(ArraySchema, __spreadArray([<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>], <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values()), <span class=\"code-literal\">false</span>)))();\n","                }\n","                <span class=\"code-keyword\">else</span> {\n","                    cloned = <span class=\"code-keyword\">new</span> (ArraySchema.bind.apply(ArraySchema, __spreadArray([<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>], <span class=\"code-keyword\">this</span>.map(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">item</span>) </span>{ <span class=\"code-keyword\">return</span> ((item[<span class=\"code-string\">'$changes'</span>])\n","                        ? item.clone()\n","                        : item); }), <span class=\"code-literal\">false</span>)))();\n","                }\n","                <span class=\"code-keyword\">return</span> cloned;\n","            };\n","            <span class=\"code-keyword\">return</span> ArraySchema;\n","        }());\n","\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">getMapProxy</span>(<span class=\"code-params\">value</span>) </span>{\n","            value[<span class=\"code-string\">'$proxy'</span>] = <span class=\"code-literal\">true</span>;\n","            value = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Proxy</span>(value, {\n","                <span class=\"code-keyword\">get</span>: function (obj, prop) {\n","                    <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (prop) !== <span class=\"code-string\">\"symbol\"</span> &amp;&amp; <span class=\"code-comment\">// accessing properties</span>\n","                        <span class=\"code-keyword\">typeof</span> (obj[prop]) === <span class=\"code-string\">\"undefined\"</span>) {\n","                        <span class=\"code-keyword\">return</span> obj.get(prop);\n","                    }\n","                    <span class=\"code-keyword\">else</span> {\n","                        <span class=\"code-keyword\">return</span> obj[prop];\n","                    }\n","                },\n","                <span class=\"code-keyword\">set</span>: function (obj, prop, setValue) {\n","                    <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (prop) !== <span class=\"code-string\">\"symbol\"</span> &amp;&amp;\n","                        (prop.indexOf(<span class=\"code-string\">\"$\"</span>) === <span class=\"code-number\">-1</span> &amp;&amp;\n","                            prop !== <span class=\"code-string\">\"onAdd\"</span> &amp;&amp;\n","                            prop !== <span class=\"code-string\">\"onRemove\"</span> &amp;&amp;\n","                            prop !== <span class=\"code-string\">\"onChange\"</span>)) {\n","                        obj.set(prop, setValue);\n","                    }\n","                    <span class=\"code-keyword\">else</span> {\n","                        obj[prop] = setValue;\n","                    }\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-literal\">true</span>;\n","                },\n","                deleteProperty: <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">obj, prop</span>) </span>{\n","                    obj.delete(prop);\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-literal\">true</span>;\n","                },\n","            });\n","            <span class=\"code-keyword\">return</span> value;\n","        }\n","        <span class=\"code-keyword\">var</span> MapSchema = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">MapSchema</span>(<span class=\"code-params\">initialValues</span>) </span>{\n","                <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","                <span class=\"code-keyword\">this</span>.$changes = <span class=\"code-keyword\">new</span> ChangeTree(<span class=\"code-keyword\">this</span>);\n","                <span class=\"code-keyword\">this</span>.$items = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Map</span>();\n","                <span class=\"code-keyword\">this</span>.$indexes = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Map</span>();\n","                <span class=\"code-keyword\">this</span>.$refId = <span class=\"code-number\">0</span>;\n","                <span class=\"code-keyword\">if</span> (initialValues) {\n","                    <span class=\"code-keyword\">if</span> (initialValues <span class=\"code-keyword\">instanceof</span> <span class=\"code-built_in\">Map</span> ||\n","                        initialValues <span class=\"code-keyword\">instanceof</span> MapSchema) {\n","                        initialValues.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">v, k</span>) </span>{ <span class=\"code-keyword\">return</span> _this.set(k, v); });\n","                    }\n","                    <span class=\"code-keyword\">else</span> {\n","                        <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> k <span class=\"code-keyword\">in</span> initialValues) {\n","                            <span class=\"code-keyword\">this</span>.set(k, initialValues[k]);\n","                        }\n","                    }\n","                }\n","            }\n","            MapSchema.prototype.onAdd = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback, triggerAll</span>) </span>{\n","                <span class=\"code-keyword\">if</span> (triggerAll === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { triggerAll = <span class=\"code-literal\">true</span>; }\n","                <span class=\"code-keyword\">return</span> addCallback((<span class=\"code-keyword\">this</span>.$callbacks || (<span class=\"code-keyword\">this</span>.$callbacks = [])), exports.OPERATION.ADD, callback, (triggerAll)\n","                    ? <span class=\"code-keyword\">this</span>.$items\n","                    : <span class=\"code-literal\">undefined</span>);\n","            };\n","            MapSchema.prototype.onRemove = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback</span>) </span>{ <span class=\"code-keyword\">return</span> addCallback(<span class=\"code-keyword\">this</span>.$callbacks || (<span class=\"code-keyword\">this</span>.$callbacks = []), exports.OPERATION.DELETE, callback); };\n","            MapSchema.prototype.onChange = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback</span>) </span>{ <span class=\"code-keyword\">return</span> addCallback(<span class=\"code-keyword\">this</span>.$callbacks || (<span class=\"code-keyword\">this</span>.$callbacks = []), exports.OPERATION.REPLACE, callback); };\n","            MapSchema.is = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">type</span>) </span>{\n","                <span class=\"code-keyword\">return</span> type[<span class=\"code-string\">'map'</span>] !== <span class=\"code-literal\">undefined</span>;\n","            };\n","            <span class=\"code-comment\">/** Iterator */</span>\n","            MapSchema.prototype[<span class=\"code-built_in\">Symbol</span>.iterator] = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{ <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items[<span class=\"code-built_in\">Symbol</span>.iterator](); };\n","            <span class=\"code-built_in\">Object</span>.defineProperty(MapSchema.prototype, <span class=\"code-built_in\">Symbol</span>.toStringTag, {\n","                <span class=\"code-keyword\">get</span>: function () { <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items[<span class=\"code-built_in\">Symbol</span>.toStringTag]; },\n","                enumerable: <span class=\"code-literal\">false</span>,\n","                configurable: <span class=\"code-literal\">true</span>\n","            });\n","            MapSchema.prototype.set = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">key, value</span>) </span>{\n","                <span class=\"code-keyword\">if</span> (value === <span class=\"code-literal\">undefined</span> || value === <span class=\"code-literal\">null</span>) {\n","                    <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">\"MapSchema#set('\"</span>.concat(key, <span class=\"code-string\">\"', \"</span>).concat(value, <span class=\"code-string\">\"): trying to set \"</span>).concat(value, <span class=\"code-string\">\" value on '\"</span>).concat(key, <span class=\"code-string\">\"'.\"</span>));\n","                }\n","                <span class=\"code-comment\">// get \"index\" for this value.</span>\n","                <span class=\"code-keyword\">var</span> hasIndex = <span class=\"code-keyword\">typeof</span> (<span class=\"code-keyword\">this</span>.$changes.indexes[key]) !== <span class=\"code-string\">\"undefined\"</span>;\n","                <span class=\"code-keyword\">var</span> index = (hasIndex)\n","                    ? <span class=\"code-keyword\">this</span>.$changes.indexes[key]\n","                    : <span class=\"code-keyword\">this</span>.$refId++;\n","                <span class=\"code-keyword\">var</span> operation = (hasIndex)\n","                    ? exports.OPERATION.REPLACE\n","                    : exports.OPERATION.ADD;\n","                <span class=\"code-keyword\">var</span> isRef = (value[<span class=\"code-string\">'$changes'</span>]) !== <span class=\"code-literal\">undefined</span>;\n","                <span class=\"code-keyword\">if</span> (isRef) {\n","                    value[<span class=\"code-string\">'$changes'</span>].setParent(<span class=\"code-keyword\">this</span>, <span class=\"code-keyword\">this</span>.$changes.root, index);\n","                }\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-comment\">// (encoding)</span>\n","                <span class=\"code-comment\">// set a unique id to relate directly with this key/value.</span>\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-keyword\">if</span> (!hasIndex) {\n","                    <span class=\"code-keyword\">this</span>.$changes.indexes[key] = index;\n","                    <span class=\"code-keyword\">this</span>.$indexes.set(index, key);\n","                }\n","                <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (isRef &amp;&amp; <span class=\"code-comment\">// if is schema, force ADD operation if value differ from previous one.</span>\n","                    <span class=\"code-keyword\">this</span>.$items.get(key) !== value) {\n","                    operation = exports.OPERATION.ADD;\n","                }\n","                <span class=\"code-keyword\">this</span>.$items.set(key, value);\n","                <span class=\"code-keyword\">this</span>.$changes.change(key, operation);\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>;\n","            };\n","            MapSchema.prototype.get = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">key</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.get(key);\n","            };\n","            MapSchema.prototype.delete = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">key</span>) </span>{\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-comment\">// <span class=\"code-doctag\">TODO:</span> add a \"purge\" method after .encode() runs, to cleanup removed `$indexes`</span>\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-comment\">// We don't remove $indexes to allow setting the same key in the same patch</span>\n","                <span class=\"code-comment\">// (See \"should allow to remove and set an item in the same place\" test)</span>\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-comment\">// // const index = this.$changes.indexes[key];</span>\n","                <span class=\"code-comment\">// // this.$indexes.delete(index);</span>\n","                <span class=\"code-keyword\">this</span>.$changes.delete(key);\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.delete(key);\n","            };\n","            MapSchema.prototype.clear = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">changes</span>) </span>{\n","                <span class=\"code-comment\">// discard previous operations.</span>\n","                <span class=\"code-keyword\">this</span>.$changes.discard(<span class=\"code-literal\">true</span>, <span class=\"code-literal\">true</span>);\n","                <span class=\"code-keyword\">this</span>.$changes.indexes = {};\n","                <span class=\"code-comment\">// clear previous indexes</span>\n","                <span class=\"code-keyword\">this</span>.$indexes.clear();\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-comment\">// When decoding:</span>\n","                <span class=\"code-comment\">// - enqueue items for DELETE callback.</span>\n","                <span class=\"code-comment\">// - flag child items for garbage collection.</span>\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-keyword\">if</span> (changes) {\n","                    removeChildRefs.call(<span class=\"code-keyword\">this</span>, changes);\n","                }\n","                <span class=\"code-comment\">// clear items</span>\n","                <span class=\"code-keyword\">this</span>.$items.clear();\n","                <span class=\"code-keyword\">this</span>.$changes.operation({ <span class=\"code-attr\">index</span>: <span class=\"code-number\">0</span>, <span class=\"code-attr\">op</span>: exports.OPERATION.CLEAR });\n","                <span class=\"code-comment\">// touch all structures until reach root</span>\n","                <span class=\"code-keyword\">this</span>.$changes.touchParents();\n","            };\n","            MapSchema.prototype.has = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">key</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.has(key);\n","            };\n","            MapSchema.prototype.forEach = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callbackfn</span>) </span>{\n","                <span class=\"code-keyword\">this</span>.$items.forEach(callbackfn);\n","            };\n","            MapSchema.prototype.entries = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.entries();\n","            };\n","            MapSchema.prototype.keys = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.keys();\n","            };\n","            MapSchema.prototype.values = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.values();\n","            };\n","            <span class=\"code-built_in\">Object</span>.defineProperty(MapSchema.prototype, <span class=\"code-string\">\"size\"</span>, {\n","                <span class=\"code-keyword\">get</span>: function () {\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.size;\n","                },\n","                enumerable: <span class=\"code-literal\">false</span>,\n","                configurable: <span class=\"code-literal\">true</span>\n","            });\n","            MapSchema.prototype.setIndex = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index, key</span>) </span>{\n","                <span class=\"code-keyword\">this</span>.$indexes.set(index, key);\n","            };\n","            MapSchema.prototype.getIndex = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$indexes.get(index);\n","            };\n","            MapSchema.prototype.getByIndex = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.get(<span class=\"code-keyword\">this</span>.$indexes.get(index));\n","            };\n","            MapSchema.prototype.deleteByIndex = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index</span>) </span>{\n","                <span class=\"code-keyword\">var</span> key = <span class=\"code-keyword\">this</span>.$indexes.get(index);\n","                <span class=\"code-keyword\">this</span>.$items.delete(key);\n","                <span class=\"code-keyword\">this</span>.$indexes.delete(index);\n","            };\n","            MapSchema.prototype.toJSON = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> map = {};\n","                <span class=\"code-keyword\">this</span>.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">value, key</span>) </span>{\n","                    map[key] = (<span class=\"code-keyword\">typeof</span> (value[<span class=\"code-string\">'toJSON'</span>]) === <span class=\"code-string\">\"function\"</span>)\n","                        ? value[<span class=\"code-string\">'toJSON'</span>]()\n","                        : value;\n","                });\n","                <span class=\"code-keyword\">return</span> map;\n","            };\n","            <span class=\"code-comment\">//</span>\n","            <span class=\"code-comment\">// Decoding utilities</span>\n","            <span class=\"code-comment\">//</span>\n","            MapSchema.prototype.clone = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">isDecoding</span>) </span>{\n","                <span class=\"code-keyword\">var</span> cloned;\n","                <span class=\"code-keyword\">if</span> (isDecoding) {\n","                    <span class=\"code-comment\">// client-side</span>\n","                    cloned = <span class=\"code-built_in\">Object</span>.assign(<span class=\"code-keyword\">new</span> MapSchema(), <span class=\"code-keyword\">this</span>);\n","                }\n","                <span class=\"code-keyword\">else</span> {\n","                    <span class=\"code-comment\">// server-side</span>\n","                    cloned = <span class=\"code-keyword\">new</span> MapSchema();\n","                    <span class=\"code-keyword\">this</span>.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">value, key</span>) </span>{\n","                        <span class=\"code-keyword\">if</span> (value[<span class=\"code-string\">'$changes'</span>]) {\n","                            cloned.set(key, value[<span class=\"code-string\">'clone'</span>]());\n","                        }\n","                        <span class=\"code-keyword\">else</span> {\n","                            cloned.set(key, value);\n","                        }\n","                    });\n","                }\n","                <span class=\"code-keyword\">return</span> cloned;\n","            };\n","            <span class=\"code-keyword\">return</span> MapSchema;\n","        }());\n","\n","        <span class=\"code-keyword\">var</span> registeredTypes = {};\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">registerType</span>(<span class=\"code-params\">identifier, definition</span>) </span>{\n","            registeredTypes[identifier] = definition;\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">getType</span>(<span class=\"code-params\">identifier</span>) </span>{\n","            <span class=\"code-keyword\">return</span> registeredTypes[identifier];\n","        }\n","\n","        <span class=\"code-keyword\">var</span> SchemaDefinition = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">SchemaDefinition</span>(<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-comment\">// <span class=\"code-doctag\">TODO:</span> use a \"field\" structure combining all these properties per-field.</span>\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-keyword\">this</span>.indexes = {};\n","                <span class=\"code-keyword\">this</span>.fieldsByIndex = {};\n","                <span class=\"code-keyword\">this</span>.deprecated = {};\n","                <span class=\"code-keyword\">this</span>.descriptors = {};\n","            }\n","            SchemaDefinition.create = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">parent</span>) </span>{\n","                <span class=\"code-keyword\">var</span> definition = <span class=\"code-keyword\">new</span> SchemaDefinition();\n","                <span class=\"code-comment\">// support inheritance</span>\n","                definition.schema = <span class=\"code-built_in\">Object</span>.assign({}, parent &amp;&amp; parent.schema || {});\n","                definition.indexes = <span class=\"code-built_in\">Object</span>.assign({}, parent &amp;&amp; parent.indexes || {});\n","                definition.fieldsByIndex = <span class=\"code-built_in\">Object</span>.assign({}, parent &amp;&amp; parent.fieldsByIndex || {});\n","                definition.descriptors = <span class=\"code-built_in\">Object</span>.assign({}, parent &amp;&amp; parent.descriptors || {});\n","                definition.deprecated = <span class=\"code-built_in\">Object</span>.assign({}, parent &amp;&amp; parent.deprecated || {});\n","                <span class=\"code-keyword\">return</span> definition;\n","            };\n","            SchemaDefinition.prototype.addField = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">field, type</span>) </span>{\n","                <span class=\"code-keyword\">var</span> index = <span class=\"code-keyword\">this</span>.getNextFieldIndex();\n","                <span class=\"code-keyword\">this</span>.fieldsByIndex[index] = field;\n","                <span class=\"code-keyword\">this</span>.indexes[field] = index;\n","                <span class=\"code-keyword\">this</span>.schema[field] = (<span class=\"code-built_in\">Array</span>.isArray(type))\n","                    ? { <span class=\"code-attr\">array</span>: type[<span class=\"code-number\">0</span>] }\n","                    : type;\n","            };\n","            SchemaDefinition.prototype.hasField = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">field</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.indexes[field] !== <span class=\"code-literal\">undefined</span>;\n","            };\n","            SchemaDefinition.prototype.addFilter = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">field, cb</span>) </span>{\n","                <span class=\"code-keyword\">if</span> (!<span class=\"code-keyword\">this</span>.filters) {\n","                    <span class=\"code-keyword\">this</span>.filters = {};\n","                    <span class=\"code-keyword\">this</span>.indexesWithFilters = [];\n","                }\n","                <span class=\"code-keyword\">this</span>.filters[<span class=\"code-keyword\">this</span>.indexes[field]] = cb;\n","                <span class=\"code-keyword\">this</span>.indexesWithFilters.push(<span class=\"code-keyword\">this</span>.indexes[field]);\n","                <span class=\"code-keyword\">return</span> <span class=\"code-literal\">true</span>;\n","            };\n","            SchemaDefinition.prototype.addChildrenFilter = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">field, cb</span>) </span>{\n","                <span class=\"code-keyword\">var</span> index = <span class=\"code-keyword\">this</span>.indexes[field];\n","                <span class=\"code-keyword\">var</span> type = <span class=\"code-keyword\">this</span>.schema[field];\n","                <span class=\"code-keyword\">if</span> (getType(<span class=\"code-built_in\">Object</span>.keys(type)[<span class=\"code-number\">0</span>])) {\n","                    <span class=\"code-keyword\">if</span> (!<span class=\"code-keyword\">this</span>.childFilters) {\n","                        <span class=\"code-keyword\">this</span>.childFilters = {};\n","                    }\n","                    <span class=\"code-keyword\">this</span>.childFilters[index] = cb;\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-literal\">true</span>;\n","                }\n","                <span class=\"code-keyword\">else</span> {\n","                    <span class=\"code-built_in\">console</span>.warn(<span class=\"code-string\">\"@filterChildren: field '\"</span>.concat(field, <span class=\"code-string\">\"' can't have children. Ignoring filter.\"</span>));\n","                }\n","            };\n","            SchemaDefinition.prototype.getChildrenFilter = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">field</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.childFilters &amp;&amp; <span class=\"code-keyword\">this</span>.childFilters[<span class=\"code-keyword\">this</span>.indexes[field]];\n","            };\n","            SchemaDefinition.prototype.getNextFieldIndex = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-built_in\">Object</span>.keys(<span class=\"code-keyword\">this</span>.schema || {}).length;\n","            };\n","            <span class=\"code-keyword\">return</span> SchemaDefinition;\n","        }());\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">hasFilter</span>(<span class=\"code-params\">klass</span>) </span>{\n","            <span class=\"code-keyword\">return</span> klass._context &amp;&amp; klass._context.useFilters;\n","        }\n","        <span class=\"code-keyword\">var</span> Context = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">Context</span>(<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">this</span>.types = {};\n","                <span class=\"code-keyword\">this</span>.schemas = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Map</span>();\n","                <span class=\"code-keyword\">this</span>.useFilters = <span class=\"code-literal\">false</span>;\n","            }\n","            Context.prototype.has = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">schema</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.schemas.has(schema);\n","            };\n","            Context.prototype.get = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">typeid</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.types[typeid];\n","            };\n","            Context.prototype.add = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">schema, typeid</span>) </span>{\n","                <span class=\"code-keyword\">if</span> (typeid === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { typeid = <span class=\"code-keyword\">this</span>.schemas.size; }\n","                <span class=\"code-comment\">// <span class=\"code-doctag\">FIXME:</span> move this to somewhere else?</span>\n","                <span class=\"code-comment\">// support inheritance</span>\n","                schema._definition = SchemaDefinition.create(schema._definition);\n","                schema._typeid = typeid;\n","                <span class=\"code-keyword\">this</span>.types[typeid] = schema;\n","                <span class=\"code-keyword\">this</span>.schemas.set(schema, typeid);\n","            };\n","            Context.create = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">options</span>) </span>{\n","                <span class=\"code-keyword\">if</span> (options === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { options = {}; }\n","                <span class=\"code-keyword\">return</span> <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">definition</span>) </span>{\n","                    <span class=\"code-keyword\">if</span> (!options.context) {\n","                        options.context = <span class=\"code-keyword\">new</span> Context();\n","                    }\n","                    <span class=\"code-keyword\">return</span> type(definition, options);\n","                };\n","            };\n","            <span class=\"code-keyword\">return</span> Context;\n","        }());\n","        <span class=\"code-keyword\">var</span> globalContext = <span class=\"code-keyword\">new</span> Context();\n","        <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">         * [See documentation](https://docs.colyseus.io/state/schema/)\n</span>","<span class=\"code-comment\">         *\n</span>","<span class=\"code-comment\">         * Annotate a Schema property to be serializeable.\n</span>","<span class=\"code-comment\">         * \\@type()'d fields are automatically flagged as \"dirty\" for the next patch.\n</span>","<span class=\"code-comment\">         *\n</span>","<span class=\"code-comment\">         * @example Standard usage, with automatic change tracking.\n</span>","<span class=\"code-comment\">         * ```\n</span>","<span class=\"code-comment\">         * \\@type(\"string\") propertyName: string;\n</span>","<span class=\"code-comment\">         * ```\n</span>","<span class=\"code-comment\">         *\n</span>","<span class=\"code-comment\">         * @example You can provide the \"manual\" option if you'd like to manually control your patches via .setDirty().\n</span>","<span class=\"code-comment\">         * ```\n</span>","<span class=\"code-comment\">         * \\@type(\"string\", { manual: true })\n</span>","<span class=\"code-comment\">         * ```\n</span>","<span class=\"code-comment\">         */</span>\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">type</span>(<span class=\"code-params\">type, options</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (options === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { options = {}; }\n","            <span class=\"code-keyword\">return</span> <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">target, field</span>) </span>{\n","                <span class=\"code-keyword\">var</span> context = options.context || globalContext;\n","                <span class=\"code-keyword\">var</span> <span class=\"code-keyword\">constructor</span> = target.<span class=\"code-keyword\">constructor</span>;\n","                <span class=\"code-keyword\">constructor</span>._context = context;\n","                if (!type) {\n","                    <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">\"\"</span>.concat(<span class=\"code-keyword\">constructor</span>.name, \": @type() reference provided for \\\"\").concat(field, \"\\\" is undefined. Make sure you don't have any circular dependencies.\"));\n","                }\n","                /*\n","                 * static schema\n","                 */\n","                if (!context.has(<span class=\"code-keyword\">constructor</span>)) {\n","                    context.add(<span class=\"code-keyword\">constructor</span>);\n","                }\n","                var definition = <span class=\"code-keyword\">constructor</span>._definition;\n","                definition.addField(field, type);\n","                /**\n","                 * skip if descriptor already exists for this field (`@deprecated()`)\n","                 */\n","                if (definition.descriptors[field]) {\n","                    <span class=\"code-keyword\">if</span> (definition.deprecated[field]) {\n","                        <span class=\"code-comment\">// do not create accessors for deprecated properties.</span>\n","                        <span class=\"code-keyword\">return</span>;\n","                    }\n","                    <span class=\"code-keyword\">else</span> {\n","                        <span class=\"code-comment\">// trying to define same property multiple times across inheritance.</span>\n","                        <span class=\"code-comment\">// https://github.com/colyseus/colyseus-unity3d/issues/131#issuecomment-814308572</span>\n","                        <span class=\"code-keyword\">try</span> {\n","                            <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">\"@colyseus/schema: Duplicate '\"</span>.concat(field, <span class=\"code-string\">\"' definition on '\"</span>).concat(<span class=\"code-keyword\">constructor</span>.name, \"'.\\nCheck @type() annotation\"));\n","                        }\n","                        catch (e) {\n","                            <span class=\"code-keyword\">var</span> definitionAtLine = e.stack.split(<span class=\"code-string\">\"\\n\"</span>)[<span class=\"code-number\">4</span>].trim();\n","                            <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">\"\"</span>.concat(e.message, <span class=\"code-string\">\" \"</span>).concat(definitionAtLine));\n","                        }\n","                    }\n","                }\n","                <span class=\"code-keyword\">var</span> isArray = ArraySchema.is(type);\n","                <span class=\"code-keyword\">var</span> isMap = !isArray &amp;&amp; MapSchema.is(type);\n","                <span class=\"code-comment\">// <span class=\"code-doctag\">TODO:</span> refactor me.</span>\n","                <span class=\"code-comment\">// Allow abstract intermediary classes with no fields to be serialized</span>\n","                <span class=\"code-comment\">// (See \"should support an inheritance with a Schema type without fields\" test)</span>\n","                <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (type) !== <span class=\"code-string\">\"string\"</span> &amp;&amp; !Schema.is(type)) {\n","                    <span class=\"code-keyword\">var</span> childType = <span class=\"code-built_in\">Object</span>.values(type)[<span class=\"code-number\">0</span>];\n","                    <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (childType) !== <span class=\"code-string\">\"string\"</span> &amp;&amp; !context.has(childType)) {\n","                        context.add(childType);\n","                    }\n","                }\n","                <span class=\"code-keyword\">if</span> (options.manual) {\n","                    <span class=\"code-comment\">// do not declare getter/setter descriptor</span>\n","                    definition.descriptors[field] = {\n","                        enumerable: <span class=\"code-literal\">true</span>,\n","                        configurable: <span class=\"code-literal\">true</span>,\n","                        writable: <span class=\"code-literal\">true</span>,\n","                    };\n","                    <span class=\"code-keyword\">return</span>;\n","                }\n","                <span class=\"code-keyword\">var</span> fieldCached = <span class=\"code-string\">\"_\"</span>.concat(field);\n","                definition.descriptors[fieldCached] = {\n","                    enumerable: <span class=\"code-literal\">false</span>,\n","                    configurable: <span class=\"code-literal\">false</span>,\n","                    writable: <span class=\"code-literal\">true</span>,\n","                };\n","                definition.descriptors[field] = {\n","                    <span class=\"code-keyword\">get</span>: function () {\n","                        <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>[fieldCached];\n","                    },\n","                    <span class=\"code-keyword\">set</span>: function (value) {\n","                        <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">                         * Create Proxy for array or map items\n</span>","<span class=\"code-comment\">                         */</span>\n","                        <span class=\"code-comment\">// skip if value is the same as cached.</span>\n","                        <span class=\"code-keyword\">if</span> (value === <span class=\"code-keyword\">this</span>[fieldCached]) {\n","                            <span class=\"code-keyword\">return</span>;\n","                        }\n","                        <span class=\"code-keyword\">if</span> (value !== <span class=\"code-literal\">undefined</span> &amp;&amp;\n","                            value !== <span class=\"code-literal\">null</span>) {\n","                            <span class=\"code-comment\">// automaticallty transform Array into ArraySchema</span>\n","                            <span class=\"code-keyword\">if</span> (isArray &amp;&amp; !(value <span class=\"code-keyword\">instanceof</span> ArraySchema)) {\n","                                value = <span class=\"code-keyword\">new</span> (ArraySchema.bind.apply(ArraySchema, __spreadArray([<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>], value, <span class=\"code-literal\">false</span>)))();\n","                            }\n","                            <span class=\"code-comment\">// automaticallty transform Map into MapSchema</span>\n","                            <span class=\"code-keyword\">if</span> (isMap &amp;&amp; !(value <span class=\"code-keyword\">instanceof</span> MapSchema)) {\n","                                value = <span class=\"code-keyword\">new</span> MapSchema(value);\n","                            }\n","                            <span class=\"code-comment\">// try to turn provided structure into a Proxy</span>\n","                            <span class=\"code-keyword\">if</span> (value[<span class=\"code-string\">'$proxy'</span>] === <span class=\"code-literal\">undefined</span>) {\n","                                <span class=\"code-keyword\">if</span> (isMap) {\n","                                    value = getMapProxy(value);\n","                                }\n","                                <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (isArray) {\n","                                    value = getArrayProxy(value);\n","                                }\n","                            }\n","                            <span class=\"code-comment\">// flag the change for encoding.</span>\n","                            <span class=\"code-keyword\">this</span>.$changes.change(field);\n","                            <span class=\"code-comment\">//</span>\n","                            <span class=\"code-comment\">// call setParent() recursively for this and its child</span>\n","                            <span class=\"code-comment\">// structures.</span>\n","                            <span class=\"code-comment\">//</span>\n","                            <span class=\"code-keyword\">if</span> (value[<span class=\"code-string\">'$changes'</span>]) {\n","                                value[<span class=\"code-string\">'$changes'</span>].setParent(<span class=\"code-keyword\">this</span>, <span class=\"code-keyword\">this</span>.$changes.root, <span class=\"code-keyword\">this</span>._definition.indexes[field]);\n","                            }\n","                        }\n","                        <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">this</span>[fieldCached]) {\n","                            <span class=\"code-comment\">//</span>\n","                            <span class=\"code-comment\">// Setting a field to `null` or `undefined` will delete it.</span>\n","                            <span class=\"code-comment\">//</span>\n","                            <span class=\"code-keyword\">this</span>.$changes.delete(field);\n","                        }\n","                        <span class=\"code-keyword\">this</span>[fieldCached] = value;\n","                    },\n","                    enumerable: <span class=\"code-literal\">true</span>,\n","                    configurable: <span class=\"code-literal\">true</span>\n","                };\n","            };\n","        }\n","        <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">         * `@filter()` decorator for defining data filters per client\n</span>","<span class=\"code-comment\">         */</span>\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">filter</span>(<span class=\"code-params\">cb</span>) </span>{\n","            <span class=\"code-keyword\">return</span> <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">target, field</span>) </span>{\n","                <span class=\"code-keyword\">var</span> <span class=\"code-keyword\">constructor</span> = target.<span class=\"code-keyword\">constructor</span>;\n","                var definition = <span class=\"code-keyword\">constructor</span>._definition;\n","                if (definition.addFilter(field, cb)) {\n","                    <span class=\"code-keyword\">constructor</span>._context.useFilters = true;\n","                }\n","            };\n","        }\n","        function filterChildren(cb) {\n","            <span class=\"code-keyword\">return</span> <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">target, field</span>) </span>{\n","                <span class=\"code-keyword\">var</span> <span class=\"code-keyword\">constructor</span> = target.<span class=\"code-keyword\">constructor</span>;\n","                var definition = <span class=\"code-keyword\">constructor</span>._definition;\n","                if (definition.addChildrenFilter(field, cb)) {\n","                    <span class=\"code-keyword\">constructor</span>._context.useFilters = true;\n","                }\n","            };\n","        }\n","        /**\n","         * `@deprecated()` flag a field as deprecated.\n","         * The previous `@type()` annotation should remain along with this one.\n","         */\n","        function deprecated(throws) {\n","            <span class=\"code-keyword\">if</span> (throws === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { throws = <span class=\"code-literal\">true</span>; }\n","            <span class=\"code-keyword\">return</span> <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">target, field</span>) </span>{\n","                <span class=\"code-keyword\">var</span> <span class=\"code-keyword\">constructor</span> = target.<span class=\"code-keyword\">constructor</span>;\n","                var definition = <span class=\"code-keyword\">constructor</span>._definition;\n","                definition.deprecated[field] = true;\n","                if (throws) {\n","                    definition.descriptors[field] = {\n","                        <span class=\"code-keyword\">get</span>: function () { <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">\"\"</span>.concat(field, <span class=\"code-string\">\" is deprecated.\"</span>)); },\n","                        <span class=\"code-keyword\">set</span>: function (value) { },\n","                        enumerable: <span class=\"code-literal\">false</span>,\n","                        configurable: <span class=\"code-literal\">true</span>\n","                    };\n","                }\n","            };\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">defineTypes</span>(<span class=\"code-params\">target, fields, options</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (options === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { options = {}; }\n","            <span class=\"code-keyword\">if</span> (!options.context) {\n","                options.context = target._context || options.context || globalContext;\n","            }\n","            <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> field <span class=\"code-keyword\">in</span> fields) {\n","                type(fields[field], options)(target.prototype, field);\n","            }\n","            <span class=\"code-keyword\">return</span> target;\n","        }\n","\n","        <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">         * Copyright (c) 2018 Endel Dreyer\n</span>","<span class=\"code-comment\">         * Copyright (c) 2014 Ion Drive Software Ltd.\n</span>","<span class=\"code-comment\">         *\n</span>","<span class=\"code-comment\">         * Permission is hereby granted, free of charge, to any person obtaining a copy\n</span>","<span class=\"code-comment\">         * of this software and associated documentation files (the \"Software\"), to deal\n</span>","<span class=\"code-comment\">         * in the Software without restriction, including without limitation the rights\n</span>","<span class=\"code-comment\">         * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n</span>","<span class=\"code-comment\">         * copies of the Software, and to permit persons to whom the Software is\n</span>","<span class=\"code-comment\">         * furnished to do so, subject to the following conditions:\n</span>","<span class=\"code-comment\">         *\n</span>","<span class=\"code-comment\">         * The above copyright notice and this permission notice shall be included in all\n</span>","<span class=\"code-comment\">         * copies or substantial portions of the Software.\n</span>","<span class=\"code-comment\">         *\n</span>","<span class=\"code-comment\">         * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n</span>","<span class=\"code-comment\">         * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n</span>","<span class=\"code-comment\">         * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n</span>","<span class=\"code-comment\">         * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n</span>","<span class=\"code-comment\">         * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n</span>","<span class=\"code-comment\">         * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n</span>","<span class=\"code-comment\">         * SOFTWARE\n</span>","<span class=\"code-comment\">         */</span>\n","        <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">         * msgpack implementation highly based on notepack.io\n</span>","<span class=\"code-comment\">         * https://github.com/darrachequesne/notepack\n</span>","<span class=\"code-comment\">         */</span>\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">utf8Length</span>(<span class=\"code-params\">str</span>) </span>{\n","            <span class=\"code-keyword\">var</span> c = <span class=\"code-number\">0</span>, length = <span class=\"code-number\">0</span>;\n","            <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> i = <span class=\"code-number\">0</span>, l = str.length; i &lt; l; i++) {\n","                c = str.charCodeAt(i);\n","                <span class=\"code-keyword\">if</span> (c &lt; <span class=\"code-number\">0x80</span>) {\n","                    length += <span class=\"code-number\">1</span>;\n","                }\n","                <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (c &lt; <span class=\"code-number\">0x800</span>) {\n","                    length += <span class=\"code-number\">2</span>;\n","                }\n","                <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (c &lt; <span class=\"code-number\">0xd800</span> || c &gt;= <span class=\"code-number\">0xe000</span>) {\n","                    length += <span class=\"code-number\">3</span>;\n","                }\n","                <span class=\"code-keyword\">else</span> {\n","                    i++;\n","                    length += <span class=\"code-number\">4</span>;\n","                }\n","            }\n","            <span class=\"code-keyword\">return</span> length;\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">utf8Write</span>(<span class=\"code-params\">view, offset, str</span>) </span>{\n","            <span class=\"code-keyword\">var</span> c = <span class=\"code-number\">0</span>;\n","            <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> i = <span class=\"code-number\">0</span>, l = str.length; i &lt; l; i++) {\n","                c = str.charCodeAt(i);\n","                <span class=\"code-keyword\">if</span> (c &lt; <span class=\"code-number\">0x80</span>) {\n","                    view[offset++] = c;\n","                }\n","                <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (c &lt; <span class=\"code-number\">0x800</span>) {\n","                    view[offset++] = <span class=\"code-number\">0xc0</span> | (c &gt;&gt; <span class=\"code-number\">6</span>);\n","                    view[offset++] = <span class=\"code-number\">0x80</span> | (c &amp; <span class=\"code-number\">0x3f</span>);\n","                }\n","                <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (c &lt; <span class=\"code-number\">0xd800</span> || c &gt;= <span class=\"code-number\">0xe000</span>) {\n","                    view[offset++] = <span class=\"code-number\">0xe0</span> | (c &gt;&gt; <span class=\"code-number\">12</span>);\n","                    view[offset++] = <span class=\"code-number\">0x80</span> | (c &gt;&gt; <span class=\"code-number\">6</span> &amp; <span class=\"code-number\">0x3f</span>);\n","                    view[offset++] = <span class=\"code-number\">0x80</span> | (c &amp; <span class=\"code-number\">0x3f</span>);\n","                }\n","                <span class=\"code-keyword\">else</span> {\n","                    i++;\n","                    c = <span class=\"code-number\">0x10000</span> + (((c &amp; <span class=\"code-number\">0x3ff</span>) &lt;&lt; <span class=\"code-number\">10</span>) | (str.charCodeAt(i) &amp; <span class=\"code-number\">0x3ff</span>));\n","                    view[offset++] = <span class=\"code-number\">0xf0</span> | (c &gt;&gt; <span class=\"code-number\">18</span>);\n","                    view[offset++] = <span class=\"code-number\">0x80</span> | (c &gt;&gt; <span class=\"code-number\">12</span> &amp; <span class=\"code-number\">0x3f</span>);\n","                    view[offset++] = <span class=\"code-number\">0x80</span> | (c &gt;&gt; <span class=\"code-number\">6</span> &amp; <span class=\"code-number\">0x3f</span>);\n","                    view[offset++] = <span class=\"code-number\">0x80</span> | (c &amp; <span class=\"code-number\">0x3f</span>);\n","                }\n","            }\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">int8$1</span>(<span class=\"code-params\">bytes, value</span>) </span>{\n","            bytes.push(value &amp; <span class=\"code-number\">255</span>);\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">uint8$1</span>(<span class=\"code-params\">bytes, value</span>) </span>{\n","            bytes.push(value &amp; <span class=\"code-number\">255</span>);\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">int16$1</span>(<span class=\"code-params\">bytes, value</span>) </span>{\n","            bytes.push(value &amp; <span class=\"code-number\">255</span>);\n","            bytes.push((value &gt;&gt; <span class=\"code-number\">8</span>) &amp; <span class=\"code-number\">255</span>);\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">uint16$1</span>(<span class=\"code-params\">bytes, value</span>) </span>{\n","            bytes.push(value &amp; <span class=\"code-number\">255</span>);\n","            bytes.push((value &gt;&gt; <span class=\"code-number\">8</span>) &amp; <span class=\"code-number\">255</span>);\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">int32$1</span>(<span class=\"code-params\">bytes, value</span>) </span>{\n","            bytes.push(value &amp; <span class=\"code-number\">255</span>);\n","            bytes.push((value &gt;&gt; <span class=\"code-number\">8</span>) &amp; <span class=\"code-number\">255</span>);\n","            bytes.push((value &gt;&gt; <span class=\"code-number\">16</span>) &amp; <span class=\"code-number\">255</span>);\n","            bytes.push((value &gt;&gt; <span class=\"code-number\">24</span>) &amp; <span class=\"code-number\">255</span>);\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">uint32$1</span>(<span class=\"code-params\">bytes, value</span>) </span>{\n","            <span class=\"code-keyword\">var</span> b4 = value &gt;&gt; <span class=\"code-number\">24</span>;\n","            <span class=\"code-keyword\">var</span> b3 = value &gt;&gt; <span class=\"code-number\">16</span>;\n","            <span class=\"code-keyword\">var</span> b2 = value &gt;&gt; <span class=\"code-number\">8</span>;\n","            <span class=\"code-keyword\">var</span> b1 = value;\n","            bytes.push(b1 &amp; <span class=\"code-number\">255</span>);\n","            bytes.push(b2 &amp; <span class=\"code-number\">255</span>);\n","            bytes.push(b3 &amp; <span class=\"code-number\">255</span>);\n","            bytes.push(b4 &amp; <span class=\"code-number\">255</span>);\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">int64$1</span>(<span class=\"code-params\">bytes, value</span>) </span>{\n","            <span class=\"code-keyword\">var</span> high = <span class=\"code-built_in\">Math</span>.floor(value / <span class=\"code-built_in\">Math</span>.pow(<span class=\"code-number\">2</span>, <span class=\"code-number\">32</span>));\n","            <span class=\"code-keyword\">var</span> low = value &gt;&gt;&gt; <span class=\"code-number\">0</span>;\n","            uint32$<span class=\"code-number\">1</span>(bytes, low);\n","            uint32$<span class=\"code-number\">1</span>(bytes, high);\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">uint64$1</span>(<span class=\"code-params\">bytes, value</span>) </span>{\n","            <span class=\"code-keyword\">var</span> high = (value / <span class=\"code-built_in\">Math</span>.pow(<span class=\"code-number\">2</span>, <span class=\"code-number\">32</span>)) &gt;&gt; <span class=\"code-number\">0</span>;\n","            <span class=\"code-keyword\">var</span> low = value &gt;&gt;&gt; <span class=\"code-number\">0</span>;\n","            uint32$<span class=\"code-number\">1</span>(bytes, low);\n","            uint32$<span class=\"code-number\">1</span>(bytes, high);\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">float32$1</span>(<span class=\"code-params\">bytes, value</span>) </span>{\n","            writeFloat32(bytes, value);\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">float64$1</span>(<span class=\"code-params\">bytes, value</span>) </span>{\n","            writeFloat64(bytes, value);\n","        }\n","        <span class=\"code-keyword\">var</span> _int32$<span class=\"code-number\">1</span> = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Int32Array</span>(<span class=\"code-number\">2</span>);\n","        <span class=\"code-keyword\">var</span> _float32$<span class=\"code-number\">1</span> = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Float32Array</span>(_int32$<span class=\"code-number\">1.</span>buffer);\n","        <span class=\"code-keyword\">var</span> _float64$<span class=\"code-number\">1</span> = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Float64Array</span>(_int32$<span class=\"code-number\">1.</span>buffer);\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">writeFloat32</span>(<span class=\"code-params\">bytes, value</span>) </span>{\n","            _float32$<span class=\"code-number\">1</span>[<span class=\"code-number\">0</span>] = value;\n","            int32$<span class=\"code-number\">1</span>(bytes, _int32$<span class=\"code-number\">1</span>[<span class=\"code-number\">0</span>]);\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">writeFloat64</span>(<span class=\"code-params\">bytes, value</span>) </span>{\n","            _float64$<span class=\"code-number\">1</span>[<span class=\"code-number\">0</span>] = value;\n","            int32$<span class=\"code-number\">1</span>(bytes, _int32$<span class=\"code-number\">1</span>[<span class=\"code-number\">0</span> ]);\n","            int32$<span class=\"code-number\">1</span>(bytes, _int32$<span class=\"code-number\">1</span>[<span class=\"code-number\">1</span> ]);\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">boolean$1</span>(<span class=\"code-params\">bytes, value</span>) </span>{\n","            <span class=\"code-keyword\">return</span> uint8$<span class=\"code-number\">1</span>(bytes, value ? <span class=\"code-number\">1</span> : <span class=\"code-number\">0</span>);\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">string$1</span>(<span class=\"code-params\">bytes, value</span>) </span>{\n","            <span class=\"code-comment\">// encode `null` strings as empty.</span>\n","            <span class=\"code-keyword\">if</span> (!value) {\n","                value = <span class=\"code-string\">\"\"</span>;\n","            }\n","            <span class=\"code-keyword\">var</span> length = utf8Length(value);\n","            <span class=\"code-keyword\">var</span> size = <span class=\"code-number\">0</span>;\n","            <span class=\"code-comment\">// fixstr</span>\n","            <span class=\"code-keyword\">if</span> (length &lt; <span class=\"code-number\">0x20</span>) {\n","                bytes.push(length | <span class=\"code-number\">0xa0</span>);\n","                size = <span class=\"code-number\">1</span>;\n","            }\n","            <span class=\"code-comment\">// str 8</span>\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (length &lt; <span class=\"code-number\">0x100</span>) {\n","                bytes.push(<span class=\"code-number\">0xd9</span>);\n","                uint8$<span class=\"code-number\">1</span>(bytes, length);\n","                size = <span class=\"code-number\">2</span>;\n","            }\n","            <span class=\"code-comment\">// str 16</span>\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (length &lt; <span class=\"code-number\">0x10000</span>) {\n","                bytes.push(<span class=\"code-number\">0xda</span>);\n","                uint16$<span class=\"code-number\">1</span>(bytes, length);\n","                size = <span class=\"code-number\">3</span>;\n","            }\n","            <span class=\"code-comment\">// str 32</span>\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (length &lt; <span class=\"code-number\">0x100000000</span>) {\n","                bytes.push(<span class=\"code-number\">0xdb</span>);\n","                uint32$<span class=\"code-number\">1</span>(bytes, length);\n","                size = <span class=\"code-number\">5</span>;\n","            }\n","            <span class=\"code-keyword\">else</span> {\n","                <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">'String too long'</span>);\n","            }\n","            utf8Write(bytes, bytes.length, value);\n","            <span class=\"code-keyword\">return</span> size + length;\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">number$1</span>(<span class=\"code-params\">bytes, value</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (<span class=\"code-built_in\">isNaN</span>(value)) {\n","                <span class=\"code-keyword\">return</span> number$<span class=\"code-number\">1</span>(bytes, <span class=\"code-number\">0</span>);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (!<span class=\"code-built_in\">isFinite</span>(value)) {\n","                <span class=\"code-keyword\">return</span> number$<span class=\"code-number\">1</span>(bytes, (value &gt; <span class=\"code-number\">0</span>) ? <span class=\"code-built_in\">Number</span>.MAX_SAFE_INTEGER : -<span class=\"code-built_in\">Number</span>.MAX_SAFE_INTEGER);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (value !== (value | <span class=\"code-number\">0</span>)) {\n","                bytes.push(<span class=\"code-number\">0xcb</span>);\n","                writeFloat64(bytes, value);\n","                <span class=\"code-keyword\">return</span> <span class=\"code-number\">9</span>;\n","                <span class=\"code-comment\">// <span class=\"code-doctag\">TODO:</span> encode float 32?</span>\n","                <span class=\"code-comment\">// is it possible to differentiate between float32 / float64 here?</span>\n","                <span class=\"code-comment\">// // float 32</span>\n","                <span class=\"code-comment\">// bytes.push(0xca);</span>\n","                <span class=\"code-comment\">// writeFloat32(bytes, value);</span>\n","                <span class=\"code-comment\">// return 5;</span>\n","            }\n","            <span class=\"code-keyword\">if</span> (value &gt;= <span class=\"code-number\">0</span>) {\n","                <span class=\"code-comment\">// positive fixnum</span>\n","                <span class=\"code-keyword\">if</span> (value &lt; <span class=\"code-number\">0x80</span>) {\n","                    uint8$<span class=\"code-number\">1</span>(bytes, value);\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-number\">1</span>;\n","                }\n","                <span class=\"code-comment\">// uint 8</span>\n","                <span class=\"code-keyword\">if</span> (value &lt; <span class=\"code-number\">0x100</span>) {\n","                    bytes.push(<span class=\"code-number\">0xcc</span>);\n","                    uint8$<span class=\"code-number\">1</span>(bytes, value);\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-number\">2</span>;\n","                }\n","                <span class=\"code-comment\">// uint 16</span>\n","                <span class=\"code-keyword\">if</span> (value &lt; <span class=\"code-number\">0x10000</span>) {\n","                    bytes.push(<span class=\"code-number\">0xcd</span>);\n","                    uint16$<span class=\"code-number\">1</span>(bytes, value);\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-number\">3</span>;\n","                }\n","                <span class=\"code-comment\">// uint 32</span>\n","                <span class=\"code-keyword\">if</span> (value &lt; <span class=\"code-number\">0x100000000</span>) {\n","                    bytes.push(<span class=\"code-number\">0xce</span>);\n","                    uint32$<span class=\"code-number\">1</span>(bytes, value);\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-number\">5</span>;\n","                }\n","                <span class=\"code-comment\">// uint 64</span>\n","                bytes.push(<span class=\"code-number\">0xcf</span>);\n","                uint64$<span class=\"code-number\">1</span>(bytes, value);\n","                <span class=\"code-keyword\">return</span> <span class=\"code-number\">9</span>;\n","            }\n","            <span class=\"code-keyword\">else</span> {\n","                <span class=\"code-comment\">// negative fixnum</span>\n","                <span class=\"code-keyword\">if</span> (value &gt;= <span class=\"code-number\">-0x20</span>) {\n","                    bytes.push(<span class=\"code-number\">0xe0</span> | (value + <span class=\"code-number\">0x20</span>));\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-number\">1</span>;\n","                }\n","                <span class=\"code-comment\">// int 8</span>\n","                <span class=\"code-keyword\">if</span> (value &gt;= <span class=\"code-number\">-0x80</span>) {\n","                    bytes.push(<span class=\"code-number\">0xd0</span>);\n","                    int8$<span class=\"code-number\">1</span>(bytes, value);\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-number\">2</span>;\n","                }\n","                <span class=\"code-comment\">// int 16</span>\n","                <span class=\"code-keyword\">if</span> (value &gt;= <span class=\"code-number\">-0x8000</span>) {\n","                    bytes.push(<span class=\"code-number\">0xd1</span>);\n","                    int16$<span class=\"code-number\">1</span>(bytes, value);\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-number\">3</span>;\n","                }\n","                <span class=\"code-comment\">// int 32</span>\n","                <span class=\"code-keyword\">if</span> (value &gt;= <span class=\"code-number\">-0x80000000</span>) {\n","                    bytes.push(<span class=\"code-number\">0xd2</span>);\n","                    int32$<span class=\"code-number\">1</span>(bytes, value);\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-number\">5</span>;\n","                }\n","                <span class=\"code-comment\">// int 64</span>\n","                bytes.push(<span class=\"code-number\">0xd3</span>);\n","                int64$<span class=\"code-number\">1</span>(bytes, value);\n","                <span class=\"code-keyword\">return</span> <span class=\"code-number\">9</span>;\n","            }\n","        }\n","\n","        <span class=\"code-keyword\">var</span> encode = <span class=\"code-comment\">/*#__PURE__*/</span><span class=\"code-built_in\">Object</span>.freeze({\n","            __proto__: <span class=\"code-literal\">null</span>,\n","            utf8Write: utf8Write,\n","            int8: int8$<span class=\"code-number\">1</span>,\n","            uint8: uint8$<span class=\"code-number\">1</span>,\n","            int16: int16$<span class=\"code-number\">1</span>,\n","            uint16: uint16$<span class=\"code-number\">1</span>,\n","            int32: int32$<span class=\"code-number\">1</span>,\n","            uint32: uint32$<span class=\"code-number\">1</span>,\n","            int64: int64$<span class=\"code-number\">1</span>,\n","            uint64: uint64$<span class=\"code-number\">1</span>,\n","            float32: float32$<span class=\"code-number\">1</span>,\n","            float64: float64$<span class=\"code-number\">1</span>,\n","            writeFloat32: writeFloat32,\n","            writeFloat64: writeFloat64,\n","            boolean: boolean$<span class=\"code-number\">1</span>,\n","            string: string$<span class=\"code-number\">1</span>,\n","            number: number$<span class=\"code-number\">1</span>\n","        });\n","\n","        <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">         * Copyright (c) 2018 Endel Dreyer\n</span>","<span class=\"code-comment\">         * Copyright (c) 2014 Ion Drive Software Ltd.\n</span>","<span class=\"code-comment\">         *\n</span>","<span class=\"code-comment\">         * Permission is hereby granted, free of charge, to any person obtaining a copy\n</span>","<span class=\"code-comment\">         * of this software and associated documentation files (the \"Software\"), to deal\n</span>","<span class=\"code-comment\">         * in the Software without restriction, including without limitation the rights\n</span>","<span class=\"code-comment\">         * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n</span>","<span class=\"code-comment\">         * copies of the Software, and to permit persons to whom the Software is\n</span>","<span class=\"code-comment\">         * furnished to do so, subject to the following conditions:\n</span>","<span class=\"code-comment\">         *\n</span>","<span class=\"code-comment\">         * The above copyright notice and this permission notice shall be included in all\n</span>","<span class=\"code-comment\">         * copies or substantial portions of the Software.\n</span>","<span class=\"code-comment\">         *\n</span>","<span class=\"code-comment\">         * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n</span>","<span class=\"code-comment\">         * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n</span>","<span class=\"code-comment\">         * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n</span>","<span class=\"code-comment\">         * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n</span>","<span class=\"code-comment\">         * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n</span>","<span class=\"code-comment\">         * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n</span>","<span class=\"code-comment\">         * SOFTWARE\n</span>","<span class=\"code-comment\">         */</span>\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">utf8Read</span>(<span class=\"code-params\">bytes, offset, length</span>) </span>{\n","            <span class=\"code-keyword\">var</span> string = <span class=\"code-string\">''</span>, chr = <span class=\"code-number\">0</span>;\n","            <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> i = offset, end = offset + length; i &lt; end; i++) {\n","                <span class=\"code-keyword\">var</span> byte = bytes[i];\n","                <span class=\"code-keyword\">if</span> ((byte &amp; <span class=\"code-number\">0x80</span>) === <span class=\"code-number\">0x00</span>) {\n","                    string += <span class=\"code-built_in\">String</span>.fromCharCode(byte);\n","                    <span class=\"code-keyword\">continue</span>;\n","                }\n","                <span class=\"code-keyword\">if</span> ((byte &amp; <span class=\"code-number\">0xe0</span>) === <span class=\"code-number\">0xc0</span>) {\n","                    string += <span class=\"code-built_in\">String</span>.fromCharCode(((byte &amp; <span class=\"code-number\">0x1f</span>) &lt;&lt; <span class=\"code-number\">6</span>) |\n","                        (bytes[++i] &amp; <span class=\"code-number\">0x3f</span>));\n","                    <span class=\"code-keyword\">continue</span>;\n","                }\n","                <span class=\"code-keyword\">if</span> ((byte &amp; <span class=\"code-number\">0xf0</span>) === <span class=\"code-number\">0xe0</span>) {\n","                    string += <span class=\"code-built_in\">String</span>.fromCharCode(((byte &amp; <span class=\"code-number\">0x0f</span>) &lt;&lt; <span class=\"code-number\">12</span>) |\n","                        ((bytes[++i] &amp; <span class=\"code-number\">0x3f</span>) &lt;&lt; <span class=\"code-number\">6</span>) |\n","                        ((bytes[++i] &amp; <span class=\"code-number\">0x3f</span>) &lt;&lt; <span class=\"code-number\">0</span>));\n","                    <span class=\"code-keyword\">continue</span>;\n","                }\n","                <span class=\"code-keyword\">if</span> ((byte &amp; <span class=\"code-number\">0xf8</span>) === <span class=\"code-number\">0xf0</span>) {\n","                    chr = ((byte &amp; <span class=\"code-number\">0x07</span>) &lt;&lt; <span class=\"code-number\">18</span>) |\n","                        ((bytes[++i] &amp; <span class=\"code-number\">0x3f</span>) &lt;&lt; <span class=\"code-number\">12</span>) |\n","                        ((bytes[++i] &amp; <span class=\"code-number\">0x3f</span>) &lt;&lt; <span class=\"code-number\">6</span>) |\n","                        ((bytes[++i] &amp; <span class=\"code-number\">0x3f</span>) &lt;&lt; <span class=\"code-number\">0</span>);\n","                    <span class=\"code-keyword\">if</span> (chr &gt;= <span class=\"code-number\">0x010000</span>) { <span class=\"code-comment\">// surrogate pair</span>\n","                        chr -= <span class=\"code-number\">0x010000</span>;\n","                        string += <span class=\"code-built_in\">String</span>.fromCharCode((chr &gt;&gt;&gt; <span class=\"code-number\">10</span>) + <span class=\"code-number\">0xD800</span>, (chr &amp; <span class=\"code-number\">0x3FF</span>) + <span class=\"code-number\">0xDC00</span>);\n","                    }\n","                    <span class=\"code-keyword\">else</span> {\n","                        string += <span class=\"code-built_in\">String</span>.fromCharCode(chr);\n","                    }\n","                    <span class=\"code-keyword\">continue</span>;\n","                }\n","                <span class=\"code-built_in\">console</span>.error(<span class=\"code-string\">'Invalid byte '</span> + byte.toString(<span class=\"code-number\">16</span>));\n","                <span class=\"code-comment\">// (do not throw error to avoid server/client from crashing due to hack attemps)</span>\n","                <span class=\"code-comment\">// throw new Error('Invalid byte ' + byte.toString(16));</span>\n","            }\n","            <span class=\"code-keyword\">return</span> string;\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">int8</span>(<span class=\"code-params\">bytes, it</span>) </span>{\n","            <span class=\"code-keyword\">return</span> uint8(bytes, it) &lt;&lt; <span class=\"code-number\">24</span> &gt;&gt; <span class=\"code-number\">24</span>;\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">uint8</span>(<span class=\"code-params\">bytes, it</span>) </span>{\n","            <span class=\"code-keyword\">return</span> bytes[it.offset++];\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">int16</span>(<span class=\"code-params\">bytes, it</span>) </span>{\n","            <span class=\"code-keyword\">return</span> uint16(bytes, it) &lt;&lt; <span class=\"code-number\">16</span> &gt;&gt; <span class=\"code-number\">16</span>;\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">uint16</span>(<span class=\"code-params\">bytes, it</span>) </span>{\n","            <span class=\"code-keyword\">return</span> bytes[it.offset++] | bytes[it.offset++] &lt;&lt; <span class=\"code-number\">8</span>;\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">int32</span>(<span class=\"code-params\">bytes, it</span>) </span>{\n","            <span class=\"code-keyword\">return</span> bytes[it.offset++] | bytes[it.offset++] &lt;&lt; <span class=\"code-number\">8</span> | bytes[it.offset++] &lt;&lt; <span class=\"code-number\">16</span> | bytes[it.offset++] &lt;&lt; <span class=\"code-number\">24</span>;\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">uint32</span>(<span class=\"code-params\">bytes, it</span>) </span>{\n","            <span class=\"code-keyword\">return</span> int32(bytes, it) &gt;&gt;&gt; <span class=\"code-number\">0</span>;\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">float32</span>(<span class=\"code-params\">bytes, it</span>) </span>{\n","            <span class=\"code-keyword\">return</span> readFloat32(bytes, it);\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">float64</span>(<span class=\"code-params\">bytes, it</span>) </span>{\n","            <span class=\"code-keyword\">return</span> readFloat64(bytes, it);\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">int64</span>(<span class=\"code-params\">bytes, it</span>) </span>{\n","            <span class=\"code-keyword\">var</span> low = uint32(bytes, it);\n","            <span class=\"code-keyword\">var</span> high = int32(bytes, it) * <span class=\"code-built_in\">Math</span>.pow(<span class=\"code-number\">2</span>, <span class=\"code-number\">32</span>);\n","            <span class=\"code-keyword\">return</span> high + low;\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">uint64</span>(<span class=\"code-params\">bytes, it</span>) </span>{\n","            <span class=\"code-keyword\">var</span> low = uint32(bytes, it);\n","            <span class=\"code-keyword\">var</span> high = uint32(bytes, it) * <span class=\"code-built_in\">Math</span>.pow(<span class=\"code-number\">2</span>, <span class=\"code-number\">32</span>);\n","            <span class=\"code-keyword\">return</span> high + low;\n","        }\n","        <span class=\"code-keyword\">var</span> _int32 = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Int32Array</span>(<span class=\"code-number\">2</span>);\n","        <span class=\"code-keyword\">var</span> _float32 = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Float32Array</span>(_int32.buffer);\n","        <span class=\"code-keyword\">var</span> _float64 = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Float64Array</span>(_int32.buffer);\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">readFloat32</span>(<span class=\"code-params\">bytes, it</span>) </span>{\n","            _int32[<span class=\"code-number\">0</span>] = int32(bytes, it);\n","            <span class=\"code-keyword\">return</span> _float32[<span class=\"code-number\">0</span>];\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">readFloat64</span>(<span class=\"code-params\">bytes, it</span>) </span>{\n","            _int32[<span class=\"code-number\">0</span> ] = int32(bytes, it);\n","            _int32[<span class=\"code-number\">1</span> ] = int32(bytes, it);\n","            <span class=\"code-keyword\">return</span> _float64[<span class=\"code-number\">0</span>];\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">boolean</span>(<span class=\"code-params\">bytes, it</span>) </span>{\n","            <span class=\"code-keyword\">return</span> uint8(bytes, it) &gt; <span class=\"code-number\">0</span>;\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">string</span>(<span class=\"code-params\">bytes, it</span>) </span>{\n","            <span class=\"code-keyword\">var</span> prefix = bytes[it.offset++];\n","            <span class=\"code-keyword\">var</span> length;\n","            <span class=\"code-keyword\">if</span> (prefix &lt; <span class=\"code-number\">0xc0</span>) {\n","                <span class=\"code-comment\">// fixstr</span>\n","                length = prefix &amp; <span class=\"code-number\">0x1f</span>;\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (prefix === <span class=\"code-number\">0xd9</span>) {\n","                length = uint8(bytes, it);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (prefix === <span class=\"code-number\">0xda</span>) {\n","                length = uint16(bytes, it);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (prefix === <span class=\"code-number\">0xdb</span>) {\n","                length = uint32(bytes, it);\n","            }\n","            <span class=\"code-keyword\">var</span> value = utf8Read(bytes, it.offset, length);\n","            it.offset += length;\n","            <span class=\"code-keyword\">return</span> value;\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">stringCheck</span>(<span class=\"code-params\">bytes, it</span>) </span>{\n","            <span class=\"code-keyword\">var</span> prefix = bytes[it.offset];\n","            <span class=\"code-keyword\">return</span> (\n","            <span class=\"code-comment\">// fixstr</span>\n","            (prefix &lt; <span class=\"code-number\">0xc0</span> &amp;&amp; prefix &gt; <span class=\"code-number\">0xa0</span>) ||\n","                <span class=\"code-comment\">// str 8</span>\n","                prefix === <span class=\"code-number\">0xd9</span> ||\n","                <span class=\"code-comment\">// str 16</span>\n","                prefix === <span class=\"code-number\">0xda</span> ||\n","                <span class=\"code-comment\">// str 32</span>\n","                prefix === <span class=\"code-number\">0xdb</span>);\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">number</span>(<span class=\"code-params\">bytes, it</span>) </span>{\n","            <span class=\"code-keyword\">var</span> prefix = bytes[it.offset++];\n","            <span class=\"code-keyword\">if</span> (prefix &lt; <span class=\"code-number\">0x80</span>) {\n","                <span class=\"code-comment\">// positive fixint</span>\n","                <span class=\"code-keyword\">return</span> prefix;\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (prefix === <span class=\"code-number\">0xca</span>) {\n","                <span class=\"code-comment\">// float 32</span>\n","                <span class=\"code-keyword\">return</span> readFloat32(bytes, it);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (prefix === <span class=\"code-number\">0xcb</span>) {\n","                <span class=\"code-comment\">// float 64</span>\n","                <span class=\"code-keyword\">return</span> readFloat64(bytes, it);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (prefix === <span class=\"code-number\">0xcc</span>) {\n","                <span class=\"code-comment\">// uint 8</span>\n","                <span class=\"code-keyword\">return</span> uint8(bytes, it);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (prefix === <span class=\"code-number\">0xcd</span>) {\n","                <span class=\"code-comment\">// uint 16</span>\n","                <span class=\"code-keyword\">return</span> uint16(bytes, it);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (prefix === <span class=\"code-number\">0xce</span>) {\n","                <span class=\"code-comment\">// uint 32</span>\n","                <span class=\"code-keyword\">return</span> uint32(bytes, it);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (prefix === <span class=\"code-number\">0xcf</span>) {\n","                <span class=\"code-comment\">// uint 64</span>\n","                <span class=\"code-keyword\">return</span> uint64(bytes, it);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (prefix === <span class=\"code-number\">0xd0</span>) {\n","                <span class=\"code-comment\">// int 8</span>\n","                <span class=\"code-keyword\">return</span> int8(bytes, it);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (prefix === <span class=\"code-number\">0xd1</span>) {\n","                <span class=\"code-comment\">// int 16</span>\n","                <span class=\"code-keyword\">return</span> int16(bytes, it);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (prefix === <span class=\"code-number\">0xd2</span>) {\n","                <span class=\"code-comment\">// int 32</span>\n","                <span class=\"code-keyword\">return</span> int32(bytes, it);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (prefix === <span class=\"code-number\">0xd3</span>) {\n","                <span class=\"code-comment\">// int 64</span>\n","                <span class=\"code-keyword\">return</span> int64(bytes, it);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (prefix &gt; <span class=\"code-number\">0xdf</span>) {\n","                <span class=\"code-comment\">// negative fixint</span>\n","                <span class=\"code-keyword\">return</span> (<span class=\"code-number\">0xff</span> - prefix + <span class=\"code-number\">1</span>) * <span class=\"code-number\">-1</span>;\n","            }\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">numberCheck</span>(<span class=\"code-params\">bytes, it</span>) </span>{\n","            <span class=\"code-keyword\">var</span> prefix = bytes[it.offset];\n","            <span class=\"code-comment\">// positive fixint - 0x00 - 0x7f</span>\n","            <span class=\"code-comment\">// float 32        - 0xca</span>\n","            <span class=\"code-comment\">// float 64        - 0xcb</span>\n","            <span class=\"code-comment\">// uint 8          - 0xcc</span>\n","            <span class=\"code-comment\">// uint 16         - 0xcd</span>\n","            <span class=\"code-comment\">// uint 32         - 0xce</span>\n","            <span class=\"code-comment\">// uint 64         - 0xcf</span>\n","            <span class=\"code-comment\">// int 8           - 0xd0</span>\n","            <span class=\"code-comment\">// int 16          - 0xd1</span>\n","            <span class=\"code-comment\">// int 32          - 0xd2</span>\n","            <span class=\"code-comment\">// int 64          - 0xd3</span>\n","            <span class=\"code-keyword\">return</span> (prefix &lt; <span class=\"code-number\">0x80</span> ||\n","                (prefix &gt;= <span class=\"code-number\">0xca</span> &amp;&amp; prefix &lt;= <span class=\"code-number\">0xd3</span>));\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">arrayCheck</span>(<span class=\"code-params\">bytes, it</span>) </span>{\n","            <span class=\"code-keyword\">return</span> bytes[it.offset] &lt; <span class=\"code-number\">0xa0</span>;\n","            <span class=\"code-comment\">// const prefix = bytes[it.offset] ;</span>\n","            <span class=\"code-comment\">// if (prefix &lt; 0xa0) {</span>\n","            <span class=\"code-comment\">//   return prefix;</span>\n","            <span class=\"code-comment\">// // array</span>\n","            <span class=\"code-comment\">// } else if (prefix === 0xdc) {</span>\n","            <span class=\"code-comment\">//   it.offset += 2;</span>\n","            <span class=\"code-comment\">// } else if (0xdd) {</span>\n","            <span class=\"code-comment\">//   it.offset += 4;</span>\n","            <span class=\"code-comment\">// }</span>\n","            <span class=\"code-comment\">// return prefix;</span>\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">switchStructureCheck</span>(<span class=\"code-params\">bytes, it</span>) </span>{\n","            <span class=\"code-keyword\">return</span> (\n","            <span class=\"code-comment\">// previous byte should be `SWITCH_TO_STRUCTURE`</span>\n","            bytes[it.offset - <span class=\"code-number\">1</span>] === SWITCH_TO_STRUCTURE &amp;&amp;\n","                <span class=\"code-comment\">// next byte should be a number</span>\n","                (bytes[it.offset] &lt; <span class=\"code-number\">0x80</span> || (bytes[it.offset] &gt;= <span class=\"code-number\">0xca</span> &amp;&amp; bytes[it.offset] &lt;= <span class=\"code-number\">0xd3</span>)));\n","        }\n","\n","        <span class=\"code-keyword\">var</span> decode = <span class=\"code-comment\">/*#__PURE__*/</span><span class=\"code-built_in\">Object</span>.freeze({\n","            __proto__: <span class=\"code-literal\">null</span>,\n","            int8: int8,\n","            uint8: uint8,\n","            int16: int16,\n","            uint16: uint16,\n","            int32: int32,\n","            uint32: uint32,\n","            float32: float32,\n","            float64: float64,\n","            int64: int64,\n","            uint64: uint64,\n","            readFloat32: readFloat32,\n","            readFloat64: readFloat64,\n","            boolean: boolean,\n","            string: string,\n","            stringCheck: stringCheck,\n","            number: number,\n","            numberCheck: numberCheck,\n","            arrayCheck: arrayCheck,\n","            switchStructureCheck: switchStructureCheck\n","        });\n","\n","        <span class=\"code-keyword\">var</span> CollectionSchema = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">CollectionSchema</span>(<span class=\"code-params\">initialValues</span>) </span>{\n","                <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","                <span class=\"code-keyword\">this</span>.$changes = <span class=\"code-keyword\">new</span> ChangeTree(<span class=\"code-keyword\">this</span>);\n","                <span class=\"code-keyword\">this</span>.$items = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Map</span>();\n","                <span class=\"code-keyword\">this</span>.$indexes = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Map</span>();\n","                <span class=\"code-keyword\">this</span>.$refId = <span class=\"code-number\">0</span>;\n","                <span class=\"code-keyword\">if</span> (initialValues) {\n","                    initialValues.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">v</span>) </span>{ <span class=\"code-keyword\">return</span> _this.add(v); });\n","                }\n","            }\n","            CollectionSchema.prototype.onAdd = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback, triggerAll</span>) </span>{\n","                <span class=\"code-keyword\">if</span> (triggerAll === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { triggerAll = <span class=\"code-literal\">true</span>; }\n","                <span class=\"code-keyword\">return</span> addCallback((<span class=\"code-keyword\">this</span>.$callbacks || (<span class=\"code-keyword\">this</span>.$callbacks = [])), exports.OPERATION.ADD, callback, (triggerAll)\n","                    ? <span class=\"code-keyword\">this</span>.$items\n","                    : <span class=\"code-literal\">undefined</span>);\n","            };\n","            CollectionSchema.prototype.onRemove = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback</span>) </span>{ <span class=\"code-keyword\">return</span> addCallback(<span class=\"code-keyword\">this</span>.$callbacks || (<span class=\"code-keyword\">this</span>.$callbacks = []), exports.OPERATION.DELETE, callback); };\n","            CollectionSchema.prototype.onChange = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback</span>) </span>{ <span class=\"code-keyword\">return</span> addCallback(<span class=\"code-keyword\">this</span>.$callbacks || (<span class=\"code-keyword\">this</span>.$callbacks = []), exports.OPERATION.REPLACE, callback); };\n","            CollectionSchema.is = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">type</span>) </span>{\n","                <span class=\"code-keyword\">return</span> type[<span class=\"code-string\">'collection'</span>] !== <span class=\"code-literal\">undefined</span>;\n","            };\n","            CollectionSchema.prototype.add = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">value</span>) </span>{\n","                <span class=\"code-comment\">// set \"index\" for reference.</span>\n","                <span class=\"code-keyword\">var</span> index = <span class=\"code-keyword\">this</span>.$refId++;\n","                <span class=\"code-keyword\">var</span> isRef = (value[<span class=\"code-string\">'$changes'</span>]) !== <span class=\"code-literal\">undefined</span>;\n","                <span class=\"code-keyword\">if</span> (isRef) {\n","                    value[<span class=\"code-string\">'$changes'</span>].setParent(<span class=\"code-keyword\">this</span>, <span class=\"code-keyword\">this</span>.$changes.root, index);\n","                }\n","                <span class=\"code-keyword\">this</span>.$changes.indexes[index] = index;\n","                <span class=\"code-keyword\">this</span>.$indexes.set(index, index);\n","                <span class=\"code-keyword\">this</span>.$items.set(index, value);\n","                <span class=\"code-keyword\">this</span>.$changes.change(index);\n","                <span class=\"code-keyword\">return</span> index;\n","            };\n","            CollectionSchema.prototype.at = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index</span>) </span>{\n","                <span class=\"code-keyword\">var</span> key = <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.keys())[index];\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.get(key);\n","            };\n","            CollectionSchema.prototype.entries = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.entries();\n","            };\n","            CollectionSchema.prototype.delete = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">item</span>) </span>{\n","                <span class=\"code-keyword\">var</span> entries = <span class=\"code-keyword\">this</span>.$items.entries();\n","                <span class=\"code-keyword\">var</span> index;\n","                <span class=\"code-keyword\">var</span> entry;\n","                <span class=\"code-keyword\">while</span> (entry = entries.next()) {\n","                    <span class=\"code-keyword\">if</span> (entry.done) {\n","                        <span class=\"code-keyword\">break</span>;\n","                    }\n","                    <span class=\"code-keyword\">if</span> (item === entry.value[<span class=\"code-number\">1</span>]) {\n","                        index = entry.value[<span class=\"code-number\">0</span>];\n","                        <span class=\"code-keyword\">break</span>;\n","                    }\n","                }\n","                <span class=\"code-keyword\">if</span> (index === <span class=\"code-literal\">undefined</span>) {\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-literal\">false</span>;\n","                }\n","                <span class=\"code-keyword\">this</span>.$changes.delete(index);\n","                <span class=\"code-keyword\">this</span>.$indexes.delete(index);\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.delete(index);\n","            };\n","            CollectionSchema.prototype.clear = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">changes</span>) </span>{\n","                <span class=\"code-comment\">// discard previous operations.</span>\n","                <span class=\"code-keyword\">this</span>.$changes.discard(<span class=\"code-literal\">true</span>, <span class=\"code-literal\">true</span>);\n","                <span class=\"code-keyword\">this</span>.$changes.indexes = {};\n","                <span class=\"code-comment\">// clear previous indexes</span>\n","                <span class=\"code-keyword\">this</span>.$indexes.clear();\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-comment\">// When decoding:</span>\n","                <span class=\"code-comment\">// - enqueue items for DELETE callback.</span>\n","                <span class=\"code-comment\">// - flag child items for garbage collection.</span>\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-keyword\">if</span> (changes) {\n","                    removeChildRefs.call(<span class=\"code-keyword\">this</span>, changes);\n","                }\n","                <span class=\"code-comment\">// clear items</span>\n","                <span class=\"code-keyword\">this</span>.$items.clear();\n","                <span class=\"code-keyword\">this</span>.$changes.operation({ <span class=\"code-attr\">index</span>: <span class=\"code-number\">0</span>, <span class=\"code-attr\">op</span>: exports.OPERATION.CLEAR });\n","                <span class=\"code-comment\">// touch all structures until reach root</span>\n","                <span class=\"code-keyword\">this</span>.$changes.touchParents();\n","            };\n","            CollectionSchema.prototype.has = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">value</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values()).some(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">v</span>) </span>{ <span class=\"code-keyword\">return</span> v === value; });\n","            };\n","            CollectionSchema.prototype.forEach = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callbackfn</span>) </span>{\n","                <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","                <span class=\"code-keyword\">this</span>.$items.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">value, key, _</span>) </span>{ <span class=\"code-keyword\">return</span> callbackfn(value, key, _this); });\n","            };\n","            CollectionSchema.prototype.values = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.values();\n","            };\n","            <span class=\"code-built_in\">Object</span>.defineProperty(CollectionSchema.prototype, <span class=\"code-string\">\"size\"</span>, {\n","                <span class=\"code-keyword\">get</span>: function () {\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.size;\n","                },\n","                enumerable: <span class=\"code-literal\">false</span>,\n","                configurable: <span class=\"code-literal\">true</span>\n","            });\n","            CollectionSchema.prototype.setIndex = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index, key</span>) </span>{\n","                <span class=\"code-keyword\">this</span>.$indexes.set(index, key);\n","            };\n","            CollectionSchema.prototype.getIndex = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$indexes.get(index);\n","            };\n","            CollectionSchema.prototype.getByIndex = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.get(<span class=\"code-keyword\">this</span>.$indexes.get(index));\n","            };\n","            CollectionSchema.prototype.deleteByIndex = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index</span>) </span>{\n","                <span class=\"code-keyword\">var</span> key = <span class=\"code-keyword\">this</span>.$indexes.get(index);\n","                <span class=\"code-keyword\">this</span>.$items.delete(key);\n","                <span class=\"code-keyword\">this</span>.$indexes.delete(index);\n","            };\n","            CollectionSchema.prototype.toArray = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values());\n","            };\n","            CollectionSchema.prototype.toJSON = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> values = [];\n","                <span class=\"code-keyword\">this</span>.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">value, key</span>) </span>{\n","                    values.push((<span class=\"code-keyword\">typeof</span> (value[<span class=\"code-string\">'toJSON'</span>]) === <span class=\"code-string\">\"function\"</span>)\n","                        ? value[<span class=\"code-string\">'toJSON'</span>]()\n","                        : value);\n","                });\n","                <span class=\"code-keyword\">return</span> values;\n","            };\n","            <span class=\"code-comment\">//</span>\n","            <span class=\"code-comment\">// Decoding utilities</span>\n","            <span class=\"code-comment\">//</span>\n","            CollectionSchema.prototype.clone = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">isDecoding</span>) </span>{\n","                <span class=\"code-keyword\">var</span> cloned;\n","                <span class=\"code-keyword\">if</span> (isDecoding) {\n","                    <span class=\"code-comment\">// client-side</span>\n","                    cloned = <span class=\"code-built_in\">Object</span>.assign(<span class=\"code-keyword\">new</span> CollectionSchema(), <span class=\"code-keyword\">this</span>);\n","                }\n","                <span class=\"code-keyword\">else</span> {\n","                    <span class=\"code-comment\">// server-side</span>\n","                    cloned = <span class=\"code-keyword\">new</span> CollectionSchema();\n","                    <span class=\"code-keyword\">this</span>.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">value</span>) </span>{\n","                        <span class=\"code-keyword\">if</span> (value[<span class=\"code-string\">'$changes'</span>]) {\n","                            cloned.add(value[<span class=\"code-string\">'clone'</span>]());\n","                        }\n","                        <span class=\"code-keyword\">else</span> {\n","                            cloned.add(value);\n","                        }\n","                    });\n","                }\n","                <span class=\"code-keyword\">return</span> cloned;\n","            };\n","            <span class=\"code-keyword\">return</span> CollectionSchema;\n","        }());\n","\n","        <span class=\"code-keyword\">var</span> SetSchema = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">SetSchema</span>(<span class=\"code-params\">initialValues</span>) </span>{\n","                <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","                <span class=\"code-keyword\">this</span>.$changes = <span class=\"code-keyword\">new</span> ChangeTree(<span class=\"code-keyword\">this</span>);\n","                <span class=\"code-keyword\">this</span>.$items = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Map</span>();\n","                <span class=\"code-keyword\">this</span>.$indexes = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Map</span>();\n","                <span class=\"code-keyword\">this</span>.$refId = <span class=\"code-number\">0</span>;\n","                <span class=\"code-keyword\">if</span> (initialValues) {\n","                    initialValues.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">v</span>) </span>{ <span class=\"code-keyword\">return</span> _this.add(v); });\n","                }\n","            }\n","            SetSchema.prototype.onAdd = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback, triggerAll</span>) </span>{\n","                <span class=\"code-keyword\">if</span> (triggerAll === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { triggerAll = <span class=\"code-literal\">true</span>; }\n","                <span class=\"code-keyword\">return</span> addCallback((<span class=\"code-keyword\">this</span>.$callbacks || (<span class=\"code-keyword\">this</span>.$callbacks = [])), exports.OPERATION.ADD, callback, (triggerAll)\n","                    ? <span class=\"code-keyword\">this</span>.$items\n","                    : <span class=\"code-literal\">undefined</span>);\n","            };\n","            SetSchema.prototype.onRemove = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback</span>) </span>{ <span class=\"code-keyword\">return</span> addCallback(<span class=\"code-keyword\">this</span>.$callbacks || (<span class=\"code-keyword\">this</span>.$callbacks = []), exports.OPERATION.DELETE, callback); };\n","            SetSchema.prototype.onChange = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback</span>) </span>{ <span class=\"code-keyword\">return</span> addCallback(<span class=\"code-keyword\">this</span>.$callbacks || (<span class=\"code-keyword\">this</span>.$callbacks = []), exports.OPERATION.REPLACE, callback); };\n","            SetSchema.is = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">type</span>) </span>{\n","                <span class=\"code-keyword\">return</span> type[<span class=\"code-string\">'set'</span>] !== <span class=\"code-literal\">undefined</span>;\n","            };\n","            SetSchema.prototype.add = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">value</span>) </span>{\n","                <span class=\"code-keyword\">var</span> _a, _b;\n","                <span class=\"code-comment\">// immediatelly return false if value already added.</span>\n","                <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">this</span>.has(value)) {\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-literal\">false</span>;\n","                }\n","                <span class=\"code-comment\">// set \"index\" for reference.</span>\n","                <span class=\"code-keyword\">var</span> index = <span class=\"code-keyword\">this</span>.$refId++;\n","                <span class=\"code-keyword\">if</span> ((value[<span class=\"code-string\">'$changes'</span>]) !== <span class=\"code-literal\">undefined</span>) {\n","                    value[<span class=\"code-string\">'$changes'</span>].setParent(<span class=\"code-keyword\">this</span>, <span class=\"code-keyword\">this</span>.$changes.root, index);\n","                }\n","                <span class=\"code-keyword\">var</span> operation = (_b = (_a = <span class=\"code-keyword\">this</span>.$changes.indexes[index]) === <span class=\"code-literal\">null</span> || _a === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _a.op) !== <span class=\"code-literal\">null</span> &amp;&amp; _b !== <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? _b : exports.OPERATION.ADD;\n","                <span class=\"code-keyword\">this</span>.$changes.indexes[index] = index;\n","                <span class=\"code-keyword\">this</span>.$indexes.set(index, index);\n","                <span class=\"code-keyword\">this</span>.$items.set(index, value);\n","                <span class=\"code-keyword\">this</span>.$changes.change(index, operation);\n","                <span class=\"code-keyword\">return</span> index;\n","            };\n","            SetSchema.prototype.entries = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.entries();\n","            };\n","            SetSchema.prototype.delete = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">item</span>) </span>{\n","                <span class=\"code-keyword\">var</span> entries = <span class=\"code-keyword\">this</span>.$items.entries();\n","                <span class=\"code-keyword\">var</span> index;\n","                <span class=\"code-keyword\">var</span> entry;\n","                <span class=\"code-keyword\">while</span> (entry = entries.next()) {\n","                    <span class=\"code-keyword\">if</span> (entry.done) {\n","                        <span class=\"code-keyword\">break</span>;\n","                    }\n","                    <span class=\"code-keyword\">if</span> (item === entry.value[<span class=\"code-number\">1</span>]) {\n","                        index = entry.value[<span class=\"code-number\">0</span>];\n","                        <span class=\"code-keyword\">break</span>;\n","                    }\n","                }\n","                <span class=\"code-keyword\">if</span> (index === <span class=\"code-literal\">undefined</span>) {\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-literal\">false</span>;\n","                }\n","                <span class=\"code-keyword\">this</span>.$changes.delete(index);\n","                <span class=\"code-keyword\">this</span>.$indexes.delete(index);\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.delete(index);\n","            };\n","            SetSchema.prototype.clear = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">changes</span>) </span>{\n","                <span class=\"code-comment\">// discard previous operations.</span>\n","                <span class=\"code-keyword\">this</span>.$changes.discard(<span class=\"code-literal\">true</span>, <span class=\"code-literal\">true</span>);\n","                <span class=\"code-keyword\">this</span>.$changes.indexes = {};\n","                <span class=\"code-comment\">// clear previous indexes</span>\n","                <span class=\"code-keyword\">this</span>.$indexes.clear();\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-comment\">// When decoding:</span>\n","                <span class=\"code-comment\">// - enqueue items for DELETE callback.</span>\n","                <span class=\"code-comment\">// - flag child items for garbage collection.</span>\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-keyword\">if</span> (changes) {\n","                    removeChildRefs.call(<span class=\"code-keyword\">this</span>, changes);\n","                }\n","                <span class=\"code-comment\">// clear items</span>\n","                <span class=\"code-keyword\">this</span>.$items.clear();\n","                <span class=\"code-keyword\">this</span>.$changes.operation({ <span class=\"code-attr\">index</span>: <span class=\"code-number\">0</span>, <span class=\"code-attr\">op</span>: exports.OPERATION.CLEAR });\n","                <span class=\"code-comment\">// touch all structures until reach root</span>\n","                <span class=\"code-keyword\">this</span>.$changes.touchParents();\n","            };\n","            SetSchema.prototype.has = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">value</span>) </span>{\n","                <span class=\"code-keyword\">var</span> values = <span class=\"code-keyword\">this</span>.$items.values();\n","                <span class=\"code-keyword\">var</span> has = <span class=\"code-literal\">false</span>;\n","                <span class=\"code-keyword\">var</span> entry;\n","                <span class=\"code-keyword\">while</span> (entry = values.next()) {\n","                    <span class=\"code-keyword\">if</span> (entry.done) {\n","                        <span class=\"code-keyword\">break</span>;\n","                    }\n","                    <span class=\"code-keyword\">if</span> (value === entry.value) {\n","                        has = <span class=\"code-literal\">true</span>;\n","                        <span class=\"code-keyword\">break</span>;\n","                    }\n","                }\n","                <span class=\"code-keyword\">return</span> has;\n","            };\n","            SetSchema.prototype.forEach = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callbackfn</span>) </span>{\n","                <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","                <span class=\"code-keyword\">this</span>.$items.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">value, key, _</span>) </span>{ <span class=\"code-keyword\">return</span> callbackfn(value, key, _this); });\n","            };\n","            SetSchema.prototype.values = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.values();\n","            };\n","            <span class=\"code-built_in\">Object</span>.defineProperty(SetSchema.prototype, <span class=\"code-string\">\"size\"</span>, {\n","                <span class=\"code-keyword\">get</span>: function () {\n","                    <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.size;\n","                },\n","                enumerable: <span class=\"code-literal\">false</span>,\n","                configurable: <span class=\"code-literal\">true</span>\n","            });\n","            SetSchema.prototype.setIndex = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index, key</span>) </span>{\n","                <span class=\"code-keyword\">this</span>.$indexes.set(index, key);\n","            };\n","            SetSchema.prototype.getIndex = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$indexes.get(index);\n","            };\n","            SetSchema.prototype.getByIndex = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.$items.get(<span class=\"code-keyword\">this</span>.$indexes.get(index));\n","            };\n","            SetSchema.prototype.deleteByIndex = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index</span>) </span>{\n","                <span class=\"code-keyword\">var</span> key = <span class=\"code-keyword\">this</span>.$indexes.get(index);\n","                <span class=\"code-keyword\">this</span>.$items.delete(key);\n","                <span class=\"code-keyword\">this</span>.$indexes.delete(index);\n","            };\n","            SetSchema.prototype.toArray = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">this</span>.$items.values());\n","            };\n","            SetSchema.prototype.toJSON = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> values = [];\n","                <span class=\"code-keyword\">this</span>.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">value, key</span>) </span>{\n","                    values.push((<span class=\"code-keyword\">typeof</span> (value[<span class=\"code-string\">'toJSON'</span>]) === <span class=\"code-string\">\"function\"</span>)\n","                        ? value[<span class=\"code-string\">'toJSON'</span>]()\n","                        : value);\n","                });\n","                <span class=\"code-keyword\">return</span> values;\n","            };\n","            <span class=\"code-comment\">//</span>\n","            <span class=\"code-comment\">// Decoding utilities</span>\n","            <span class=\"code-comment\">//</span>\n","            SetSchema.prototype.clone = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">isDecoding</span>) </span>{\n","                <span class=\"code-keyword\">var</span> cloned;\n","                <span class=\"code-keyword\">if</span> (isDecoding) {\n","                    <span class=\"code-comment\">// client-side</span>\n","                    cloned = <span class=\"code-built_in\">Object</span>.assign(<span class=\"code-keyword\">new</span> SetSchema(), <span class=\"code-keyword\">this</span>);\n","                }\n","                <span class=\"code-keyword\">else</span> {\n","                    <span class=\"code-comment\">// server-side</span>\n","                    cloned = <span class=\"code-keyword\">new</span> SetSchema();\n","                    <span class=\"code-keyword\">this</span>.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">value</span>) </span>{\n","                        <span class=\"code-keyword\">if</span> (value[<span class=\"code-string\">'$changes'</span>]) {\n","                            cloned.add(value[<span class=\"code-string\">'clone'</span>]());\n","                        }\n","                        <span class=\"code-keyword\">else</span> {\n","                            cloned.add(value);\n","                        }\n","                    });\n","                }\n","                <span class=\"code-keyword\">return</span> cloned;\n","            };\n","            <span class=\"code-keyword\">return</span> SetSchema;\n","        }());\n","\n","        <span class=\"code-keyword\">var</span> ClientState = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">ClientState</span>(<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">this</span>.refIds = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">WeakSet</span>();\n","                <span class=\"code-keyword\">this</span>.containerIndexes = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">WeakMap</span>();\n","            }\n","            <span class=\"code-comment\">// containerIndexes = new Map&lt;ChangeTree, Set&lt;number&gt;&gt;();</span>\n","            ClientState.prototype.addRefId = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">changeTree</span>) </span>{\n","                <span class=\"code-keyword\">if</span> (!<span class=\"code-keyword\">this</span>.refIds.has(changeTree)) {\n","                    <span class=\"code-keyword\">this</span>.refIds.add(changeTree);\n","                    <span class=\"code-keyword\">this</span>.containerIndexes.set(changeTree, <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Set</span>());\n","                }\n","            };\n","            ClientState.get = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">client</span>) </span>{\n","                <span class=\"code-keyword\">if</span> (client.$filterState === <span class=\"code-literal\">undefined</span>) {\n","                    client.$filterState = <span class=\"code-keyword\">new</span> ClientState();\n","                }\n","                <span class=\"code-keyword\">return</span> client.$filterState;\n","            };\n","            <span class=\"code-keyword\">return</span> ClientState;\n","        }());\n","\n","        <span class=\"code-keyword\">var</span> ReferenceTracker = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">ReferenceTracker</span>(<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-comment\">// Relation of refId =&gt; Schema structure</span>\n","                <span class=\"code-comment\">// For direct access of structures during decoding time.</span>\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-keyword\">this</span>.refs = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Map</span>();\n","                <span class=\"code-keyword\">this</span>.refCounts = {};\n","                <span class=\"code-keyword\">this</span>.deletedRefs = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Set</span>();\n","                <span class=\"code-keyword\">this</span>.nextUniqueId = <span class=\"code-number\">0</span>;\n","            }\n","            ReferenceTracker.prototype.getNextUniqueId = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.nextUniqueId++;\n","            };\n","            <span class=\"code-comment\">// for decoding</span>\n","            ReferenceTracker.prototype.addRef = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">refId, ref, incrementCount</span>) </span>{\n","                <span class=\"code-keyword\">if</span> (incrementCount === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { incrementCount = <span class=\"code-literal\">true</span>; }\n","                <span class=\"code-keyword\">this</span>.refs.set(refId, ref);\n","                <span class=\"code-keyword\">if</span> (incrementCount) {\n","                    <span class=\"code-keyword\">this</span>.refCounts[refId] = (<span class=\"code-keyword\">this</span>.refCounts[refId] || <span class=\"code-number\">0</span>) + <span class=\"code-number\">1</span>;\n","                }\n","            };\n","            <span class=\"code-comment\">// for decoding</span>\n","            ReferenceTracker.prototype.removeRef = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">refId</span>) </span>{\n","                <span class=\"code-keyword\">this</span>.refCounts[refId] = <span class=\"code-keyword\">this</span>.refCounts[refId] - <span class=\"code-number\">1</span>;\n","                <span class=\"code-keyword\">this</span>.deletedRefs.add(refId);\n","            };\n","            ReferenceTracker.prototype.clearRefs = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">this</span>.refs.clear();\n","                <span class=\"code-keyword\">this</span>.deletedRefs.clear();\n","                <span class=\"code-keyword\">this</span>.refCounts = {};\n","            };\n","            <span class=\"code-comment\">// for decoding</span>\n","            ReferenceTracker.prototype.garbageCollectDeletedRefs = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","                <span class=\"code-keyword\">this</span>.deletedRefs.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">refId</span>) </span>{\n","                    <span class=\"code-comment\">//</span>\n","                    <span class=\"code-comment\">// Skip active references.</span>\n","                    <span class=\"code-comment\">//</span>\n","                    <span class=\"code-keyword\">if</span> (_this.refCounts[refId] &gt; <span class=\"code-number\">0</span>) {\n","                        <span class=\"code-keyword\">return</span>;\n","                    }\n","                    <span class=\"code-keyword\">var</span> ref = _this.refs.get(refId);\n","                    <span class=\"code-comment\">//</span>\n","                    <span class=\"code-comment\">// Ensure child schema instances have their references removed as well.</span>\n","                    <span class=\"code-comment\">//</span>\n","                    <span class=\"code-keyword\">if</span> (ref <span class=\"code-keyword\">instanceof</span> Schema) {\n","                        <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> fieldName <span class=\"code-keyword\">in</span> ref[<span class=\"code-string\">'_definition'</span>].schema) {\n","                            <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (ref[<span class=\"code-string\">'_definition'</span>].schema[fieldName]) !== <span class=\"code-string\">\"string\"</span> &amp;&amp;\n","                                ref[fieldName] &amp;&amp;\n","                                ref[fieldName][<span class=\"code-string\">'$changes'</span>]) {\n","                                _this.removeRef(ref[fieldName][<span class=\"code-string\">'$changes'</span>].refId);\n","                            }\n","                        }\n","                    }\n","                    <span class=\"code-keyword\">else</span> {\n","                        <span class=\"code-keyword\">var</span> definition = ref[<span class=\"code-string\">'$changes'</span>].parent._definition;\n","                        <span class=\"code-keyword\">var</span> type = definition.schema[definition.fieldsByIndex[ref[<span class=\"code-string\">'$changes'</span>].parentIndex]];\n","                        <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (<span class=\"code-built_in\">Object</span>.values(type)[<span class=\"code-number\">0</span>]) === <span class=\"code-string\">\"function\"</span>) {\n","                            <span class=\"code-built_in\">Array</span>.from(ref.values())\n","                                .forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">child</span>) </span>{ <span class=\"code-keyword\">return</span> _this.removeRef(child[<span class=\"code-string\">'$changes'</span>].refId); });\n","                        }\n","                    }\n","                    _this.refs.delete(refId);\n","                    <span class=\"code-keyword\">delete</span> _this.refCounts[refId];\n","                });\n","                <span class=\"code-comment\">// clear deleted refs.</span>\n","                <span class=\"code-keyword\">this</span>.deletedRefs.clear();\n","            };\n","            <span class=\"code-keyword\">return</span> ReferenceTracker;\n","        }());\n","\n","        <span class=\"code-keyword\">var</span> EncodeSchemaError = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_super</span>) </span>{\n","            __extends(EncodeSchemaError, _super);\n","            <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">EncodeSchemaError</span>(<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> _super !== <span class=\"code-literal\">null</span> &amp;&amp; _super.apply(<span class=\"code-keyword\">this</span>, <span class=\"code-built_in\">arguments</span>) || <span class=\"code-keyword\">this</span>;\n","            }\n","            <span class=\"code-keyword\">return</span> EncodeSchemaError;\n","        }(<span class=\"code-built_in\">Error</span>));\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">assertType</span>(<span class=\"code-params\">value, type, klass, field</span>) </span>{\n","            <span class=\"code-keyword\">var</span> typeofTarget;\n","            <span class=\"code-keyword\">var</span> allowNull = <span class=\"code-literal\">false</span>;\n","            <span class=\"code-keyword\">switch</span> (type) {\n","                <span class=\"code-keyword\">case</span> <span class=\"code-string\">\"number\"</span>:\n","                <span class=\"code-keyword\">case</span> <span class=\"code-string\">\"int8\"</span>:\n","                <span class=\"code-keyword\">case</span> <span class=\"code-string\">\"uint8\"</span>:\n","                <span class=\"code-keyword\">case</span> <span class=\"code-string\">\"int16\"</span>:\n","                <span class=\"code-keyword\">case</span> <span class=\"code-string\">\"uint16\"</span>:\n","                <span class=\"code-keyword\">case</span> <span class=\"code-string\">\"int32\"</span>:\n","                <span class=\"code-keyword\">case</span> <span class=\"code-string\">\"uint32\"</span>:\n","                <span class=\"code-keyword\">case</span> <span class=\"code-string\">\"int64\"</span>:\n","                <span class=\"code-keyword\">case</span> <span class=\"code-string\">\"uint64\"</span>:\n","                <span class=\"code-keyword\">case</span> <span class=\"code-string\">\"float32\"</span>:\n","                <span class=\"code-keyword\">case</span> <span class=\"code-string\">\"float64\"</span>:\n","                    typeofTarget = <span class=\"code-string\">\"number\"</span>;\n","                    <span class=\"code-keyword\">if</span> (<span class=\"code-built_in\">isNaN</span>(value)) {\n","                        <span class=\"code-built_in\">console</span>.log(<span class=\"code-string\">\"trying to encode \\\"NaN\\\" in \"</span>.concat(klass.constructor.name, <span class=\"code-string\">\"#\"</span>).concat(field));\n","                    }\n","                    <span class=\"code-keyword\">break</span>;\n","                <span class=\"code-keyword\">case</span> <span class=\"code-string\">\"string\"</span>:\n","                    typeofTarget = <span class=\"code-string\">\"string\"</span>;\n","                    allowNull = <span class=\"code-literal\">true</span>;\n","                    <span class=\"code-keyword\">break</span>;\n","                <span class=\"code-keyword\">case</span> <span class=\"code-string\">\"boolean\"</span>:\n","                    <span class=\"code-comment\">// boolean is always encoded as true/false based on truthiness</span>\n","                    <span class=\"code-keyword\">return</span>;\n","            }\n","            <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (value) !== typeofTarget &amp;&amp; (!allowNull || (allowNull &amp;&amp; value !== <span class=\"code-literal\">null</span>))) {\n","                <span class=\"code-keyword\">var</span> foundValue = <span class=\"code-string\">\"'\"</span>.concat(<span class=\"code-built_in\">JSON</span>.stringify(value), <span class=\"code-string\">\"'\"</span>).concat((value &amp;&amp; value.constructor &amp;&amp; <span class=\"code-string\">\" (\"</span>.concat(value.constructor.name, <span class=\"code-string\">\")\"</span>)) || <span class=\"code-string\">''</span>);\n","                <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> EncodeSchemaError(<span class=\"code-string\">\"a '\"</span>.concat(typeofTarget, <span class=\"code-string\">\"' was expected, but \"</span>).concat(foundValue, <span class=\"code-string\">\" was provided in \"</span>).concat(klass.constructor.name, <span class=\"code-string\">\"#\"</span>).concat(field));\n","            }\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">assertInstanceType</span>(<span class=\"code-params\">value, type, klass, field</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (!(value <span class=\"code-keyword\">instanceof</span> type)) {\n","                <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> EncodeSchemaError(<span class=\"code-string\">\"a '\"</span>.concat(type.name, <span class=\"code-string\">\"' was expected, but '\"</span>).concat(value.constructor.name, <span class=\"code-string\">\"' was provided in \"</span>).concat(klass.constructor.name, <span class=\"code-string\">\"#\"</span>).concat(field));\n","            }\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">encodePrimitiveType</span>(<span class=\"code-params\">type, bytes, value, klass, field</span>) </span>{\n","            assertType(value, type, klass, field);\n","            <span class=\"code-keyword\">var</span> encodeFunc = encode[type];\n","            <span class=\"code-keyword\">if</span> (encodeFunc) {\n","                encodeFunc(bytes, value);\n","            }\n","            <span class=\"code-keyword\">else</span> {\n","                <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> EncodeSchemaError(<span class=\"code-string\">\"a '\"</span>.concat(type, <span class=\"code-string\">\"' was expected, but \"</span>).concat(value, <span class=\"code-string\">\" was provided in \"</span>).concat(klass.constructor.name, <span class=\"code-string\">\"#\"</span>).concat(field));\n","            }\n","        }\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">decodePrimitiveType</span>(<span class=\"code-params\">type, bytes, it</span>) </span>{\n","            <span class=\"code-keyword\">return</span> decode[type](bytes, it);\n","        }\n","        <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">         * Schema encoder / decoder\n</span>","<span class=\"code-comment\">         */</span>\n","        <span class=\"code-keyword\">var</span> Schema = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-comment\">// allow inherited classes to have a constructor</span>\n","            <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">Schema</span>(<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> args = [];\n","                <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> _i = <span class=\"code-number\">0</span>; _i &lt; <span class=\"code-built_in\">arguments</span>.length; _i++) {\n","                    args[_i] = <span class=\"code-built_in\">arguments</span>[_i];\n","                }\n","                <span class=\"code-comment\">// fix enumerability of fields for end-user</span>\n","                <span class=\"code-built_in\">Object</span>.defineProperties(<span class=\"code-keyword\">this</span>, {\n","                    $changes: {\n","                        value: <span class=\"code-keyword\">new</span> ChangeTree(<span class=\"code-keyword\">this</span>, <span class=\"code-literal\">undefined</span>, <span class=\"code-keyword\">new</span> ReferenceTracker()),\n","                        enumerable: <span class=\"code-literal\">false</span>,\n","                        writable: <span class=\"code-literal\">true</span>\n","                    },\n","                    <span class=\"code-comment\">// $listeners: {</span>\n","                    <span class=\"code-comment\">//     value: undefined,</span>\n","                    <span class=\"code-comment\">//     enumerable: false,</span>\n","                    <span class=\"code-comment\">//     writable: true</span>\n","                    <span class=\"code-comment\">// },</span>\n","                    $callbacks: {\n","                        value: <span class=\"code-literal\">undefined</span>,\n","                        enumerable: <span class=\"code-literal\">false</span>,\n","                        writable: <span class=\"code-literal\">true</span>\n","                    },\n","                });\n","                <span class=\"code-keyword\">var</span> descriptors = <span class=\"code-keyword\">this</span>._definition.descriptors;\n","                <span class=\"code-keyword\">if</span> (descriptors) {\n","                    <span class=\"code-built_in\">Object</span>.defineProperties(<span class=\"code-keyword\">this</span>, descriptors);\n","                }\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-comment\">// Assign initial values</span>\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-keyword\">if</span> (args[<span class=\"code-number\">0</span>]) {\n","                    <span class=\"code-keyword\">this</span>.assign(args[<span class=\"code-number\">0</span>]);\n","                }\n","            }\n","            Schema.onError = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">e</span>) </span>{\n","                <span class=\"code-built_in\">console</span>.error(e);\n","            };\n","            Schema.is = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">type</span>) </span>{\n","                <span class=\"code-keyword\">return</span> (type[<span class=\"code-string\">'_definition'</span>] &amp;&amp;\n","                    type[<span class=\"code-string\">'_definition'</span>].schema !== <span class=\"code-literal\">undefined</span>);\n","            };\n","            Schema.prototype.onChange = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback</span>) </span>{\n","                <span class=\"code-keyword\">return</span> addCallback((<span class=\"code-keyword\">this</span>.$callbacks || (<span class=\"code-keyword\">this</span>.$callbacks = [])), exports.OPERATION.REPLACE, callback);\n","            };\n","            Schema.prototype.onRemove = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback</span>) </span>{\n","                <span class=\"code-keyword\">return</span> addCallback((<span class=\"code-keyword\">this</span>.$callbacks || (<span class=\"code-keyword\">this</span>.$callbacks = [])), exports.OPERATION.DELETE, callback);\n","            };\n","            Schema.prototype.assign = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">props</span>) </span>{\n","                <span class=\"code-built_in\">Object</span>.assign(<span class=\"code-keyword\">this</span>, props);\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>;\n","            };\n","            <span class=\"code-built_in\">Object</span>.defineProperty(Schema.prototype, <span class=\"code-string\">\"_definition\"</span>, {\n","                <span class=\"code-keyword\">get</span>: function () { <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.constructor._definition; },\n","                enumerable: <span class=\"code-literal\">false</span>,\n","                configurable: <span class=\"code-literal\">true</span>\n","            });\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * (Server-side): Flag a property to be encoded for the next patch.\n</span>","<span class=\"code-comment\">             * @param instance Schema instance\n</span>","<span class=\"code-comment\">             * @param property string representing the property name, or number representing the index of the property.\n</span>","<span class=\"code-comment\">             * @param operation OPERATION to perform (detected automatically)\n</span>","<span class=\"code-comment\">             */</span>\n","            Schema.prototype.setDirty = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">property, operation</span>) </span>{\n","                <span class=\"code-keyword\">this</span>.$changes.change(property, operation);\n","            };\n","            <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">             * Client-side: listen for changes on property.\n</span>","<span class=\"code-comment\">             * @param prop the property name\n</span>","<span class=\"code-comment\">             * @param callback callback to be triggered on property change\n</span>","<span class=\"code-comment\">             * @param immediate trigger immediatelly if property has been already set.\n</span>","<span class=\"code-comment\">             */</span>\n","            Schema.prototype.listen = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">prop, callback, immediate</span>) </span>{\n","                <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","                <span class=\"code-keyword\">if</span> (immediate === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { immediate = <span class=\"code-literal\">true</span>; }\n","                <span class=\"code-keyword\">if</span> (!<span class=\"code-keyword\">this</span>.$callbacks) {\n","                    <span class=\"code-keyword\">this</span>.$callbacks = {};\n","                }\n","                <span class=\"code-keyword\">if</span> (!<span class=\"code-keyword\">this</span>.$callbacks[prop]) {\n","                    <span class=\"code-keyword\">this</span>.$callbacks[prop] = [];\n","                }\n","                <span class=\"code-keyword\">this</span>.$callbacks[prop].push(callback);\n","                <span class=\"code-keyword\">if</span> (immediate &amp;&amp; <span class=\"code-keyword\">this</span>[prop] !== <span class=\"code-literal\">undefined</span>) {\n","                    callback(<span class=\"code-keyword\">this</span>[prop], <span class=\"code-literal\">undefined</span>);\n","                }\n","                <span class=\"code-comment\">// return un-register callback.</span>\n","                <span class=\"code-keyword\">return</span> <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{ <span class=\"code-keyword\">return</span> spliceOne(_this.$callbacks[prop], _this.$callbacks[prop].indexOf(callback)); };\n","            };\n","            Schema.prototype.decode = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">bytes, it, ref</span>) </span>{\n","                <span class=\"code-keyword\">var</span> _a;\n","                <span class=\"code-keyword\">if</span> (it === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { it = { <span class=\"code-attr\">offset</span>: <span class=\"code-number\">0</span> }; }\n","                <span class=\"code-keyword\">if</span> (ref === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { ref = <span class=\"code-keyword\">this</span>; }\n","                <span class=\"code-keyword\">var</span> allChanges = [];\n","                <span class=\"code-keyword\">var</span> $root = <span class=\"code-keyword\">this</span>.$changes.root;\n","                <span class=\"code-keyword\">var</span> totalBytes = bytes.length;\n","                <span class=\"code-keyword\">var</span> refId = <span class=\"code-number\">0</span>;\n","                $root.refs.set(refId, <span class=\"code-keyword\">this</span>);\n","                <span class=\"code-keyword\">while</span> (it.offset &lt; totalBytes) {\n","                    <span class=\"code-keyword\">var</span> byte = bytes[it.offset++];\n","                    <span class=\"code-keyword\">if</span> (byte == SWITCH_TO_STRUCTURE) {\n","                        refId = number(bytes, it);\n","                        <span class=\"code-keyword\">var</span> nextRef = $root.refs.get(refId);\n","                        <span class=\"code-comment\">//</span>\n","                        <span class=\"code-comment\">// Trying to access a reference that haven't been decoded yet.</span>\n","                        <span class=\"code-comment\">//</span>\n","                        <span class=\"code-keyword\">if</span> (!nextRef) {\n","                            <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">\"\\\"refId\\\" not found: \"</span>.concat(refId));\n","                        }\n","                        ref = nextRef;\n","                        <span class=\"code-keyword\">continue</span>;\n","                    }\n","                    <span class=\"code-keyword\">var</span> changeTree = ref[<span class=\"code-string\">'$changes'</span>];\n","                    <span class=\"code-keyword\">var</span> isSchema = (ref[<span class=\"code-string\">'_definition'</span>] !== <span class=\"code-literal\">undefined</span>);\n","                    <span class=\"code-keyword\">var</span> operation = (isSchema)\n","                        ? (byte &gt;&gt; <span class=\"code-number\">6</span>) &lt;&lt; <span class=\"code-number\">6</span> <span class=\"code-comment\">// \"compressed\" index + operation</span>\n","                        : byte; <span class=\"code-comment\">// \"uncompressed\" index + operation (array/map items)</span>\n","                    <span class=\"code-keyword\">if</span> (operation === exports.OPERATION.CLEAR) {\n","                        <span class=\"code-comment\">//</span>\n","                        <span class=\"code-comment\">// <span class=\"code-doctag\">TODO:</span> refactor me!</span>\n","                        <span class=\"code-comment\">// The `.clear()` method is calling `$root.removeRef(refId)` for</span>\n","                        <span class=\"code-comment\">// each item inside this collection</span>\n","                        <span class=\"code-comment\">//</span>\n","                        ref.clear(allChanges);\n","                        <span class=\"code-keyword\">continue</span>;\n","                    }\n","                    <span class=\"code-keyword\">var</span> fieldIndex = (isSchema)\n","                        ? byte % (operation || <span class=\"code-number\">255</span>) <span class=\"code-comment\">// if \"REPLACE\" operation (0), use 255</span>\n","                        : number(bytes, it);\n","                    <span class=\"code-keyword\">var</span> fieldName = (isSchema)\n","                        ? (ref[<span class=\"code-string\">'_definition'</span>].fieldsByIndex[fieldIndex])\n","                        : <span class=\"code-string\">\"\"</span>;\n","                    <span class=\"code-keyword\">var</span> type = changeTree.getType(fieldIndex);\n","                    <span class=\"code-keyword\">var</span> value = <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>;\n","                    <span class=\"code-keyword\">var</span> previousValue = <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>;\n","                    <span class=\"code-keyword\">var</span> dynamicIndex = <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>;\n","                    <span class=\"code-keyword\">if</span> (!isSchema) {\n","                        previousValue = ref[<span class=\"code-string\">'getByIndex'</span>](fieldIndex);\n","                        <span class=\"code-keyword\">if</span> ((operation &amp; exports.OPERATION.ADD) === exports.OPERATION.ADD) { <span class=\"code-comment\">// ADD or DELETE_AND_ADD</span>\n","                            dynamicIndex = (ref <span class=\"code-keyword\">instanceof</span> MapSchema)\n","                                ? string(bytes, it)\n","                                : fieldIndex;\n","                            ref[<span class=\"code-string\">'setIndex'</span>](fieldIndex, dynamicIndex);\n","                        }\n","                        <span class=\"code-keyword\">else</span> {\n","                            <span class=\"code-comment\">// here</span>\n","                            dynamicIndex = ref[<span class=\"code-string\">'getIndex'</span>](fieldIndex);\n","                        }\n","                    }\n","                    <span class=\"code-keyword\">else</span> {\n","                        previousValue = ref[<span class=\"code-string\">\"_\"</span>.concat(fieldName)];\n","                    }\n","                    <span class=\"code-comment\">//</span>\n","                    <span class=\"code-comment\">// Delete operations</span>\n","                    <span class=\"code-comment\">//</span>\n","                    <span class=\"code-keyword\">if</span> ((operation &amp; exports.OPERATION.DELETE) === exports.OPERATION.DELETE) {\n","                        <span class=\"code-keyword\">if</span> (operation !== exports.OPERATION.DELETE_AND_ADD) {\n","                            ref[<span class=\"code-string\">'deleteByIndex'</span>](fieldIndex);\n","                        }\n","                        <span class=\"code-comment\">// Flag `refId` for garbage collection.</span>\n","                        <span class=\"code-keyword\">if</span> (previousValue &amp;&amp; previousValue[<span class=\"code-string\">'$changes'</span>]) {\n","                            $root.removeRef(previousValue[<span class=\"code-string\">'$changes'</span>].refId);\n","                        }\n","                        value = <span class=\"code-literal\">null</span>;\n","                    }\n","                    <span class=\"code-keyword\">if</span> (fieldName === <span class=\"code-literal\">undefined</span>) {\n","                        <span class=\"code-built_in\">console</span>.warn(<span class=\"code-string\">\"@colyseus/schema: definition mismatch\"</span>);\n","                        <span class=\"code-comment\">//</span>\n","                        <span class=\"code-comment\">// keep skipping next bytes until reaches a known structure</span>\n","                        <span class=\"code-comment\">// by local decoder.</span>\n","                        <span class=\"code-comment\">//</span>\n","                        <span class=\"code-keyword\">var</span> nextIterator = { <span class=\"code-attr\">offset</span>: it.offset };\n","                        <span class=\"code-keyword\">while</span> (it.offset &lt; totalBytes) {\n","                            <span class=\"code-keyword\">if</span> (switchStructureCheck(bytes, it)) {\n","                                nextIterator.offset = it.offset + <span class=\"code-number\">1</span>;\n","                                <span class=\"code-keyword\">if</span> ($root.refs.has(number(bytes, nextIterator))) {\n","                                    <span class=\"code-keyword\">break</span>;\n","                                }\n","                            }\n","                            it.offset++;\n","                        }\n","                        <span class=\"code-keyword\">continue</span>;\n","                    }\n","                    <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (operation === exports.OPERATION.DELETE) ;\n","                    <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (Schema.is(type)) {\n","                        <span class=\"code-keyword\">var</span> refId_1 = number(bytes, it);\n","                        value = $root.refs.get(refId_1);\n","                        <span class=\"code-keyword\">if</span> (operation !== exports.OPERATION.REPLACE) {\n","                            <span class=\"code-keyword\">var</span> childType = <span class=\"code-keyword\">this</span>.getSchemaType(bytes, it, type);\n","                            <span class=\"code-keyword\">if</span> (!value) {\n","                                value = <span class=\"code-keyword\">this</span>.createTypeInstance(childType);\n","                                value.$changes.refId = refId_1;\n","                                <span class=\"code-keyword\">if</span> (previousValue) {\n","                                    value.$callbacks = previousValue.$callbacks;\n","                                    <span class=\"code-comment\">// value.$listeners = previousValue.$listeners;</span>\n","                                    <span class=\"code-keyword\">if</span> (previousValue[<span class=\"code-string\">'$changes'</span>].refId &amp;&amp;\n","                                        refId_1 !== previousValue[<span class=\"code-string\">'$changes'</span>].refId) {\n","                                        $root.removeRef(previousValue[<span class=\"code-string\">'$changes'</span>].refId);\n","                                    }\n","                                }\n","                            }\n","                            $root.addRef(refId_1, value, (value !== previousValue));\n","                        }\n","                    }\n","                    <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (type) === <span class=\"code-string\">\"string\"</span>) {\n","                        <span class=\"code-comment\">//</span>\n","                        <span class=\"code-comment\">// primitive value (number, string, boolean, etc)</span>\n","                        <span class=\"code-comment\">//</span>\n","                        value = decodePrimitiveType(type, bytes, it);\n","                    }\n","                    <span class=\"code-keyword\">else</span> {\n","                        <span class=\"code-keyword\">var</span> typeDef = getType(<span class=\"code-built_in\">Object</span>.keys(type)[<span class=\"code-number\">0</span>]);\n","                        <span class=\"code-keyword\">var</span> refId_2 = number(bytes, it);\n","                        <span class=\"code-keyword\">var</span> valueRef = ($root.refs.has(refId_2))\n","                            ? previousValue || $root.refs.get(refId_2)\n","                            : <span class=\"code-keyword\">new</span> typeDef.constructor();\n","                        value = valueRef.clone(<span class=\"code-literal\">true</span>);\n","                        value.$changes.refId = refId_2;\n","                        <span class=\"code-comment\">// preserve schema callbacks</span>\n","                        <span class=\"code-keyword\">if</span> (previousValue) {\n","                            value[<span class=\"code-string\">'$callbacks'</span>] = previousValue[<span class=\"code-string\">'$callbacks'</span>];\n","                            <span class=\"code-keyword\">if</span> (previousValue[<span class=\"code-string\">'$changes'</span>].refId &amp;&amp;\n","                                refId_2 !== previousValue[<span class=\"code-string\">'$changes'</span>].refId) {\n","                                $root.removeRef(previousValue[<span class=\"code-string\">'$changes'</span>].refId);\n","                                <span class=\"code-comment\">//</span>\n","                                <span class=\"code-comment\">// Trigger onRemove if structure has been replaced.</span>\n","                                <span class=\"code-comment\">//</span>\n","                                <span class=\"code-keyword\">var</span> entries = previousValue.entries();\n","                                <span class=\"code-keyword\">var</span> iter = <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>;\n","                                <span class=\"code-keyword\">while</span> ((iter = entries.next()) &amp;&amp; !iter.done) {\n","                                    <span class=\"code-keyword\">var</span> key = (_a = iter.value, _a[<span class=\"code-number\">0</span>]), value_1 = _a[<span class=\"code-number\">1</span>];\n","                                    allChanges.push({\n","                                        refId: refId_2,\n","                                        op: exports.OPERATION.DELETE,\n","                                        field: key,\n","                                        value: <span class=\"code-literal\">undefined</span>,\n","                                        previousValue: value_1,\n","                                    });\n","                                }\n","                            }\n","                        }\n","                        $root.addRef(refId_2, value, (valueRef !== previousValue));\n","                    }\n","                    <span class=\"code-keyword\">if</span> (value !== <span class=\"code-literal\">null</span> &amp;&amp;\n","                        value !== <span class=\"code-literal\">undefined</span>) {\n","                        <span class=\"code-keyword\">if</span> (value[<span class=\"code-string\">'$changes'</span>]) {\n","                            value[<span class=\"code-string\">'$changes'</span>].setParent(changeTree.ref, changeTree.root, fieldIndex);\n","                        }\n","                        <span class=\"code-keyword\">if</span> (ref <span class=\"code-keyword\">instanceof</span> Schema) {\n","                            ref[fieldName] = value;\n","                            <span class=\"code-comment\">// ref[`_${fieldName}`] = value;</span>\n","                        }\n","                        <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (ref <span class=\"code-keyword\">instanceof</span> MapSchema) {\n","                            <span class=\"code-comment\">// const key = ref['$indexes'].get(field);</span>\n","                            <span class=\"code-keyword\">var</span> key = dynamicIndex;\n","                            <span class=\"code-comment\">// ref.set(key, value);</span>\n","                            ref[<span class=\"code-string\">'$items'</span>].set(key, value);\n","                            ref[<span class=\"code-string\">'$changes'</span>].allChanges.add(fieldIndex);\n","                        }\n","                        <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (ref <span class=\"code-keyword\">instanceof</span> ArraySchema) {\n","                            <span class=\"code-comment\">// const key = ref['$indexes'][field];</span>\n","                            <span class=\"code-comment\">// console.log(\"SETTING FOR ArraySchema =&gt;\", { field, key, value });</span>\n","                            <span class=\"code-comment\">// ref[key] = value;</span>\n","                            ref.setAt(fieldIndex, value);\n","                        }\n","                        <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (ref <span class=\"code-keyword\">instanceof</span> CollectionSchema) {\n","                            <span class=\"code-keyword\">var</span> index = ref.add(value);\n","                            ref[<span class=\"code-string\">'setIndex'</span>](fieldIndex, index);\n","                        }\n","                        <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (ref <span class=\"code-keyword\">instanceof</span> SetSchema) {\n","                            <span class=\"code-keyword\">var</span> index = ref.add(value);\n","                            <span class=\"code-keyword\">if</span> (index !== <span class=\"code-literal\">false</span>) {\n","                                ref[<span class=\"code-string\">'setIndex'</span>](fieldIndex, index);\n","                            }\n","                        }\n","                    }\n","                    <span class=\"code-keyword\">if</span> (previousValue !== value) {\n","                        allChanges.push({\n","                            refId: refId,\n","                            op: operation,\n","                            field: fieldName,\n","                            dynamicIndex: dynamicIndex,\n","                            value: value,\n","                            previousValue: previousValue,\n","                        });\n","                    }\n","                }\n","                <span class=\"code-keyword\">this</span>._triggerChanges(allChanges);\n","                <span class=\"code-comment\">// drop references of unused schemas</span>\n","                $root.garbageCollectDeletedRefs();\n","                <span class=\"code-keyword\">return</span> allChanges;\n","            };\n","            Schema.prototype.encode = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">encodeAll, bytes, useFilters</span>) </span>{\n","                <span class=\"code-keyword\">if</span> (encodeAll === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { encodeAll = <span class=\"code-literal\">false</span>; }\n","                <span class=\"code-keyword\">if</span> (bytes === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { bytes = []; }\n","                <span class=\"code-keyword\">if</span> (useFilters === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { useFilters = <span class=\"code-literal\">false</span>; }\n","                <span class=\"code-keyword\">var</span> rootChangeTree = <span class=\"code-keyword\">this</span>.$changes;\n","                <span class=\"code-keyword\">var</span> refIdsVisited = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">WeakSet</span>();\n","                <span class=\"code-keyword\">var</span> changeTrees = [rootChangeTree];\n","                <span class=\"code-keyword\">var</span> numChangeTrees = <span class=\"code-number\">1</span>;\n","                <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> i = <span class=\"code-number\">0</span>; i &lt; numChangeTrees; i++) {\n","                    <span class=\"code-keyword\">var</span> changeTree = changeTrees[i];\n","                    <span class=\"code-keyword\">var</span> ref = changeTree.ref;\n","                    <span class=\"code-keyword\">var</span> isSchema = (ref <span class=\"code-keyword\">instanceof</span> Schema);\n","                    <span class=\"code-comment\">// Generate unique refId for the ChangeTree.</span>\n","                    changeTree.ensureRefId();\n","                    <span class=\"code-comment\">// mark this ChangeTree as visited.</span>\n","                    refIdsVisited.add(changeTree);\n","                    <span class=\"code-comment\">// root `refId` is skipped.</span>\n","                    <span class=\"code-keyword\">if</span> (changeTree !== rootChangeTree &amp;&amp;\n","                        (changeTree.changed || encodeAll)) {\n","                        uint8$<span class=\"code-number\">1</span>(bytes, SWITCH_TO_STRUCTURE);\n","                        number$<span class=\"code-number\">1</span>(bytes, changeTree.refId);\n","                    }\n","                    <span class=\"code-keyword\">var</span> changes = (encodeAll)\n","                        ? <span class=\"code-built_in\">Array</span>.from(changeTree.allChanges)\n","                        : <span class=\"code-built_in\">Array</span>.from(changeTree.changes.values());\n","                    <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> j = <span class=\"code-number\">0</span>, cl = changes.length; j &lt; cl; j++) {\n","                        <span class=\"code-keyword\">var</span> operation = (encodeAll)\n","                            ? { <span class=\"code-attr\">op</span>: exports.OPERATION.ADD, <span class=\"code-attr\">index</span>: changes[j] }\n","                            : changes[j];\n","                        <span class=\"code-keyword\">var</span> fieldIndex = operation.index;\n","                        <span class=\"code-keyword\">var</span> field = (isSchema)\n","                            ? ref[<span class=\"code-string\">'_definition'</span>].fieldsByIndex &amp;&amp; ref[<span class=\"code-string\">'_definition'</span>].fieldsByIndex[fieldIndex]\n","                            : fieldIndex;\n","                        <span class=\"code-comment\">// cache begin index if `useFilters`</span>\n","                        <span class=\"code-keyword\">var</span> beginIndex = bytes.length;\n","                        <span class=\"code-comment\">// encode field index + operation</span>\n","                        <span class=\"code-keyword\">if</span> (operation.op !== exports.OPERATION.TOUCH) {\n","                            <span class=\"code-keyword\">if</span> (isSchema) {\n","                                <span class=\"code-comment\">//</span>\n","                                <span class=\"code-comment\">// Compress `fieldIndex` + `operation` into a single byte.</span>\n","                                <span class=\"code-comment\">// This adds a limitaion of 64 fields per Schema structure</span>\n","                                <span class=\"code-comment\">//</span>\n","                                uint8$<span class=\"code-number\">1</span>(bytes, (fieldIndex | operation.op));\n","                            }\n","                            <span class=\"code-keyword\">else</span> {\n","                                uint8$<span class=\"code-number\">1</span>(bytes, operation.op);\n","                                <span class=\"code-comment\">// custom operations</span>\n","                                <span class=\"code-keyword\">if</span> (operation.op === exports.OPERATION.CLEAR) {\n","                                    <span class=\"code-keyword\">continue</span>;\n","                                }\n","                                <span class=\"code-comment\">// indexed operations</span>\n","                                number$<span class=\"code-number\">1</span>(bytes, fieldIndex);\n","                            }\n","                        }\n","                        <span class=\"code-comment\">//</span>\n","                        <span class=\"code-comment\">// encode \"alias\" for dynamic fields (maps)</span>\n","                        <span class=\"code-comment\">//</span>\n","                        <span class=\"code-keyword\">if</span> (!isSchema &amp;&amp;\n","                            (operation.op &amp; exports.OPERATION.ADD) == exports.OPERATION.ADD <span class=\"code-comment\">// ADD or DELETE_AND_ADD</span>\n","                        ) {\n","                            <span class=\"code-keyword\">if</span> (ref <span class=\"code-keyword\">instanceof</span> MapSchema) {\n","                                <span class=\"code-comment\">//</span>\n","                                <span class=\"code-comment\">// MapSchema dynamic key</span>\n","                                <span class=\"code-comment\">//</span>\n","                                <span class=\"code-keyword\">var</span> dynamicIndex = changeTree.ref[<span class=\"code-string\">'$indexes'</span>].get(fieldIndex);\n","                                string$<span class=\"code-number\">1</span>(bytes, dynamicIndex);\n","                            }\n","                        }\n","                        <span class=\"code-keyword\">if</span> (operation.op === exports.OPERATION.DELETE) {\n","                            <span class=\"code-comment\">//</span>\n","                            <span class=\"code-comment\">// <span class=\"code-doctag\">TODO:</span> delete from filter cache data.</span>\n","                            <span class=\"code-comment\">//</span>\n","                            <span class=\"code-comment\">// if (useFilters) {</span>\n","                            <span class=\"code-comment\">//     delete changeTree.caches[fieldIndex];</span>\n","                            <span class=\"code-comment\">// }</span>\n","                            <span class=\"code-keyword\">continue</span>;\n","                        }\n","                        <span class=\"code-comment\">// const type = changeTree.childType || ref._schema[field];</span>\n","                        <span class=\"code-keyword\">var</span> type = changeTree.getType(fieldIndex);\n","                        <span class=\"code-comment\">// const type = changeTree.getType(fieldIndex);</span>\n","                        <span class=\"code-keyword\">var</span> value = changeTree.getValue(fieldIndex);\n","                        <span class=\"code-comment\">// Enqueue ChangeTree to be visited</span>\n","                        <span class=\"code-keyword\">if</span> (value &amp;&amp;\n","                            value[<span class=\"code-string\">'$changes'</span>] &amp;&amp;\n","                            !refIdsVisited.has(value[<span class=\"code-string\">'$changes'</span>])) {\n","                            changeTrees.push(value[<span class=\"code-string\">'$changes'</span>]);\n","                            value[<span class=\"code-string\">'$changes'</span>].ensureRefId();\n","                            numChangeTrees++;\n","                        }\n","                        <span class=\"code-keyword\">if</span> (operation.op === exports.OPERATION.TOUCH) {\n","                            <span class=\"code-keyword\">continue</span>;\n","                        }\n","                        <span class=\"code-keyword\">if</span> (Schema.is(type)) {\n","                            assertInstanceType(value, type, ref, field);\n","                            <span class=\"code-comment\">//</span>\n","                            <span class=\"code-comment\">// Encode refId for this instance.</span>\n","                            <span class=\"code-comment\">// The actual instance is going to be encoded on next `changeTree` iteration.</span>\n","                            <span class=\"code-comment\">//</span>\n","                            number$<span class=\"code-number\">1</span>(bytes, value.$changes.refId);\n","                            <span class=\"code-comment\">// Try to encode inherited TYPE_ID if it's an ADD operation.</span>\n","                            <span class=\"code-keyword\">if</span> ((operation.op &amp; exports.OPERATION.ADD) === exports.OPERATION.ADD) {\n","                                <span class=\"code-keyword\">this</span>.tryEncodeTypeId(bytes, type, value.constructor);\n","                            }\n","                        }\n","                        <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (type) === <span class=\"code-string\">\"string\"</span>) {\n","                            <span class=\"code-comment\">//</span>\n","                            <span class=\"code-comment\">// Primitive values</span>\n","                            <span class=\"code-comment\">//</span>\n","                            encodePrimitiveType(type, bytes, value, ref, field);\n","                        }\n","                        <span class=\"code-keyword\">else</span> {\n","                            <span class=\"code-comment\">//</span>\n","                            <span class=\"code-comment\">// Custom type (MapSchema, ArraySchema, etc)</span>\n","                            <span class=\"code-comment\">//</span>\n","                            <span class=\"code-keyword\">var</span> definition = getType(<span class=\"code-built_in\">Object</span>.keys(type)[<span class=\"code-number\">0</span>]);\n","                            <span class=\"code-comment\">//</span>\n","                            <span class=\"code-comment\">// ensure a ArraySchema has been provided</span>\n","                            <span class=\"code-comment\">//</span>\n","                            assertInstanceType(ref[<span class=\"code-string\">\"_\"</span>.concat(field)], definition.constructor, ref, field);\n","                            <span class=\"code-comment\">//</span>\n","                            <span class=\"code-comment\">// Encode refId for this instance.</span>\n","                            <span class=\"code-comment\">// The actual instance is going to be encoded on next `changeTree` iteration.</span>\n","                            <span class=\"code-comment\">//</span>\n","                            number$<span class=\"code-number\">1</span>(bytes, value.$changes.refId);\n","                        }\n","                        <span class=\"code-keyword\">if</span> (useFilters) {\n","                            <span class=\"code-comment\">// cache begin / end index</span>\n","                            changeTree.cache(fieldIndex, bytes.slice(beginIndex));\n","                        }\n","                    }\n","                    <span class=\"code-keyword\">if</span> (!encodeAll &amp;&amp; !useFilters) {\n","                        changeTree.discard();\n","                    }\n","                }\n","                <span class=\"code-keyword\">return</span> bytes;\n","            };\n","            Schema.prototype.encodeAll = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">useFilters</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.encode(<span class=\"code-literal\">true</span>, [], useFilters);\n","            };\n","            Schema.prototype.applyFilters = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">client, encodeAll</span>) </span>{\n","                <span class=\"code-keyword\">var</span> _a, _b;\n","                <span class=\"code-keyword\">if</span> (encodeAll === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { encodeAll = <span class=\"code-literal\">false</span>; }\n","                <span class=\"code-keyword\">var</span> root = <span class=\"code-keyword\">this</span>;\n","                <span class=\"code-keyword\">var</span> refIdsDissallowed = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Set</span>();\n","                <span class=\"code-keyword\">var</span> $filterState = ClientState.get(client);\n","                <span class=\"code-keyword\">var</span> changeTrees = [<span class=\"code-keyword\">this</span>.$changes];\n","                <span class=\"code-keyword\">var</span> numChangeTrees = <span class=\"code-number\">1</span>;\n","                <span class=\"code-keyword\">var</span> filteredBytes = [];\n","                <span class=\"code-keyword\">var</span> _loop_1 = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">i</span>) </span>{\n","                    <span class=\"code-keyword\">var</span> changeTree = changeTrees[i];\n","                    <span class=\"code-keyword\">if</span> (refIdsDissallowed.has(changeTree.refId)) {\n","                        <span class=\"code-keyword\">return</span> <span class=\"code-string\">\"continue\"</span>;\n","                    }\n","                    <span class=\"code-keyword\">var</span> ref = changeTree.ref;\n","                    <span class=\"code-keyword\">var</span> isSchema = ref <span class=\"code-keyword\">instanceof</span> Schema;\n","                    uint8$<span class=\"code-number\">1</span>(filteredBytes, SWITCH_TO_STRUCTURE);\n","                    number$<span class=\"code-number\">1</span>(filteredBytes, changeTree.refId);\n","                    <span class=\"code-keyword\">var</span> clientHasRefId = $filterState.refIds.has(changeTree);\n","                    <span class=\"code-keyword\">var</span> isEncodeAll = (encodeAll || !clientHasRefId);\n","                    <span class=\"code-comment\">// console.log(\"REF:\", ref.constructor.name);</span>\n","                    <span class=\"code-comment\">// console.log(\"Encode all?\", isEncodeAll);</span>\n","                    <span class=\"code-comment\">//</span>\n","                    <span class=\"code-comment\">// include `changeTree` on list of known refIds by this client.</span>\n","                    <span class=\"code-comment\">//</span>\n","                    $filterState.addRefId(changeTree);\n","                    <span class=\"code-keyword\">var</span> containerIndexes = $filterState.containerIndexes.get(changeTree);\n","                    <span class=\"code-keyword\">var</span> changes = (isEncodeAll)\n","                        ? <span class=\"code-built_in\">Array</span>.from(changeTree.allChanges)\n","                        : <span class=\"code-built_in\">Array</span>.from(changeTree.changes.values());\n","                    <span class=\"code-comment\">//</span>\n","                    <span class=\"code-comment\">// WORKAROUND: tries to re-evaluate previously not included @filter() attributes</span>\n","                    <span class=\"code-comment\">// - see \"DELETE a field of Schema\" test case.</span>\n","                    <span class=\"code-comment\">//</span>\n","                    <span class=\"code-keyword\">if</span> (!encodeAll &amp;&amp;\n","                        isSchema &amp;&amp;\n","                        ref._definition.indexesWithFilters) {\n","                        <span class=\"code-keyword\">var</span> indexesWithFilters = ref._definition.indexesWithFilters;\n","                        indexesWithFilters.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">indexWithFilter</span>) </span>{\n","                            <span class=\"code-keyword\">if</span> (!containerIndexes.has(indexWithFilter) &amp;&amp;\n","                                changeTree.allChanges.has(indexWithFilter)) {\n","                                <span class=\"code-keyword\">if</span> (isEncodeAll) {\n","                                    changes.push(indexWithFilter);\n","                                }\n","                                <span class=\"code-keyword\">else</span> {\n","                                    changes.push({ <span class=\"code-attr\">op</span>: exports.OPERATION.ADD, <span class=\"code-attr\">index</span>: indexWithFilter, });\n","                                }\n","                            }\n","                        });\n","                    }\n","                    <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> j = <span class=\"code-number\">0</span>, cl = changes.length; j &lt; cl; j++) {\n","                        <span class=\"code-keyword\">var</span> change = (isEncodeAll)\n","                            ? { <span class=\"code-attr\">op</span>: exports.OPERATION.ADD, <span class=\"code-attr\">index</span>: changes[j] }\n","                            : changes[j];\n","                        <span class=\"code-comment\">// custom operations</span>\n","                        <span class=\"code-keyword\">if</span> (change.op === exports.OPERATION.CLEAR) {\n","                            uint8$<span class=\"code-number\">1</span>(filteredBytes, change.op);\n","                            <span class=\"code-keyword\">continue</span>;\n","                        }\n","                        <span class=\"code-keyword\">var</span> fieldIndex = change.index;\n","                        <span class=\"code-comment\">//</span>\n","                        <span class=\"code-comment\">// Deleting fields: encode the operation + field index</span>\n","                        <span class=\"code-comment\">//</span>\n","                        <span class=\"code-keyword\">if</span> (change.op === exports.OPERATION.DELETE) {\n","                            <span class=\"code-comment\">//</span>\n","                            <span class=\"code-comment\">// DELETE operations also need to go through filtering.</span>\n","                            <span class=\"code-comment\">//</span>\n","                            <span class=\"code-comment\">// <span class=\"code-doctag\">TODO:</span> cache the previous value so we can access the value (primitive or `refId`)</span>\n","                            <span class=\"code-comment\">// (check against `$filterState.refIds`)</span>\n","                            <span class=\"code-comment\">//</span>\n","                            <span class=\"code-keyword\">if</span> (isSchema) {\n","                                uint8$<span class=\"code-number\">1</span>(filteredBytes, change.op | fieldIndex);\n","                            }\n","                            <span class=\"code-keyword\">else</span> {\n","                                uint8$<span class=\"code-number\">1</span>(filteredBytes, change.op);\n","                                number$<span class=\"code-number\">1</span>(filteredBytes, fieldIndex);\n","                            }\n","                            <span class=\"code-keyword\">continue</span>;\n","                        }\n","                        <span class=\"code-comment\">// indexed operation</span>\n","                        <span class=\"code-keyword\">var</span> value = changeTree.getValue(fieldIndex);\n","                        <span class=\"code-keyword\">var</span> type = changeTree.getType(fieldIndex);\n","                        <span class=\"code-keyword\">if</span> (isSchema) {\n","                            <span class=\"code-comment\">// Is a Schema!</span>\n","                            <span class=\"code-keyword\">var</span> filter = (ref._definition.filters &amp;&amp;\n","                                ref._definition.filters[fieldIndex]);\n","                            <span class=\"code-keyword\">if</span> (filter &amp;&amp; !filter.call(ref, client, value, root)) {\n","                                <span class=\"code-keyword\">if</span> (value &amp;&amp; value[<span class=\"code-string\">'$changes'</span>]) {\n","                                    refIdsDissallowed.add(value[<span class=\"code-string\">'$changes'</span>].refId);\n","                                }\n","                                <span class=\"code-keyword\">continue</span>;\n","                            }\n","                        }\n","                        <span class=\"code-keyword\">else</span> {\n","                            <span class=\"code-comment\">// Is a collection! (map, array, etc.)</span>\n","                            <span class=\"code-keyword\">var</span> parent = changeTree.parent;\n","                            <span class=\"code-keyword\">var</span> filter = changeTree.getChildrenFilter();\n","                            <span class=\"code-keyword\">if</span> (filter &amp;&amp; !filter.call(parent, client, ref[<span class=\"code-string\">'$indexes'</span>].get(fieldIndex), value, root)) {\n","                                <span class=\"code-keyword\">if</span> (value &amp;&amp; value[<span class=\"code-string\">'$changes'</span>]) {\n","                                    refIdsDissallowed.add(value[<span class=\"code-string\">'$changes'</span>].refId);\n","                                }\n","                                <span class=\"code-keyword\">continue</span>;\n","                            }\n","                        }\n","                        <span class=\"code-comment\">// visit child ChangeTree on further iteration.</span>\n","                        <span class=\"code-keyword\">if</span> (value[<span class=\"code-string\">'$changes'</span>]) {\n","                            changeTrees.push(value[<span class=\"code-string\">'$changes'</span>]);\n","                            numChangeTrees++;\n","                        }\n","                        <span class=\"code-comment\">//</span>\n","                        <span class=\"code-comment\">// Copy cached bytes</span>\n","                        <span class=\"code-comment\">//</span>\n","                        <span class=\"code-keyword\">if</span> (change.op !== exports.OPERATION.TOUCH) {\n","                            <span class=\"code-comment\">//</span>\n","                            <span class=\"code-comment\">// <span class=\"code-doctag\">TODO:</span> refactor me!</span>\n","                            <span class=\"code-comment\">//</span>\n","                            <span class=\"code-keyword\">if</span> (change.op === exports.OPERATION.ADD || isSchema) {\n","                                <span class=\"code-comment\">//</span>\n","                                <span class=\"code-comment\">// use cached bytes directly if is from Schema type.</span>\n","                                <span class=\"code-comment\">//</span>\n","                                filteredBytes.push.apply(filteredBytes, (_a = changeTree.caches[fieldIndex]) !== <span class=\"code-literal\">null</span> &amp;&amp; _a !== <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? _a : []);\n","                                containerIndexes.add(fieldIndex);\n","                            }\n","                            <span class=\"code-keyword\">else</span> {\n","                                <span class=\"code-keyword\">if</span> (containerIndexes.has(fieldIndex)) {\n","                                    <span class=\"code-comment\">//</span>\n","                                    <span class=\"code-comment\">// use cached bytes if already has the field</span>\n","                                    <span class=\"code-comment\">//</span>\n","                                    filteredBytes.push.apply(filteredBytes, (_b = changeTree.caches[fieldIndex]) !== <span class=\"code-literal\">null</span> &amp;&amp; _b !== <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? _b : []);\n","                                }\n","                                <span class=\"code-keyword\">else</span> {\n","                                    <span class=\"code-comment\">//</span>\n","                                    <span class=\"code-comment\">// force ADD operation if field is not known by this client.</span>\n","                                    <span class=\"code-comment\">//</span>\n","                                    containerIndexes.add(fieldIndex);\n","                                    uint8$<span class=\"code-number\">1</span>(filteredBytes, exports.OPERATION.ADD);\n","                                    number$<span class=\"code-number\">1</span>(filteredBytes, fieldIndex);\n","                                    <span class=\"code-keyword\">if</span> (ref <span class=\"code-keyword\">instanceof</span> MapSchema) {\n","                                        <span class=\"code-comment\">//</span>\n","                                        <span class=\"code-comment\">// MapSchema dynamic key</span>\n","                                        <span class=\"code-comment\">//</span>\n","                                        <span class=\"code-keyword\">var</span> dynamicIndex = changeTree.ref[<span class=\"code-string\">'$indexes'</span>].get(fieldIndex);\n","                                        string$<span class=\"code-number\">1</span>(filteredBytes, dynamicIndex);\n","                                    }\n","                                    <span class=\"code-keyword\">if</span> (value[<span class=\"code-string\">'$changes'</span>]) {\n","                                        number$<span class=\"code-number\">1</span>(filteredBytes, value[<span class=\"code-string\">'$changes'</span>].refId);\n","                                    }\n","                                    <span class=\"code-keyword\">else</span> {\n","                                        <span class=\"code-comment\">// \"encodePrimitiveType\" without type checking.</span>\n","                                        <span class=\"code-comment\">// the type checking has been done on the first .encode() call.</span>\n","                                        encode[type](filteredBytes, value);\n","                                    }\n","                                }\n","                            }\n","                        }\n","                        <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (value[<span class=\"code-string\">'$changes'</span>] &amp;&amp; !isSchema) {\n","                            <span class=\"code-comment\">//</span>\n","                            <span class=\"code-comment\">// <span class=\"code-doctag\">TODO:</span></span>\n","                            <span class=\"code-comment\">// - track ADD/REPLACE/DELETE instances on `$filterState`</span>\n","                            <span class=\"code-comment\">// - do NOT always encode dynamicIndex for MapSchema.</span>\n","                            <span class=\"code-comment\">//   (If client already has that key, only the first index is necessary.)</span>\n","                            <span class=\"code-comment\">//</span>\n","                            uint8$<span class=\"code-number\">1</span>(filteredBytes, exports.OPERATION.ADD);\n","                            number$<span class=\"code-number\">1</span>(filteredBytes, fieldIndex);\n","                            <span class=\"code-keyword\">if</span> (ref <span class=\"code-keyword\">instanceof</span> MapSchema) {\n","                                <span class=\"code-comment\">//</span>\n","                                <span class=\"code-comment\">// MapSchema dynamic key</span>\n","                                <span class=\"code-comment\">//</span>\n","                                <span class=\"code-keyword\">var</span> dynamicIndex = changeTree.ref[<span class=\"code-string\">'$indexes'</span>].get(fieldIndex);\n","                                string$<span class=\"code-number\">1</span>(filteredBytes, dynamicIndex);\n","                            }\n","                            number$<span class=\"code-number\">1</span>(filteredBytes, value[<span class=\"code-string\">'$changes'</span>].refId);\n","                        }\n","                    }\n","                };\n","                <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> i = <span class=\"code-number\">0</span>; i &lt; numChangeTrees; i++) {\n","                    _loop_1(i);\n","                }\n","                <span class=\"code-keyword\">return</span> filteredBytes;\n","            };\n","            Schema.prototype.clone = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> _a;\n","                <span class=\"code-keyword\">var</span> cloned = <span class=\"code-keyword\">new</span> (<span class=\"code-keyword\">this</span>.constructor);\n","                <span class=\"code-keyword\">var</span> schema = <span class=\"code-keyword\">this</span>._definition.schema;\n","                <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> field <span class=\"code-keyword\">in</span> schema) {\n","                    <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (<span class=\"code-keyword\">this</span>[field]) === <span class=\"code-string\">\"object\"</span> &amp;&amp;\n","                        <span class=\"code-keyword\">typeof</span> ((_a = <span class=\"code-keyword\">this</span>[field]) === <span class=\"code-literal\">null</span> || _a === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _a.clone) === <span class=\"code-string\">\"function\"</span>) {\n","                        <span class=\"code-comment\">// deep clone</span>\n","                        cloned[field] = <span class=\"code-keyword\">this</span>[field].clone();\n","                    }\n","                    <span class=\"code-keyword\">else</span> {\n","                        <span class=\"code-comment\">// primitive values</span>\n","                        cloned[field] = <span class=\"code-keyword\">this</span>[field];\n","                    }\n","                }\n","                <span class=\"code-keyword\">return</span> cloned;\n","            };\n","            Schema.prototype.toJSON = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> schema = <span class=\"code-keyword\">this</span>._definition.schema;\n","                <span class=\"code-keyword\">var</span> deprecated = <span class=\"code-keyword\">this</span>._definition.deprecated;\n","                <span class=\"code-keyword\">var</span> obj = {};\n","                <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> field <span class=\"code-keyword\">in</span> schema) {\n","                    <span class=\"code-keyword\">if</span> (!deprecated[field] &amp;&amp; <span class=\"code-keyword\">this</span>[field] !== <span class=\"code-literal\">null</span> &amp;&amp; <span class=\"code-keyword\">typeof</span> (<span class=\"code-keyword\">this</span>[field]) !== <span class=\"code-string\">\"undefined\"</span>) {\n","                        obj[field] = (<span class=\"code-keyword\">typeof</span> (<span class=\"code-keyword\">this</span>[field][<span class=\"code-string\">'toJSON'</span>]) === <span class=\"code-string\">\"function\"</span>)\n","                            ? <span class=\"code-keyword\">this</span>[field][<span class=\"code-string\">'toJSON'</span>]()\n","                            : <span class=\"code-keyword\">this</span>[<span class=\"code-string\">\"_\"</span>.concat(field)];\n","                    }\n","                }\n","                <span class=\"code-keyword\">return</span> obj;\n","            };\n","            Schema.prototype.discardAllChanges = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">this</span>.$changes.discardAll();\n","            };\n","            Schema.prototype.getByIndex = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index</span>) </span>{\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>[<span class=\"code-keyword\">this</span>._definition.fieldsByIndex[index]];\n","            };\n","            Schema.prototype.deleteByIndex = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">index</span>) </span>{\n","                <span class=\"code-keyword\">this</span>[<span class=\"code-keyword\">this</span>._definition.fieldsByIndex[index]] = <span class=\"code-literal\">undefined</span>;\n","            };\n","            Schema.prototype.tryEncodeTypeId = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">bytes, type, targetType</span>) </span>{\n","                <span class=\"code-keyword\">if</span> (type._typeid !== targetType._typeid) {\n","                    uint8$<span class=\"code-number\">1</span>(bytes, TYPE_ID);\n","                    number$<span class=\"code-number\">1</span>(bytes, targetType._typeid);\n","                }\n","            };\n","            Schema.prototype.getSchemaType = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">bytes, it, defaultType</span>) </span>{\n","                <span class=\"code-keyword\">var</span> type;\n","                <span class=\"code-keyword\">if</span> (bytes[it.offset] === TYPE_ID) {\n","                    it.offset++;\n","                    type = <span class=\"code-keyword\">this</span>.constructor._context.get(number(bytes, it));\n","                }\n","                <span class=\"code-keyword\">return</span> type || defaultType;\n","            };\n","            Schema.prototype.createTypeInstance = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">type</span>) </span>{\n","                <span class=\"code-keyword\">var</span> instance = <span class=\"code-keyword\">new</span> type();\n","                <span class=\"code-comment\">// assign root on $changes</span>\n","                instance.$changes.root = <span class=\"code-keyword\">this</span>.$changes.root;\n","                <span class=\"code-keyword\">return</span> instance;\n","            };\n","            Schema.prototype._triggerChanges = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">changes</span>) </span>{\n","                <span class=\"code-keyword\">var</span> _a, _b, _c, _d, _e, _f, _g, _h, _j;\n","                <span class=\"code-keyword\">var</span> uniqueRefIds = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Set</span>();\n","                <span class=\"code-keyword\">var</span> $refs = <span class=\"code-keyword\">this</span>.$changes.root.refs;\n","                <span class=\"code-keyword\">var</span> _loop_2 = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">i</span>) </span>{\n","                    <span class=\"code-keyword\">var</span> change = changes[i];\n","                    <span class=\"code-keyword\">var</span> refId = change.refId;\n","                    <span class=\"code-keyword\">var</span> ref = $refs.get(refId);\n","                    <span class=\"code-keyword\">var</span> $callbacks = ref[<span class=\"code-string\">'$callbacks'</span>];\n","                    <span class=\"code-comment\">//</span>\n","                    <span class=\"code-comment\">// trigger onRemove on child structure.</span>\n","                    <span class=\"code-comment\">//</span>\n","                    <span class=\"code-keyword\">if</span> ((change.op &amp; exports.OPERATION.DELETE) === exports.OPERATION.DELETE &amp;&amp;\n","                        change.previousValue <span class=\"code-keyword\">instanceof</span> Schema) {\n","                        (_b = (_a = change.previousValue[<span class=\"code-string\">'$callbacks'</span>]) === <span class=\"code-literal\">null</span> || _a === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _a[exports.OPERATION.DELETE]) === <span class=\"code-literal\">null</span> || _b === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _b.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback</span>) </span>{ <span class=\"code-keyword\">return</span> callback(); });\n","                    }\n","                    <span class=\"code-comment\">// no callbacks defined, skip this structure!</span>\n","                    <span class=\"code-keyword\">if</span> (!$callbacks) {\n","                        <span class=\"code-keyword\">return</span> <span class=\"code-string\">\"continue\"</span>;\n","                    }\n","                    <span class=\"code-keyword\">if</span> (ref <span class=\"code-keyword\">instanceof</span> Schema) {\n","                        <span class=\"code-keyword\">if</span> (!uniqueRefIds.has(refId)) {\n","                            <span class=\"code-keyword\">try</span> {\n","                                <span class=\"code-comment\">// trigger onChange</span>\n","                                (_c = $callbacks === <span class=\"code-literal\">null</span> || $callbacks === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : $callbacks[exports.OPERATION.REPLACE]) === <span class=\"code-literal\">null</span> || _c === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _c.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback</span>) </span>{\n","                                    <span class=\"code-keyword\">return</span> callback(changes);\n","                                });\n","                            }\n","                            <span class=\"code-keyword\">catch</span> (e) {\n","                                Schema.onError(e);\n","                            }\n","                        }\n","                        <span class=\"code-keyword\">try</span> {\n","                            <span class=\"code-keyword\">if</span> ($callbacks.hasOwnProperty(change.field)) {\n","                                (_d = $callbacks[change.field]) === <span class=\"code-literal\">null</span> || _d === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _d.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback</span>) </span>{\n","                                    <span class=\"code-keyword\">return</span> callback(change.value, change.previousValue);\n","                                });\n","                            }\n","                        }\n","                        <span class=\"code-keyword\">catch</span> (e) {\n","                            Schema.onError(e);\n","                        }\n","                    }\n","                    <span class=\"code-keyword\">else</span> {\n","                        <span class=\"code-comment\">// is a collection of items</span>\n","                        <span class=\"code-keyword\">if</span> (change.op === exports.OPERATION.ADD &amp;&amp; change.previousValue === <span class=\"code-literal\">undefined</span>) {\n","                            <span class=\"code-comment\">// triger onAdd</span>\n","                            (_e = $callbacks[exports.OPERATION.ADD]) === <span class=\"code-literal\">null</span> || _e === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _e.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback</span>) </span>{ <span class=\"code-keyword\">var</span> _a; <span class=\"code-keyword\">return</span> callback(change.value, (_a = change.dynamicIndex) !== <span class=\"code-literal\">null</span> &amp;&amp; _a !== <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? _a : change.field); });\n","                        }\n","                        <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (change.op === exports.OPERATION.DELETE) {\n","                            <span class=\"code-comment\">//</span>\n","                            <span class=\"code-comment\">// <span class=\"code-doctag\">FIXME:</span> `previousValue` should always be available.</span>\n","                            <span class=\"code-comment\">// ADD + DELETE operations are still encoding DELETE operation.</span>\n","                            <span class=\"code-comment\">//</span>\n","                            <span class=\"code-keyword\">if</span> (change.previousValue !== <span class=\"code-literal\">undefined</span>) {\n","                                <span class=\"code-comment\">// triger onRemove</span>\n","                                (_f = $callbacks[exports.OPERATION.DELETE]) === <span class=\"code-literal\">null</span> || _f === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _f.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback</span>) </span>{ <span class=\"code-keyword\">var</span> _a; <span class=\"code-keyword\">return</span> callback(change.previousValue, (_a = change.dynamicIndex) !== <span class=\"code-literal\">null</span> &amp;&amp; _a !== <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? _a : change.field); });\n","                            }\n","                        }\n","                        <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (change.op === exports.OPERATION.DELETE_AND_ADD) {\n","                            <span class=\"code-comment\">// triger onRemove</span>\n","                            <span class=\"code-keyword\">if</span> (change.previousValue !== <span class=\"code-literal\">undefined</span>) {\n","                                (_g = $callbacks[exports.OPERATION.DELETE]) === <span class=\"code-literal\">null</span> || _g === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _g.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback</span>) </span>{ <span class=\"code-keyword\">var</span> _a; <span class=\"code-keyword\">return</span> callback(change.previousValue, (_a = change.dynamicIndex) !== <span class=\"code-literal\">null</span> &amp;&amp; _a !== <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? _a : change.field); });\n","                            }\n","                            <span class=\"code-comment\">// triger onAdd</span>\n","                            (_h = $callbacks[exports.OPERATION.ADD]) === <span class=\"code-literal\">null</span> || _h === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _h.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback</span>) </span>{ <span class=\"code-keyword\">var</span> _a; <span class=\"code-keyword\">return</span> callback(change.value, (_a = change.dynamicIndex) !== <span class=\"code-literal\">null</span> &amp;&amp; _a !== <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? _a : change.field); });\n","                        }\n","                        <span class=\"code-comment\">// trigger onChange</span>\n","                        <span class=\"code-keyword\">if</span> (change.value !== change.previousValue) {\n","                            (_j = $callbacks[exports.OPERATION.REPLACE]) === <span class=\"code-literal\">null</span> || _j === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _j.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback</span>) </span>{ <span class=\"code-keyword\">var</span> _a; <span class=\"code-keyword\">return</span> callback(change.value, (_a = change.dynamicIndex) !== <span class=\"code-literal\">null</span> &amp;&amp; _a !== <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? _a : change.field); });\n","                        }\n","                    }\n","                    uniqueRefIds.add(refId);\n","                };\n","                <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> i = <span class=\"code-number\">0</span>; i &lt; changes.length; i++) {\n","                    _loop_2(i);\n","                }\n","            };\n","            Schema._definition = SchemaDefinition.create();\n","            <span class=\"code-keyword\">return</span> Schema;\n","        }());\n","\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">dumpChanges</span>(<span class=\"code-params\">schema</span>) </span>{\n","            <span class=\"code-keyword\">var</span> changeTrees = [schema[<span class=\"code-string\">'$changes'</span>]];\n","            <span class=\"code-keyword\">var</span> numChangeTrees = <span class=\"code-number\">1</span>;\n","            <span class=\"code-keyword\">var</span> dump = {};\n","            <span class=\"code-keyword\">var</span> currentStructure = dump;\n","            <span class=\"code-keyword\">var</span> _loop_1 = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">i</span>) </span>{\n","                <span class=\"code-keyword\">var</span> changeTree = changeTrees[i];\n","                changeTree.changes.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">change</span>) </span>{\n","                    <span class=\"code-keyword\">var</span> ref = changeTree.ref;\n","                    <span class=\"code-keyword\">var</span> fieldIndex = change.index;\n","                    <span class=\"code-keyword\">var</span> field = (ref[<span class=\"code-string\">'_definition'</span>])\n","                        ? ref[<span class=\"code-string\">'_definition'</span>].fieldsByIndex[fieldIndex]\n","                        : ref[<span class=\"code-string\">'$indexes'</span>].get(fieldIndex);\n","                    currentStructure[field] = changeTree.getValue(fieldIndex);\n","                });\n","            };\n","            <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> i = <span class=\"code-number\">0</span>; i &lt; numChangeTrees; i++) {\n","                _loop_1(i);\n","            }\n","            <span class=\"code-keyword\">return</span> dump;\n","        }\n","\n","        <span class=\"code-keyword\">var</span> reflectionContext = { <span class=\"code-attr\">context</span>: <span class=\"code-keyword\">new</span> Context() };\n","        <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">         * Reflection\n</span>","<span class=\"code-comment\">         */</span>\n","        <span class=\"code-keyword\">var</span> ReflectionField = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_super</span>) </span>{\n","            __extends(ReflectionField, _super);\n","            <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">ReflectionField</span>(<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> _super !== <span class=\"code-literal\">null</span> &amp;&amp; _super.apply(<span class=\"code-keyword\">this</span>, <span class=\"code-built_in\">arguments</span>) || <span class=\"code-keyword\">this</span>;\n","            }\n","            __decorate([\n","                type(<span class=\"code-string\">\"string\"</span>, reflectionContext)\n","            ], ReflectionField.prototype, <span class=\"code-string\">\"name\"</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>);\n","            __decorate([\n","                type(<span class=\"code-string\">\"string\"</span>, reflectionContext)\n","            ], ReflectionField.prototype, <span class=\"code-string\">\"type\"</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>);\n","            __decorate([\n","                type(<span class=\"code-string\">\"number\"</span>, reflectionContext)\n","            ], ReflectionField.prototype, <span class=\"code-string\">\"referencedType\"</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>);\n","            <span class=\"code-keyword\">return</span> ReflectionField;\n","        }(Schema));\n","        <span class=\"code-keyword\">var</span> ReflectionType = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_super</span>) </span>{\n","            __extends(ReflectionType, _super);\n","            <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">ReflectionType</span>(<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> _this = _super !== <span class=\"code-literal\">null</span> &amp;&amp; _super.apply(<span class=\"code-keyword\">this</span>, <span class=\"code-built_in\">arguments</span>) || <span class=\"code-keyword\">this</span>;\n","                _this.fields = <span class=\"code-keyword\">new</span> ArraySchema();\n","                <span class=\"code-keyword\">return</span> _this;\n","            }\n","            __decorate([\n","                type(<span class=\"code-string\">\"number\"</span>, reflectionContext)\n","            ], ReflectionType.prototype, <span class=\"code-string\">\"id\"</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>);\n","            __decorate([\n","                type([ReflectionField], reflectionContext)\n","            ], ReflectionType.prototype, <span class=\"code-string\">\"fields\"</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>);\n","            <span class=\"code-keyword\">return</span> ReflectionType;\n","        }(Schema));\n","        <span class=\"code-keyword\">var</span> Reflection = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_super</span>) </span>{\n","            __extends(Reflection, _super);\n","            <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">Reflection</span>(<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> _this = _super !== <span class=\"code-literal\">null</span> &amp;&amp; _super.apply(<span class=\"code-keyword\">this</span>, <span class=\"code-built_in\">arguments</span>) || <span class=\"code-keyword\">this</span>;\n","                _this.types = <span class=\"code-keyword\">new</span> ArraySchema();\n","                <span class=\"code-keyword\">return</span> _this;\n","            }\n","            Reflection.encode = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">instance</span>) </span>{\n","                <span class=\"code-keyword\">var</span> rootSchemaType = instance.constructor;\n","                <span class=\"code-keyword\">var</span> reflection = <span class=\"code-keyword\">new</span> Reflection();\n","                reflection.rootType = rootSchemaType._typeid;\n","                <span class=\"code-keyword\">var</span> buildType = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">currentType, schema</span>) </span>{\n","                    <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> fieldName <span class=\"code-keyword\">in</span> schema) {\n","                        <span class=\"code-keyword\">var</span> field = <span class=\"code-keyword\">new</span> ReflectionField();\n","                        field.name = fieldName;\n","                        <span class=\"code-keyword\">var</span> fieldType = <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>;\n","                        <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (schema[fieldName]) === <span class=\"code-string\">\"string\"</span>) {\n","                            fieldType = schema[fieldName];\n","                        }\n","                        <span class=\"code-keyword\">else</span> {\n","                            <span class=\"code-keyword\">var</span> type_1 = schema[fieldName];\n","                            <span class=\"code-keyword\">var</span> childTypeSchema = <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>;\n","                            <span class=\"code-comment\">//</span>\n","                            <span class=\"code-comment\">// <span class=\"code-doctag\">TODO:</span> refactor below.</span>\n","                            <span class=\"code-comment\">//</span>\n","                            <span class=\"code-keyword\">if</span> (Schema.is(type_1)) {\n","                                fieldType = <span class=\"code-string\">\"ref\"</span>;\n","                                childTypeSchema = schema[fieldName];\n","                            }\n","                            <span class=\"code-keyword\">else</span> {\n","                                fieldType = <span class=\"code-built_in\">Object</span>.keys(type_1)[<span class=\"code-number\">0</span>];\n","                                <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (type_1[fieldType]) === <span class=\"code-string\">\"string\"</span>) {\n","                                    fieldType += <span class=\"code-string\">\":\"</span> + type_1[fieldType]; <span class=\"code-comment\">// array:string</span>\n","                                }\n","                                <span class=\"code-keyword\">else</span> {\n","                                    childTypeSchema = type_1[fieldType];\n","                                }\n","                            }\n","                            field.referencedType = (childTypeSchema)\n","                                ? childTypeSchema._typeid\n","                                : <span class=\"code-number\">-1</span>;\n","                        }\n","                        field.type = fieldType;\n","                        currentType.fields.push(field);\n","                    }\n","                    reflection.types.push(currentType);\n","                };\n","                <span class=\"code-keyword\">var</span> types = rootSchemaType._context.types;\n","                <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> typeid <span class=\"code-keyword\">in</span> types) {\n","                    <span class=\"code-keyword\">var</span> type_2 = <span class=\"code-keyword\">new</span> ReflectionType();\n","                    type_2.id = <span class=\"code-built_in\">Number</span>(typeid);\n","                    buildType(type_2, types[typeid]._definition.schema);\n","                }\n","                <span class=\"code-keyword\">return</span> reflection.encodeAll();\n","            };\n","            Reflection.decode = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">bytes, it</span>) </span>{\n","                <span class=\"code-keyword\">var</span> context = <span class=\"code-keyword\">new</span> Context();\n","                <span class=\"code-keyword\">var</span> reflection = <span class=\"code-keyword\">new</span> Reflection();\n","                reflection.decode(bytes, it);\n","                <span class=\"code-keyword\">var</span> schemaTypes = reflection.types.reduce(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">types, reflectionType</span>) </span>{\n","                    <span class=\"code-keyword\">var</span> schema = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_super</span>) </span>{\n","                        __extends(_, _super);\n","                        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">_</span>(<span class=\"code-params\"></span>) </span>{\n","                            <span class=\"code-keyword\">return</span> _super !== <span class=\"code-literal\">null</span> &amp;&amp; _super.apply(<span class=\"code-keyword\">this</span>, <span class=\"code-built_in\">arguments</span>) || <span class=\"code-keyword\">this</span>;\n","                        }\n","                        <span class=\"code-keyword\">return</span> _;\n","                    }(Schema));\n","                    <span class=\"code-keyword\">var</span> typeid = reflectionType.id;\n","                    types[typeid] = schema;\n","                    context.add(schema, typeid);\n","                    <span class=\"code-keyword\">return</span> types;\n","                }, {});\n","                reflection.types.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">reflectionType</span>) </span>{\n","                    <span class=\"code-keyword\">var</span> schemaType = schemaTypes[reflectionType.id];\n","                    reflectionType.fields.forEach(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">field</span>) </span>{\n","                        <span class=\"code-keyword\">var</span> _a;\n","                        <span class=\"code-keyword\">if</span> (field.referencedType !== <span class=\"code-literal\">undefined</span>) {\n","                            <span class=\"code-keyword\">var</span> fieldType = field.type;\n","                            <span class=\"code-keyword\">var</span> refType = schemaTypes[field.referencedType];\n","                            <span class=\"code-comment\">// map or array of primitive type (-1)</span>\n","                            <span class=\"code-keyword\">if</span> (!refType) {\n","                                <span class=\"code-keyword\">var</span> typeInfo = field.type.split(<span class=\"code-string\">\":\"</span>);\n","                                fieldType = typeInfo[<span class=\"code-number\">0</span>];\n","                                refType = typeInfo[<span class=\"code-number\">1</span>];\n","                            }\n","                            <span class=\"code-keyword\">if</span> (fieldType === <span class=\"code-string\">\"ref\"</span>) {\n","                                type(refType, { <span class=\"code-attr\">context</span>: context })(schemaType.prototype, field.name);\n","                            }\n","                            <span class=\"code-keyword\">else</span> {\n","                                type((_a = {}, _a[fieldType] = refType, _a), { <span class=\"code-attr\">context</span>: context })(schemaType.prototype, field.name);\n","                            }\n","                        }\n","                        <span class=\"code-keyword\">else</span> {\n","                            type(field.type, { <span class=\"code-attr\">context</span>: context })(schemaType.prototype, field.name);\n","                        }\n","                    });\n","                });\n","                <span class=\"code-keyword\">var</span> rootType = schemaTypes[reflection.rootType];\n","                <span class=\"code-keyword\">var</span> rootInstance = <span class=\"code-keyword\">new</span> rootType();\n","                <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">                 * auto-initialize referenced types on root type\n</span>","<span class=\"code-comment\">                 * to allow registering listeners immediatelly on client-side\n</span>","<span class=\"code-comment\">                 */</span>\n","                <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> fieldName <span class=\"code-keyword\">in</span> rootType._definition.schema) {\n","                    <span class=\"code-keyword\">var</span> fieldType = rootType._definition.schema[fieldName];\n","                    <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (fieldType) !== <span class=\"code-string\">\"string\"</span>) {\n","                        rootInstance[fieldName] = (<span class=\"code-keyword\">typeof</span> (fieldType) === <span class=\"code-string\">\"function\"</span>)\n","                            ? <span class=\"code-keyword\">new</span> fieldType() <span class=\"code-comment\">// is a schema reference</span>\n","                            : <span class=\"code-keyword\">new</span> (getType(<span class=\"code-built_in\">Object</span>.keys(fieldType)[<span class=\"code-number\">0</span>])).constructor(); <span class=\"code-comment\">// is a \"collection\"</span>\n","                    }\n","                }\n","                <span class=\"code-keyword\">return</span> rootInstance;\n","            };\n","            __decorate([\n","                type([ReflectionType], reflectionContext)\n","            ], Reflection.prototype, <span class=\"code-string\">\"types\"</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>);\n","            __decorate([\n","                type(<span class=\"code-string\">\"number\"</span>, reflectionContext)\n","            ], Reflection.prototype, <span class=\"code-string\">\"rootType\"</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>);\n","            <span class=\"code-keyword\">return</span> Reflection;\n","        }(Schema));\n","\n","        registerType(<span class=\"code-string\">\"map\"</span>, { <span class=\"code-attr\">constructor</span>: MapSchema });\n","        registerType(<span class=\"code-string\">\"array\"</span>, { <span class=\"code-attr\">constructor</span>: ArraySchema });\n","        registerType(<span class=\"code-string\">\"set\"</span>, { <span class=\"code-attr\">constructor</span>: SetSchema });\n","        registerType(<span class=\"code-string\">\"collection\"</span>, { <span class=\"code-attr\">constructor</span>: CollectionSchema, });\n","\n","        exports.ArraySchema = ArraySchema;\n","        exports.CollectionSchema = CollectionSchema;\n","        exports.Context = Context;\n","        exports.MapSchema = MapSchema;\n","        exports.Reflection = Reflection;\n","        exports.ReflectionField = ReflectionField;\n","        exports.ReflectionType = ReflectionType;\n","        exports.Schema = Schema;\n","        exports.SchemaDefinition = SchemaDefinition;\n","        exports.SetSchema = SetSchema;\n","        exports.decode = decode;\n","        exports.defineTypes = defineTypes;\n","        exports.deprecated = deprecated;\n","        exports.dumpChanges = dumpChanges;\n","        exports.encode = encode;\n","        exports.filter = filter;\n","        exports.filterChildren = filterChildren;\n","        exports.hasFilter = hasFilter;\n","        exports.registerType = registerType;\n","        exports.type = type;\n","\n","        <span class=\"code-built_in\">Object</span>.defineProperty(exports, <span class=\"code-string\">'__esModule'</span>, { <span class=\"code-attr\">value</span>: <span class=\"code-literal\">true</span> });\n","\n","    }));\n","    });\n","\n","    <span class=\"code-keyword\">var</span> Room = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">Room</span>(<span class=\"code-params\">name, rootSchema</span>) </span>{\n","            <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","            <span class=\"code-comment\">// Public signals</span>\n","            <span class=\"code-keyword\">this</span>.onStateChange = createSignal();\n","            <span class=\"code-keyword\">this</span>.onError = createSignal();\n","            <span class=\"code-keyword\">this</span>.onLeave = createSignal();\n","            <span class=\"code-keyword\">this</span>.onJoin = createSignal();\n","            <span class=\"code-keyword\">this</span>.hasJoined = <span class=\"code-literal\">false</span>;\n","            <span class=\"code-keyword\">this</span>.onMessageHandlers = createNanoEvents();\n","            <span class=\"code-keyword\">this</span>.roomId = <span class=\"code-literal\">null</span>;\n","            <span class=\"code-keyword\">this</span>.name = name;\n","            <span class=\"code-keyword\">if</span> (rootSchema) {\n","                <span class=\"code-keyword\">this</span>.serializer = <span class=\"code-keyword\">new</span> (getSerializer(<span class=\"code-string\">\"schema\"</span>));\n","                <span class=\"code-keyword\">this</span>.rootSchema = rootSchema;\n","                <span class=\"code-keyword\">this</span>.serializer.state = <span class=\"code-keyword\">new</span> rootSchema();\n","            }\n","            <span class=\"code-keyword\">this</span>.onError(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">code, message</span>) </span>{ <span class=\"code-keyword\">var</span> _a; <span class=\"code-keyword\">return</span> (_a = <span class=\"code-built_in\">console</span>.warn) === <span class=\"code-literal\">null</span> || _a === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _a.call(<span class=\"code-built_in\">console</span>, <span class=\"code-string\">\"colyseus.js - onError =&gt; (\"</span>.concat(code, <span class=\"code-string\">\") \"</span>).concat(message)); });\n","            <span class=\"code-keyword\">this</span>.onLeave(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{ <span class=\"code-keyword\">return</span> _this.removeAllListeners(); });\n","        }\n","        <span class=\"code-built_in\">Object</span>.defineProperty(Room.prototype, <span class=\"code-string\">\"id\"</span>, {\n","            <span class=\"code-comment\">// <span class=\"code-doctag\">TODO:</span> deprecate me on version 1.0</span>\n","            <span class=\"code-keyword\">get</span>: function () { <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.roomId; },\n","            enumerable: <span class=\"code-literal\">false</span>,\n","            configurable: <span class=\"code-literal\">true</span>\n","        });\n","        Room.prototype.connect = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">endpoint, devModeCloseCallback, room <span class=\"code-regexp\">//</span> when reconnecting on devMode, re-use previous room intance for handling events.\n</span></span>","<span class=\"code-function\"><span class=\"code-params\">        </span>) </span>{\n","            <span class=\"code-keyword\">if</span> (room === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { room = <span class=\"code-keyword\">this</span>; }\n","            <span class=\"code-keyword\">var</span> connection = <span class=\"code-keyword\">new</span> Connection();\n","            room.connection = connection;\n","            connection.events.onmessage = Room.prototype.onMessageCallback.bind(room);\n","            connection.events.onclose = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">e</span>) </span>{\n","                <span class=\"code-keyword\">var</span> _a;\n","                <span class=\"code-keyword\">if</span> (!room.hasJoined) {\n","                    (_a = <span class=\"code-built_in\">console</span>.warn) === <span class=\"code-literal\">null</span> || _a === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _a.call(<span class=\"code-built_in\">console</span>, <span class=\"code-string\">\"Room connection was closed unexpectedly (\"</span>.concat(e.code, <span class=\"code-string\">\"): \"</span>).concat(e.reason));\n","                    room.onError.invoke(e.code, e.reason);\n","                    <span class=\"code-keyword\">return</span>;\n","                }\n","                <span class=\"code-keyword\">if</span> (e.code === CloseCode.DEVMODE_RESTART &amp;&amp; devModeCloseCallback) {\n","                    devModeCloseCallback();\n","                }\n","                <span class=\"code-keyword\">else</span> {\n","                    room.onLeave.invoke(e.code);\n","                    room.destroy();\n","                }\n","            };\n","            connection.events.onerror = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">e</span>) </span>{\n","                <span class=\"code-keyword\">var</span> _a;\n","                (_a = <span class=\"code-built_in\">console</span>.warn) === <span class=\"code-literal\">null</span> || _a === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _a.call(<span class=\"code-built_in\">console</span>, <span class=\"code-string\">\"Room, onError (\"</span>.concat(e.code, <span class=\"code-string\">\"): \"</span>).concat(e.reason));\n","                room.onError.invoke(e.code, e.reason);\n","            };\n","            connection.connect(endpoint);\n","        };\n","        Room.prototype.leave = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">consented</span>) </span>{\n","            <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","            <span class=\"code-keyword\">if</span> (consented === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { consented = <span class=\"code-literal\">true</span>; }\n","            <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Promise</span>(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">resolve</span>) </span>{\n","                _this.onLeave(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">code</span>) </span>{ <span class=\"code-keyword\">return</span> resolve(code); });\n","                <span class=\"code-keyword\">if</span> (_this.connection) {\n","                    <span class=\"code-keyword\">if</span> (consented) {\n","                        _this.connection.send([exports.Protocol.LEAVE_ROOM]);\n","                    }\n","                    <span class=\"code-keyword\">else</span> {\n","                        _this.connection.close();\n","                    }\n","                }\n","                <span class=\"code-keyword\">else</span> {\n","                    _this.onLeave.invoke(CloseCode.CONSENTED);\n","                }\n","            });\n","        };\n","        Room.prototype.onMessage = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">type, callback</span>) </span>{\n","            <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.onMessageHandlers.on(<span class=\"code-keyword\">this</span>.getMessageHandlerKey(type), callback);\n","        };\n","        Room.prototype.send = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">type, message</span>) </span>{\n","            <span class=\"code-keyword\">var</span> initialBytes = [exports.Protocol.ROOM_DATA];\n","            <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (type) === <span class=\"code-string\">\"string\"</span>) {\n","                umd.encode.string(initialBytes, type);\n","            }\n","            <span class=\"code-keyword\">else</span> {\n","                umd.encode.number(initialBytes, type);\n","            }\n","            <span class=\"code-keyword\">var</span> arr;\n","            <span class=\"code-keyword\">if</span> (message !== <span class=\"code-literal\">undefined</span>) {\n","                <span class=\"code-keyword\">var</span> encoded = encode(message);\n","                arr = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Uint8Array</span>(initialBytes.length + encoded.byteLength);\n","                arr.set(<span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Uint8Array</span>(initialBytes), <span class=\"code-number\">0</span>);\n","                arr.set(<span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Uint8Array</span>(encoded), initialBytes.length);\n","            }\n","            <span class=\"code-keyword\">else</span> {\n","                arr = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Uint8Array</span>(initialBytes);\n","            }\n","            <span class=\"code-keyword\">this</span>.connection.send(arr.buffer);\n","        };\n","        Room.prototype.sendBytes = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">type, bytes</span>) </span>{\n","            <span class=\"code-keyword\">var</span> initialBytes = [exports.Protocol.ROOM_DATA_BYTES];\n","            <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (type) === <span class=\"code-string\">\"string\"</span>) {\n","                umd.encode.string(initialBytes, type);\n","            }\n","            <span class=\"code-keyword\">else</span> {\n","                umd.encode.number(initialBytes, type);\n","            }\n","            <span class=\"code-keyword\">var</span> arr;\n","            arr = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Uint8Array</span>(initialBytes.length + (bytes.byteLength || bytes.length));\n","            arr.set(<span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Uint8Array</span>(initialBytes), <span class=\"code-number\">0</span>);\n","            arr.set(<span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Uint8Array</span>(bytes), initialBytes.length);\n","            <span class=\"code-keyword\">this</span>.connection.send(arr.buffer);\n","        };\n","        <span class=\"code-built_in\">Object</span>.defineProperty(Room.prototype, <span class=\"code-string\">\"state\"</span>, {\n","            <span class=\"code-keyword\">get</span>: function () {\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.serializer.getState();\n","            },\n","            enumerable: <span class=\"code-literal\">false</span>,\n","            configurable: <span class=\"code-literal\">true</span>\n","        });\n","        Room.prototype.removeAllListeners = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-keyword\">this</span>.onJoin.clear();\n","            <span class=\"code-keyword\">this</span>.onStateChange.clear();\n","            <span class=\"code-keyword\">this</span>.onError.clear();\n","            <span class=\"code-keyword\">this</span>.onLeave.clear();\n","            <span class=\"code-keyword\">this</span>.onMessageHandlers.events = {};\n","        };\n","        Room.prototype.onMessageCallback = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">event</span>) </span>{\n","            <span class=\"code-keyword\">var</span> bytes = <span class=\"code-built_in\">Array</span>.from(<span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Uint8Array</span>(event.data));\n","            <span class=\"code-keyword\">var</span> code = bytes[<span class=\"code-number\">0</span>];\n","            <span class=\"code-keyword\">if</span> (code === exports.Protocol.JOIN_ROOM) {\n","                <span class=\"code-keyword\">var</span> offset = <span class=\"code-number\">1</span>;\n","                <span class=\"code-keyword\">var</span> reconnectionToken = utf8Read(bytes, offset);\n","                offset += utf8Length(reconnectionToken);\n","                <span class=\"code-keyword\">this</span>.serializerId = utf8Read(bytes, offset);\n","                offset += utf8Length(<span class=\"code-keyword\">this</span>.serializerId);\n","                <span class=\"code-comment\">// Instantiate serializer if not locally available.</span>\n","                <span class=\"code-keyword\">if</span> (!<span class=\"code-keyword\">this</span>.serializer) {\n","                    <span class=\"code-keyword\">var</span> serializer = getSerializer(<span class=\"code-keyword\">this</span>.serializerId);\n","                    <span class=\"code-keyword\">this</span>.serializer = <span class=\"code-keyword\">new</span> serializer();\n","                }\n","                <span class=\"code-keyword\">if</span> (bytes.length &gt; offset &amp;&amp; <span class=\"code-keyword\">this</span>.serializer.handshake) {\n","                    <span class=\"code-keyword\">this</span>.serializer.handshake(bytes, { <span class=\"code-attr\">offset</span>: offset });\n","                }\n","                <span class=\"code-keyword\">this</span>.reconnectionToken = <span class=\"code-string\">\"\"</span>.concat(<span class=\"code-keyword\">this</span>.roomId, <span class=\"code-string\">\":\"</span>).concat(reconnectionToken);\n","                <span class=\"code-keyword\">this</span>.hasJoined = <span class=\"code-literal\">true</span>;\n","                <span class=\"code-keyword\">this</span>.onJoin.invoke();\n","                <span class=\"code-comment\">// acknowledge successfull JOIN_ROOM</span>\n","                <span class=\"code-keyword\">this</span>.connection.send([exports.Protocol.JOIN_ROOM]);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (code === exports.Protocol.ERROR) {\n","                <span class=\"code-keyword\">var</span> it_1 = { <span class=\"code-attr\">offset</span>: <span class=\"code-number\">1</span> };\n","                <span class=\"code-keyword\">var</span> code_1 = umd.decode.number(bytes, it_1);\n","                <span class=\"code-keyword\">var</span> message = umd.decode.string(bytes, it_1);\n","                <span class=\"code-keyword\">this</span>.onError.invoke(code_1, message);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (code === exports.Protocol.LEAVE_ROOM) {\n","                <span class=\"code-keyword\">this</span>.leave();\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (code === exports.Protocol.ROOM_DATA_SCHEMA) {\n","                <span class=\"code-keyword\">var</span> it_2 = { <span class=\"code-attr\">offset</span>: <span class=\"code-number\">1</span> };\n","                <span class=\"code-keyword\">var</span> context_1 = <span class=\"code-keyword\">this</span>.serializer.getState().constructor._context;\n","                <span class=\"code-keyword\">var</span> type = context_1.get(umd.decode.number(bytes, it_2));\n","                <span class=\"code-keyword\">var</span> message = <span class=\"code-keyword\">new</span> type();\n","                message.decode(bytes, it_2);\n","                <span class=\"code-keyword\">this</span>.dispatchMessage(type, message);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (code === exports.Protocol.ROOM_STATE) {\n","                bytes.shift(); <span class=\"code-comment\">// drop `code` byte</span>\n","                <span class=\"code-keyword\">this</span>.setState(bytes);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (code === exports.Protocol.ROOM_STATE_PATCH) {\n","                bytes.shift(); <span class=\"code-comment\">// drop `code` byte</span>\n","                <span class=\"code-keyword\">this</span>.patch(bytes);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (code === exports.Protocol.ROOM_DATA) {\n","                <span class=\"code-keyword\">var</span> it_3 = { <span class=\"code-attr\">offset</span>: <span class=\"code-number\">1</span> };\n","                <span class=\"code-keyword\">var</span> type = (umd.decode.stringCheck(bytes, it_3))\n","                    ? umd.decode.string(bytes, it_3)\n","                    : umd.decode.number(bytes, it_3);\n","                <span class=\"code-keyword\">var</span> message = (bytes.length &gt; it_3.offset)\n","                    ? decode(event.data, it_3.offset)\n","                    : <span class=\"code-literal\">undefined</span>;\n","                <span class=\"code-keyword\">this</span>.dispatchMessage(type, message);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (code === exports.Protocol.ROOM_DATA_BYTES) {\n","                <span class=\"code-keyword\">var</span> it_4 = { <span class=\"code-attr\">offset</span>: <span class=\"code-number\">1</span> };\n","                <span class=\"code-keyword\">var</span> type = (umd.decode.stringCheck(bytes, it_4))\n","                    ? umd.decode.string(bytes, it_4)\n","                    : umd.decode.number(bytes, it_4);\n","                <span class=\"code-keyword\">this</span>.dispatchMessage(type, <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Uint8Array</span>(bytes.slice(it_4.offset)));\n","            }\n","        };\n","        Room.prototype.setState = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">encodedState</span>) </span>{\n","            <span class=\"code-keyword\">this</span>.serializer.setState(encodedState);\n","            <span class=\"code-keyword\">this</span>.onStateChange.invoke(<span class=\"code-keyword\">this</span>.serializer.getState());\n","        };\n","        Room.prototype.patch = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">binaryPatch</span>) </span>{\n","            <span class=\"code-keyword\">this</span>.serializer.patch(binaryPatch);\n","            <span class=\"code-keyword\">this</span>.onStateChange.invoke(<span class=\"code-keyword\">this</span>.serializer.getState());\n","        };\n","        Room.prototype.dispatchMessage = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">type, message</span>) </span>{\n","            <span class=\"code-keyword\">var</span> _a;\n","            <span class=\"code-keyword\">var</span> messageType = <span class=\"code-keyword\">this</span>.getMessageHandlerKey(type);\n","            <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">this</span>.onMessageHandlers.events[messageType]) {\n","                <span class=\"code-keyword\">this</span>.onMessageHandlers.emit(messageType, message);\n","            }\n","            <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">this</span>.onMessageHandlers.events[<span class=\"code-string\">'*'</span>]) {\n","                <span class=\"code-keyword\">this</span>.onMessageHandlers.emit(<span class=\"code-string\">'*'</span>, type, message);\n","            }\n","            <span class=\"code-keyword\">else</span> {\n","                (_a = <span class=\"code-built_in\">console</span>.warn) === <span class=\"code-literal\">null</span> || _a === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _a.call(<span class=\"code-built_in\">console</span>, <span class=\"code-string\">\"colyseus.js: onMessage() not registered for type '\"</span>.concat(type, <span class=\"code-string\">\"'.\"</span>));\n","            }\n","        };\n","        Room.prototype.destroy = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">this</span>.serializer) {\n","                <span class=\"code-keyword\">this</span>.serializer.teardown();\n","            }\n","        };\n","        Room.prototype.getMessageHandlerKey = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">type</span>) </span>{\n","            <span class=\"code-keyword\">switch</span> (<span class=\"code-keyword\">typeof</span> (type)) {\n","                <span class=\"code-comment\">// typeof Schema</span>\n","                <span class=\"code-keyword\">case</span> <span class=\"code-string\">\"function\"</span>: <span class=\"code-keyword\">return</span> <span class=\"code-string\">\"$\"</span>.concat(type._typeid);\n","                <span class=\"code-comment\">// string</span>\n","                <span class=\"code-keyword\">case</span> <span class=\"code-string\">\"string\"</span>: <span class=\"code-keyword\">return</span> type;\n","                <span class=\"code-comment\">// number</span>\n","                <span class=\"code-keyword\">case</span> <span class=\"code-string\">\"number\"</span>: <span class=\"code-keyword\">return</span> <span class=\"code-string\">\"i\"</span>.concat(type);\n","                <span class=\"code-keyword\">default</span>: <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">\"invalid message type.\"</span>);\n","            }\n","        };\n","        <span class=\"code-keyword\">return</span> Room;\n","    }());\n","\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">apply</span>(<span class=\"code-params\">src, tar</span>) </span>{\n","    \ttar.statusMessage = src.statusText;\n","    \ttar.statusCode = src.status;\n","    \ttar.data = src.body;\n","    }\n","\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">send</span>(<span class=\"code-params\">method, uri, opts</span>) </span>{\n","    \topts = opts || {};\n","    \t<span class=\"code-keyword\">var</span> timer, ctrl, tmp=opts.body;\n","\n","    \topts.method = method;\n","    \topts.headers = opts.headers || {};\n","\n","    \t<span class=\"code-keyword\">if</span> (tmp <span class=\"code-keyword\">instanceof</span> FormData) ; <span class=\"code-keyword\">else</span> <span class=\"code-keyword\">if</span> (tmp &amp;&amp; <span class=\"code-keyword\">typeof</span> tmp == <span class=\"code-string\">'object'</span>) {\n","    \t\topts.headers[<span class=\"code-string\">'content-type'</span>] = <span class=\"code-string\">'application/json'</span>;\n","    \t\topts.body = <span class=\"code-built_in\">JSON</span>.stringify(tmp);\n","    \t}\n","\n","    \t<span class=\"code-keyword\">if</span> (opts.withCredentials) {\n","    \t\topts.credentials = <span class=\"code-string\">'include'</span>;\n","    \t}\n","\n","    \t<span class=\"code-keyword\">if</span> (opts.timeout) {\n","    \t\tctrl = <span class=\"code-keyword\">new</span> AbortController;\n","    \t\topts.signal = ctrl.signal;\n","    \t\ttimer = setTimeout(ctrl.abort, opts.timeout);\n","    \t}\n","\n","    \t<span class=\"code-keyword\">return</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Promise</span>(<span class=\"code-function\">(<span class=\"code-params\">res, rej</span>) =&gt;</span> {\n","    \t\tfetch(uri, opts).then(<span class=\"code-function\">(<span class=\"code-params\">rr, reply</span>) =&gt;</span> {\n","    \t\t\tclearTimeout(timer);\n","\n","    \t\t\tapply(rr, rr); <span class=\"code-comment\">//=&gt; rr.headers</span>\n","    \t\t\treply = rr.status &gt;= <span class=\"code-number\">400</span> ? rej : res;\n","\n","    \t\t\ttmp = rr.headers.get(<span class=\"code-string\">'content-type'</span>);\n","    \t\t\t<span class=\"code-keyword\">if</span> (!tmp || !~tmp.indexOf(<span class=\"code-string\">'application/json'</span>)) {\n","    \t\t\t\treply(rr);\n","    \t\t\t} <span class=\"code-keyword\">else</span> {\n","    \t\t\t\trr.text().then(<span class=\"code-function\"><span class=\"code-params\">str</span> =&gt;</span> {\n","    \t\t\t\t\t<span class=\"code-keyword\">try</span> {\n","    \t\t\t\t\t\trr.data = <span class=\"code-built_in\">JSON</span>.parse(str, opts.reviver);\n","    \t\t\t\t\t\treply(rr);\n","    \t\t\t\t\t} <span class=\"code-keyword\">catch</span> (err) {\n","    \t\t\t\t\t\terr.headers = rr.headers;\n","    \t\t\t\t\t\tapply(rr, err);\n","    \t\t\t\t\t\trej(err);\n","    \t\t\t\t\t}\n","    \t\t\t\t});\n","    \t\t\t}\n","    \t\t}).catch(<span class=\"code-function\"><span class=\"code-params\">err</span> =&gt;</span> {\n","    \t\t\terr.timeout = ctrl &amp;&amp; ctrl.signal.aborted;\n","    \t\t\trej(err);\n","    \t\t});\n","    \t});\n","    }\n","\n","    <span class=\"code-keyword\">var</span> <span class=\"code-keyword\">get</span> = /*#__PURE__*/ send.bind(send, 'GET');\n","    var post = /*#__PURE__*/ send.bind(send, 'POST');\n","    var patch = /*#__PURE__*/ send.bind(send, 'PATCH');\n","    var del = /*#__PURE__*/ send.bind(send, 'DELETE');\n","    var put = /*#__PURE__*/ send.bind(send, 'PUT');\n","\n","    var del_1 = del;\n","    var get_1 = <span class=\"code-keyword\">get</span>;\n","    var patch_1 = patch;\n","    var post_1 = post;\n","    var put_1 = put;\n","    var send_1 = send;\n","\n","    var fetch_1 = {\n","    \tdel: del_1,\n","    \t<span class=\"code-keyword\">get</span>: get_1,\n","    \tpatch: patch_1,\n","    \tpost: post_1,\n","    \tput: put_1,\n","    \tsend: send_1\n","    };\n","\n","    var httpie = /*#__PURE__*/_mergeNamespaces({\n","        __proto__: <span class=\"code-literal\">null</span>,\n","        <span class=\"code-string\">'default'</span>: fetch_1,\n","        del: del_1,\n","        <span class=\"code-keyword\">get</span>: get_1,\n","        patch: patch_1,\n","        post: post_1,\n","        put: put_1,\n","        send: send_1\n","    }, [fetch_1]);\n","\n","    var HTTP = /** @class */ (function () {\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">HTTP</span>(<span class=\"code-params\">client</span>) </span>{\n","            <span class=\"code-keyword\">this</span>.client = client;\n","        }\n","        HTTP.prototype.get = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">path, options</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (options === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { options = {}; }\n","            <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.request(<span class=\"code-string\">\"get\"</span>, path, options);\n","        };\n","        HTTP.prototype.post = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">path, options</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (options === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { options = {}; }\n","            <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.request(<span class=\"code-string\">\"post\"</span>, path, options);\n","        };\n","        HTTP.prototype.del = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">path, options</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (options === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { options = {}; }\n","            <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.request(<span class=\"code-string\">\"del\"</span>, path, options);\n","        };\n","        HTTP.prototype.put = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">path, options</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (options === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { options = {}; }\n","            <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.request(<span class=\"code-string\">\"put\"</span>, path, options);\n","        };\n","        HTTP.prototype.request = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">method, path, options</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (options === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { options = {}; }\n","            <span class=\"code-keyword\">return</span> httpie[method](<span class=\"code-keyword\">this</span>.client[<span class=\"code-string\">'getHttpEndpoint'</span>](path), <span class=\"code-keyword\">this</span>.getOptions(options)).catch(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">e</span>) </span>{\n","                <span class=\"code-keyword\">var</span> _a;\n","                <span class=\"code-keyword\">var</span> status = e.statusCode; <span class=\"code-comment\">//  || -1</span>\n","                <span class=\"code-keyword\">var</span> message = ((_a = e.data) === <span class=\"code-literal\">null</span> || _a === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _a.error) || e.statusMessage || e.message; <span class=\"code-comment\">//  || \"offline\"</span>\n","                <span class=\"code-keyword\">if</span> (!status &amp;&amp; !message) {\n","                    <span class=\"code-keyword\">throw</span> e;\n","                }\n","                <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> ServerError(status, message);\n","            });\n","        };\n","        HTTP.prototype.getOptions = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">options</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">this</span>.authToken) {\n","                <span class=\"code-keyword\">if</span> (!options.headers) {\n","                    options.headers = {};\n","                }\n","                options.headers[<span class=\"code-string\">'Authorization'</span>] = <span class=\"code-string\">\"Bearer \"</span>.concat(<span class=\"code-keyword\">this</span>.authToken);\n","            }\n","            <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (cc) !== <span class=\"code-string\">'undefined'</span> &amp;&amp; cc.sys &amp;&amp; cc.sys.isNative) ;\n","            <span class=\"code-keyword\">else</span> {\n","                <span class=\"code-comment\">// always include credentials</span>\n","                options.withCredentials = <span class=\"code-literal\">true</span>;\n","            }\n","            <span class=\"code-keyword\">return</span> options;\n","        };\n","        <span class=\"code-keyword\">return</span> HTTP;\n","    }());\n","\n","    <span class=\"code-comment\">/// &lt;reference path=\"../typings/cocos-creator.d.ts\" /&gt;</span>\n","    <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">     * We do not assign 'storage' to window.localStorage immediatelly for React\n</span>","<span class=\"code-comment\">     * Native compatibility. window.localStorage is not present when this module is\n</span>","<span class=\"code-comment\">     * loaded.\n</span>","<span class=\"code-comment\">     */</span>\n","    <span class=\"code-keyword\">var</span> storage;\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">getStorage</span>(<span class=\"code-params\"></span>) </span>{\n","        <span class=\"code-keyword\">if</span> (!storage) {\n","            <span class=\"code-keyword\">try</span> {\n","                storage = (<span class=\"code-keyword\">typeof</span> (cc) !== <span class=\"code-string\">'undefined'</span> &amp;&amp; cc.sys &amp;&amp; cc.sys.localStorage)\n","                    ? cc.sys.localStorage <span class=\"code-comment\">// compatibility with cocos creator</span>\n","                    : <span class=\"code-built_in\">window</span>.localStorage; <span class=\"code-comment\">// RN does have window object at this point, but localStorage is not defined</span>\n","            }\n","            <span class=\"code-keyword\">catch</span> (e) {\n","                <span class=\"code-comment\">// ignore error</span>\n","            }\n","        }\n","        <span class=\"code-keyword\">if</span> (!storage) {\n","            <span class=\"code-comment\">// mock localStorage if not available (Node.js or RN environment)</span>\n","            storage = {\n","                cache: {},\n","                setItem: <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">key, value</span>) </span>{ <span class=\"code-keyword\">this</span>.cache[key] = value; },\n","                getItem: <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">key</span>) </span>{ <span class=\"code-keyword\">this</span>.cache[key]; },\n","                removeItem: <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">key</span>) </span>{ <span class=\"code-keyword\">delete</span> <span class=\"code-keyword\">this</span>.cache[key]; },\n","            };\n","        }\n","        <span class=\"code-keyword\">return</span> storage;\n","    }\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">setItem</span>(<span class=\"code-params\">key, value</span>) </span>{\n","        getStorage().setItem(key, value);\n","    }\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">removeItem</span>(<span class=\"code-params\">key</span>) </span>{\n","        getStorage().removeItem(key);\n","    }\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">getItem</span>(<span class=\"code-params\">key, callback</span>) </span>{\n","        <span class=\"code-keyword\">var</span> value = getStorage().getItem(key);\n","        <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (<span class=\"code-built_in\">Promise</span>) === <span class=\"code-string\">'undefined'</span> || <span class=\"code-comment\">// old browsers</span>\n","            !(value <span class=\"code-keyword\">instanceof</span> <span class=\"code-built_in\">Promise</span>)) {\n","            <span class=\"code-comment\">// browser has synchronous return</span>\n","            callback(value);\n","        }\n","        <span class=\"code-keyword\">else</span> {\n","            <span class=\"code-comment\">// react-native is asynchronous</span>\n","            value.then(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">id</span>) </span>{ <span class=\"code-keyword\">return</span> callback(id); });\n","        }\n","    }\n","\n","    <span class=\"code-keyword\">var</span> _Auth__initialized, _Auth__initializationPromise, _Auth__signInWindow, _Auth__events;\n","    <span class=\"code-keyword\">var</span> Auth = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">Auth</span>(<span class=\"code-params\">http</span>) </span>{\n","            <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","            <span class=\"code-keyword\">this</span>.http = http;\n","            <span class=\"code-keyword\">this</span>.settings = {\n","                path: <span class=\"code-string\">\"/auth\"</span>,\n","                key: <span class=\"code-string\">\"colyseus-auth-token\"</span>,\n","            };\n","            _Auth__initialized.set(<span class=\"code-keyword\">this</span>, <span class=\"code-literal\">false</span>);\n","            _Auth__initializationPromise.set(<span class=\"code-keyword\">this</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>);\n","            _Auth__signInWindow.set(<span class=\"code-keyword\">this</span>, <span class=\"code-literal\">undefined</span>);\n","            _Auth__events.set(<span class=\"code-keyword\">this</span>, createNanoEvents());\n","            getItem(<span class=\"code-keyword\">this</span>.settings.key, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">token</span>) </span>{ <span class=\"code-keyword\">return</span> _this.token = token; });\n","        }\n","        <span class=\"code-built_in\">Object</span>.defineProperty(Auth.prototype, <span class=\"code-string\">\"token\"</span>, {\n","            <span class=\"code-keyword\">get</span>: function () {\n","                <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.http.authToken;\n","            },\n","            <span class=\"code-keyword\">set</span>: function (token) {\n","                <span class=\"code-keyword\">this</span>.http.authToken = token;\n","            },\n","            enumerable: <span class=\"code-literal\">false</span>,\n","            configurable: <span class=\"code-literal\">true</span>\n","        });\n","        Auth.prototype.onChange = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">callback</span>) </span>{\n","            <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","            <span class=\"code-keyword\">var</span> unbindChange = __classPrivateFieldGet(<span class=\"code-keyword\">this</span>, _Auth__events, <span class=\"code-string\">\"f\"</span>).on(<span class=\"code-string\">\"change\"</span>, callback);\n","            <span class=\"code-keyword\">if</span> (!__classPrivateFieldGet(<span class=\"code-keyword\">this</span>, _Auth__initialized, <span class=\"code-string\">\"f\"</span>)) {\n","                __classPrivateFieldSet(<span class=\"code-keyword\">this</span>, _Auth__initializationPromise, <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Promise</span>(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">resolve, reject</span>) </span>{\n","                    _this.getUserData().then(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">userData</span>) </span>{\n","                        _this.emitChange(__assign(__assign({}, userData), { <span class=\"code-attr\">token</span>: _this.token }));\n","                    }).catch(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">e</span>) </span>{\n","                        <span class=\"code-comment\">// user is not logged in, or service is down</span>\n","                        _this.emitChange({ <span class=\"code-attr\">user</span>: <span class=\"code-literal\">null</span>, <span class=\"code-attr\">token</span>: <span class=\"code-literal\">undefined</span> });\n","                    }).finally(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                        resolve();\n","                    });\n","                }), <span class=\"code-string\">\"f\"</span>);\n","            }\n","            __classPrivateFieldSet(<span class=\"code-keyword\">this</span>, _Auth__initialized, <span class=\"code-literal\">true</span>, <span class=\"code-string\">\"f\"</span>);\n","            <span class=\"code-keyword\">return</span> unbindChange;\n","        };\n","        Auth.prototype.getUserData = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-keyword\">return</span> __awaiter(<span class=\"code-keyword\">this</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> __generator(<span class=\"code-keyword\">this</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_a</span>) </span>{\n","                    <span class=\"code-keyword\">switch</span> (_a.label) {\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">0</span>:\n","                            <span class=\"code-keyword\">if</span> (!<span class=\"code-keyword\">this</span>.token) <span class=\"code-keyword\">return</span> [<span class=\"code-number\">3</span> <span class=\"code-comment\">/*break*/</span>, <span class=\"code-number\">2</span>];\n","                            <span class=\"code-keyword\">return</span> [<span class=\"code-number\">4</span> <span class=\"code-comment\">/*yield*/</span>, <span class=\"code-keyword\">this</span>.http.get(<span class=\"code-string\">\"\"</span>.concat(<span class=\"code-keyword\">this</span>.settings.path, <span class=\"code-string\">\"/userdata\"</span>))];\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">1</span>: <span class=\"code-keyword\">return</span> [<span class=\"code-number\">2</span> <span class=\"code-comment\">/*return*/</span>, (_a.sent()).data];\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">2</span>: <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">\"missing auth.token\"</span>);\n","                    }\n","                });\n","            });\n","        };\n","        Auth.prototype.registerWithEmailAndPassword = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">email, password, options</span>) </span>{\n","            <span class=\"code-keyword\">return</span> __awaiter(<span class=\"code-keyword\">this</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> data;\n","                <span class=\"code-keyword\">return</span> __generator(<span class=\"code-keyword\">this</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_a</span>) </span>{\n","                    <span class=\"code-keyword\">switch</span> (_a.label) {\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">0</span>: <span class=\"code-keyword\">return</span> [<span class=\"code-number\">4</span> <span class=\"code-comment\">/*yield*/</span>, <span class=\"code-keyword\">this</span>.http.post(<span class=\"code-string\">\"\"</span>.concat(<span class=\"code-keyword\">this</span>.settings.path, <span class=\"code-string\">\"/register\"</span>), {\n","                                body: { <span class=\"code-attr\">email</span>: email, <span class=\"code-attr\">password</span>: password, <span class=\"code-attr\">options</span>: options, },\n","                            })];\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">1</span>:\n","                            data = (_a.sent()).data;\n","                            <span class=\"code-keyword\">this</span>.emitChange(data);\n","                            <span class=\"code-keyword\">return</span> [<span class=\"code-number\">2</span> <span class=\"code-comment\">/*return*/</span>, data];\n","                    }\n","                });\n","            });\n","        };\n","        Auth.prototype.signInWithEmailAndPassword = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">email, password</span>) </span>{\n","            <span class=\"code-keyword\">return</span> __awaiter(<span class=\"code-keyword\">this</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> data;\n","                <span class=\"code-keyword\">return</span> __generator(<span class=\"code-keyword\">this</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_a</span>) </span>{\n","                    <span class=\"code-keyword\">switch</span> (_a.label) {\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">0</span>: <span class=\"code-keyword\">return</span> [<span class=\"code-number\">4</span> <span class=\"code-comment\">/*yield*/</span>, <span class=\"code-keyword\">this</span>.http.post(<span class=\"code-string\">\"\"</span>.concat(<span class=\"code-keyword\">this</span>.settings.path, <span class=\"code-string\">\"/login\"</span>), {\n","                                body: { <span class=\"code-attr\">email</span>: email, <span class=\"code-attr\">password</span>: password, },\n","                            })];\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">1</span>:\n","                            data = (_a.sent()).data;\n","                            <span class=\"code-keyword\">this</span>.emitChange(data);\n","                            <span class=\"code-keyword\">return</span> [<span class=\"code-number\">2</span> <span class=\"code-comment\">/*return*/</span>, data];\n","                    }\n","                });\n","            });\n","        };\n","        Auth.prototype.signInAnonymously = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">options</span>) </span>{\n","            <span class=\"code-keyword\">return</span> __awaiter(<span class=\"code-keyword\">this</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> data;\n","                <span class=\"code-keyword\">return</span> __generator(<span class=\"code-keyword\">this</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_a</span>) </span>{\n","                    <span class=\"code-keyword\">switch</span> (_a.label) {\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">0</span>: <span class=\"code-keyword\">return</span> [<span class=\"code-number\">4</span> <span class=\"code-comment\">/*yield*/</span>, <span class=\"code-keyword\">this</span>.http.post(<span class=\"code-string\">\"\"</span>.concat(<span class=\"code-keyword\">this</span>.settings.path, <span class=\"code-string\">\"/anonymous\"</span>), {\n","                                body: { <span class=\"code-attr\">options</span>: options, }\n","                            })];\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">1</span>:\n","                            data = (_a.sent()).data;\n","                            <span class=\"code-keyword\">this</span>.emitChange(data);\n","                            <span class=\"code-keyword\">return</span> [<span class=\"code-number\">2</span> <span class=\"code-comment\">/*return*/</span>, data];\n","                    }\n","                });\n","            });\n","        };\n","        Auth.prototype.sendPasswordResetEmail = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">email</span>) </span>{\n","            <span class=\"code-keyword\">return</span> __awaiter(<span class=\"code-keyword\">this</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> __generator(<span class=\"code-keyword\">this</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_a</span>) </span>{\n","                    <span class=\"code-keyword\">switch</span> (_a.label) {\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">0</span>: <span class=\"code-keyword\">return</span> [<span class=\"code-number\">4</span> <span class=\"code-comment\">/*yield*/</span>, <span class=\"code-keyword\">this</span>.http.post(<span class=\"code-string\">\"\"</span>.concat(<span class=\"code-keyword\">this</span>.settings.path, <span class=\"code-string\">\"/forgot-password\"</span>), {\n","                                body: { <span class=\"code-attr\">email</span>: email, }\n","                            })];\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">1</span>: <span class=\"code-keyword\">return</span> [<span class=\"code-number\">2</span> <span class=\"code-comment\">/*return*/</span>, (_a.sent()).data];\n","                    }\n","                });\n","            });\n","        };\n","        Auth.prototype.signInWithProvider = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">providerName, settings</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (settings === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { settings = {}; }\n","            <span class=\"code-keyword\">return</span> __awaiter(<span class=\"code-keyword\">this</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","                <span class=\"code-keyword\">return</span> __generator(<span class=\"code-keyword\">this</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_a</span>) </span>{\n","                    <span class=\"code-keyword\">return</span> [<span class=\"code-number\">2</span> <span class=\"code-comment\">/*return*/</span>, <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Promise</span>(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">resolve, reject</span>) </span>{\n","                            <span class=\"code-keyword\">var</span> w = settings.width || <span class=\"code-number\">480</span>;\n","                            <span class=\"code-keyword\">var</span> h = settings.height || <span class=\"code-number\">768</span>;\n","                            <span class=\"code-comment\">// forward existing token for upgrading</span>\n","                            <span class=\"code-keyword\">var</span> upgradingToken = _this.token ? <span class=\"code-string\">\"?token=\"</span>.concat(_this.token) : <span class=\"code-string\">\"\"</span>;\n","                            <span class=\"code-comment\">// Capitalize first letter of providerName</span>\n","                            <span class=\"code-keyword\">var</span> title = <span class=\"code-string\">\"Login with \"</span>.concat((providerName[<span class=\"code-number\">0</span>].toUpperCase() + providerName.substring(<span class=\"code-number\">1</span>)));\n","                            <span class=\"code-keyword\">var</span> url = _this.http[<span class=\"code-string\">'client'</span>][<span class=\"code-string\">'getHttpEndpoint'</span>](<span class=\"code-string\">\"\"</span>.concat((settings.prefix || <span class=\"code-string\">\"\"</span>.concat(_this.settings.path, <span class=\"code-string\">\"/provider\"</span>)), <span class=\"code-string\">\"/\"</span>).concat(providerName).concat(upgradingToken));\n","                            <span class=\"code-keyword\">var</span> left = (screen.width / <span class=\"code-number\">2</span>) - (w / <span class=\"code-number\">2</span>);\n","                            <span class=\"code-keyword\">var</span> top = (screen.height / <span class=\"code-number\">2</span>) - (h / <span class=\"code-number\">2</span>);\n","                            __classPrivateFieldSet(_this, _Auth__signInWindow, <span class=\"code-built_in\">window</span>.open(url, title, <span class=\"code-string\">'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width='</span> + w + <span class=\"code-string\">', height='</span> + h + <span class=\"code-string\">', top='</span> + top + <span class=\"code-string\">', left='</span> + left), <span class=\"code-string\">\"f\"</span>);\n","                            <span class=\"code-keyword\">var</span> onMessage = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">event</span>) </span>{\n","                                <span class=\"code-comment\">// <span class=\"code-doctag\">TODO:</span> it is a good idea to check if event.origin can be trusted!</span>\n","                                <span class=\"code-comment\">// if (event.origin.indexOf(window.location.hostname) === -1) { return; }</span>\n","                                <span class=\"code-comment\">// require 'user' and 'token' inside received data.</span>\n","                                <span class=\"code-keyword\">if</span> (event.data.user === <span class=\"code-literal\">undefined</span> &amp;&amp; event.data.token === <span class=\"code-literal\">undefined</span>) {\n","                                    <span class=\"code-keyword\">return</span>;\n","                                }\n","                                clearInterval(rejectionChecker);\n","                                __classPrivateFieldGet(_this, _Auth__signInWindow, <span class=\"code-string\">\"f\"</span>).close();\n","                                __classPrivateFieldSet(_this, _Auth__signInWindow, <span class=\"code-literal\">undefined</span>, <span class=\"code-string\">\"f\"</span>);\n","                                <span class=\"code-built_in\">window</span>.removeEventListener(<span class=\"code-string\">\"message\"</span>, onMessage);\n","                                <span class=\"code-keyword\">if</span> (event.data.error !== <span class=\"code-literal\">undefined</span>) {\n","                                    reject(event.data.error);\n","                                }\n","                                <span class=\"code-keyword\">else</span> {\n","                                    resolve(event.data);\n","                                    _this.emitChange(event.data);\n","                                }\n","                            };\n","                            <span class=\"code-keyword\">var</span> rejectionChecker = setInterval(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                                <span class=\"code-keyword\">if</span> (!__classPrivateFieldGet(_this, _Auth__signInWindow, <span class=\"code-string\">\"f\"</span>) || __classPrivateFieldGet(_this, _Auth__signInWindow, <span class=\"code-string\">\"f\"</span>).closed) {\n","                                    __classPrivateFieldSet(_this, _Auth__signInWindow, <span class=\"code-literal\">undefined</span>, <span class=\"code-string\">\"f\"</span>);\n","                                    reject(<span class=\"code-string\">\"cancelled\"</span>);\n","                                    <span class=\"code-built_in\">window</span>.removeEventListener(<span class=\"code-string\">\"message\"</span>, onMessage);\n","                                }\n","                            }, <span class=\"code-number\">200</span>);\n","                            <span class=\"code-built_in\">window</span>.addEventListener(<span class=\"code-string\">\"message\"</span>, onMessage);\n","                        })];\n","                });\n","            });\n","        };\n","        Auth.prototype.signOut = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-keyword\">return</span> __awaiter(<span class=\"code-keyword\">this</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> __generator(<span class=\"code-keyword\">this</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_a</span>) </span>{\n","                    <span class=\"code-keyword\">this</span>.emitChange({ <span class=\"code-attr\">user</span>: <span class=\"code-literal\">null</span>, <span class=\"code-attr\">token</span>: <span class=\"code-literal\">null</span> });\n","                    <span class=\"code-keyword\">return</span> [<span class=\"code-number\">2</span> <span class=\"code-comment\">/*return*/</span>];\n","                });\n","            });\n","        };\n","        Auth.prototype.emitChange = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">authData</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (authData.token !== <span class=\"code-literal\">undefined</span>) {\n","                <span class=\"code-keyword\">this</span>.token = authData.token;\n","                <span class=\"code-keyword\">if</span> (authData.token === <span class=\"code-literal\">null</span>) {\n","                    removeItem(<span class=\"code-keyword\">this</span>.settings.key);\n","                }\n","                <span class=\"code-keyword\">else</span> {\n","                    <span class=\"code-comment\">// store key in localStorage</span>\n","                    setItem(<span class=\"code-keyword\">this</span>.settings.key, authData.token);\n","                }\n","            }\n","            __classPrivateFieldGet(<span class=\"code-keyword\">this</span>, _Auth__events, <span class=\"code-string\">\"f\"</span>).emit(<span class=\"code-string\">\"change\"</span>, authData);\n","        };\n","        <span class=\"code-keyword\">return</span> Auth;\n","    }());\n","    _Auth__initialized = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">WeakMap</span>(), _Auth__initializationPromise = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">WeakMap</span>(), _Auth__signInWindow = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">WeakMap</span>(), _Auth__events = <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">WeakMap</span>();\n","\n","    <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">     * Discord Embedded App SDK\n</span>","<span class=\"code-comment\">     * https://github.com/colyseus/colyseus/issues/707\n</span>","<span class=\"code-comment\">     *\n</span>","<span class=\"code-comment\">     * All URLs must go through the local proxy from\n</span>","<span class=\"code-comment\">     * https://&lt;app_id&gt;.discordsays.com/.proxy/&lt;mapped_url&gt;/...\n</span>","<span class=\"code-comment\">     *\n</span>","<span class=\"code-comment\">     * URL Mapping Examples:\n</span>","<span class=\"code-comment\">     *\n</span>","<span class=\"code-comment\">     * 1. Using Colyseus Cloud:\n</span>","<span class=\"code-comment\">     *   - /colyseus/{subdomain} -&gt; {subdomain}.colyseus.cloud\n</span>","<span class=\"code-comment\">     *\n</span>","<span class=\"code-comment\">     *   Example:\n</span>","<span class=\"code-comment\">     *     const client = new Client(\"https://xxxx.colyseus.cloud\");\n</span>","<span class=\"code-comment\">     *\n</span>","<span class=\"code-comment\">     * -------------------------------------------------------------\n</span>","<span class=\"code-comment\">     *\n</span>","<span class=\"code-comment\">     * 2. Using `cloudflared` tunnel:\n</span>","<span class=\"code-comment\">     *   - /colyseus/ -&gt; &lt;your-cloudflared-url&gt;.trycloudflare.com\n</span>","<span class=\"code-comment\">     *\n</span>","<span class=\"code-comment\">     *   Example:\n</span>","<span class=\"code-comment\">     *     const client = new Client(\"https://&lt;your-cloudflared-url&gt;.trycloudflare.com\");\n</span>","<span class=\"code-comment\">     *\n</span>","<span class=\"code-comment\">     * -------------------------------------------------------------\n</span>","<span class=\"code-comment\">     *\n</span>","<span class=\"code-comment\">     * 3. Providing a manual /.proxy/your-mapping:\n</span>","<span class=\"code-comment\">     *   - /your-mapping/ -&gt; your-endpoint.com\n</span>","<span class=\"code-comment\">     *\n</span>","<span class=\"code-comment\">     *   Example:\n</span>","<span class=\"code-comment\">     *     const client = new Client(\"/.proxy/your-mapping\");\n</span>","<span class=\"code-comment\">     *\n</span>","<span class=\"code-comment\">     */</span>\n","    <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">discordURLBuilder</span>(<span class=\"code-params\">url</span>) </span>{\n","        <span class=\"code-keyword\">var</span> _a;\n","        <span class=\"code-keyword\">var</span> localHostname = ((_a = <span class=\"code-built_in\">window</span> === <span class=\"code-literal\">null</span> || <span class=\"code-built_in\">window</span> === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : <span class=\"code-built_in\">window</span>.location) === <span class=\"code-literal\">null</span> || _a === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _a.hostname) || <span class=\"code-string\">\"localhost\"</span>;\n","        <span class=\"code-keyword\">var</span> remoteHostnameSplitted = url.hostname.split(<span class=\"code-string\">'.'</span>);\n","        <span class=\"code-keyword\">var</span> subdomain = (!url.hostname.includes(<span class=\"code-string\">\"trycloudflare.com\"</span>) &amp;&amp; <span class=\"code-comment\">// ignore cloudflared subdomains</span>\n","            !url.hostname.includes(<span class=\"code-string\">\"discordsays.com\"</span>) &amp;&amp; <span class=\"code-comment\">// ignore discordsays.com subdomains</span>\n","            remoteHostnameSplitted.length &gt; <span class=\"code-number\">2</span>)\n","            ? <span class=\"code-string\">\"/\"</span>.concat(remoteHostnameSplitted[<span class=\"code-number\">0</span>])\n","            : <span class=\"code-string\">''</span>;\n","        <span class=\"code-keyword\">return</span> (url.pathname.startsWith(<span class=\"code-string\">\"/.proxy\"</span>))\n","            ? <span class=\"code-string\">\"\"</span>.concat(url.protocol, <span class=\"code-string\">\"//\"</span>).concat(localHostname).concat(subdomain).concat(url.pathname).concat(url.search)\n","            : <span class=\"code-string\">\"\"</span>.concat(url.protocol, <span class=\"code-string\">\"//\"</span>).concat(localHostname, <span class=\"code-string\">\"/.proxy/colyseus\"</span>).concat(subdomain).concat(url.pathname).concat(url.search);\n","    }\n","\n","    <span class=\"code-keyword\">var</span> _a;\n","    <span class=\"code-keyword\">var</span> MatchMakeError = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_super</span>) </span>{\n","        __extends(MatchMakeError, _super);\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">MatchMakeError</span>(<span class=\"code-params\">message, code</span>) </span>{\n","            <span class=\"code-keyword\">var</span> _this = _super.call(<span class=\"code-keyword\">this</span>, message) || <span class=\"code-keyword\">this</span>;\n","            _this.code = code;\n","            <span class=\"code-built_in\">Object</span>.setPrototypeOf(_this, MatchMakeError.prototype);\n","            <span class=\"code-keyword\">return</span> _this;\n","        }\n","        <span class=\"code-keyword\">return</span> MatchMakeError;\n","    }(<span class=\"code-built_in\">Error</span>));\n","    <span class=\"code-comment\">// - React Native does not provide `window.location`</span>\n","    <span class=\"code-comment\">// - Cocos Creator (Native) does not provide `window.location.hostname`</span>\n","    <span class=\"code-keyword\">var</span> DEFAULT_ENDPOINT = (<span class=\"code-keyword\">typeof</span> (<span class=\"code-built_in\">window</span>) !== <span class=\"code-string\">\"undefined\"</span> &amp;&amp; <span class=\"code-keyword\">typeof</span> ((_a = <span class=\"code-built_in\">window</span> === <span class=\"code-literal\">null</span> || <span class=\"code-built_in\">window</span> === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : <span class=\"code-built_in\">window</span>.location) === <span class=\"code-literal\">null</span> || _a === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _a.hostname) !== <span class=\"code-string\">\"undefined\"</span>)\n","        ? <span class=\"code-string\">\"\"</span>.concat(<span class=\"code-built_in\">window</span>.location.protocol.replace(<span class=\"code-string\">\"http\"</span>, <span class=\"code-string\">\"ws\"</span>), <span class=\"code-string\">\"//\"</span>).concat(<span class=\"code-built_in\">window</span>.location.hostname).concat((<span class=\"code-built_in\">window</span>.location.port &amp;&amp; <span class=\"code-string\">\":\"</span>.concat(<span class=\"code-built_in\">window</span>.location.port)))\n","        : <span class=\"code-string\">\"ws://127.0.0.1:2567\"</span>;\n","    <span class=\"code-keyword\">var</span> Client = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">Client</span>(<span class=\"code-params\">settings, customURLBuilder</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (settings === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { settings = DEFAULT_ENDPOINT; }\n","            <span class=\"code-keyword\">var</span> _a, _b;\n","            <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (settings) === <span class=\"code-string\">\"string\"</span>) {\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-comment\">// endpoint by url</span>\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-keyword\">var</span> url = (settings.startsWith(<span class=\"code-string\">\"/\"</span>))\n","                    ? <span class=\"code-keyword\">new</span> URL(settings, DEFAULT_ENDPOINT)\n","                    : <span class=\"code-keyword\">new</span> URL(settings);\n","                <span class=\"code-keyword\">var</span> secure = (url.protocol === <span class=\"code-string\">\"https:\"</span> || url.protocol === <span class=\"code-string\">\"wss:\"</span>);\n","                <span class=\"code-keyword\">var</span> port = <span class=\"code-built_in\">Number</span>(url.port || (secure ? <span class=\"code-number\">443</span> : <span class=\"code-number\">80</span>));\n","                <span class=\"code-keyword\">this</span>.settings = {\n","                    hostname: url.hostname,\n","                    pathname: url.pathname,\n","                    port: port,\n","                    secure: secure\n","                };\n","            }\n","            <span class=\"code-keyword\">else</span> {\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-comment\">// endpoint by settings</span>\n","                <span class=\"code-comment\">//</span>\n","                <span class=\"code-keyword\">if</span> (settings.port === <span class=\"code-literal\">undefined</span>) {\n","                    settings.port = (settings.secure) ? <span class=\"code-number\">443</span> : <span class=\"code-number\">80</span>;\n","                }\n","                <span class=\"code-keyword\">if</span> (settings.pathname === <span class=\"code-literal\">undefined</span>) {\n","                    settings.pathname = <span class=\"code-string\">\"\"</span>;\n","                }\n","                <span class=\"code-keyword\">this</span>.settings = settings;\n","            }\n","            <span class=\"code-comment\">// make sure pathname does not end with \"/\"</span>\n","            <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">this</span>.settings.pathname.endsWith(<span class=\"code-string\">\"/\"</span>)) {\n","                <span class=\"code-keyword\">this</span>.settings.pathname = <span class=\"code-keyword\">this</span>.settings.pathname.slice(<span class=\"code-number\">0</span>, <span class=\"code-number\">-1</span>);\n","            }\n","            <span class=\"code-keyword\">this</span>.http = <span class=\"code-keyword\">new</span> HTTP(<span class=\"code-keyword\">this</span>);\n","            <span class=\"code-keyword\">this</span>.auth = <span class=\"code-keyword\">new</span> Auth(<span class=\"code-keyword\">this</span>.http);\n","            <span class=\"code-keyword\">this</span>.urlBuilder = customURLBuilder;\n","            <span class=\"code-comment\">//</span>\n","            <span class=\"code-comment\">// Discord Embedded SDK requires a custom URL builder</span>\n","            <span class=\"code-comment\">//</span>\n","            <span class=\"code-keyword\">if</span> (!<span class=\"code-keyword\">this</span>.urlBuilder &amp;&amp;\n","                <span class=\"code-keyword\">typeof</span> (<span class=\"code-built_in\">window</span>) !== <span class=\"code-string\">\"undefined\"</span> &amp;&amp;\n","                ((_b = (_a = <span class=\"code-built_in\">window</span> === <span class=\"code-literal\">null</span> || <span class=\"code-built_in\">window</span> === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : <span class=\"code-built_in\">window</span>.location) === <span class=\"code-literal\">null</span> || _a === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _a.hostname) === <span class=\"code-literal\">null</span> || _b === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _b.includes(<span class=\"code-string\">\"discordsays.com\"</span>))) {\n","                <span class=\"code-keyword\">this</span>.urlBuilder = discordURLBuilder;\n","                <span class=\"code-built_in\">console</span>.log(<span class=\"code-string\">\"Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder.\"</span>);\n","            }\n","        }\n","        Client.prototype.joinOrCreate = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">roomName, options, rootSchema</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (options === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { options = {}; }\n","            <span class=\"code-keyword\">return</span> __awaiter(<span class=\"code-keyword\">this</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> __generator(<span class=\"code-keyword\">this</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_a</span>) </span>{\n","                    <span class=\"code-keyword\">switch</span> (_a.label) {\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">0</span>: <span class=\"code-keyword\">return</span> [<span class=\"code-number\">4</span> <span class=\"code-comment\">/*yield*/</span>, <span class=\"code-keyword\">this</span>.createMatchMakeRequest(<span class=\"code-string\">'joinOrCreate'</span>, roomName, options, rootSchema)];\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">1</span>: <span class=\"code-keyword\">return</span> [<span class=\"code-number\">2</span> <span class=\"code-comment\">/*return*/</span>, _a.sent()];\n","                    }\n","                });\n","            });\n","        };\n","        Client.prototype.create = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">roomName, options, rootSchema</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (options === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { options = {}; }\n","            <span class=\"code-keyword\">return</span> __awaiter(<span class=\"code-keyword\">this</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> __generator(<span class=\"code-keyword\">this</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_a</span>) </span>{\n","                    <span class=\"code-keyword\">switch</span> (_a.label) {\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">0</span>: <span class=\"code-keyword\">return</span> [<span class=\"code-number\">4</span> <span class=\"code-comment\">/*yield*/</span>, <span class=\"code-keyword\">this</span>.createMatchMakeRequest(<span class=\"code-string\">'create'</span>, roomName, options, rootSchema)];\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">1</span>: <span class=\"code-keyword\">return</span> [<span class=\"code-number\">2</span> <span class=\"code-comment\">/*return*/</span>, _a.sent()];\n","                    }\n","                });\n","            });\n","        };\n","        Client.prototype.join = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">roomName, options, rootSchema</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (options === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { options = {}; }\n","            <span class=\"code-keyword\">return</span> __awaiter(<span class=\"code-keyword\">this</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> __generator(<span class=\"code-keyword\">this</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_a</span>) </span>{\n","                    <span class=\"code-keyword\">switch</span> (_a.label) {\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">0</span>: <span class=\"code-keyword\">return</span> [<span class=\"code-number\">4</span> <span class=\"code-comment\">/*yield*/</span>, <span class=\"code-keyword\">this</span>.createMatchMakeRequest(<span class=\"code-string\">'join'</span>, roomName, options, rootSchema)];\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">1</span>: <span class=\"code-keyword\">return</span> [<span class=\"code-number\">2</span> <span class=\"code-comment\">/*return*/</span>, _a.sent()];\n","                    }\n","                });\n","            });\n","        };\n","        Client.prototype.joinById = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">roomId, options, rootSchema</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (options === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { options = {}; }\n","            <span class=\"code-keyword\">return</span> __awaiter(<span class=\"code-keyword\">this</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> __generator(<span class=\"code-keyword\">this</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_a</span>) </span>{\n","                    <span class=\"code-keyword\">switch</span> (_a.label) {\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">0</span>: <span class=\"code-keyword\">return</span> [<span class=\"code-number\">4</span> <span class=\"code-comment\">/*yield*/</span>, <span class=\"code-keyword\">this</span>.createMatchMakeRequest(<span class=\"code-string\">'joinById'</span>, roomId, options, rootSchema)];\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">1</span>: <span class=\"code-keyword\">return</span> [<span class=\"code-number\">2</span> <span class=\"code-comment\">/*return*/</span>, _a.sent()];\n","                    }\n","                });\n","            });\n","        };\n","        <span class=\"code-comment\">/**\n</span>","<span class=\"code-comment\">         * Re-establish connection with a room this client was previously connected to.\n</span>","<span class=\"code-comment\">         *\n</span>","<span class=\"code-comment\">         * @param reconnectionToken The `room.reconnectionToken` from previously connected room.\n</span>","<span class=\"code-comment\">         * @param rootSchema (optional) Concrete root schema definition\n</span>","<span class=\"code-comment\">         * @returns Promise&lt;Room&gt;\n</span>","<span class=\"code-comment\">         */</span>\n","        Client.prototype.reconnect = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">reconnectionToken, rootSchema</span>) </span>{\n","            <span class=\"code-keyword\">return</span> __awaiter(<span class=\"code-keyword\">this</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> _a, roomId, token;\n","                <span class=\"code-keyword\">return</span> __generator(<span class=\"code-keyword\">this</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_b</span>) </span>{\n","                    <span class=\"code-keyword\">switch</span> (_b.label) {\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">0</span>:\n","                            <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">typeof</span> (reconnectionToken) === <span class=\"code-string\">\"string\"</span> &amp;&amp; <span class=\"code-keyword\">typeof</span> (rootSchema) === <span class=\"code-string\">\"string\"</span>) {\n","                                <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">\"DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\\nYou can get this token from previously connected `room.reconnectionToken`\"</span>);\n","                            }\n","                            _a = reconnectionToken.split(<span class=\"code-string\">\":\"</span>), roomId = _a[<span class=\"code-number\">0</span>], token = _a[<span class=\"code-number\">1</span>];\n","                            <span class=\"code-keyword\">if</span> (!roomId || !token) {\n","                                <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">\"Invalid reconnection token format.\\nThe format should be roomId:reconnectionToken\"</span>);\n","                            }\n","                            <span class=\"code-keyword\">return</span> [<span class=\"code-number\">4</span> <span class=\"code-comment\">/*yield*/</span>, <span class=\"code-keyword\">this</span>.createMatchMakeRequest(<span class=\"code-string\">'reconnect'</span>, roomId, { <span class=\"code-attr\">reconnectionToken</span>: token }, rootSchema)];\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">1</span>: <span class=\"code-keyword\">return</span> [<span class=\"code-number\">2</span> <span class=\"code-comment\">/*return*/</span>, _b.sent()];\n","                    }\n","                });\n","            });\n","        };\n","        Client.prototype.getAvailableRooms = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">roomName</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (roomName === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { roomName = <span class=\"code-string\">\"\"</span>; }\n","            <span class=\"code-keyword\">return</span> __awaiter(<span class=\"code-keyword\">this</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">return</span> __generator(<span class=\"code-keyword\">this</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_a</span>) </span>{\n","                    <span class=\"code-keyword\">switch</span> (_a.label) {\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">0</span>: <span class=\"code-keyword\">return</span> [<span class=\"code-number\">4</span> <span class=\"code-comment\">/*yield*/</span>, <span class=\"code-keyword\">this</span>.http.get(<span class=\"code-string\">\"matchmake/\"</span>.concat(roomName), {\n","                                headers: {\n","                                    <span class=\"code-string\">'Accept'</span>: <span class=\"code-string\">'application/json'</span>\n","                                }\n","                            })];\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">1</span>: <span class=\"code-keyword\">return</span> [<span class=\"code-number\">2</span> <span class=\"code-comment\">/*return*/</span>, (_a.sent()).data];\n","                    }\n","                });\n","            });\n","        };\n","        Client.prototype.consumeSeatReservation = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">response, rootSchema, reuseRoomInstance <span class=\"code-regexp\">//</span> used in devMode\n</span></span>","<span class=\"code-function\"><span class=\"code-params\">        </span>) </span>{\n","            <span class=\"code-keyword\">return</span> __awaiter(<span class=\"code-keyword\">this</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> room, options, targetRoom;\n","                <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","                <span class=\"code-keyword\">return</span> __generator(<span class=\"code-keyword\">this</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_a</span>) </span>{\n","                    room = <span class=\"code-keyword\">this</span>.createRoom(response.room.name, rootSchema);\n","                    room.roomId = response.room.roomId;\n","                    room.sessionId = response.sessionId;\n","                    options = { <span class=\"code-attr\">sessionId</span>: room.sessionId };\n","                    <span class=\"code-comment\">// forward \"reconnection token\" in case of reconnection.</span>\n","                    <span class=\"code-keyword\">if</span> (response.reconnectionToken) {\n","                        options.reconnectionToken = response.reconnectionToken;\n","                    }\n","                    targetRoom = reuseRoomInstance || room;\n","                    room.connect(<span class=\"code-keyword\">this</span>.buildEndpoint(response.room, options), response.devMode &amp;&amp; (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{ <span class=\"code-keyword\">return</span> __awaiter(_this, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                        <span class=\"code-keyword\">var</span> retryCount, retryMaxRetries, retryReconnection;\n","                        <span class=\"code-keyword\">var</span> _this = <span class=\"code-keyword\">this</span>;\n","                        <span class=\"code-keyword\">return</span> __generator(<span class=\"code-keyword\">this</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_a</span>) </span>{\n","                            <span class=\"code-built_in\">console</span>.info(<span class=\"code-string\">\"[Colyseus devMode]: \"</span>.concat(<span class=\"code-built_in\">String</span>.fromCodePoint(<span class=\"code-number\">0x1F504</span>), <span class=\"code-string\">\" Re-establishing connection with room id '\"</span>).concat(room.roomId, <span class=\"code-string\">\"'...\"</span>)); <span class=\"code-comment\">// \uD83D\uDD04</span>\n","                            retryCount = <span class=\"code-number\">0</span>;\n","                            retryMaxRetries = <span class=\"code-number\">8</span>;\n","                            retryReconnection = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{ <span class=\"code-keyword\">return</span> __awaiter(_this, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                                <span class=\"code-keyword\">return</span> __generator(<span class=\"code-keyword\">this</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_a</span>) </span>{\n","                                    <span class=\"code-keyword\">switch</span> (_a.label) {\n","                                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">0</span>:\n","                                            retryCount++;\n","                                            _a.label = <span class=\"code-number\">1</span>;\n","                                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">1</span>:\n","                                            _a.trys.push([<span class=\"code-number\">1</span>, <span class=\"code-number\">3</span>, , <span class=\"code-number\">4</span>]);\n","                                            <span class=\"code-keyword\">return</span> [<span class=\"code-number\">4</span> <span class=\"code-comment\">/*yield*/</span>, <span class=\"code-keyword\">this</span>.consumeSeatReservation(response, rootSchema, targetRoom)];\n","                                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">2</span>:\n","                                            _a.sent();\n","                                            <span class=\"code-built_in\">console</span>.info(<span class=\"code-string\">\"[Colyseus devMode]: \"</span>.concat(<span class=\"code-built_in\">String</span>.fromCodePoint(<span class=\"code-number\">0x2705</span>), <span class=\"code-string\">\" Successfully re-established connection with room '\"</span>).concat(room.roomId, <span class=\"code-string\">\"'\"</span>)); <span class=\"code-comment\">// \u2705</span>\n","                                            <span class=\"code-keyword\">return</span> [<span class=\"code-number\">3</span> <span class=\"code-comment\">/*break*/</span>, <span class=\"code-number\">4</span>];\n","                                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">3</span>:\n","                                            _a.sent();\n","                                            <span class=\"code-keyword\">if</span> (retryCount &lt; retryMaxRetries) {\n","                                                <span class=\"code-built_in\">console</span>.info(<span class=\"code-string\">\"[Colyseus devMode]: \"</span>.concat(<span class=\"code-built_in\">String</span>.fromCodePoint(<span class=\"code-number\">0x1F504</span>), <span class=\"code-string\">\" retrying... (\"</span>).concat(retryCount, <span class=\"code-string\">\" out of \"</span>).concat(retryMaxRetries, <span class=\"code-string\">\")\"</span>)); <span class=\"code-comment\">// \uD83D\uDD04</span>\n","                                                setTimeout(retryReconnection, <span class=\"code-number\">2000</span>);\n","                                            }\n","                                            <span class=\"code-keyword\">else</span> {\n","                                                <span class=\"code-built_in\">console</span>.info(<span class=\"code-string\">\"[Colyseus devMode]: \"</span>.concat(<span class=\"code-built_in\">String</span>.fromCodePoint(<span class=\"code-number\">0x274C</span>), <span class=\"code-string\">\" Failed to reconnect. Is your server running? Please check server logs.\"</span>)); <span class=\"code-comment\">// \u274C</span>\n","                                            }\n","                                            <span class=\"code-keyword\">return</span> [<span class=\"code-number\">3</span> <span class=\"code-comment\">/*break*/</span>, <span class=\"code-number\">4</span>];\n","                                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">4</span>: <span class=\"code-keyword\">return</span> [<span class=\"code-number\">2</span> <span class=\"code-comment\">/*return*/</span>];\n","                                    }\n","                                });\n","                            }); };\n","                            setTimeout(retryReconnection, <span class=\"code-number\">2000</span>);\n","                            <span class=\"code-keyword\">return</span> [<span class=\"code-number\">2</span> <span class=\"code-comment\">/*return*/</span>];\n","                        });\n","                    }); }), targetRoom);\n","                    <span class=\"code-keyword\">return</span> [<span class=\"code-number\">2</span> <span class=\"code-comment\">/*return*/</span>, <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Promise</span>(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">resolve, reject</span>) </span>{\n","                            <span class=\"code-keyword\">var</span> onError = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">code, message</span>) </span>{ <span class=\"code-keyword\">return</span> reject(<span class=\"code-keyword\">new</span> ServerError(code, message)); };\n","                            targetRoom.onError.once(onError);\n","                            targetRoom[<span class=\"code-string\">'onJoin'</span>].once(<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                                targetRoom.onError.remove(onError);\n","                                resolve(targetRoom);\n","                            });\n","                        })];\n","                });\n","            });\n","        };\n","        Client.prototype.createMatchMakeRequest = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">method, roomName, options, rootSchema, reuseRoomInstance</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (options === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { options = {}; }\n","            <span class=\"code-keyword\">return</span> __awaiter(<span class=\"code-keyword\">this</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","                <span class=\"code-keyword\">var</span> response;\n","                <span class=\"code-keyword\">return</span> __generator(<span class=\"code-keyword\">this</span>, <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">_a</span>) </span>{\n","                    <span class=\"code-keyword\">switch</span> (_a.label) {\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">0</span>: <span class=\"code-keyword\">return</span> [<span class=\"code-number\">4</span> <span class=\"code-comment\">/*yield*/</span>, <span class=\"code-keyword\">this</span>.http.post(<span class=\"code-string\">\"matchmake/\"</span>.concat(method, <span class=\"code-string\">\"/\"</span>).concat(roomName), {\n","                                headers: {\n","                                    <span class=\"code-string\">'Accept'</span>: <span class=\"code-string\">'application/json'</span>,\n","                                    <span class=\"code-string\">'Content-Type'</span>: <span class=\"code-string\">'application/json'</span>\n","                                },\n","                                body: <span class=\"code-built_in\">JSON</span>.stringify(options)\n","                            })];\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">1</span>:\n","                            response = (_a.sent()).data;\n","                            <span class=\"code-comment\">// <span class=\"code-doctag\">FIXME:</span> HTTP class is already handling this as ServerError.</span>\n","                            <span class=\"code-keyword\">if</span> (response.error) {\n","                                <span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> MatchMakeError(response.error, response.code);\n","                            }\n","                            <span class=\"code-comment\">// forward reconnection token during \"reconnect\" methods.</span>\n","                            <span class=\"code-keyword\">if</span> (method === <span class=\"code-string\">\"reconnect\"</span>) {\n","                                response.reconnectionToken = options.reconnectionToken;\n","                            }\n","                            <span class=\"code-keyword\">return</span> [<span class=\"code-number\">4</span> <span class=\"code-comment\">/*yield*/</span>, <span class=\"code-keyword\">this</span>.consumeSeatReservation(response, rootSchema, reuseRoomInstance)];\n","                        <span class=\"code-keyword\">case</span> <span class=\"code-number\">2</span>: <span class=\"code-keyword\">return</span> [<span class=\"code-number\">2</span> <span class=\"code-comment\">/*return*/</span>, _a.sent()];\n","                    }\n","                });\n","            });\n","        };\n","        Client.prototype.createRoom = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">roomName, rootSchema</span>) </span>{\n","            <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">new</span> Room(roomName, rootSchema);\n","        };\n","        Client.prototype.buildEndpoint = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">room, options</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (options === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { options = {}; }\n","            <span class=\"code-keyword\">var</span> params = [];\n","            <span class=\"code-comment\">// append provided options</span>\n","            <span class=\"code-keyword\">for</span> (<span class=\"code-keyword\">var</span> name_1 <span class=\"code-keyword\">in</span> options) {\n","                <span class=\"code-keyword\">if</span> (!options.hasOwnProperty(name_1)) {\n","                    <span class=\"code-keyword\">continue</span>;\n","                }\n","                params.push(<span class=\"code-string\">\"\"</span>.concat(name_1, <span class=\"code-string\">\"=\"</span>).concat(options[name_1]));\n","            }\n","            <span class=\"code-keyword\">var</span> endpoint = (<span class=\"code-keyword\">this</span>.settings.secure)\n","                ? <span class=\"code-string\">\"wss://\"</span>\n","                : <span class=\"code-string\">\"ws://\"</span>;\n","            <span class=\"code-keyword\">if</span> (room.publicAddress) {\n","                endpoint += <span class=\"code-string\">\"\"</span>.concat(room.publicAddress);\n","            }\n","            <span class=\"code-keyword\">else</span> {\n","                endpoint += <span class=\"code-string\">\"\"</span>.concat(<span class=\"code-keyword\">this</span>.settings.hostname).concat(<span class=\"code-keyword\">this</span>.getEndpointPort()).concat(<span class=\"code-keyword\">this</span>.settings.pathname);\n","            }\n","            <span class=\"code-keyword\">var</span> endpointURL = <span class=\"code-string\">\"\"</span>.concat(endpoint, <span class=\"code-string\">\"/\"</span>).concat(room.processId, <span class=\"code-string\">\"/\"</span>).concat(room.roomId, <span class=\"code-string\">\"?\"</span>).concat(params.join(<span class=\"code-string\">'&amp;'</span>));\n","            <span class=\"code-keyword\">return</span> (<span class=\"code-keyword\">this</span>.urlBuilder)\n","                ? <span class=\"code-keyword\">this</span>.urlBuilder(<span class=\"code-keyword\">new</span> URL(endpointURL))\n","                : endpointURL;\n","        };\n","        Client.prototype.getHttpEndpoint = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">segments</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (segments === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>) { segments = <span class=\"code-string\">''</span>; }\n","            <span class=\"code-keyword\">var</span> path = segments.startsWith(<span class=\"code-string\">\"/\"</span>) ? segments : <span class=\"code-string\">\"/\"</span>.concat(segments);\n","            <span class=\"code-keyword\">var</span> endpointURL = <span class=\"code-string\">\"\"</span>.concat((<span class=\"code-keyword\">this</span>.settings.secure) ? <span class=\"code-string\">\"https\"</span> : <span class=\"code-string\">\"http\"</span>, <span class=\"code-string\">\"://\"</span>).concat(<span class=\"code-keyword\">this</span>.settings.hostname).concat(<span class=\"code-keyword\">this</span>.getEndpointPort()).concat(<span class=\"code-keyword\">this</span>.settings.pathname).concat(path);\n","            <span class=\"code-keyword\">return</span> (<span class=\"code-keyword\">this</span>.urlBuilder)\n","                ? <span class=\"code-keyword\">this</span>.urlBuilder(<span class=\"code-keyword\">new</span> URL(endpointURL))\n","                : endpointURL;\n","        };\n","        Client.prototype.getEndpointPort = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-keyword\">return</span> (<span class=\"code-keyword\">this</span>.settings.port !== <span class=\"code-number\">80</span> &amp;&amp; <span class=\"code-keyword\">this</span>.settings.port !== <span class=\"code-number\">443</span>)\n","                ? <span class=\"code-string\">\":\"</span>.concat(<span class=\"code-keyword\">this</span>.settings.port)\n","                : <span class=\"code-string\">\"\"</span>;\n","        };\n","        <span class=\"code-keyword\">return</span> Client;\n","    }());\n","\n","    <span class=\"code-keyword\">var</span> SchemaSerializer = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">SchemaSerializer</span>(<span class=\"code-params\"></span>) </span>{\n","        }\n","        SchemaSerializer.prototype.setState = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">rawState</span>) </span>{\n","            <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.state.decode(rawState);\n","        };\n","        SchemaSerializer.prototype.getState = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.state;\n","        };\n","        SchemaSerializer.prototype.patch = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">patches</span>) </span>{\n","            <span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>.state.decode(patches);\n","        };\n","        SchemaSerializer.prototype.teardown = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","            <span class=\"code-keyword\">var</span> _a, _b;\n","            (_b = (_a = <span class=\"code-keyword\">this</span>.state) === <span class=\"code-literal\">null</span> || _a === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _a[<span class=\"code-string\">'$changes'</span>]) === <span class=\"code-literal\">null</span> || _b === <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> ? <span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span> : _b.root.clearRefs();\n","        };\n","        SchemaSerializer.prototype.handshake = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">bytes, it</span>) </span>{\n","            <span class=\"code-keyword\">if</span> (<span class=\"code-keyword\">this</span>.state) {\n","                <span class=\"code-comment\">// <span class=\"code-doctag\">TODO:</span> validate client/server definitinos</span>\n","                <span class=\"code-keyword\">var</span> reflection = <span class=\"code-keyword\">new</span> umd.Reflection();\n","                reflection.decode(bytes, it);\n","            }\n","            <span class=\"code-keyword\">else</span> {\n","                <span class=\"code-comment\">// initialize reflected state from server</span>\n","                <span class=\"code-keyword\">this</span>.state = umd.Reflection.decode(bytes, it);\n","            }\n","        };\n","        <span class=\"code-keyword\">return</span> SchemaSerializer;\n","    }());\n","\n","    <span class=\"code-keyword\">var</span> NoneSerializer = <span class=\"code-comment\">/** @class */</span> (<span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{\n","        <span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">NoneSerializer</span>(<span class=\"code-params\"></span>) </span>{\n","        }\n","        NoneSerializer.prototype.setState = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">rawState</span>) </span>{ };\n","        NoneSerializer.prototype.getState = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{ <span class=\"code-keyword\">return</span> <span class=\"code-literal\">null</span>; };\n","        NoneSerializer.prototype.patch = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">patches</span>) </span>{ };\n","        NoneSerializer.prototype.teardown = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\"></span>) </span>{ };\n","        NoneSerializer.prototype.handshake = <span class=\"code-function\"><span class=\"code-keyword\">function</span> (<span class=\"code-params\">bytes</span>) </span>{ };\n","        <span class=\"code-keyword\">return</span> NoneSerializer;\n","    }());\n","\n","    registerSerializer(<span class=\"code-string\">'schema'</span>, SchemaSerializer);\n","    registerSerializer(<span class=\"code-string\">'none'</span>, NoneSerializer);\n","\n","    exports.Auth = Auth;\n","    exports.Client = Client;\n","    exports.Room = Room;\n","    exports.SchemaSerializer = SchemaSerializer;\n","    exports.registerSerializer = registerSerializer;\n","\n","    <span class=\"code-built_in\">Object</span>.defineProperty(exports, <span class=\"code-string\">'__esModule'</span>, { <span class=\"code-attr\">value</span>: <span class=\"code-literal\">true</span> });\n","\n","}));\n","<span class=\"code-comment\">//# sourceMappingURL=colyseus.js.map</span>\n",""]}}}</script></head><body><div id="root"><style data-emotion-css="gtfibm">html{box-sizing:border-box;}*,*:before,*:after{box-sizing:inherit;}html,body,#root{height:100%;margin:0;}body{font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;font-size:16px;line-height:1.5;overflow-wrap:break-word;background:white;color:black;}code{font-family:Menlo, Monaco, Lucida Console, Liberation Mono, DejaVu Sans Mono, Bitstream Vera Sans Mono, Courier New, monospace;}th,td{padding:0;}select{font-size:inherit;}#root{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}</style><style data-emotion-css="1r6h1r6">.code-listing{background:#fbfdff;color:#383a42;}.code-comment,.code-quote{color:#a0a1a7;font-style:italic;}.code-doctag,.code-keyword,.code-link,.code-formula{color:#a626a4;}.code-section,.code-name,.code-selector-tag,.code-deletion,.code-subst{color:#e45649;}.code-literal{color:#0184bb;}.code-string,.code-regexp,.code-addition,.code-attribute,.code-meta-string{color:#50a14f;}.code-built_in,.code-class .code-title{color:#c18401;}.code-attr,.code-variable,.code-template-variable,.code-type,.code-selector-class,.code-selector-attr,.code-selector-pseudo,.code-number{color:#986801;}.code-symbol,.code-bullet,.code-meta,.code-selector-id,.code-title{color:#4078f2;}.code-emphasis{font-style:italic;}.code-strong{font-weight:bold;}</style><style data-emotion-css="1c3h18e">.css-1c3h18e{-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;}</style><div class="css-1c3h18e"><style data-emotion-css="1cfuj1t">.css-1cfuj1t{max-width:940px;padding:0 20px;margin:0 auto;}</style><div class="css-1cfuj1t"><style data-emotion-css="i51og3">.css-i51og3{margin-top:2rem;}</style><header class="css-i51og3"><style data-emotion-css="1y7u1xh">.css-1y7u1xh{text-align:center;font-size:3rem;-webkit-letter-spacing:0.05em;-moz-letter-spacing:0.05em;-ms-letter-spacing:0.05em;letter-spacing:0.05em;}</style><h1 class="css-1y7u1xh"><style data-emotion-css="1ydg16i">.css-1ydg16i{color:#000;-webkit-text-decoration:none;text-decoration:none;}</style><a href="/" class="css-1ydg16i">UNPKG</a></h1></header></div><div class="css-1cfuj1t"><style data-emotion-css="93o42g">.css-93o42g{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}@media (max-width:700px){.css-93o42g{-webkit-flex-direction:column-reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}</style><header class="css-93o42g"><style data-emotion-css="1dlpvgi">.css-1dlpvgi{font-size:1.5rem;font-weight:normal;-webkit-flex:1;-ms-flex:1;flex:1;word-break:break-all;}</style><h1 class="css-1dlpvgi"><nav><style data-emotion-css="xt128v">.css-xt128v{color:#0076ff;-webkit-text-decoration:none;text-decoration:none;}.css-xt128v:hover{-webkit-text-decoration:underline;text-decoration:underline;}</style><a href="/browse/colyseus.js@0.15.26/" class="css-xt128v">colyseus.js</a><style data-emotion-css="lllnmq">.css-lllnmq{padding-left:5px;padding-right:5px;}</style><span class="css-lllnmq">/</span><a href="/browse/colyseus.js@0.15.26/dist/" class="css-xt128v">dist</a><span class="css-lllnmq">/</span><strong>colyseus.js</strong></nav></h1><style data-emotion-css="1nr3dab">.css-1nr3dab{margin-left:20px;}@media (max-width:700px){.css-1nr3dab{margin-left:0;margin-bottom:0;}}</style><p class="css-1nr3dab"><label>Version:<!-- --> <style data-emotion-css="un3bt6">.css-un3bt6{-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;padding:4px 24px 4px 8px;font-weight:600;font-size:0.9em;color:#24292e;border:1px solid rgba(27,31,35,.2);border-radius:3px;background-color:#eff3f6;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAKCAYAAAC9vt6cAAAAAXNSR0IArs4c6QAAARFJREFUKBVjZAACNS39RhBNKrh17WI9o4quoT3Dn78HSNUMUs/CzOTI/O7Vi4dCYpJ3/jP+92BkYGAlyiBGhm8MjIxJt65e3MQM0vDu9YvLYmISILYZELOBxHABRkaGr0yMzF23r12YDFIDNgDEePv65SEhEXENBkYGFSAXuyGMjF8Z/jOsvX3tYiFIDwgwQSgIaaijnvj/P8M5IO8HsjiY/f//D4b//88A1SQhywG9jQr09PS4v/1mPAeUUPzP8B8cJowMjL+Bqu6xMQmaXL164AuyDgwDQJLa2qYSP//9vARkCoMVMzK8YeVkNbh+9uxzMB+JwGoASF5Vx0jz/98/18BqmZi171w9D2EjaaYKEwAEK00XQLdJuwAAAABJRU5ErkJggg==);background-position:right 8px center;background-repeat:no-repeat;background-size:auto 25%;}.css-un3bt6:hover{background-color:#e6ebf1;border-color:rgba(27,31,35,.35);}.css-un3bt6:active{background-color:#e9ecef;border-color:rgba(27,31,35,.35);box-shadow:inset 0 0.15em 0.3em rgba(27,31,35,.15);}</style><select name="version" class="css-un3bt6"><option value="0.1.3">0.1.3</option><option value="0.1.4">0.1.4</option><option value="0.1.5">0.1.5</option><option value="0.1.6">0.1.6</option><option value="0.1.7">0.1.7</option><option value="0.1.8">0.1.8</option><option value="0.2.0">0.2.0</option><option value="0.2.1">0.2.1</option><option value="0.2.2">0.2.2</option><option value="0.2.3">0.2.3</option><option value="0.2.4">0.2.4</option><option value="0.2.5">0.2.5</option><option value="0.2.6">0.2.6</option><option value="0.4.0">0.4.0</option><option value="0.4.1">0.4.1</option><option value="0.4.2">0.4.2</option><option value="0.4.4">0.4.4</option><option value="0.4.5">0.4.5</option><option value="0.5.0-beta.0">0.5.0-beta.0</option><option value="0.5.0">0.5.0</option><option value="0.5.1">0.5.1</option><option value="0.5.2">0.5.2</option><option value="0.6.0-alpha.0">0.6.0-alpha.0</option><option value="0.6.0-alpha.1">0.6.0-alpha.1</option><option value="0.6.0-alpha.2">0.6.0-alpha.2</option><option value="0.6.0-alpha.3">0.6.0-alpha.3</option><option value="0.6.0">0.6.0</option><option value="0.7.0-alpha.1">0.7.0-alpha.1</option><option value="0.7.0-alpha.2">0.7.0-alpha.2</option><option value="0.7.0-alpha.3">0.7.0-alpha.3</option><option value="0.7.0-alpha.4">0.7.0-alpha.4</option><option value="0.7.0-alpha.5">0.7.0-alpha.5</option><option value="0.7.0">0.7.0</option><option value="0.7.1">0.7.1</option><option value="0.7.2-rc1">0.7.2-rc1</option><option value="0.7.2-rc2">0.7.2-rc2</option><option value="0.7.2-rc3">0.7.2-rc3</option><option value="0.7.2-rc4">0.7.2-rc4</option><option value="0.7.2">0.7.2</option><option value="0.7.3-rc1">0.7.3-rc1</option><option value="0.7.3">0.7.3</option><option value="0.7.4">0.7.4</option><option value="0.7.5-alpha.0">0.7.5-alpha.0</option><option value="0.7.5-alpha.1">0.7.5-alpha.1</option><option value="0.7.5-alpha.2">0.7.5-alpha.2</option><option value="0.7.5">0.7.5</option><option value="0.7.6">0.7.6</option><option value="0.7.7-alpha.1">0.7.7-alpha.1</option><option value="0.8.0-alpha.0">0.8.0-alpha.0</option><option value="0.8.0">0.8.0</option><option value="0.8.1-alpha.0">0.8.1-alpha.0</option><option value="0.8.1-alpha.1">0.8.1-alpha.1</option><option value="0.8.2-alpha.0">0.8.2-alpha.0</option><option value="0.8.2-alpha.1">0.8.2-alpha.1</option><option value="0.8.2-alpha.2">0.8.2-alpha.2</option><option value="0.8.2">0.8.2</option><option value="0.8.3">0.8.3</option><option value="0.8.4">0.8.4</option><option value="0.9.0-alpha.0">0.9.0-alpha.0</option><option value="0.9.0-alpha.1">0.9.0-alpha.1</option><option value="0.9.0-alpha.2">0.9.0-alpha.2</option><option value="0.9.0-alpha.3">0.9.0-alpha.3</option><option value="0.9.0-alpha.4">0.9.0-alpha.4</option><option value="0.9.0-alpha.5">0.9.0-alpha.5</option><option value="0.9.0-alpha.6">0.9.0-alpha.6</option><option value="0.9.0">0.9.0</option><option value="0.9.1">0.9.1</option><option value="0.9.2-alpha.0">0.9.2-alpha.0</option><option value="0.9.2-alpha.1">0.9.2-alpha.1</option><option value="0.9.2">0.9.2</option><option value="0.9.3">0.9.3</option><option value="0.9.4">0.9.4</option><option value="0.9.5">0.9.5</option><option value="0.9.6">0.9.6</option><option value="0.9.7">0.9.7</option><option value="0.9.8">0.9.8</option><option value="0.9.9">0.9.9</option><option value="0.9.10">0.9.10</option><option value="0.9.11">0.9.11</option><option value="0.9.12-alpha.0">0.9.12-alpha.0</option><option value="0.9.12">0.9.12</option><option value="0.9.13">0.9.13</option><option value="0.9.14">0.9.14</option><option value="0.9.15">0.9.15</option><option value="0.9.16">0.9.16</option><option value="0.10.0-alpha.0">0.10.0-alpha.0</option><option value="0.10.0-alpha.1">0.10.0-alpha.1</option><option value="0.10.0-alpha-0">0.10.0-alpha-0</option><option value="0.10.0-alpha-1">0.10.0-alpha-1</option><option value="0.10.0-alpha-2">0.10.0-alpha-2</option><option value="0.10.0-alpha-3">0.10.0-alpha-3</option><option value="0.10.0-alpha-4">0.10.0-alpha-4</option><option value="0.10.0-alpha-5">0.10.0-alpha-5</option><option value="0.10.0-alpha-6">0.10.0-alpha-6</option><option value="0.10.0-alpha-7">0.10.0-alpha-7</option><option value="0.10.0-alpha-8">0.10.0-alpha-8</option><option value="0.10.0">0.10.0</option><option value="0.10.1">0.10.1</option><option value="0.10.2">0.10.2</option><option value="0.10.3">0.10.3</option><option value="0.10.4">0.10.4</option><option value="0.10.5">0.10.5</option><option value="0.10.6">0.10.6</option><option value="0.10.7">0.10.7</option><option value="0.10.8">0.10.8</option><option value="0.10.9-alpha.0">0.10.9-alpha.0</option><option value="0.11.0-alpha.0">0.11.0-alpha.0</option><option value="0.11.0-alpha.1">0.11.0-alpha.1</option><option value="0.11.0-alpha.2">0.11.0-alpha.2</option><option value="0.11.0-alpha.3">0.11.0-alpha.3</option><option value="0.11.0">0.11.0</option><option value="0.11.1">0.11.1</option><option value="0.11.2-alpha.0">0.11.2-alpha.0</option><option value="0.11.2-alpha.1">0.11.2-alpha.1</option><option value="0.11.2-alpha.2">0.11.2-alpha.2</option><option value="0.11.2-alpha.3">0.11.2-alpha.3</option><option value="0.11.2">0.11.2</option><option value="0.11.3">0.11.3</option><option value="0.11.4">0.11.4</option><option value="0.11.5">0.11.5</option><option value="0.11.6-beta.0">0.11.6-beta.0</option><option value="0.11.6-beta.1">0.11.6-beta.1</option><option value="0.11.6-beta.2">0.11.6-beta.2</option><option value="0.11.6">0.11.6</option><option value="0.11.7">0.11.7</option><option value="0.12.0-alpha.0">0.12.0-alpha.0</option><option value="0.12.0-alpha.1">0.12.0-alpha.1</option><option value="0.12.0">0.12.0</option><option value="0.12.1">0.12.1</option><option value="0.12.2">0.12.2</option><option value="0.13.0-alpha.0">0.13.0-alpha.0</option><option value="0.13.0-alpha.1">0.13.0-alpha.1</option><option value="0.13.0-alpha.2">0.13.0-alpha.2</option><option value="0.13.0-alpha.3">0.13.0-alpha.3</option><option value="0.13.0-alpha.4">0.13.0-alpha.4</option><option value="0.13.0-alpha.5">0.13.0-alpha.5</option><option value="0.13.0-alpha.6">0.13.0-alpha.6</option><option value="0.13.0-alpha.7">0.13.0-alpha.7</option><option value="0.13.0-alpha.8">0.13.0-alpha.8</option><option value="0.13.0-alpha.9">0.13.0-alpha.9</option><option value="0.13.0-alpha.10">0.13.0-alpha.10</option><option value="0.13.0">0.13.0</option><option value="0.13.1">0.13.1</option><option value="0.13.2-alpha.0">0.13.2-alpha.0</option><option value="0.13.2">0.13.2</option><option value="0.14.0-alpha.0">0.14.0-alpha.0</option><option value="0.14.0-alpha.1">0.14.0-alpha.1</option><option value="0.14.0-alpha.2">0.14.0-alpha.2</option><option value="0.14.0-alpha.3">0.14.0-alpha.3</option><option value="0.14.0-alpha.4">0.14.0-alpha.4</option><option value="0.14.0-alpha.6">0.14.0-alpha.6</option><option value="0.14.0-alpha.7">0.14.0-alpha.7</option><option value="0.14.0-alpha.8">0.14.0-alpha.8</option><option value="0.14.0-alpha.9">0.14.0-alpha.9</option><option value="0.14.0-alpha.10">0.14.0-alpha.10</option><option value="0.14.0-alpha.11">0.14.0-alpha.11</option><option value="0.14.0-alpha.13">0.14.0-alpha.13</option><option value="0.14.0-alpha.15">0.14.0-alpha.15</option><option value="0.14.0-alpha.16">0.14.0-alpha.16</option><option value="0.14.0-alpha.17">0.14.0-alpha.17</option><option value="0.14.0">0.14.0</option><option value="0.14.1-1.alpha.0">0.14.1-1.alpha.0</option><option value="0.14.1">0.14.1</option><option value="0.14.2-alpha.0">0.14.2-alpha.0</option><option value="0.14.2-alpha.1">0.14.2-alpha.1</option><option value="0.14.2-alpha.2">0.14.2-alpha.2</option><option value="0.14.2-alpha.3">0.14.2-alpha.3</option><option value="0.14.2">0.14.2</option><option value="0.14.3">0.14.3</option><option value="0.14.4">0.14.4</option><option value="0.14.5">0.14.5</option><option value="0.14.6">0.14.6</option><option value="0.14.7">0.14.7</option><option value="0.14.8-alpha.0">0.14.8-alpha.0</option><option value="0.14.8">0.14.8</option><option value="0.14.9">0.14.9</option><option value="0.14.10">0.14.10</option><option value="0.14.11">0.14.11</option><option value="0.14.12">0.14.12</option><option value="0.14.13-alpha.0">0.14.13-alpha.0</option><option value="0.14.13">0.14.13</option><option value="0.14.15-alpha.0">0.14.15-alpha.0</option><option value="0.15.0-preview.0">0.15.0-preview.0</option><option value="0.15.0-preview.1">0.15.0-preview.1</option><option value="0.15.0-preview.2">0.15.0-preview.2</option><option value="0.15.0-preview.3">0.15.0-preview.3</option><option value="0.15.0-preview.4">0.15.0-preview.4</option><option value="0.15.0-preview.5">0.15.0-preview.5</option><option value="0.15.0-preview.7">0.15.0-preview.7</option><option value="0.15.0">0.15.0</option><option value="0.15.1">0.15.1</option><option value="0.15.2">0.15.2</option><option value="0.15.3">0.15.3</option><option value="0.15.4">0.15.4</option><option value="0.15.5">0.15.5</option><option value="0.15.6">0.15.6</option><option value="0.15.8">0.15.8</option><option value="0.15.9">0.15.9</option><option value="0.15.10">0.15.10</option><option value="0.15.11">0.15.11</option><option value="0.15.12-alpha.0">0.15.12-alpha.0</option><option value="0.15.12-alpha.1">0.15.12-alpha.1</option><option value="0.15.12">0.15.12</option><option value="0.15.13">0.15.13</option><option value="0.15.14">0.15.14</option><option value="0.15.15-alpha.0">0.15.15-alpha.0</option><option value="0.15.15-alpha.1">0.15.15-alpha.1</option><option value="0.15.15-alpha.2">0.15.15-alpha.2</option><option value="0.15.15-preview.3">0.15.15-preview.3</option><option value="0.15.15-preview.4">0.15.15-preview.4</option><option value="0.15.15-preview.5">0.15.15-preview.5</option><option value="0.15.15-preview.6">0.15.15-preview.6</option><option value="0.15.15-preview.7">0.15.15-preview.7</option><option value="0.15.15-preview.8">0.15.15-preview.8</option><option value="0.15.15-preview.9">0.15.15-preview.9</option><option value="0.15.15-preview.10">0.15.15-preview.10</option><option value="0.15.15-preview.11">0.15.15-preview.11</option><option value="0.15.15-preview.13">0.15.15-preview.13</option><option value="0.15.15-preview.14">0.15.15-preview.14</option><option value="0.15.15-preview.15">0.15.15-preview.15</option><option value="0.15.15-preview.16">0.15.15-preview.16</option><option value="0.15.15-preview.17">0.15.15-preview.17</option><option value="0.15.15-preview.18">0.15.15-preview.18</option><option value="0.15.15-preview.19">0.15.15-preview.19</option><option value="0.15.15-preview.20">0.15.15-preview.20</option><option value="0.15.15-preview.21">0.15.15-preview.21</option><option value="0.15.15-preview.22">0.15.15-preview.22</option><option value="0.15.15">0.15.15</option><option value="0.15.16">0.15.16</option><option value="0.15.17">0.15.17</option><option value="0.15.18">0.15.18</option><option value="0.15.19">0.15.19</option><option value="0.15.20">0.15.20</option><option value="0.15.21">0.15.21</option><option value="0.15.22">0.15.22</option><option value="0.15.23">0.15.23</option><option value="0.15.24">0.15.24</option><option value="0.15.25">0.15.25</option><option selected="" value="0.15.26">0.15.26</option><option value="0.16.0-preview.0">0.16.0-preview.0</option><option value="0.16.0-preview.2">0.16.0-preview.2</option><option value="0.16.0-preview.3">0.16.0-preview.3</option><option value="0.16.0-preview.4">0.16.0-preview.4</option><option value="0.16.0-preview.5">0.16.0-preview.5</option><option value="0.16.0-preview.6">0.16.0-preview.6</option><option value="0.16.0-preview.7">0.16.0-preview.7</option><option value="0.16.0-preview.8">0.16.0-preview.8</option><option value="0.16.0-preview.9">0.16.0-preview.9</option><option value="0.16.0-preview.10">0.16.0-preview.10</option><option value="0.16.0-preview.11">0.16.0-preview.11</option><option value="0.16.0-preview.13">0.16.0-preview.13</option><option value="0.16.0-preview.14">0.16.0-preview.14</option><option value="0.16.0-preview.15">0.16.0-preview.15</option><option value="0.16.0-preview.16">0.16.0-preview.16</option><option value="0.16.0-preview.17">0.16.0-preview.17</option><option value="0.16.0-preview.18">0.16.0-preview.18</option><option value="0.16.0-preview.20">0.16.0-preview.20</option><option value="0.16.0-preview.21">0.16.0-preview.21</option></select></label></p></header></div><style data-emotion-css="107j3ms">.css-107j3ms{max-width:940px;padding:0 20px;margin:0 auto;}@media (max-width:700px){.css-107j3ms{padding:0;margin:0;}}</style><div class="css-107j3ms"><style data-emotion-css="q3frg4">.css-q3frg4{border:1px solid #dfe2e5;border-radius:3px;}@media (max-width:700px){.css-q3frg4{border-right-width:0;border-left-width:0;}}</style><div class="css-q3frg4"><style data-emotion-css="10o5omr">.css-10o5omr{padding:10px;background:#f6f8fa;color:#424242;border:1px solid #d1d5da;border-top-left-radius:3px;border-top-right-radius:3px;margin:-1px -1px 0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}@media (max-width:700px){.css-10o5omr{padding-right:20px;padding-left:20px;}}</style><div class="css-10o5omr"><span>242 kB</span><span>JavaScript</span><span><style data-emotion-css="18x593j">.css-18x593j{display:inline-block;margin-left:8px;padding:2px 8px;-webkit-text-decoration:none;text-decoration:none;font-weight:600;font-size:0.9rem;color:#24292e;background-color:#eff3f6;border:1px solid rgba(27,31,35,.2);border-radius:3px;}.css-18x593j:hover{background-color:#e6ebf1;border-color:rgba(27,31,35,.35);}.css-18x593j:active{background-color:#e9ecef;border-color:rgba(27,31,35,.35);box-shadow:inset 0 0.15em 0.3em rgba(27,31,35,.15);}</style><a href="/colyseus.js@0.15.26/dist/colyseus.js" class="css-18x593j">View Raw</a></span></div><style data-emotion-css="1i31ihw">.css-1i31ihw{overflow-x:auto;overflow-y:hidden;padding-top:5px;padding-bottom:5px;}</style><div class="code-listing css-1i31ihw"><style data-emotion-css="173nir8">.css-173nir8{border:none;border-collapse:collapse;border-spacing:0;}</style><table class="css-173nir8"><tbody><tr><style data-emotion-css="a4x74f">.css-a4x74f{padding-left:10px;padding-right:10px;color:rgba(27,31,35,.3);text-align:right;vertical-align:top;width:1%;min-width:50px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}</style><td id="L1" class="css-a4x74f"><span>1</span></td><style data-emotion-css="1dcdqdg">.css-1dcdqdg{padding-left:10px;padding-right:10px;color:#24292e;white-space:pre;}</style><td id="LC1" class="css-1dcdqdg"><code><span class="code-comment">// colyseus.js@0.15.26 (@colyseus/schema 2.0.9)</span>
</code></td></tr><tr><td id="L2" class="css-a4x74f"><span>2</span></td><td id="LC2" class="css-1dcdqdg"><code>(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">global, factory</span>) </span>{
</code></td></tr><tr><td id="L3" class="css-a4x74f"><span>3</span></td><td id="LC3" class="css-1dcdqdg"><code>    <span class="code-keyword">typeof</span> exports === <span class="code-string">'object'</span> &amp;&amp; <span class="code-keyword">typeof</span> <span class="code-built_in">module</span> !== <span class="code-string">'undefined'</span> ? factory(exports) :
</code></td></tr><tr><td id="L4" class="css-a4x74f"><span>4</span></td><td id="LC4" class="css-1dcdqdg"><code>    <span class="code-keyword">typeof</span> define === <span class="code-string">'function'</span> &amp;&amp; define.amd ? define(<span class="code-string">'colyseus.js'</span>, [<span class="code-string">'exports'</span>], factory) :
</code></td></tr><tr><td id="L5" class="css-a4x74f"><span>5</span></td><td id="LC5" class="css-1dcdqdg"><code>    (global = <span class="code-keyword">typeof</span> globalThis !== <span class="code-string">'undefined'</span> ? globalThis : global || self, factory(global.Colyseus = {}));
</code></td></tr><tr><td id="L6" class="css-a4x74f"><span>6</span></td><td id="LC6" class="css-1dcdqdg"><code>})(<span class="code-keyword">this</span>, (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">exports</span>) </span>{ <span class="code-string">'use strict'</span>;
</code></td></tr><tr><td id="L7" class="css-a4x74f"><span>7</span></td><td id="LC7" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L8" class="css-a4x74f"><span>8</span></td><td id="LC8" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">_mergeNamespaces</span>(<span class="code-params">n, m</span>) </span>{
</code></td></tr><tr><td id="L9" class="css-a4x74f"><span>9</span></td><td id="LC9" class="css-1dcdqdg"><code>        m.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">e</span>) </span>{
</code></td></tr><tr><td id="L10" class="css-a4x74f"><span>10</span></td><td id="LC10" class="css-1dcdqdg"><code>            e &amp;&amp; <span class="code-keyword">typeof</span> e !== <span class="code-string">'string'</span> &amp;&amp; !<span class="code-built_in">Array</span>.isArray(e) &amp;&amp; <span class="code-built_in">Object</span>.keys(e).forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">k</span>) </span>{
</code></td></tr><tr><td id="L11" class="css-a4x74f"><span>11</span></td><td id="LC11" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (k !== <span class="code-string">'default'</span> &amp;&amp; !(k <span class="code-keyword">in</span> n)) {
</code></td></tr><tr><td id="L12" class="css-a4x74f"><span>12</span></td><td id="LC12" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> d = <span class="code-built_in">Object</span>.getOwnPropertyDescriptor(e, k);
</code></td></tr><tr><td id="L13" class="css-a4x74f"><span>13</span></td><td id="LC13" class="css-1dcdqdg"><code>                    <span class="code-built_in">Object</span>.defineProperty(n, k, d.get ? d : {
</code></td></tr><tr><td id="L14" class="css-a4x74f"><span>14</span></td><td id="LC14" class="css-1dcdqdg"><code>                        enumerable: <span class="code-literal">true</span>,
</code></td></tr><tr><td id="L15" class="css-a4x74f"><span>15</span></td><td id="LC15" class="css-1dcdqdg"><code>                        <span class="code-keyword">get</span>: function () { <span class="code-keyword">return</span> e[k]; }
</code></td></tr><tr><td id="L16" class="css-a4x74f"><span>16</span></td><td id="LC16" class="css-1dcdqdg"><code>                    });
</code></td></tr><tr><td id="L17" class="css-a4x74f"><span>17</span></td><td id="LC17" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L18" class="css-a4x74f"><span>18</span></td><td id="LC18" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L19" class="css-a4x74f"><span>19</span></td><td id="LC19" class="css-1dcdqdg"><code>        });
</code></td></tr><tr><td id="L20" class="css-a4x74f"><span>20</span></td><td id="LC20" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> <span class="code-built_in">Object</span>.freeze(n);
</code></td></tr><tr><td id="L21" class="css-a4x74f"><span>21</span></td><td id="LC21" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L22" class="css-a4x74f"><span>22</span></td><td id="LC22" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L23" class="css-a4x74f"><span>23</span></td><td id="LC23" class="css-1dcdqdg"><code>    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L24" class="css-a4x74f"><span>24</span></td><td id="LC24" class="css-1dcdqdg"><code>    <span class="code-comment">// Polyfills for legacy environments</span>
</code></td></tr><tr><td id="L25" class="css-a4x74f"><span>25</span></td><td id="LC25" class="css-1dcdqdg"><code>    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L26" class="css-a4x74f"><span>26</span></td><td id="LC26" class="css-1dcdqdg"><code>    <span class="code-comment">/*
</span></code></td></tr><tr><td id="L27" class="css-a4x74f"><span>27</span></td><td id="LC27" class="css-1dcdqdg"><code><span class="code-comment">     * Support Android 4.4.x
</span></code></td></tr><tr><td id="L28" class="css-a4x74f"><span>28</span></td><td id="LC28" class="css-1dcdqdg"><code><span class="code-comment">     */</span>
</code></td></tr><tr><td id="L29" class="css-a4x74f"><span>29</span></td><td id="LC29" class="css-1dcdqdg"><code>    <span class="code-keyword">if</span> (!<span class="code-built_in">ArrayBuffer</span>.isView) {
</code></td></tr><tr><td id="L30" class="css-a4x74f"><span>30</span></td><td id="LC30" class="css-1dcdqdg"><code>        <span class="code-built_in">ArrayBuffer</span>.isView = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">a</span>) </span>{
</code></td></tr><tr><td id="L31" class="css-a4x74f"><span>31</span></td><td id="LC31" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> a !== <span class="code-literal">null</span> &amp;&amp; <span class="code-keyword">typeof</span> (a) === <span class="code-string">'object'</span> &amp;&amp; a.buffer <span class="code-keyword">instanceof</span> <span class="code-built_in">ArrayBuffer</span>;
</code></td></tr><tr><td id="L32" class="css-a4x74f"><span>32</span></td><td id="LC32" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L33" class="css-a4x74f"><span>33</span></td><td id="LC33" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L34" class="css-a4x74f"><span>34</span></td><td id="LC34" class="css-1dcdqdg"><code>    <span class="code-comment">// Define globalThis if not available.</span>
</code></td></tr><tr><td id="L35" class="css-a4x74f"><span>35</span></td><td id="LC35" class="css-1dcdqdg"><code>    <span class="code-comment">// https://github.com/colyseus/colyseus.js/issues/86</span>
</code></td></tr><tr><td id="L36" class="css-a4x74f"><span>36</span></td><td id="LC36" class="css-1dcdqdg"><code>    <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (globalThis) === <span class="code-string">"undefined"</span> &amp;&amp;
</code></td></tr><tr><td id="L37" class="css-a4x74f"><span>37</span></td><td id="LC37" class="css-1dcdqdg"><code>        <span class="code-keyword">typeof</span> (<span class="code-built_in">window</span>) !== <span class="code-string">"undefined"</span>) {
</code></td></tr><tr><td id="L38" class="css-a4x74f"><span>38</span></td><td id="LC38" class="css-1dcdqdg"><code>        <span class="code-comment">// @ts-ignore</span>
</code></td></tr><tr><td id="L39" class="css-a4x74f"><span>39</span></td><td id="LC39" class="css-1dcdqdg"><code>        <span class="code-built_in">window</span>[<span class="code-string">'globalThis'</span>] = <span class="code-built_in">window</span>;
</code></td></tr><tr><td id="L40" class="css-a4x74f"><span>40</span></td><td id="LC40" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L41" class="css-a4x74f"><span>41</span></td><td id="LC41" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L42" class="css-a4x74f"><span>42</span></td><td id="LC42" class="css-1dcdqdg"><code>    <span class="code-comment">/******************************************************************************
</span></code></td></tr><tr><td id="L43" class="css-a4x74f"><span>43</span></td><td id="LC43" class="css-1dcdqdg"><code><span class="code-comment">    Copyright (c) Microsoft Corporation.
</span></code></td></tr><tr><td id="L44" class="css-a4x74f"><span>44</span></td><td id="LC44" class="css-1dcdqdg"><code><span class="code-comment">
</span></code></td></tr><tr><td id="L45" class="css-a4x74f"><span>45</span></td><td id="LC45" class="css-1dcdqdg"><code><span class="code-comment">    Permission to use, copy, modify, and/or distribute this software for any
</span></code></td></tr><tr><td id="L46" class="css-a4x74f"><span>46</span></td><td id="LC46" class="css-1dcdqdg"><code><span class="code-comment">    purpose with or without fee is hereby granted.
</span></code></td></tr><tr><td id="L47" class="css-a4x74f"><span>47</span></td><td id="LC47" class="css-1dcdqdg"><code><span class="code-comment">
</span></code></td></tr><tr><td id="L48" class="css-a4x74f"><span>48</span></td><td id="LC48" class="css-1dcdqdg"><code><span class="code-comment">    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
</span></code></td></tr><tr><td id="L49" class="css-a4x74f"><span>49</span></td><td id="LC49" class="css-1dcdqdg"><code><span class="code-comment">    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
</span></code></td></tr><tr><td id="L50" class="css-a4x74f"><span>50</span></td><td id="LC50" class="css-1dcdqdg"><code><span class="code-comment">    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
</span></code></td></tr><tr><td id="L51" class="css-a4x74f"><span>51</span></td><td id="LC51" class="css-1dcdqdg"><code><span class="code-comment">    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
</span></code></td></tr><tr><td id="L52" class="css-a4x74f"><span>52</span></td><td id="LC52" class="css-1dcdqdg"><code><span class="code-comment">    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
</span></code></td></tr><tr><td id="L53" class="css-a4x74f"><span>53</span></td><td id="LC53" class="css-1dcdqdg"><code><span class="code-comment">    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
</span></code></td></tr><tr><td id="L54" class="css-a4x74f"><span>54</span></td><td id="LC54" class="css-1dcdqdg"><code><span class="code-comment">    PERFORMANCE OF THIS SOFTWARE.
</span></code></td></tr><tr><td id="L55" class="css-a4x74f"><span>55</span></td><td id="LC55" class="css-1dcdqdg"><code><span class="code-comment">    ***************************************************************************** */</span>
</code></td></tr><tr><td id="L56" class="css-a4x74f"><span>56</span></td><td id="LC56" class="css-1dcdqdg"><code>    <span class="code-comment">/* global Reflect, Promise */</span>
</code></td></tr><tr><td id="L57" class="css-a4x74f"><span>57</span></td><td id="LC57" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L58" class="css-a4x74f"><span>58</span></td><td id="LC58" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> extendStatics = <span class="code-function"><span class="code-keyword">function</span>(<span class="code-params">d, b</span>) </span>{
</code></td></tr><tr><td id="L59" class="css-a4x74f"><span>59</span></td><td id="LC59" class="css-1dcdqdg"><code>        extendStatics = <span class="code-built_in">Object</span>.setPrototypeOf ||
</code></td></tr><tr><td id="L60" class="css-a4x74f"><span>60</span></td><td id="LC60" class="css-1dcdqdg"><code>            ({ <span class="code-attr">__proto__</span>: [] } <span class="code-keyword">instanceof</span> <span class="code-built_in">Array</span> &amp;&amp; <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">d, b</span>) </span>{ d.__proto__ = b; }) ||
</code></td></tr><tr><td id="L61" class="css-a4x74f"><span>61</span></td><td id="LC61" class="css-1dcdqdg"><code>            <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">d, b</span>) </span>{ <span class="code-keyword">for</span> (<span class="code-keyword">var</span> p <span class="code-keyword">in</span> b) <span class="code-keyword">if</span> (<span class="code-built_in">Object</span>.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
</code></td></tr><tr><td id="L62" class="css-a4x74f"><span>62</span></td><td id="LC62" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> extendStatics(d, b);
</code></td></tr><tr><td id="L63" class="css-a4x74f"><span>63</span></td><td id="LC63" class="css-1dcdqdg"><code>    };
</code></td></tr><tr><td id="L64" class="css-a4x74f"><span>64</span></td><td id="LC64" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L65" class="css-a4x74f"><span>65</span></td><td id="LC65" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">__extends</span>(<span class="code-params">d, b</span>) </span>{
</code></td></tr><tr><td id="L66" class="css-a4x74f"><span>66</span></td><td id="LC66" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> b !== <span class="code-string">"function"</span> &amp;&amp; b !== <span class="code-literal">null</span>)
</code></td></tr><tr><td id="L67" class="css-a4x74f"><span>67</span></td><td id="LC67" class="css-1dcdqdg"><code>            <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">TypeError</span>(<span class="code-string">"Class extends value "</span> + <span class="code-built_in">String</span>(b) + <span class="code-string">" is not a constructor or null"</span>);
</code></td></tr><tr><td id="L68" class="css-a4x74f"><span>68</span></td><td id="LC68" class="css-1dcdqdg"><code>        extendStatics(d, b);
</code></td></tr><tr><td id="L69" class="css-a4x74f"><span>69</span></td><td id="LC69" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">__</span>(<span class="code-params"></span>) </span>{ <span class="code-keyword">this</span>.constructor = d; }
</code></td></tr><tr><td id="L70" class="css-a4x74f"><span>70</span></td><td id="LC70" class="css-1dcdqdg"><code>        d.prototype = b === <span class="code-literal">null</span> ? <span class="code-built_in">Object</span>.create(b) : (__.prototype = b.prototype, <span class="code-keyword">new</span> __());
</code></td></tr><tr><td id="L71" class="css-a4x74f"><span>71</span></td><td id="LC71" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L72" class="css-a4x74f"><span>72</span></td><td id="LC72" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L73" class="css-a4x74f"><span>73</span></td><td id="LC73" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> __assign = <span class="code-function"><span class="code-keyword">function</span>(<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L74" class="css-a4x74f"><span>74</span></td><td id="LC74" class="css-1dcdqdg"><code>        __assign = <span class="code-built_in">Object</span>.assign || <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">__assign</span>(<span class="code-params">t</span>) </span>{
</code></td></tr><tr><td id="L75" class="css-a4x74f"><span>75</span></td><td id="LC75" class="css-1dcdqdg"><code>            <span class="code-keyword">for</span> (<span class="code-keyword">var</span> s, i = <span class="code-number">1</span>, n = <span class="code-built_in">arguments</span>.length; i &lt; n; i++) {
</code></td></tr><tr><td id="L76" class="css-a4x74f"><span>76</span></td><td id="LC76" class="css-1dcdqdg"><code>                s = <span class="code-built_in">arguments</span>[i];
</code></td></tr><tr><td id="L77" class="css-a4x74f"><span>77</span></td><td id="LC77" class="css-1dcdqdg"><code>                <span class="code-keyword">for</span> (<span class="code-keyword">var</span> p <span class="code-keyword">in</span> s) <span class="code-keyword">if</span> (<span class="code-built_in">Object</span>.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
</code></td></tr><tr><td id="L78" class="css-a4x74f"><span>78</span></td><td id="LC78" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L79" class="css-a4x74f"><span>79</span></td><td id="LC79" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> t;
</code></td></tr><tr><td id="L80" class="css-a4x74f"><span>80</span></td><td id="LC80" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L81" class="css-a4x74f"><span>81</span></td><td id="LC81" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> __assign.apply(<span class="code-keyword">this</span>, <span class="code-built_in">arguments</span>);
</code></td></tr><tr><td id="L82" class="css-a4x74f"><span>82</span></td><td id="LC82" class="css-1dcdqdg"><code>    };
</code></td></tr><tr><td id="L83" class="css-a4x74f"><span>83</span></td><td id="LC83" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L84" class="css-a4x74f"><span>84</span></td><td id="LC84" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">__awaiter</span>(<span class="code-params">thisArg, _arguments, P, generator</span>) </span>{
</code></td></tr><tr><td id="L85" class="css-a4x74f"><span>85</span></td><td id="LC85" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">adopt</span>(<span class="code-params">value</span>) </span>{ <span class="code-keyword">return</span> value <span class="code-keyword">instanceof</span> P ? value : <span class="code-keyword">new</span> P(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">resolve</span>) </span>{ resolve(value); }); }
</code></td></tr><tr><td id="L86" class="css-a4x74f"><span>86</span></td><td id="LC86" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> <span class="code-keyword">new</span> (P || (P = <span class="code-built_in">Promise</span>))(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">resolve, reject</span>) </span>{
</code></td></tr><tr><td id="L87" class="css-a4x74f"><span>87</span></td><td id="LC87" class="css-1dcdqdg"><code>            <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">fulfilled</span>(<span class="code-params">value</span>) </span>{ <span class="code-keyword">try</span> { step(generator.next(value)); } <span class="code-keyword">catch</span> (e) { reject(e); } }
</code></td></tr><tr><td id="L88" class="css-a4x74f"><span>88</span></td><td id="LC88" class="css-1dcdqdg"><code>            <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">rejected</span>(<span class="code-params">value</span>) </span>{ <span class="code-keyword">try</span> { step(generator[<span class="code-string">"throw"</span>](value)); } <span class="code-keyword">catch</span> (e) { reject(e); } }
</code></td></tr><tr><td id="L89" class="css-a4x74f"><span>89</span></td><td id="LC89" class="css-1dcdqdg"><code>            <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">step</span>(<span class="code-params">result</span>) </span>{ result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
</code></td></tr><tr><td id="L90" class="css-a4x74f"><span>90</span></td><td id="LC90" class="css-1dcdqdg"><code>            step((generator = generator.apply(thisArg, _arguments || [])).next());
</code></td></tr><tr><td id="L91" class="css-a4x74f"><span>91</span></td><td id="LC91" class="css-1dcdqdg"><code>        });
</code></td></tr><tr><td id="L92" class="css-a4x74f"><span>92</span></td><td id="LC92" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L93" class="css-a4x74f"><span>93</span></td><td id="LC93" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L94" class="css-a4x74f"><span>94</span></td><td id="LC94" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">__generator</span>(<span class="code-params">thisArg, body</span>) </span>{
</code></td></tr><tr><td id="L95" class="css-a4x74f"><span>95</span></td><td id="LC95" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> _ = { <span class="code-attr">label</span>: <span class="code-number">0</span>, <span class="code-attr">sent</span>: <span class="code-function"><span class="code-keyword">function</span>(<span class="code-params"></span>) </span>{ <span class="code-keyword">if</span> (t[<span class="code-number">0</span>] &amp; <span class="code-number">1</span>) <span class="code-keyword">throw</span> t[<span class="code-number">1</span>]; <span class="code-keyword">return</span> t[<span class="code-number">1</span>]; }, <span class="code-attr">trys</span>: [], <span class="code-attr">ops</span>: [] }, f, y, t, g;
</code></td></tr><tr><td id="L96" class="css-a4x74f"><span>96</span></td><td id="LC96" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> g = { <span class="code-attr">next</span>: verb(<span class="code-number">0</span>), <span class="code-string">"throw"</span>: verb(<span class="code-number">1</span>), <span class="code-string">"return"</span>: verb(<span class="code-number">2</span>) }, <span class="code-keyword">typeof</span> <span class="code-built_in">Symbol</span> === <span class="code-string">"function"</span> &amp;&amp; (g[<span class="code-built_in">Symbol</span>.iterator] = <span class="code-function"><span class="code-keyword">function</span>(<span class="code-params"></span>) </span>{ <span class="code-keyword">return</span> <span class="code-keyword">this</span>; }), g;
</code></td></tr><tr><td id="L97" class="css-a4x74f"><span>97</span></td><td id="LC97" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">verb</span>(<span class="code-params">n</span>) </span>{ <span class="code-keyword">return</span> <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">v</span>) </span>{ <span class="code-keyword">return</span> step([n, v]); }; }
</code></td></tr><tr><td id="L98" class="css-a4x74f"><span>98</span></td><td id="LC98" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">step</span>(<span class="code-params">op</span>) </span>{
</code></td></tr><tr><td id="L99" class="css-a4x74f"><span>99</span></td><td id="LC99" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (f) <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">TypeError</span>(<span class="code-string">"Generator is already executing."</span>);
</code></td></tr><tr><td id="L100" class="css-a4x74f"><span>100</span></td><td id="LC100" class="css-1dcdqdg"><code>            <span class="code-keyword">while</span> (g &amp;&amp; (g = <span class="code-number">0</span>, op[<span class="code-number">0</span>] &amp;&amp; (_ = <span class="code-number">0</span>)), _) <span class="code-keyword">try</span> {
</code></td></tr><tr><td id="L101" class="css-a4x74f"><span>101</span></td><td id="LC101" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (f = <span class="code-number">1</span>, y &amp;&amp; (t = op[<span class="code-number">0</span>] &amp; <span class="code-number">2</span> ? y[<span class="code-string">"return"</span>] : op[<span class="code-number">0</span>] ? y[<span class="code-string">"throw"</span>] || ((t = y[<span class="code-string">"return"</span>]) &amp;&amp; t.call(y), <span class="code-number">0</span>) : y.next) &amp;&amp; !(t = t.call(y, op[<span class="code-number">1</span>])).done) <span class="code-keyword">return</span> t;
</code></td></tr><tr><td id="L102" class="css-a4x74f"><span>102</span></td><td id="LC102" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (y = <span class="code-number">0</span>, t) op = [op[<span class="code-number">0</span>] &amp; <span class="code-number">2</span>, t.value];
</code></td></tr><tr><td id="L103" class="css-a4x74f"><span>103</span></td><td id="LC103" class="css-1dcdqdg"><code>                <span class="code-keyword">switch</span> (op[<span class="code-number">0</span>]) {
</code></td></tr><tr><td id="L104" class="css-a4x74f"><span>104</span></td><td id="LC104" class="css-1dcdqdg"><code>                    <span class="code-keyword">case</span> <span class="code-number">0</span>: <span class="code-keyword">case</span> <span class="code-number">1</span>: t = op; <span class="code-keyword">break</span>;
</code></td></tr><tr><td id="L105" class="css-a4x74f"><span>105</span></td><td id="LC105" class="css-1dcdqdg"><code>                    <span class="code-keyword">case</span> <span class="code-number">4</span>: _.label++; <span class="code-keyword">return</span> { <span class="code-attr">value</span>: op[<span class="code-number">1</span>], <span class="code-attr">done</span>: <span class="code-literal">false</span> };
</code></td></tr><tr><td id="L106" class="css-a4x74f"><span>106</span></td><td id="LC106" class="css-1dcdqdg"><code>                    <span class="code-keyword">case</span> <span class="code-number">5</span>: _.label++; y = op[<span class="code-number">1</span>]; op = [<span class="code-number">0</span>]; <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L107" class="css-a4x74f"><span>107</span></td><td id="LC107" class="css-1dcdqdg"><code>                    <span class="code-keyword">case</span> <span class="code-number">7</span>: op = _.ops.pop(); _.trys.pop(); <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L108" class="css-a4x74f"><span>108</span></td><td id="LC108" class="css-1dcdqdg"><code>                    <span class="code-keyword">default</span>:
</code></td></tr><tr><td id="L109" class="css-a4x74f"><span>109</span></td><td id="LC109" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (!(t = _.trys, t = t.length &gt; <span class="code-number">0</span> &amp;&amp; t[t.length - <span class="code-number">1</span>]) &amp;&amp; (op[<span class="code-number">0</span>] === <span class="code-number">6</span> || op[<span class="code-number">0</span>] === <span class="code-number">2</span>)) { _ = <span class="code-number">0</span>; <span class="code-keyword">continue</span>; }
</code></td></tr><tr><td id="L110" class="css-a4x74f"><span>110</span></td><td id="LC110" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (op[<span class="code-number">0</span>] === <span class="code-number">3</span> &amp;&amp; (!t || (op[<span class="code-number">1</span>] &gt; t[<span class="code-number">0</span>] &amp;&amp; op[<span class="code-number">1</span>] &lt; t[<span class="code-number">3</span>]))) { _.label = op[<span class="code-number">1</span>]; <span class="code-keyword">break</span>; }
</code></td></tr><tr><td id="L111" class="css-a4x74f"><span>111</span></td><td id="LC111" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (op[<span class="code-number">0</span>] === <span class="code-number">6</span> &amp;&amp; _.label &lt; t[<span class="code-number">1</span>]) { _.label = t[<span class="code-number">1</span>]; t = op; <span class="code-keyword">break</span>; }
</code></td></tr><tr><td id="L112" class="css-a4x74f"><span>112</span></td><td id="LC112" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (t &amp;&amp; _.label &lt; t[<span class="code-number">2</span>]) { _.label = t[<span class="code-number">2</span>]; _.ops.push(op); <span class="code-keyword">break</span>; }
</code></td></tr><tr><td id="L113" class="css-a4x74f"><span>113</span></td><td id="LC113" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (t[<span class="code-number">2</span>]) _.ops.pop();
</code></td></tr><tr><td id="L114" class="css-a4x74f"><span>114</span></td><td id="LC114" class="css-1dcdqdg"><code>                        _.trys.pop(); <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L115" class="css-a4x74f"><span>115</span></td><td id="LC115" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L116" class="css-a4x74f"><span>116</span></td><td id="LC116" class="css-1dcdqdg"><code>                op = body.call(thisArg, _);
</code></td></tr><tr><td id="L117" class="css-a4x74f"><span>117</span></td><td id="LC117" class="css-1dcdqdg"><code>            } <span class="code-keyword">catch</span> (e) { op = [<span class="code-number">6</span>, e]; y = <span class="code-number">0</span>; } <span class="code-keyword">finally</span> { f = t = <span class="code-number">0</span>; }
</code></td></tr><tr><td id="L118" class="css-a4x74f"><span>118</span></td><td id="LC118" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (op[<span class="code-number">0</span>] &amp; <span class="code-number">5</span>) <span class="code-keyword">throw</span> op[<span class="code-number">1</span>]; <span class="code-keyword">return</span> { <span class="code-attr">value</span>: op[<span class="code-number">0</span>] ? op[<span class="code-number">1</span>] : <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-attr">done</span>: <span class="code-literal">true</span> };
</code></td></tr><tr><td id="L119" class="css-a4x74f"><span>119</span></td><td id="LC119" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L120" class="css-a4x74f"><span>120</span></td><td id="LC120" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L121" class="css-a4x74f"><span>121</span></td><td id="LC121" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L122" class="css-a4x74f"><span>122</span></td><td id="LC122" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">__classPrivateFieldGet</span>(<span class="code-params">receiver, state, kind, f</span>) </span>{
</code></td></tr><tr><td id="L123" class="css-a4x74f"><span>123</span></td><td id="LC123" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (kind === <span class="code-string">"a"</span> &amp;&amp; !f) <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">TypeError</span>(<span class="code-string">"Private accessor was defined without a getter"</span>);
</code></td></tr><tr><td id="L124" class="css-a4x74f"><span>124</span></td><td id="LC124" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> state === <span class="code-string">"function"</span> ? receiver !== state || !f : !state.has(receiver)) <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">TypeError</span>(<span class="code-string">"Cannot read private member from an object whose class did not declare it"</span>);
</code></td></tr><tr><td id="L125" class="css-a4x74f"><span>125</span></td><td id="LC125" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> kind === <span class="code-string">"m"</span> ? f : kind === <span class="code-string">"a"</span> ? f.call(receiver) : f ? f.value : state.get(receiver);
</code></td></tr><tr><td id="L126" class="css-a4x74f"><span>126</span></td><td id="LC126" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L127" class="css-a4x74f"><span>127</span></td><td id="LC127" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L128" class="css-a4x74f"><span>128</span></td><td id="LC128" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">__classPrivateFieldSet</span>(<span class="code-params">receiver, state, value, kind, f</span>) </span>{
</code></td></tr><tr><td id="L129" class="css-a4x74f"><span>129</span></td><td id="LC129" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (kind === <span class="code-string">"m"</span>) <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">TypeError</span>(<span class="code-string">"Private method is not writable"</span>);
</code></td></tr><tr><td id="L130" class="css-a4x74f"><span>130</span></td><td id="LC130" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (kind === <span class="code-string">"a"</span> &amp;&amp; !f) <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">TypeError</span>(<span class="code-string">"Private accessor was defined without a setter"</span>);
</code></td></tr><tr><td id="L131" class="css-a4x74f"><span>131</span></td><td id="LC131" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> state === <span class="code-string">"function"</span> ? receiver !== state || !f : !state.has(receiver)) <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">TypeError</span>(<span class="code-string">"Cannot write private member to an object whose class did not declare it"</span>);
</code></td></tr><tr><td id="L132" class="css-a4x74f"><span>132</span></td><td id="LC132" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> (kind === <span class="code-string">"a"</span> ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;
</code></td></tr><tr><td id="L133" class="css-a4x74f"><span>133</span></td><td id="LC133" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L134" class="css-a4x74f"><span>134</span></td><td id="LC134" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L135" class="css-a4x74f"><span>135</span></td><td id="LC135" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> CloseCode;
</code></td></tr><tr><td id="L136" class="css-a4x74f"><span>136</span></td><td id="LC136" class="css-1dcdqdg"><code>    (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">CloseCode</span>) </span>{
</code></td></tr><tr><td id="L137" class="css-a4x74f"><span>137</span></td><td id="LC137" class="css-1dcdqdg"><code>        CloseCode[CloseCode[<span class="code-string">"CONSENTED"</span>] = <span class="code-number">4000</span>] = <span class="code-string">"CONSENTED"</span>;
</code></td></tr><tr><td id="L138" class="css-a4x74f"><span>138</span></td><td id="LC138" class="css-1dcdqdg"><code>        CloseCode[CloseCode[<span class="code-string">"DEVMODE_RESTART"</span>] = <span class="code-number">4010</span>] = <span class="code-string">"DEVMODE_RESTART"</span>;
</code></td></tr><tr><td id="L139" class="css-a4x74f"><span>139</span></td><td id="LC139" class="css-1dcdqdg"><code>    })(CloseCode || (CloseCode = {}));
</code></td></tr><tr><td id="L140" class="css-a4x74f"><span>140</span></td><td id="LC140" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> ServerError = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_super</span>) </span>{
</code></td></tr><tr><td id="L141" class="css-a4x74f"><span>141</span></td><td id="LC141" class="css-1dcdqdg"><code>        __extends(ServerError, _super);
</code></td></tr><tr><td id="L142" class="css-a4x74f"><span>142</span></td><td id="LC142" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">ServerError</span>(<span class="code-params">code, message</span>) </span>{
</code></td></tr><tr><td id="L143" class="css-a4x74f"><span>143</span></td><td id="LC143" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> _this = _super.call(<span class="code-keyword">this</span>, message) || <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L144" class="css-a4x74f"><span>144</span></td><td id="LC144" class="css-1dcdqdg"><code>            _this.name = <span class="code-string">"ServerError"</span>;
</code></td></tr><tr><td id="L145" class="css-a4x74f"><span>145</span></td><td id="LC145" class="css-1dcdqdg"><code>            _this.code = code;
</code></td></tr><tr><td id="L146" class="css-a4x74f"><span>146</span></td><td id="LC146" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> _this;
</code></td></tr><tr><td id="L147" class="css-a4x74f"><span>147</span></td><td id="LC147" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L148" class="css-a4x74f"><span>148</span></td><td id="LC148" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> ServerError;
</code></td></tr><tr><td id="L149" class="css-a4x74f"><span>149</span></td><td id="LC149" class="css-1dcdqdg"><code>    }(<span class="code-built_in">Error</span>));
</code></td></tr><tr><td id="L150" class="css-a4x74f"><span>150</span></td><td id="LC150" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L151" class="css-a4x74f"><span>151</span></td><td id="LC151" class="css-1dcdqdg"><code>    <span class="code-comment">/**
</span></code></td></tr><tr><td id="L152" class="css-a4x74f"><span>152</span></td><td id="LC152" class="css-1dcdqdg"><code><span class="code-comment">     * Copyright (c) 2014 Ion Drive Software Ltd.
</span></code></td></tr><tr><td id="L153" class="css-a4x74f"><span>153</span></td><td id="LC153" class="css-1dcdqdg"><code><span class="code-comment">     * https://github.com/darrachequesne/notepack/
</span></code></td></tr><tr><td id="L154" class="css-a4x74f"><span>154</span></td><td id="LC154" class="css-1dcdqdg"><code><span class="code-comment">     *
</span></code></td></tr><tr><td id="L155" class="css-a4x74f"><span>155</span></td><td id="LC155" class="css-1dcdqdg"><code><span class="code-comment">     * Permission is hereby granted, free of charge, to any person obtaining a copy
</span></code></td></tr><tr><td id="L156" class="css-a4x74f"><span>156</span></td><td id="LC156" class="css-1dcdqdg"><code><span class="code-comment">     * of this software and associated documentation files (the "Software"), to deal
</span></code></td></tr><tr><td id="L157" class="css-a4x74f"><span>157</span></td><td id="LC157" class="css-1dcdqdg"><code><span class="code-comment">     * in the Software without restriction, including without limitation the rights
</span></code></td></tr><tr><td id="L158" class="css-a4x74f"><span>158</span></td><td id="LC158" class="css-1dcdqdg"><code><span class="code-comment">     * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
</span></code></td></tr><tr><td id="L159" class="css-a4x74f"><span>159</span></td><td id="LC159" class="css-1dcdqdg"><code><span class="code-comment">     * copies of the Software, and to permit persons to whom the Software is
</span></code></td></tr><tr><td id="L160" class="css-a4x74f"><span>160</span></td><td id="LC160" class="css-1dcdqdg"><code><span class="code-comment">     * furnished to do so, subject to the following conditions:
</span></code></td></tr><tr><td id="L161" class="css-a4x74f"><span>161</span></td><td id="LC161" class="css-1dcdqdg"><code><span class="code-comment">     *
</span></code></td></tr><tr><td id="L162" class="css-a4x74f"><span>162</span></td><td id="LC162" class="css-1dcdqdg"><code><span class="code-comment">     * The above copyright notice and this permission notice shall be included in all
</span></code></td></tr><tr><td id="L163" class="css-a4x74f"><span>163</span></td><td id="LC163" class="css-1dcdqdg"><code><span class="code-comment">     * copies or substantial portions of the Software.
</span></code></td></tr><tr><td id="L164" class="css-a4x74f"><span>164</span></td><td id="LC164" class="css-1dcdqdg"><code><span class="code-comment">     *
</span></code></td></tr><tr><td id="L165" class="css-a4x74f"><span>165</span></td><td id="LC165" class="css-1dcdqdg"><code><span class="code-comment">     * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
</span></code></td></tr><tr><td id="L166" class="css-a4x74f"><span>166</span></td><td id="LC166" class="css-1dcdqdg"><code><span class="code-comment">     * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
</span></code></td></tr><tr><td id="L167" class="css-a4x74f"><span>167</span></td><td id="LC167" class="css-1dcdqdg"><code><span class="code-comment">     * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
</span></code></td></tr><tr><td id="L168" class="css-a4x74f"><span>168</span></td><td id="LC168" class="css-1dcdqdg"><code><span class="code-comment">     * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
</span></code></td></tr><tr><td id="L169" class="css-a4x74f"><span>169</span></td><td id="LC169" class="css-1dcdqdg"><code><span class="code-comment">     * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
</span></code></td></tr><tr><td id="L170" class="css-a4x74f"><span>170</span></td><td id="LC170" class="css-1dcdqdg"><code><span class="code-comment">     * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
</span></code></td></tr><tr><td id="L171" class="css-a4x74f"><span>171</span></td><td id="LC171" class="css-1dcdqdg"><code><span class="code-comment">     * SOFTWARE.
</span></code></td></tr><tr><td id="L172" class="css-a4x74f"><span>172</span></td><td id="LC172" class="css-1dcdqdg"><code><span class="code-comment">     */</span>
</code></td></tr><tr><td id="L173" class="css-a4x74f"><span>173</span></td><td id="LC173" class="css-1dcdqdg"><code>    <span class="code-comment">/**
</span></code></td></tr><tr><td id="L174" class="css-a4x74f"><span>174</span></td><td id="LC174" class="css-1dcdqdg"><code><span class="code-comment">     * Patch for Colyseus:
</span></code></td></tr><tr><td id="L175" class="css-a4x74f"><span>175</span></td><td id="LC175" class="css-1dcdqdg"><code><span class="code-comment">     * -------------------
</span></code></td></tr><tr><td id="L176" class="css-a4x74f"><span>176</span></td><td id="LC176" class="css-1dcdqdg"><code><span class="code-comment">     * notepack.io@3.0.1
</span></code></td></tr><tr><td id="L177" class="css-a4x74f"><span>177</span></td><td id="LC177" class="css-1dcdqdg"><code><span class="code-comment">     *
</span></code></td></tr><tr><td id="L178" class="css-a4x74f"><span>178</span></td><td id="LC178" class="css-1dcdqdg"><code><span class="code-comment">     * added `offset` on Decoder constructor, for messages arriving with a code
</span></code></td></tr><tr><td id="L179" class="css-a4x74f"><span>179</span></td><td id="LC179" class="css-1dcdqdg"><code><span class="code-comment">     * before actual msgpack data
</span></code></td></tr><tr><td id="L180" class="css-a4x74f"><span>180</span></td><td id="LC180" class="css-1dcdqdg"><code><span class="code-comment">     */</span>
</code></td></tr><tr><td id="L181" class="css-a4x74f"><span>181</span></td><td id="LC181" class="css-1dcdqdg"><code>    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L182" class="css-a4x74f"><span>182</span></td><td id="LC182" class="css-1dcdqdg"><code>    <span class="code-comment">// DECODER</span>
</code></td></tr><tr><td id="L183" class="css-a4x74f"><span>183</span></td><td id="LC183" class="css-1dcdqdg"><code>    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L184" class="css-a4x74f"><span>184</span></td><td id="LC184" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">Decoder</span>(<span class="code-params">buffer, offset</span>) </span>{
</code></td></tr><tr><td id="L185" class="css-a4x74f"><span>185</span></td><td id="LC185" class="css-1dcdqdg"><code>        <span class="code-keyword">this</span>._offset = offset;
</code></td></tr><tr><td id="L186" class="css-a4x74f"><span>186</span></td><td id="LC186" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (buffer <span class="code-keyword">instanceof</span> <span class="code-built_in">ArrayBuffer</span>) {
</code></td></tr><tr><td id="L187" class="css-a4x74f"><span>187</span></td><td id="LC187" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>._buffer = buffer;
</code></td></tr><tr><td id="L188" class="css-a4x74f"><span>188</span></td><td id="LC188" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>._view = <span class="code-keyword">new</span> <span class="code-built_in">DataView</span>(<span class="code-keyword">this</span>._buffer);
</code></td></tr><tr><td id="L189" class="css-a4x74f"><span>189</span></td><td id="LC189" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L190" class="css-a4x74f"><span>190</span></td><td id="LC190" class="css-1dcdqdg"><code>        <span class="code-keyword">else</span> <span class="code-keyword">if</span> (<span class="code-built_in">ArrayBuffer</span>.isView(buffer)) {
</code></td></tr><tr><td id="L191" class="css-a4x74f"><span>191</span></td><td id="LC191" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>._buffer = buffer.buffer;
</code></td></tr><tr><td id="L192" class="css-a4x74f"><span>192</span></td><td id="LC192" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>._view = <span class="code-keyword">new</span> <span class="code-built_in">DataView</span>(<span class="code-keyword">this</span>._buffer, buffer.byteOffset, buffer.byteLength);
</code></td></tr><tr><td id="L193" class="css-a4x74f"><span>193</span></td><td id="LC193" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L194" class="css-a4x74f"><span>194</span></td><td id="LC194" class="css-1dcdqdg"><code>        <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L195" class="css-a4x74f"><span>195</span></td><td id="LC195" class="css-1dcdqdg"><code>            <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">'Invalid argument'</span>);
</code></td></tr><tr><td id="L196" class="css-a4x74f"><span>196</span></td><td id="LC196" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L197" class="css-a4x74f"><span>197</span></td><td id="LC197" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L198" class="css-a4x74f"><span>198</span></td><td id="LC198" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">utf8Read$1</span>(<span class="code-params">view, offset, length</span>) </span>{
</code></td></tr><tr><td id="L199" class="css-a4x74f"><span>199</span></td><td id="LC199" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> string = <span class="code-string">''</span>, chr = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L200" class="css-a4x74f"><span>200</span></td><td id="LC200" class="css-1dcdqdg"><code>        <span class="code-keyword">for</span> (<span class="code-keyword">var</span> i = offset, end = offset + length; i &lt; end; i++) {
</code></td></tr><tr><td id="L201" class="css-a4x74f"><span>201</span></td><td id="LC201" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> byte = view.getUint8(i);
</code></td></tr><tr><td id="L202" class="css-a4x74f"><span>202</span></td><td id="LC202" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> ((byte &amp; <span class="code-number">0x80</span>) === <span class="code-number">0x00</span>) {
</code></td></tr><tr><td id="L203" class="css-a4x74f"><span>203</span></td><td id="LC203" class="css-1dcdqdg"><code>                string += <span class="code-built_in">String</span>.fromCharCode(byte);
</code></td></tr><tr><td id="L204" class="css-a4x74f"><span>204</span></td><td id="LC204" class="css-1dcdqdg"><code>                <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L205" class="css-a4x74f"><span>205</span></td><td id="LC205" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L206" class="css-a4x74f"><span>206</span></td><td id="LC206" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> ((byte &amp; <span class="code-number">0xe0</span>) === <span class="code-number">0xc0</span>) {
</code></td></tr><tr><td id="L207" class="css-a4x74f"><span>207</span></td><td id="LC207" class="css-1dcdqdg"><code>                string += <span class="code-built_in">String</span>.fromCharCode(((byte &amp; <span class="code-number">0x1f</span>) &lt;&lt; <span class="code-number">6</span>) |
</code></td></tr><tr><td id="L208" class="css-a4x74f"><span>208</span></td><td id="LC208" class="css-1dcdqdg"><code>                    (view.getUint8(++i) &amp; <span class="code-number">0x3f</span>));
</code></td></tr><tr><td id="L209" class="css-a4x74f"><span>209</span></td><td id="LC209" class="css-1dcdqdg"><code>                <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L210" class="css-a4x74f"><span>210</span></td><td id="LC210" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L211" class="css-a4x74f"><span>211</span></td><td id="LC211" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> ((byte &amp; <span class="code-number">0xf0</span>) === <span class="code-number">0xe0</span>) {
</code></td></tr><tr><td id="L212" class="css-a4x74f"><span>212</span></td><td id="LC212" class="css-1dcdqdg"><code>                string += <span class="code-built_in">String</span>.fromCharCode(((byte &amp; <span class="code-number">0x0f</span>) &lt;&lt; <span class="code-number">12</span>) |
</code></td></tr><tr><td id="L213" class="css-a4x74f"><span>213</span></td><td id="LC213" class="css-1dcdqdg"><code>                    ((view.getUint8(++i) &amp; <span class="code-number">0x3f</span>) &lt;&lt; <span class="code-number">6</span>) |
</code></td></tr><tr><td id="L214" class="css-a4x74f"><span>214</span></td><td id="LC214" class="css-1dcdqdg"><code>                    ((view.getUint8(++i) &amp; <span class="code-number">0x3f</span>) &lt;&lt; <span class="code-number">0</span>));
</code></td></tr><tr><td id="L215" class="css-a4x74f"><span>215</span></td><td id="LC215" class="css-1dcdqdg"><code>                <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L216" class="css-a4x74f"><span>216</span></td><td id="LC216" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L217" class="css-a4x74f"><span>217</span></td><td id="LC217" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> ((byte &amp; <span class="code-number">0xf8</span>) === <span class="code-number">0xf0</span>) {
</code></td></tr><tr><td id="L218" class="css-a4x74f"><span>218</span></td><td id="LC218" class="css-1dcdqdg"><code>                chr = ((byte &amp; <span class="code-number">0x07</span>) &lt;&lt; <span class="code-number">18</span>) |
</code></td></tr><tr><td id="L219" class="css-a4x74f"><span>219</span></td><td id="LC219" class="css-1dcdqdg"><code>                    ((view.getUint8(++i) &amp; <span class="code-number">0x3f</span>) &lt;&lt; <span class="code-number">12</span>) |
</code></td></tr><tr><td id="L220" class="css-a4x74f"><span>220</span></td><td id="LC220" class="css-1dcdqdg"><code>                    ((view.getUint8(++i) &amp; <span class="code-number">0x3f</span>) &lt;&lt; <span class="code-number">6</span>) |
</code></td></tr><tr><td id="L221" class="css-a4x74f"><span>221</span></td><td id="LC221" class="css-1dcdqdg"><code>                    ((view.getUint8(++i) &amp; <span class="code-number">0x3f</span>) &lt;&lt; <span class="code-number">0</span>);
</code></td></tr><tr><td id="L222" class="css-a4x74f"><span>222</span></td><td id="LC222" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (chr &gt;= <span class="code-number">0x010000</span>) { <span class="code-comment">// surrogate pair</span>
</code></td></tr><tr><td id="L223" class="css-a4x74f"><span>223</span></td><td id="LC223" class="css-1dcdqdg"><code>                    chr -= <span class="code-number">0x010000</span>;
</code></td></tr><tr><td id="L224" class="css-a4x74f"><span>224</span></td><td id="LC224" class="css-1dcdqdg"><code>                    string += <span class="code-built_in">String</span>.fromCharCode((chr &gt;&gt;&gt; <span class="code-number">10</span>) + <span class="code-number">0xD800</span>, (chr &amp; <span class="code-number">0x3FF</span>) + <span class="code-number">0xDC00</span>);
</code></td></tr><tr><td id="L225" class="css-a4x74f"><span>225</span></td><td id="LC225" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L226" class="css-a4x74f"><span>226</span></td><td id="LC226" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L227" class="css-a4x74f"><span>227</span></td><td id="LC227" class="css-1dcdqdg"><code>                    string += <span class="code-built_in">String</span>.fromCharCode(chr);
</code></td></tr><tr><td id="L228" class="css-a4x74f"><span>228</span></td><td id="LC228" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L229" class="css-a4x74f"><span>229</span></td><td id="LC229" class="css-1dcdqdg"><code>                <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L230" class="css-a4x74f"><span>230</span></td><td id="LC230" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L231" class="css-a4x74f"><span>231</span></td><td id="LC231" class="css-1dcdqdg"><code>            <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">'Invalid byte '</span> + byte.toString(<span class="code-number">16</span>));
</code></td></tr><tr><td id="L232" class="css-a4x74f"><span>232</span></td><td id="LC232" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L233" class="css-a4x74f"><span>233</span></td><td id="LC233" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> string;
</code></td></tr><tr><td id="L234" class="css-a4x74f"><span>234</span></td><td id="LC234" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L235" class="css-a4x74f"><span>235</span></td><td id="LC235" class="css-1dcdqdg"><code>    Decoder.prototype._array = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">length</span>) </span>{
</code></td></tr><tr><td id="L236" class="css-a4x74f"><span>236</span></td><td id="LC236" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> value = <span class="code-keyword">new</span> <span class="code-built_in">Array</span>(length);
</code></td></tr><tr><td id="L237" class="css-a4x74f"><span>237</span></td><td id="LC237" class="css-1dcdqdg"><code>        <span class="code-keyword">for</span> (<span class="code-keyword">var</span> i = <span class="code-number">0</span>; i &lt; length; i++) {
</code></td></tr><tr><td id="L238" class="css-a4x74f"><span>238</span></td><td id="LC238" class="css-1dcdqdg"><code>            value[i] = <span class="code-keyword">this</span>._parse();
</code></td></tr><tr><td id="L239" class="css-a4x74f"><span>239</span></td><td id="LC239" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L240" class="css-a4x74f"><span>240</span></td><td id="LC240" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> value;
</code></td></tr><tr><td id="L241" class="css-a4x74f"><span>241</span></td><td id="LC241" class="css-1dcdqdg"><code>    };
</code></td></tr><tr><td id="L242" class="css-a4x74f"><span>242</span></td><td id="LC242" class="css-1dcdqdg"><code>    Decoder.prototype._map = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">length</span>) </span>{
</code></td></tr><tr><td id="L243" class="css-a4x74f"><span>243</span></td><td id="LC243" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> key = <span class="code-string">''</span>, value = {};
</code></td></tr><tr><td id="L244" class="css-a4x74f"><span>244</span></td><td id="LC244" class="css-1dcdqdg"><code>        <span class="code-keyword">for</span> (<span class="code-keyword">var</span> i = <span class="code-number">0</span>; i &lt; length; i++) {
</code></td></tr><tr><td id="L245" class="css-a4x74f"><span>245</span></td><td id="LC245" class="css-1dcdqdg"><code>            key = <span class="code-keyword">this</span>._parse();
</code></td></tr><tr><td id="L246" class="css-a4x74f"><span>246</span></td><td id="LC246" class="css-1dcdqdg"><code>            value[key] = <span class="code-keyword">this</span>._parse();
</code></td></tr><tr><td id="L247" class="css-a4x74f"><span>247</span></td><td id="LC247" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L248" class="css-a4x74f"><span>248</span></td><td id="LC248" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> value;
</code></td></tr><tr><td id="L249" class="css-a4x74f"><span>249</span></td><td id="LC249" class="css-1dcdqdg"><code>    };
</code></td></tr><tr><td id="L250" class="css-a4x74f"><span>250</span></td><td id="LC250" class="css-1dcdqdg"><code>    Decoder.prototype._str = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">length</span>) </span>{
</code></td></tr><tr><td id="L251" class="css-a4x74f"><span>251</span></td><td id="LC251" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> value = utf8Read$<span class="code-number">1</span>(<span class="code-keyword">this</span>._view, <span class="code-keyword">this</span>._offset, length);
</code></td></tr><tr><td id="L252" class="css-a4x74f"><span>252</span></td><td id="LC252" class="css-1dcdqdg"><code>        <span class="code-keyword">this</span>._offset += length;
</code></td></tr><tr><td id="L253" class="css-a4x74f"><span>253</span></td><td id="LC253" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> value;
</code></td></tr><tr><td id="L254" class="css-a4x74f"><span>254</span></td><td id="LC254" class="css-1dcdqdg"><code>    };
</code></td></tr><tr><td id="L255" class="css-a4x74f"><span>255</span></td><td id="LC255" class="css-1dcdqdg"><code>    Decoder.prototype._bin = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">length</span>) </span>{
</code></td></tr><tr><td id="L256" class="css-a4x74f"><span>256</span></td><td id="LC256" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> value = <span class="code-keyword">this</span>._buffer.slice(<span class="code-keyword">this</span>._offset, <span class="code-keyword">this</span>._offset + length);
</code></td></tr><tr><td id="L257" class="css-a4x74f"><span>257</span></td><td id="LC257" class="css-1dcdqdg"><code>        <span class="code-keyword">this</span>._offset += length;
</code></td></tr><tr><td id="L258" class="css-a4x74f"><span>258</span></td><td id="LC258" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> value;
</code></td></tr><tr><td id="L259" class="css-a4x74f"><span>259</span></td><td id="LC259" class="css-1dcdqdg"><code>    };
</code></td></tr><tr><td id="L260" class="css-a4x74f"><span>260</span></td><td id="LC260" class="css-1dcdqdg"><code>    Decoder.prototype._parse = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L261" class="css-a4x74f"><span>261</span></td><td id="LC261" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> prefix = <span class="code-keyword">this</span>._view.getUint8(<span class="code-keyword">this</span>._offset++);
</code></td></tr><tr><td id="L262" class="css-a4x74f"><span>262</span></td><td id="LC262" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> value, length = <span class="code-number">0</span>, type = <span class="code-number">0</span>, hi = <span class="code-number">0</span>, lo = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L263" class="css-a4x74f"><span>263</span></td><td id="LC263" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (prefix &lt; <span class="code-number">0xc0</span>) {
</code></td></tr><tr><td id="L264" class="css-a4x74f"><span>264</span></td><td id="LC264" class="css-1dcdqdg"><code>            <span class="code-comment">// positive fixint</span>
</code></td></tr><tr><td id="L265" class="css-a4x74f"><span>265</span></td><td id="LC265" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (prefix &lt; <span class="code-number">0x80</span>) {
</code></td></tr><tr><td id="L266" class="css-a4x74f"><span>266</span></td><td id="LC266" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> prefix;
</code></td></tr><tr><td id="L267" class="css-a4x74f"><span>267</span></td><td id="LC267" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L268" class="css-a4x74f"><span>268</span></td><td id="LC268" class="css-1dcdqdg"><code>            <span class="code-comment">// fixmap</span>
</code></td></tr><tr><td id="L269" class="css-a4x74f"><span>269</span></td><td id="LC269" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (prefix &lt; <span class="code-number">0x90</span>) {
</code></td></tr><tr><td id="L270" class="css-a4x74f"><span>270</span></td><td id="LC270" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>._map(prefix &amp; <span class="code-number">0x0f</span>);
</code></td></tr><tr><td id="L271" class="css-a4x74f"><span>271</span></td><td id="LC271" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L272" class="css-a4x74f"><span>272</span></td><td id="LC272" class="css-1dcdqdg"><code>            <span class="code-comment">// fixarray</span>
</code></td></tr><tr><td id="L273" class="css-a4x74f"><span>273</span></td><td id="LC273" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (prefix &lt; <span class="code-number">0xa0</span>) {
</code></td></tr><tr><td id="L274" class="css-a4x74f"><span>274</span></td><td id="LC274" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>._array(prefix &amp; <span class="code-number">0x0f</span>);
</code></td></tr><tr><td id="L275" class="css-a4x74f"><span>275</span></td><td id="LC275" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L276" class="css-a4x74f"><span>276</span></td><td id="LC276" class="css-1dcdqdg"><code>            <span class="code-comment">// fixstr</span>
</code></td></tr><tr><td id="L277" class="css-a4x74f"><span>277</span></td><td id="LC277" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> <span class="code-keyword">this</span>._str(prefix &amp; <span class="code-number">0x1f</span>);
</code></td></tr><tr><td id="L278" class="css-a4x74f"><span>278</span></td><td id="LC278" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L279" class="css-a4x74f"><span>279</span></td><td id="LC279" class="css-1dcdqdg"><code>        <span class="code-comment">// negative fixint</span>
</code></td></tr><tr><td id="L280" class="css-a4x74f"><span>280</span></td><td id="LC280" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (prefix &gt; <span class="code-number">0xdf</span>) {
</code></td></tr><tr><td id="L281" class="css-a4x74f"><span>281</span></td><td id="LC281" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> (<span class="code-number">0xff</span> - prefix + <span class="code-number">1</span>) * <span class="code-number">-1</span>;
</code></td></tr><tr><td id="L282" class="css-a4x74f"><span>282</span></td><td id="LC282" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L283" class="css-a4x74f"><span>283</span></td><td id="LC283" class="css-1dcdqdg"><code>        <span class="code-keyword">switch</span> (prefix) {
</code></td></tr><tr><td id="L284" class="css-a4x74f"><span>284</span></td><td id="LC284" class="css-1dcdqdg"><code>            <span class="code-comment">// nil</span>
</code></td></tr><tr><td id="L285" class="css-a4x74f"><span>285</span></td><td id="LC285" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xc0</span>:
</code></td></tr><tr><td id="L286" class="css-a4x74f"><span>286</span></td><td id="LC286" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-literal">null</span>;
</code></td></tr><tr><td id="L287" class="css-a4x74f"><span>287</span></td><td id="LC287" class="css-1dcdqdg"><code>            <span class="code-comment">// false</span>
</code></td></tr><tr><td id="L288" class="css-a4x74f"><span>288</span></td><td id="LC288" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xc2</span>:
</code></td></tr><tr><td id="L289" class="css-a4x74f"><span>289</span></td><td id="LC289" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-literal">false</span>;
</code></td></tr><tr><td id="L290" class="css-a4x74f"><span>290</span></td><td id="LC290" class="css-1dcdqdg"><code>            <span class="code-comment">// true</span>
</code></td></tr><tr><td id="L291" class="css-a4x74f"><span>291</span></td><td id="LC291" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xc3</span>:
</code></td></tr><tr><td id="L292" class="css-a4x74f"><span>292</span></td><td id="LC292" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-literal">true</span>;
</code></td></tr><tr><td id="L293" class="css-a4x74f"><span>293</span></td><td id="LC293" class="css-1dcdqdg"><code>            <span class="code-comment">// bin</span>
</code></td></tr><tr><td id="L294" class="css-a4x74f"><span>294</span></td><td id="LC294" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xc4</span>:
</code></td></tr><tr><td id="L295" class="css-a4x74f"><span>295</span></td><td id="LC295" class="css-1dcdqdg"><code>                length = <span class="code-keyword">this</span>._view.getUint8(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L296" class="css-a4x74f"><span>296</span></td><td id="LC296" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">1</span>;
</code></td></tr><tr><td id="L297" class="css-a4x74f"><span>297</span></td><td id="LC297" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>._bin(length);
</code></td></tr><tr><td id="L298" class="css-a4x74f"><span>298</span></td><td id="LC298" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xc5</span>:
</code></td></tr><tr><td id="L299" class="css-a4x74f"><span>299</span></td><td id="LC299" class="css-1dcdqdg"><code>                length = <span class="code-keyword">this</span>._view.getUint16(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L300" class="css-a4x74f"><span>300</span></td><td id="LC300" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">2</span>;
</code></td></tr><tr><td id="L301" class="css-a4x74f"><span>301</span></td><td id="LC301" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>._bin(length);
</code></td></tr><tr><td id="L302" class="css-a4x74f"><span>302</span></td><td id="LC302" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xc6</span>:
</code></td></tr><tr><td id="L303" class="css-a4x74f"><span>303</span></td><td id="LC303" class="css-1dcdqdg"><code>                length = <span class="code-keyword">this</span>._view.getUint32(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L304" class="css-a4x74f"><span>304</span></td><td id="LC304" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">4</span>;
</code></td></tr><tr><td id="L305" class="css-a4x74f"><span>305</span></td><td id="LC305" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>._bin(length);
</code></td></tr><tr><td id="L306" class="css-a4x74f"><span>306</span></td><td id="LC306" class="css-1dcdqdg"><code>            <span class="code-comment">// ext</span>
</code></td></tr><tr><td id="L307" class="css-a4x74f"><span>307</span></td><td id="LC307" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xc7</span>:
</code></td></tr><tr><td id="L308" class="css-a4x74f"><span>308</span></td><td id="LC308" class="css-1dcdqdg"><code>                length = <span class="code-keyword">this</span>._view.getUint8(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L309" class="css-a4x74f"><span>309</span></td><td id="LC309" class="css-1dcdqdg"><code>                type = <span class="code-keyword">this</span>._view.getInt8(<span class="code-keyword">this</span>._offset + <span class="code-number">1</span>);
</code></td></tr><tr><td id="L310" class="css-a4x74f"><span>310</span></td><td id="LC310" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">2</span>;
</code></td></tr><tr><td id="L311" class="css-a4x74f"><span>311</span></td><td id="LC311" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (type === <span class="code-number">-1</span>) {
</code></td></tr><tr><td id="L312" class="css-a4x74f"><span>312</span></td><td id="LC312" class="css-1dcdqdg"><code>                    <span class="code-comment">// timestamp 96</span>
</code></td></tr><tr><td id="L313" class="css-a4x74f"><span>313</span></td><td id="LC313" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> ns = <span class="code-keyword">this</span>._view.getUint32(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L314" class="css-a4x74f"><span>314</span></td><td id="LC314" class="css-1dcdqdg"><code>                    hi = <span class="code-keyword">this</span>._view.getInt32(<span class="code-keyword">this</span>._offset + <span class="code-number">4</span>);
</code></td></tr><tr><td id="L315" class="css-a4x74f"><span>315</span></td><td id="LC315" class="css-1dcdqdg"><code>                    lo = <span class="code-keyword">this</span>._view.getUint32(<span class="code-keyword">this</span>._offset + <span class="code-number">8</span>);
</code></td></tr><tr><td id="L316" class="css-a4x74f"><span>316</span></td><td id="LC316" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>._offset += <span class="code-number">12</span>;
</code></td></tr><tr><td id="L317" class="css-a4x74f"><span>317</span></td><td id="LC317" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-keyword">new</span> <span class="code-built_in">Date</span>((hi * <span class="code-number">0x100000000</span> + lo) * <span class="code-number">1e3</span> + ns / <span class="code-number">1e6</span>);
</code></td></tr><tr><td id="L318" class="css-a4x74f"><span>318</span></td><td id="LC318" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L319" class="css-a4x74f"><span>319</span></td><td id="LC319" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> [type, <span class="code-keyword">this</span>._bin(length)];
</code></td></tr><tr><td id="L320" class="css-a4x74f"><span>320</span></td><td id="LC320" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xc8</span>:
</code></td></tr><tr><td id="L321" class="css-a4x74f"><span>321</span></td><td id="LC321" class="css-1dcdqdg"><code>                length = <span class="code-keyword">this</span>._view.getUint16(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L322" class="css-a4x74f"><span>322</span></td><td id="LC322" class="css-1dcdqdg"><code>                type = <span class="code-keyword">this</span>._view.getInt8(<span class="code-keyword">this</span>._offset + <span class="code-number">2</span>);
</code></td></tr><tr><td id="L323" class="css-a4x74f"><span>323</span></td><td id="LC323" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">3</span>;
</code></td></tr><tr><td id="L324" class="css-a4x74f"><span>324</span></td><td id="LC324" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> [type, <span class="code-keyword">this</span>._bin(length)];
</code></td></tr><tr><td id="L325" class="css-a4x74f"><span>325</span></td><td id="LC325" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xc9</span>:
</code></td></tr><tr><td id="L326" class="css-a4x74f"><span>326</span></td><td id="LC326" class="css-1dcdqdg"><code>                length = <span class="code-keyword">this</span>._view.getUint32(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L327" class="css-a4x74f"><span>327</span></td><td id="LC327" class="css-1dcdqdg"><code>                type = <span class="code-keyword">this</span>._view.getInt8(<span class="code-keyword">this</span>._offset + <span class="code-number">4</span>);
</code></td></tr><tr><td id="L328" class="css-a4x74f"><span>328</span></td><td id="LC328" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">5</span>;
</code></td></tr><tr><td id="L329" class="css-a4x74f"><span>329</span></td><td id="LC329" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> [type, <span class="code-keyword">this</span>._bin(length)];
</code></td></tr><tr><td id="L330" class="css-a4x74f"><span>330</span></td><td id="LC330" class="css-1dcdqdg"><code>            <span class="code-comment">// float</span>
</code></td></tr><tr><td id="L331" class="css-a4x74f"><span>331</span></td><td id="LC331" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xca</span>:
</code></td></tr><tr><td id="L332" class="css-a4x74f"><span>332</span></td><td id="LC332" class="css-1dcdqdg"><code>                value = <span class="code-keyword">this</span>._view.getFloat32(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L333" class="css-a4x74f"><span>333</span></td><td id="LC333" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">4</span>;
</code></td></tr><tr><td id="L334" class="css-a4x74f"><span>334</span></td><td id="LC334" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> value;
</code></td></tr><tr><td id="L335" class="css-a4x74f"><span>335</span></td><td id="LC335" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xcb</span>:
</code></td></tr><tr><td id="L336" class="css-a4x74f"><span>336</span></td><td id="LC336" class="css-1dcdqdg"><code>                value = <span class="code-keyword">this</span>._view.getFloat64(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L337" class="css-a4x74f"><span>337</span></td><td id="LC337" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">8</span>;
</code></td></tr><tr><td id="L338" class="css-a4x74f"><span>338</span></td><td id="LC338" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> value;
</code></td></tr><tr><td id="L339" class="css-a4x74f"><span>339</span></td><td id="LC339" class="css-1dcdqdg"><code>            <span class="code-comment">// uint</span>
</code></td></tr><tr><td id="L340" class="css-a4x74f"><span>340</span></td><td id="LC340" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xcc</span>:
</code></td></tr><tr><td id="L341" class="css-a4x74f"><span>341</span></td><td id="LC341" class="css-1dcdqdg"><code>                value = <span class="code-keyword">this</span>._view.getUint8(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L342" class="css-a4x74f"><span>342</span></td><td id="LC342" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">1</span>;
</code></td></tr><tr><td id="L343" class="css-a4x74f"><span>343</span></td><td id="LC343" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> value;
</code></td></tr><tr><td id="L344" class="css-a4x74f"><span>344</span></td><td id="LC344" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xcd</span>:
</code></td></tr><tr><td id="L345" class="css-a4x74f"><span>345</span></td><td id="LC345" class="css-1dcdqdg"><code>                value = <span class="code-keyword">this</span>._view.getUint16(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L346" class="css-a4x74f"><span>346</span></td><td id="LC346" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">2</span>;
</code></td></tr><tr><td id="L347" class="css-a4x74f"><span>347</span></td><td id="LC347" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> value;
</code></td></tr><tr><td id="L348" class="css-a4x74f"><span>348</span></td><td id="LC348" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xce</span>:
</code></td></tr><tr><td id="L349" class="css-a4x74f"><span>349</span></td><td id="LC349" class="css-1dcdqdg"><code>                value = <span class="code-keyword">this</span>._view.getUint32(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L350" class="css-a4x74f"><span>350</span></td><td id="LC350" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">4</span>;
</code></td></tr><tr><td id="L351" class="css-a4x74f"><span>351</span></td><td id="LC351" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> value;
</code></td></tr><tr><td id="L352" class="css-a4x74f"><span>352</span></td><td id="LC352" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xcf</span>:
</code></td></tr><tr><td id="L353" class="css-a4x74f"><span>353</span></td><td id="LC353" class="css-1dcdqdg"><code>                hi = <span class="code-keyword">this</span>._view.getUint32(<span class="code-keyword">this</span>._offset) * <span class="code-built_in">Math</span>.pow(<span class="code-number">2</span>, <span class="code-number">32</span>);
</code></td></tr><tr><td id="L354" class="css-a4x74f"><span>354</span></td><td id="LC354" class="css-1dcdqdg"><code>                lo = <span class="code-keyword">this</span>._view.getUint32(<span class="code-keyword">this</span>._offset + <span class="code-number">4</span>);
</code></td></tr><tr><td id="L355" class="css-a4x74f"><span>355</span></td><td id="LC355" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">8</span>;
</code></td></tr><tr><td id="L356" class="css-a4x74f"><span>356</span></td><td id="LC356" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> hi + lo;
</code></td></tr><tr><td id="L357" class="css-a4x74f"><span>357</span></td><td id="LC357" class="css-1dcdqdg"><code>            <span class="code-comment">// int</span>
</code></td></tr><tr><td id="L358" class="css-a4x74f"><span>358</span></td><td id="LC358" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xd0</span>:
</code></td></tr><tr><td id="L359" class="css-a4x74f"><span>359</span></td><td id="LC359" class="css-1dcdqdg"><code>                value = <span class="code-keyword">this</span>._view.getInt8(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L360" class="css-a4x74f"><span>360</span></td><td id="LC360" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">1</span>;
</code></td></tr><tr><td id="L361" class="css-a4x74f"><span>361</span></td><td id="LC361" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> value;
</code></td></tr><tr><td id="L362" class="css-a4x74f"><span>362</span></td><td id="LC362" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xd1</span>:
</code></td></tr><tr><td id="L363" class="css-a4x74f"><span>363</span></td><td id="LC363" class="css-1dcdqdg"><code>                value = <span class="code-keyword">this</span>._view.getInt16(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L364" class="css-a4x74f"><span>364</span></td><td id="LC364" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">2</span>;
</code></td></tr><tr><td id="L365" class="css-a4x74f"><span>365</span></td><td id="LC365" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> value;
</code></td></tr><tr><td id="L366" class="css-a4x74f"><span>366</span></td><td id="LC366" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xd2</span>:
</code></td></tr><tr><td id="L367" class="css-a4x74f"><span>367</span></td><td id="LC367" class="css-1dcdqdg"><code>                value = <span class="code-keyword">this</span>._view.getInt32(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L368" class="css-a4x74f"><span>368</span></td><td id="LC368" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">4</span>;
</code></td></tr><tr><td id="L369" class="css-a4x74f"><span>369</span></td><td id="LC369" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> value;
</code></td></tr><tr><td id="L370" class="css-a4x74f"><span>370</span></td><td id="LC370" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xd3</span>:
</code></td></tr><tr><td id="L371" class="css-a4x74f"><span>371</span></td><td id="LC371" class="css-1dcdqdg"><code>                hi = <span class="code-keyword">this</span>._view.getInt32(<span class="code-keyword">this</span>._offset) * <span class="code-built_in">Math</span>.pow(<span class="code-number">2</span>, <span class="code-number">32</span>);
</code></td></tr><tr><td id="L372" class="css-a4x74f"><span>372</span></td><td id="LC372" class="css-1dcdqdg"><code>                lo = <span class="code-keyword">this</span>._view.getUint32(<span class="code-keyword">this</span>._offset + <span class="code-number">4</span>);
</code></td></tr><tr><td id="L373" class="css-a4x74f"><span>373</span></td><td id="LC373" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">8</span>;
</code></td></tr><tr><td id="L374" class="css-a4x74f"><span>374</span></td><td id="LC374" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> hi + lo;
</code></td></tr><tr><td id="L375" class="css-a4x74f"><span>375</span></td><td id="LC375" class="css-1dcdqdg"><code>            <span class="code-comment">// fixext</span>
</code></td></tr><tr><td id="L376" class="css-a4x74f"><span>376</span></td><td id="LC376" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xd4</span>:
</code></td></tr><tr><td id="L377" class="css-a4x74f"><span>377</span></td><td id="LC377" class="css-1dcdqdg"><code>                type = <span class="code-keyword">this</span>._view.getInt8(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L378" class="css-a4x74f"><span>378</span></td><td id="LC378" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">1</span>;
</code></td></tr><tr><td id="L379" class="css-a4x74f"><span>379</span></td><td id="LC379" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (type === <span class="code-number">0x00</span>) {
</code></td></tr><tr><td id="L380" class="css-a4x74f"><span>380</span></td><td id="LC380" class="css-1dcdqdg"><code>                    <span class="code-comment">// custom encoding for 'undefined' (kept for backward-compatibility)</span>
</code></td></tr><tr><td id="L381" class="css-a4x74f"><span>381</span></td><td id="LC381" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>._offset += <span class="code-number">1</span>;
</code></td></tr><tr><td id="L382" class="css-a4x74f"><span>382</span></td><td id="LC382" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-keyword">void</span> <span class="code-number">0</span>;
</code></td></tr><tr><td id="L383" class="css-a4x74f"><span>383</span></td><td id="LC383" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L384" class="css-a4x74f"><span>384</span></td><td id="LC384" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> [type, <span class="code-keyword">this</span>._bin(<span class="code-number">1</span>)];
</code></td></tr><tr><td id="L385" class="css-a4x74f"><span>385</span></td><td id="LC385" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xd5</span>:
</code></td></tr><tr><td id="L386" class="css-a4x74f"><span>386</span></td><td id="LC386" class="css-1dcdqdg"><code>                type = <span class="code-keyword">this</span>._view.getInt8(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L387" class="css-a4x74f"><span>387</span></td><td id="LC387" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">1</span>;
</code></td></tr><tr><td id="L388" class="css-a4x74f"><span>388</span></td><td id="LC388" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> [type, <span class="code-keyword">this</span>._bin(<span class="code-number">2</span>)];
</code></td></tr><tr><td id="L389" class="css-a4x74f"><span>389</span></td><td id="LC389" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xd6</span>:
</code></td></tr><tr><td id="L390" class="css-a4x74f"><span>390</span></td><td id="LC390" class="css-1dcdqdg"><code>                type = <span class="code-keyword">this</span>._view.getInt8(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L391" class="css-a4x74f"><span>391</span></td><td id="LC391" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">1</span>;
</code></td></tr><tr><td id="L392" class="css-a4x74f"><span>392</span></td><td id="LC392" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (type === <span class="code-number">-1</span>) {
</code></td></tr><tr><td id="L393" class="css-a4x74f"><span>393</span></td><td id="LC393" class="css-1dcdqdg"><code>                    <span class="code-comment">// timestamp 32</span>
</code></td></tr><tr><td id="L394" class="css-a4x74f"><span>394</span></td><td id="LC394" class="css-1dcdqdg"><code>                    value = <span class="code-keyword">this</span>._view.getUint32(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L395" class="css-a4x74f"><span>395</span></td><td id="LC395" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>._offset += <span class="code-number">4</span>;
</code></td></tr><tr><td id="L396" class="css-a4x74f"><span>396</span></td><td id="LC396" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-keyword">new</span> <span class="code-built_in">Date</span>(value * <span class="code-number">1e3</span>);
</code></td></tr><tr><td id="L397" class="css-a4x74f"><span>397</span></td><td id="LC397" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L398" class="css-a4x74f"><span>398</span></td><td id="LC398" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> [type, <span class="code-keyword">this</span>._bin(<span class="code-number">4</span>)];
</code></td></tr><tr><td id="L399" class="css-a4x74f"><span>399</span></td><td id="LC399" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xd7</span>:
</code></td></tr><tr><td id="L400" class="css-a4x74f"><span>400</span></td><td id="LC400" class="css-1dcdqdg"><code>                type = <span class="code-keyword">this</span>._view.getInt8(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L401" class="css-a4x74f"><span>401</span></td><td id="LC401" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">1</span>;
</code></td></tr><tr><td id="L402" class="css-a4x74f"><span>402</span></td><td id="LC402" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (type === <span class="code-number">0x00</span>) {
</code></td></tr><tr><td id="L403" class="css-a4x74f"><span>403</span></td><td id="LC403" class="css-1dcdqdg"><code>                    <span class="code-comment">// custom date encoding (kept for backward-compatibility)</span>
</code></td></tr><tr><td id="L404" class="css-a4x74f"><span>404</span></td><td id="LC404" class="css-1dcdqdg"><code>                    hi = <span class="code-keyword">this</span>._view.getInt32(<span class="code-keyword">this</span>._offset) * <span class="code-built_in">Math</span>.pow(<span class="code-number">2</span>, <span class="code-number">32</span>);
</code></td></tr><tr><td id="L405" class="css-a4x74f"><span>405</span></td><td id="LC405" class="css-1dcdqdg"><code>                    lo = <span class="code-keyword">this</span>._view.getUint32(<span class="code-keyword">this</span>._offset + <span class="code-number">4</span>);
</code></td></tr><tr><td id="L406" class="css-a4x74f"><span>406</span></td><td id="LC406" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>._offset += <span class="code-number">8</span>;
</code></td></tr><tr><td id="L407" class="css-a4x74f"><span>407</span></td><td id="LC407" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-keyword">new</span> <span class="code-built_in">Date</span>(hi + lo);
</code></td></tr><tr><td id="L408" class="css-a4x74f"><span>408</span></td><td id="LC408" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L409" class="css-a4x74f"><span>409</span></td><td id="LC409" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (type === <span class="code-number">-1</span>) {
</code></td></tr><tr><td id="L410" class="css-a4x74f"><span>410</span></td><td id="LC410" class="css-1dcdqdg"><code>                    <span class="code-comment">// timestamp 64</span>
</code></td></tr><tr><td id="L411" class="css-a4x74f"><span>411</span></td><td id="LC411" class="css-1dcdqdg"><code>                    hi = <span class="code-keyword">this</span>._view.getUint32(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L412" class="css-a4x74f"><span>412</span></td><td id="LC412" class="css-1dcdqdg"><code>                    lo = <span class="code-keyword">this</span>._view.getUint32(<span class="code-keyword">this</span>._offset + <span class="code-number">4</span>);
</code></td></tr><tr><td id="L413" class="css-a4x74f"><span>413</span></td><td id="LC413" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>._offset += <span class="code-number">8</span>;
</code></td></tr><tr><td id="L414" class="css-a4x74f"><span>414</span></td><td id="LC414" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> s = (hi &amp; <span class="code-number">0x3</span>) * <span class="code-number">0x100000000</span> + lo;
</code></td></tr><tr><td id="L415" class="css-a4x74f"><span>415</span></td><td id="LC415" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-keyword">new</span> <span class="code-built_in">Date</span>(s * <span class="code-number">1e3</span> + (hi &gt;&gt;&gt; <span class="code-number">2</span>) / <span class="code-number">1e6</span>);
</code></td></tr><tr><td id="L416" class="css-a4x74f"><span>416</span></td><td id="LC416" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L417" class="css-a4x74f"><span>417</span></td><td id="LC417" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> [type, <span class="code-keyword">this</span>._bin(<span class="code-number">8</span>)];
</code></td></tr><tr><td id="L418" class="css-a4x74f"><span>418</span></td><td id="LC418" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xd8</span>:
</code></td></tr><tr><td id="L419" class="css-a4x74f"><span>419</span></td><td id="LC419" class="css-1dcdqdg"><code>                type = <span class="code-keyword">this</span>._view.getInt8(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L420" class="css-a4x74f"><span>420</span></td><td id="LC420" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">1</span>;
</code></td></tr><tr><td id="L421" class="css-a4x74f"><span>421</span></td><td id="LC421" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> [type, <span class="code-keyword">this</span>._bin(<span class="code-number">16</span>)];
</code></td></tr><tr><td id="L422" class="css-a4x74f"><span>422</span></td><td id="LC422" class="css-1dcdqdg"><code>            <span class="code-comment">// str</span>
</code></td></tr><tr><td id="L423" class="css-a4x74f"><span>423</span></td><td id="LC423" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xd9</span>:
</code></td></tr><tr><td id="L424" class="css-a4x74f"><span>424</span></td><td id="LC424" class="css-1dcdqdg"><code>                length = <span class="code-keyword">this</span>._view.getUint8(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L425" class="css-a4x74f"><span>425</span></td><td id="LC425" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">1</span>;
</code></td></tr><tr><td id="L426" class="css-a4x74f"><span>426</span></td><td id="LC426" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>._str(length);
</code></td></tr><tr><td id="L427" class="css-a4x74f"><span>427</span></td><td id="LC427" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xda</span>:
</code></td></tr><tr><td id="L428" class="css-a4x74f"><span>428</span></td><td id="LC428" class="css-1dcdqdg"><code>                length = <span class="code-keyword">this</span>._view.getUint16(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L429" class="css-a4x74f"><span>429</span></td><td id="LC429" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">2</span>;
</code></td></tr><tr><td id="L430" class="css-a4x74f"><span>430</span></td><td id="LC430" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>._str(length);
</code></td></tr><tr><td id="L431" class="css-a4x74f"><span>431</span></td><td id="LC431" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xdb</span>:
</code></td></tr><tr><td id="L432" class="css-a4x74f"><span>432</span></td><td id="LC432" class="css-1dcdqdg"><code>                length = <span class="code-keyword">this</span>._view.getUint32(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L433" class="css-a4x74f"><span>433</span></td><td id="LC433" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">4</span>;
</code></td></tr><tr><td id="L434" class="css-a4x74f"><span>434</span></td><td id="LC434" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>._str(length);
</code></td></tr><tr><td id="L435" class="css-a4x74f"><span>435</span></td><td id="LC435" class="css-1dcdqdg"><code>            <span class="code-comment">// array</span>
</code></td></tr><tr><td id="L436" class="css-a4x74f"><span>436</span></td><td id="LC436" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xdc</span>:
</code></td></tr><tr><td id="L437" class="css-a4x74f"><span>437</span></td><td id="LC437" class="css-1dcdqdg"><code>                length = <span class="code-keyword">this</span>._view.getUint16(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L438" class="css-a4x74f"><span>438</span></td><td id="LC438" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">2</span>;
</code></td></tr><tr><td id="L439" class="css-a4x74f"><span>439</span></td><td id="LC439" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>._array(length);
</code></td></tr><tr><td id="L440" class="css-a4x74f"><span>440</span></td><td id="LC440" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xdd</span>:
</code></td></tr><tr><td id="L441" class="css-a4x74f"><span>441</span></td><td id="LC441" class="css-1dcdqdg"><code>                length = <span class="code-keyword">this</span>._view.getUint32(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L442" class="css-a4x74f"><span>442</span></td><td id="LC442" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">4</span>;
</code></td></tr><tr><td id="L443" class="css-a4x74f"><span>443</span></td><td id="LC443" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>._array(length);
</code></td></tr><tr><td id="L444" class="css-a4x74f"><span>444</span></td><td id="LC444" class="css-1dcdqdg"><code>            <span class="code-comment">// map</span>
</code></td></tr><tr><td id="L445" class="css-a4x74f"><span>445</span></td><td id="LC445" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xde</span>:
</code></td></tr><tr><td id="L446" class="css-a4x74f"><span>446</span></td><td id="LC446" class="css-1dcdqdg"><code>                length = <span class="code-keyword">this</span>._view.getUint16(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L447" class="css-a4x74f"><span>447</span></td><td id="LC447" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">2</span>;
</code></td></tr><tr><td id="L448" class="css-a4x74f"><span>448</span></td><td id="LC448" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>._map(length);
</code></td></tr><tr><td id="L449" class="css-a4x74f"><span>449</span></td><td id="LC449" class="css-1dcdqdg"><code>            <span class="code-keyword">case</span> <span class="code-number">0xdf</span>:
</code></td></tr><tr><td id="L450" class="css-a4x74f"><span>450</span></td><td id="LC450" class="css-1dcdqdg"><code>                length = <span class="code-keyword">this</span>._view.getUint32(<span class="code-keyword">this</span>._offset);
</code></td></tr><tr><td id="L451" class="css-a4x74f"><span>451</span></td><td id="LC451" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._offset += <span class="code-number">4</span>;
</code></td></tr><tr><td id="L452" class="css-a4x74f"><span>452</span></td><td id="LC452" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>._map(length);
</code></td></tr><tr><td id="L453" class="css-a4x74f"><span>453</span></td><td id="LC453" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L454" class="css-a4x74f"><span>454</span></td><td id="LC454" class="css-1dcdqdg"><code>        <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">'Could not parse'</span>);
</code></td></tr><tr><td id="L455" class="css-a4x74f"><span>455</span></td><td id="LC455" class="css-1dcdqdg"><code>    };
</code></td></tr><tr><td id="L456" class="css-a4x74f"><span>456</span></td><td id="LC456" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">decode</span>(<span class="code-params">buffer, offset</span>) </span>{
</code></td></tr><tr><td id="L457" class="css-a4x74f"><span>457</span></td><td id="LC457" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (offset === <span class="code-keyword">void</span> <span class="code-number">0</span>) { offset = <span class="code-number">0</span>; }
</code></td></tr><tr><td id="L458" class="css-a4x74f"><span>458</span></td><td id="LC458" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> decoder = <span class="code-keyword">new</span> Decoder(buffer, offset);
</code></td></tr><tr><td id="L459" class="css-a4x74f"><span>459</span></td><td id="LC459" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> value = decoder._parse();
</code></td></tr><tr><td id="L460" class="css-a4x74f"><span>460</span></td><td id="LC460" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (decoder._offset !== buffer.byteLength) {
</code></td></tr><tr><td id="L461" class="css-a4x74f"><span>461</span></td><td id="LC461" class="css-1dcdqdg"><code>            <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>((buffer.byteLength - decoder._offset) + <span class="code-string">' trailing bytes'</span>);
</code></td></tr><tr><td id="L462" class="css-a4x74f"><span>462</span></td><td id="LC462" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L463" class="css-a4x74f"><span>463</span></td><td id="LC463" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> value;
</code></td></tr><tr><td id="L464" class="css-a4x74f"><span>464</span></td><td id="LC464" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L465" class="css-a4x74f"><span>465</span></td><td id="LC465" class="css-1dcdqdg"><code>    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L466" class="css-a4x74f"><span>466</span></td><td id="LC466" class="css-1dcdqdg"><code>    <span class="code-comment">// ENCODER</span>
</code></td></tr><tr><td id="L467" class="css-a4x74f"><span>467</span></td><td id="LC467" class="css-1dcdqdg"><code>    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L468" class="css-a4x74f"><span>468</span></td><td id="LC468" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> TIMESTAMP32_MAX_SEC = <span class="code-number">0x100000000</span> - <span class="code-number">1</span>; <span class="code-comment">// 32-bit unsigned int</span>
</code></td></tr><tr><td id="L469" class="css-a4x74f"><span>469</span></td><td id="LC469" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> TIMESTAMP64_MAX_SEC = <span class="code-number">0x400000000</span> - <span class="code-number">1</span>; <span class="code-comment">// 34-bit unsigned int</span>
</code></td></tr><tr><td id="L470" class="css-a4x74f"><span>470</span></td><td id="LC470" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">utf8Write</span>(<span class="code-params">view, offset, str</span>) </span>{
</code></td></tr><tr><td id="L471" class="css-a4x74f"><span>471</span></td><td id="LC471" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> c = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L472" class="css-a4x74f"><span>472</span></td><td id="LC472" class="css-1dcdqdg"><code>        <span class="code-keyword">for</span> (<span class="code-keyword">var</span> i = <span class="code-number">0</span>, l = str.length; i &lt; l; i++) {
</code></td></tr><tr><td id="L473" class="css-a4x74f"><span>473</span></td><td id="LC473" class="css-1dcdqdg"><code>            c = str.charCodeAt(i);
</code></td></tr><tr><td id="L474" class="css-a4x74f"><span>474</span></td><td id="LC474" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (c &lt; <span class="code-number">0x80</span>) {
</code></td></tr><tr><td id="L475" class="css-a4x74f"><span>475</span></td><td id="LC475" class="css-1dcdqdg"><code>                view.setUint8(offset++, c);
</code></td></tr><tr><td id="L476" class="css-a4x74f"><span>476</span></td><td id="LC476" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L477" class="css-a4x74f"><span>477</span></td><td id="LC477" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (c &lt; <span class="code-number">0x800</span>) {
</code></td></tr><tr><td id="L478" class="css-a4x74f"><span>478</span></td><td id="LC478" class="css-1dcdqdg"><code>                view.setUint8(offset++, <span class="code-number">0xc0</span> | (c &gt;&gt; <span class="code-number">6</span>));
</code></td></tr><tr><td id="L479" class="css-a4x74f"><span>479</span></td><td id="LC479" class="css-1dcdqdg"><code>                view.setUint8(offset++, <span class="code-number">0x80</span> | (c &amp; <span class="code-number">0x3f</span>));
</code></td></tr><tr><td id="L480" class="css-a4x74f"><span>480</span></td><td id="LC480" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L481" class="css-a4x74f"><span>481</span></td><td id="LC481" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (c &lt; <span class="code-number">0xd800</span> || c &gt;= <span class="code-number">0xe000</span>) {
</code></td></tr><tr><td id="L482" class="css-a4x74f"><span>482</span></td><td id="LC482" class="css-1dcdqdg"><code>                view.setUint8(offset++, <span class="code-number">0xe0</span> | (c &gt;&gt; <span class="code-number">12</span>));
</code></td></tr><tr><td id="L483" class="css-a4x74f"><span>483</span></td><td id="LC483" class="css-1dcdqdg"><code>                view.setUint8(offset++, <span class="code-number">0x80</span> | (c &gt;&gt; <span class="code-number">6</span>) &amp; <span class="code-number">0x3f</span>);
</code></td></tr><tr><td id="L484" class="css-a4x74f"><span>484</span></td><td id="LC484" class="css-1dcdqdg"><code>                view.setUint8(offset++, <span class="code-number">0x80</span> | (c &amp; <span class="code-number">0x3f</span>));
</code></td></tr><tr><td id="L485" class="css-a4x74f"><span>485</span></td><td id="LC485" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L486" class="css-a4x74f"><span>486</span></td><td id="LC486" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L487" class="css-a4x74f"><span>487</span></td><td id="LC487" class="css-1dcdqdg"><code>                i++;
</code></td></tr><tr><td id="L488" class="css-a4x74f"><span>488</span></td><td id="LC488" class="css-1dcdqdg"><code>                c = <span class="code-number">0x10000</span> + (((c &amp; <span class="code-number">0x3ff</span>) &lt;&lt; <span class="code-number">10</span>) | (str.charCodeAt(i) &amp; <span class="code-number">0x3ff</span>));
</code></td></tr><tr><td id="L489" class="css-a4x74f"><span>489</span></td><td id="LC489" class="css-1dcdqdg"><code>                view.setUint8(offset++, <span class="code-number">0xf0</span> | (c &gt;&gt; <span class="code-number">18</span>));
</code></td></tr><tr><td id="L490" class="css-a4x74f"><span>490</span></td><td id="LC490" class="css-1dcdqdg"><code>                view.setUint8(offset++, <span class="code-number">0x80</span> | (c &gt;&gt; <span class="code-number">12</span>) &amp; <span class="code-number">0x3f</span>);
</code></td></tr><tr><td id="L491" class="css-a4x74f"><span>491</span></td><td id="LC491" class="css-1dcdqdg"><code>                view.setUint8(offset++, <span class="code-number">0x80</span> | (c &gt;&gt; <span class="code-number">6</span>) &amp; <span class="code-number">0x3f</span>);
</code></td></tr><tr><td id="L492" class="css-a4x74f"><span>492</span></td><td id="LC492" class="css-1dcdqdg"><code>                view.setUint8(offset++, <span class="code-number">0x80</span> | (c &amp; <span class="code-number">0x3f</span>));
</code></td></tr><tr><td id="L493" class="css-a4x74f"><span>493</span></td><td id="LC493" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L494" class="css-a4x74f"><span>494</span></td><td id="LC494" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L495" class="css-a4x74f"><span>495</span></td><td id="LC495" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L496" class="css-a4x74f"><span>496</span></td><td id="LC496" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">utf8Length$1</span>(<span class="code-params">str</span>) </span>{
</code></td></tr><tr><td id="L497" class="css-a4x74f"><span>497</span></td><td id="LC497" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> c = <span class="code-number">0</span>, length = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L498" class="css-a4x74f"><span>498</span></td><td id="LC498" class="css-1dcdqdg"><code>        <span class="code-keyword">for</span> (<span class="code-keyword">var</span> i = <span class="code-number">0</span>, l = str.length; i &lt; l; i++) {
</code></td></tr><tr><td id="L499" class="css-a4x74f"><span>499</span></td><td id="LC499" class="css-1dcdqdg"><code>            c = str.charCodeAt(i);
</code></td></tr><tr><td id="L500" class="css-a4x74f"><span>500</span></td><td id="LC500" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (c &lt; <span class="code-number">0x80</span>) {
</code></td></tr><tr><td id="L501" class="css-a4x74f"><span>501</span></td><td id="LC501" class="css-1dcdqdg"><code>                length += <span class="code-number">1</span>;
</code></td></tr><tr><td id="L502" class="css-a4x74f"><span>502</span></td><td id="LC502" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L503" class="css-a4x74f"><span>503</span></td><td id="LC503" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (c &lt; <span class="code-number">0x800</span>) {
</code></td></tr><tr><td id="L504" class="css-a4x74f"><span>504</span></td><td id="LC504" class="css-1dcdqdg"><code>                length += <span class="code-number">2</span>;
</code></td></tr><tr><td id="L505" class="css-a4x74f"><span>505</span></td><td id="LC505" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L506" class="css-a4x74f"><span>506</span></td><td id="LC506" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (c &lt; <span class="code-number">0xd800</span> || c &gt;= <span class="code-number">0xe000</span>) {
</code></td></tr><tr><td id="L507" class="css-a4x74f"><span>507</span></td><td id="LC507" class="css-1dcdqdg"><code>                length += <span class="code-number">3</span>;
</code></td></tr><tr><td id="L508" class="css-a4x74f"><span>508</span></td><td id="LC508" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L509" class="css-a4x74f"><span>509</span></td><td id="LC509" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L510" class="css-a4x74f"><span>510</span></td><td id="LC510" class="css-1dcdqdg"><code>                i++;
</code></td></tr><tr><td id="L511" class="css-a4x74f"><span>511</span></td><td id="LC511" class="css-1dcdqdg"><code>                length += <span class="code-number">4</span>;
</code></td></tr><tr><td id="L512" class="css-a4x74f"><span>512</span></td><td id="LC512" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L513" class="css-a4x74f"><span>513</span></td><td id="LC513" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L514" class="css-a4x74f"><span>514</span></td><td id="LC514" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> length;
</code></td></tr><tr><td id="L515" class="css-a4x74f"><span>515</span></td><td id="LC515" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L516" class="css-a4x74f"><span>516</span></td><td id="LC516" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">_encode</span>(<span class="code-params">bytes, defers, value</span>) </span>{
</code></td></tr><tr><td id="L517" class="css-a4x74f"><span>517</span></td><td id="LC517" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> type = <span class="code-keyword">typeof</span> value, i = <span class="code-number">0</span>, l = <span class="code-number">0</span>, hi = <span class="code-number">0</span>, lo = <span class="code-number">0</span>, length = <span class="code-number">0</span>, size = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L518" class="css-a4x74f"><span>518</span></td><td id="LC518" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (type === <span class="code-string">'string'</span>) {
</code></td></tr><tr><td id="L519" class="css-a4x74f"><span>519</span></td><td id="LC519" class="css-1dcdqdg"><code>            length = utf8Length$<span class="code-number">1</span>(value);
</code></td></tr><tr><td id="L520" class="css-a4x74f"><span>520</span></td><td id="LC520" class="css-1dcdqdg"><code>            <span class="code-comment">// fixstr</span>
</code></td></tr><tr><td id="L521" class="css-a4x74f"><span>521</span></td><td id="LC521" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (length &lt; <span class="code-number">0x20</span>) {
</code></td></tr><tr><td id="L522" class="css-a4x74f"><span>522</span></td><td id="LC522" class="css-1dcdqdg"><code>                bytes.push(length | <span class="code-number">0xa0</span>);
</code></td></tr><tr><td id="L523" class="css-a4x74f"><span>523</span></td><td id="LC523" class="css-1dcdqdg"><code>                size = <span class="code-number">1</span>;
</code></td></tr><tr><td id="L524" class="css-a4x74f"><span>524</span></td><td id="LC524" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L525" class="css-a4x74f"><span>525</span></td><td id="LC525" class="css-1dcdqdg"><code>            <span class="code-comment">// str 8</span>
</code></td></tr><tr><td id="L526" class="css-a4x74f"><span>526</span></td><td id="LC526" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (length &lt; <span class="code-number">0x100</span>) {
</code></td></tr><tr><td id="L527" class="css-a4x74f"><span>527</span></td><td id="LC527" class="css-1dcdqdg"><code>                bytes.push(<span class="code-number">0xd9</span>, length);
</code></td></tr><tr><td id="L528" class="css-a4x74f"><span>528</span></td><td id="LC528" class="css-1dcdqdg"><code>                size = <span class="code-number">2</span>;
</code></td></tr><tr><td id="L529" class="css-a4x74f"><span>529</span></td><td id="LC529" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L530" class="css-a4x74f"><span>530</span></td><td id="LC530" class="css-1dcdqdg"><code>            <span class="code-comment">// str 16</span>
</code></td></tr><tr><td id="L531" class="css-a4x74f"><span>531</span></td><td id="LC531" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (length &lt; <span class="code-number">0x10000</span>) {
</code></td></tr><tr><td id="L532" class="css-a4x74f"><span>532</span></td><td id="LC532" class="css-1dcdqdg"><code>                bytes.push(<span class="code-number">0xda</span>, length &gt;&gt; <span class="code-number">8</span>, length);
</code></td></tr><tr><td id="L533" class="css-a4x74f"><span>533</span></td><td id="LC533" class="css-1dcdqdg"><code>                size = <span class="code-number">3</span>;
</code></td></tr><tr><td id="L534" class="css-a4x74f"><span>534</span></td><td id="LC534" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L535" class="css-a4x74f"><span>535</span></td><td id="LC535" class="css-1dcdqdg"><code>            <span class="code-comment">// str 32</span>
</code></td></tr><tr><td id="L536" class="css-a4x74f"><span>536</span></td><td id="LC536" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (length &lt; <span class="code-number">0x100000000</span>) {
</code></td></tr><tr><td id="L537" class="css-a4x74f"><span>537</span></td><td id="LC537" class="css-1dcdqdg"><code>                bytes.push(<span class="code-number">0xdb</span>, length &gt;&gt; <span class="code-number">24</span>, length &gt;&gt; <span class="code-number">16</span>, length &gt;&gt; <span class="code-number">8</span>, length);
</code></td></tr><tr><td id="L538" class="css-a4x74f"><span>538</span></td><td id="LC538" class="css-1dcdqdg"><code>                size = <span class="code-number">5</span>;
</code></td></tr><tr><td id="L539" class="css-a4x74f"><span>539</span></td><td id="LC539" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L540" class="css-a4x74f"><span>540</span></td><td id="LC540" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L541" class="css-a4x74f"><span>541</span></td><td id="LC541" class="css-1dcdqdg"><code>                <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">'String too long'</span>);
</code></td></tr><tr><td id="L542" class="css-a4x74f"><span>542</span></td><td id="LC542" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L543" class="css-a4x74f"><span>543</span></td><td id="LC543" class="css-1dcdqdg"><code>            defers.push({ <span class="code-attr">_str</span>: value, <span class="code-attr">_length</span>: length, <span class="code-attr">_offset</span>: bytes.length });
</code></td></tr><tr><td id="L544" class="css-a4x74f"><span>544</span></td><td id="LC544" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> size + length;
</code></td></tr><tr><td id="L545" class="css-a4x74f"><span>545</span></td><td id="LC545" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L546" class="css-a4x74f"><span>546</span></td><td id="LC546" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (type === <span class="code-string">'number'</span>) {
</code></td></tr><tr><td id="L547" class="css-a4x74f"><span>547</span></td><td id="LC547" class="css-1dcdqdg"><code>            <span class="code-comment">// <span class="code-doctag">TODO:</span> encode to float 32?</span>
</code></td></tr><tr><td id="L548" class="css-a4x74f"><span>548</span></td><td id="LC548" class="css-1dcdqdg"><code>            <span class="code-comment">// float 64</span>
</code></td></tr><tr><td id="L549" class="css-a4x74f"><span>549</span></td><td id="LC549" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (<span class="code-built_in">Math</span>.floor(value) !== value || !<span class="code-built_in">isFinite</span>(value)) {
</code></td></tr><tr><td id="L550" class="css-a4x74f"><span>550</span></td><td id="LC550" class="css-1dcdqdg"><code>                bytes.push(<span class="code-number">0xcb</span>);
</code></td></tr><tr><td id="L551" class="css-a4x74f"><span>551</span></td><td id="LC551" class="css-1dcdqdg"><code>                defers.push({ <span class="code-attr">_float</span>: value, <span class="code-attr">_length</span>: <span class="code-number">8</span>, <span class="code-attr">_offset</span>: bytes.length });
</code></td></tr><tr><td id="L552" class="css-a4x74f"><span>552</span></td><td id="LC552" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-number">9</span>;
</code></td></tr><tr><td id="L553" class="css-a4x74f"><span>553</span></td><td id="LC553" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L554" class="css-a4x74f"><span>554</span></td><td id="LC554" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (value &gt;= <span class="code-number">0</span>) {
</code></td></tr><tr><td id="L555" class="css-a4x74f"><span>555</span></td><td id="LC555" class="css-1dcdqdg"><code>                <span class="code-comment">// positive fixnum</span>
</code></td></tr><tr><td id="L556" class="css-a4x74f"><span>556</span></td><td id="LC556" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (value &lt; <span class="code-number">0x80</span>) {
</code></td></tr><tr><td id="L557" class="css-a4x74f"><span>557</span></td><td id="LC557" class="css-1dcdqdg"><code>                    bytes.push(value);
</code></td></tr><tr><td id="L558" class="css-a4x74f"><span>558</span></td><td id="LC558" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-number">1</span>;
</code></td></tr><tr><td id="L559" class="css-a4x74f"><span>559</span></td><td id="LC559" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L560" class="css-a4x74f"><span>560</span></td><td id="LC560" class="css-1dcdqdg"><code>                <span class="code-comment">// uint 8</span>
</code></td></tr><tr><td id="L561" class="css-a4x74f"><span>561</span></td><td id="LC561" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (value &lt; <span class="code-number">0x100</span>) {
</code></td></tr><tr><td id="L562" class="css-a4x74f"><span>562</span></td><td id="LC562" class="css-1dcdqdg"><code>                    bytes.push(<span class="code-number">0xcc</span>, value);
</code></td></tr><tr><td id="L563" class="css-a4x74f"><span>563</span></td><td id="LC563" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-number">2</span>;
</code></td></tr><tr><td id="L564" class="css-a4x74f"><span>564</span></td><td id="LC564" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L565" class="css-a4x74f"><span>565</span></td><td id="LC565" class="css-1dcdqdg"><code>                <span class="code-comment">// uint 16</span>
</code></td></tr><tr><td id="L566" class="css-a4x74f"><span>566</span></td><td id="LC566" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (value &lt; <span class="code-number">0x10000</span>) {
</code></td></tr><tr><td id="L567" class="css-a4x74f"><span>567</span></td><td id="LC567" class="css-1dcdqdg"><code>                    bytes.push(<span class="code-number">0xcd</span>, value &gt;&gt; <span class="code-number">8</span>, value);
</code></td></tr><tr><td id="L568" class="css-a4x74f"><span>568</span></td><td id="LC568" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-number">3</span>;
</code></td></tr><tr><td id="L569" class="css-a4x74f"><span>569</span></td><td id="LC569" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L570" class="css-a4x74f"><span>570</span></td><td id="LC570" class="css-1dcdqdg"><code>                <span class="code-comment">// uint 32</span>
</code></td></tr><tr><td id="L571" class="css-a4x74f"><span>571</span></td><td id="LC571" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (value &lt; <span class="code-number">0x100000000</span>) {
</code></td></tr><tr><td id="L572" class="css-a4x74f"><span>572</span></td><td id="LC572" class="css-1dcdqdg"><code>                    bytes.push(<span class="code-number">0xce</span>, value &gt;&gt; <span class="code-number">24</span>, value &gt;&gt; <span class="code-number">16</span>, value &gt;&gt; <span class="code-number">8</span>, value);
</code></td></tr><tr><td id="L573" class="css-a4x74f"><span>573</span></td><td id="LC573" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-number">5</span>;
</code></td></tr><tr><td id="L574" class="css-a4x74f"><span>574</span></td><td id="LC574" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L575" class="css-a4x74f"><span>575</span></td><td id="LC575" class="css-1dcdqdg"><code>                <span class="code-comment">// uint 64</span>
</code></td></tr><tr><td id="L576" class="css-a4x74f"><span>576</span></td><td id="LC576" class="css-1dcdqdg"><code>                hi = (value / <span class="code-built_in">Math</span>.pow(<span class="code-number">2</span>, <span class="code-number">32</span>)) &gt;&gt; <span class="code-number">0</span>;
</code></td></tr><tr><td id="L577" class="css-a4x74f"><span>577</span></td><td id="LC577" class="css-1dcdqdg"><code>                lo = value &gt;&gt;&gt; <span class="code-number">0</span>;
</code></td></tr><tr><td id="L578" class="css-a4x74f"><span>578</span></td><td id="LC578" class="css-1dcdqdg"><code>                bytes.push(<span class="code-number">0xcf</span>, hi &gt;&gt; <span class="code-number">24</span>, hi &gt;&gt; <span class="code-number">16</span>, hi &gt;&gt; <span class="code-number">8</span>, hi, lo &gt;&gt; <span class="code-number">24</span>, lo &gt;&gt; <span class="code-number">16</span>, lo &gt;&gt; <span class="code-number">8</span>, lo);
</code></td></tr><tr><td id="L579" class="css-a4x74f"><span>579</span></td><td id="LC579" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-number">9</span>;
</code></td></tr><tr><td id="L580" class="css-a4x74f"><span>580</span></td><td id="LC580" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L581" class="css-a4x74f"><span>581</span></td><td id="LC581" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L582" class="css-a4x74f"><span>582</span></td><td id="LC582" class="css-1dcdqdg"><code>                <span class="code-comment">// negative fixnum</span>
</code></td></tr><tr><td id="L583" class="css-a4x74f"><span>583</span></td><td id="LC583" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (value &gt;= <span class="code-number">-0x20</span>) {
</code></td></tr><tr><td id="L584" class="css-a4x74f"><span>584</span></td><td id="LC584" class="css-1dcdqdg"><code>                    bytes.push(value);
</code></td></tr><tr><td id="L585" class="css-a4x74f"><span>585</span></td><td id="LC585" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-number">1</span>;
</code></td></tr><tr><td id="L586" class="css-a4x74f"><span>586</span></td><td id="LC586" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L587" class="css-a4x74f"><span>587</span></td><td id="LC587" class="css-1dcdqdg"><code>                <span class="code-comment">// int 8</span>
</code></td></tr><tr><td id="L588" class="css-a4x74f"><span>588</span></td><td id="LC588" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (value &gt;= <span class="code-number">-0x80</span>) {
</code></td></tr><tr><td id="L589" class="css-a4x74f"><span>589</span></td><td id="LC589" class="css-1dcdqdg"><code>                    bytes.push(<span class="code-number">0xd0</span>, value);
</code></td></tr><tr><td id="L590" class="css-a4x74f"><span>590</span></td><td id="LC590" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-number">2</span>;
</code></td></tr><tr><td id="L591" class="css-a4x74f"><span>591</span></td><td id="LC591" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L592" class="css-a4x74f"><span>592</span></td><td id="LC592" class="css-1dcdqdg"><code>                <span class="code-comment">// int 16</span>
</code></td></tr><tr><td id="L593" class="css-a4x74f"><span>593</span></td><td id="LC593" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (value &gt;= <span class="code-number">-0x8000</span>) {
</code></td></tr><tr><td id="L594" class="css-a4x74f"><span>594</span></td><td id="LC594" class="css-1dcdqdg"><code>                    bytes.push(<span class="code-number">0xd1</span>, value &gt;&gt; <span class="code-number">8</span>, value);
</code></td></tr><tr><td id="L595" class="css-a4x74f"><span>595</span></td><td id="LC595" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-number">3</span>;
</code></td></tr><tr><td id="L596" class="css-a4x74f"><span>596</span></td><td id="LC596" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L597" class="css-a4x74f"><span>597</span></td><td id="LC597" class="css-1dcdqdg"><code>                <span class="code-comment">// int 32</span>
</code></td></tr><tr><td id="L598" class="css-a4x74f"><span>598</span></td><td id="LC598" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (value &gt;= <span class="code-number">-0x80000000</span>) {
</code></td></tr><tr><td id="L599" class="css-a4x74f"><span>599</span></td><td id="LC599" class="css-1dcdqdg"><code>                    bytes.push(<span class="code-number">0xd2</span>, value &gt;&gt; <span class="code-number">24</span>, value &gt;&gt; <span class="code-number">16</span>, value &gt;&gt; <span class="code-number">8</span>, value);
</code></td></tr><tr><td id="L600" class="css-a4x74f"><span>600</span></td><td id="LC600" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-number">5</span>;
</code></td></tr><tr><td id="L601" class="css-a4x74f"><span>601</span></td><td id="LC601" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L602" class="css-a4x74f"><span>602</span></td><td id="LC602" class="css-1dcdqdg"><code>                <span class="code-comment">// int 64</span>
</code></td></tr><tr><td id="L603" class="css-a4x74f"><span>603</span></td><td id="LC603" class="css-1dcdqdg"><code>                hi = <span class="code-built_in">Math</span>.floor(value / <span class="code-built_in">Math</span>.pow(<span class="code-number">2</span>, <span class="code-number">32</span>));
</code></td></tr><tr><td id="L604" class="css-a4x74f"><span>604</span></td><td id="LC604" class="css-1dcdqdg"><code>                lo = value &gt;&gt;&gt; <span class="code-number">0</span>;
</code></td></tr><tr><td id="L605" class="css-a4x74f"><span>605</span></td><td id="LC605" class="css-1dcdqdg"><code>                bytes.push(<span class="code-number">0xd3</span>, hi &gt;&gt; <span class="code-number">24</span>, hi &gt;&gt; <span class="code-number">16</span>, hi &gt;&gt; <span class="code-number">8</span>, hi, lo &gt;&gt; <span class="code-number">24</span>, lo &gt;&gt; <span class="code-number">16</span>, lo &gt;&gt; <span class="code-number">8</span>, lo);
</code></td></tr><tr><td id="L606" class="css-a4x74f"><span>606</span></td><td id="LC606" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-number">9</span>;
</code></td></tr><tr><td id="L607" class="css-a4x74f"><span>607</span></td><td id="LC607" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L608" class="css-a4x74f"><span>608</span></td><td id="LC608" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L609" class="css-a4x74f"><span>609</span></td><td id="LC609" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (type === <span class="code-string">'object'</span>) {
</code></td></tr><tr><td id="L610" class="css-a4x74f"><span>610</span></td><td id="LC610" class="css-1dcdqdg"><code>            <span class="code-comment">// nil</span>
</code></td></tr><tr><td id="L611" class="css-a4x74f"><span>611</span></td><td id="LC611" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (value === <span class="code-literal">null</span>) {
</code></td></tr><tr><td id="L612" class="css-a4x74f"><span>612</span></td><td id="LC612" class="css-1dcdqdg"><code>                bytes.push(<span class="code-number">0xc0</span>);
</code></td></tr><tr><td id="L613" class="css-a4x74f"><span>613</span></td><td id="LC613" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-number">1</span>;
</code></td></tr><tr><td id="L614" class="css-a4x74f"><span>614</span></td><td id="LC614" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L615" class="css-a4x74f"><span>615</span></td><td id="LC615" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (<span class="code-built_in">Array</span>.isArray(value)) {
</code></td></tr><tr><td id="L616" class="css-a4x74f"><span>616</span></td><td id="LC616" class="css-1dcdqdg"><code>                length = value.length;
</code></td></tr><tr><td id="L617" class="css-a4x74f"><span>617</span></td><td id="LC617" class="css-1dcdqdg"><code>                <span class="code-comment">// fixarray</span>
</code></td></tr><tr><td id="L618" class="css-a4x74f"><span>618</span></td><td id="LC618" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (length &lt; <span class="code-number">0x10</span>) {
</code></td></tr><tr><td id="L619" class="css-a4x74f"><span>619</span></td><td id="LC619" class="css-1dcdqdg"><code>                    bytes.push(length | <span class="code-number">0x90</span>);
</code></td></tr><tr><td id="L620" class="css-a4x74f"><span>620</span></td><td id="LC620" class="css-1dcdqdg"><code>                    size = <span class="code-number">1</span>;
</code></td></tr><tr><td id="L621" class="css-a4x74f"><span>621</span></td><td id="LC621" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L622" class="css-a4x74f"><span>622</span></td><td id="LC622" class="css-1dcdqdg"><code>                <span class="code-comment">// array 16</span>
</code></td></tr><tr><td id="L623" class="css-a4x74f"><span>623</span></td><td id="LC623" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> <span class="code-keyword">if</span> (length &lt; <span class="code-number">0x10000</span>) {
</code></td></tr><tr><td id="L624" class="css-a4x74f"><span>624</span></td><td id="LC624" class="css-1dcdqdg"><code>                    bytes.push(<span class="code-number">0xdc</span>, length &gt;&gt; <span class="code-number">8</span>, length);
</code></td></tr><tr><td id="L625" class="css-a4x74f"><span>625</span></td><td id="LC625" class="css-1dcdqdg"><code>                    size = <span class="code-number">3</span>;
</code></td></tr><tr><td id="L626" class="css-a4x74f"><span>626</span></td><td id="LC626" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L627" class="css-a4x74f"><span>627</span></td><td id="LC627" class="css-1dcdqdg"><code>                <span class="code-comment">// array 32</span>
</code></td></tr><tr><td id="L628" class="css-a4x74f"><span>628</span></td><td id="LC628" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> <span class="code-keyword">if</span> (length &lt; <span class="code-number">0x100000000</span>) {
</code></td></tr><tr><td id="L629" class="css-a4x74f"><span>629</span></td><td id="LC629" class="css-1dcdqdg"><code>                    bytes.push(<span class="code-number">0xdd</span>, length &gt;&gt; <span class="code-number">24</span>, length &gt;&gt; <span class="code-number">16</span>, length &gt;&gt; <span class="code-number">8</span>, length);
</code></td></tr><tr><td id="L630" class="css-a4x74f"><span>630</span></td><td id="LC630" class="css-1dcdqdg"><code>                    size = <span class="code-number">5</span>;
</code></td></tr><tr><td id="L631" class="css-a4x74f"><span>631</span></td><td id="LC631" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L632" class="css-a4x74f"><span>632</span></td><td id="LC632" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L633" class="css-a4x74f"><span>633</span></td><td id="LC633" class="css-1dcdqdg"><code>                    <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">'Array too large'</span>);
</code></td></tr><tr><td id="L634" class="css-a4x74f"><span>634</span></td><td id="LC634" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L635" class="css-a4x74f"><span>635</span></td><td id="LC635" class="css-1dcdqdg"><code>                <span class="code-keyword">for</span> (i = <span class="code-number">0</span>; i &lt; length; i++) {
</code></td></tr><tr><td id="L636" class="css-a4x74f"><span>636</span></td><td id="LC636" class="css-1dcdqdg"><code>                    size += _encode(bytes, defers, value[i]);
</code></td></tr><tr><td id="L637" class="css-a4x74f"><span>637</span></td><td id="LC637" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L638" class="css-a4x74f"><span>638</span></td><td id="LC638" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> size;
</code></td></tr><tr><td id="L639" class="css-a4x74f"><span>639</span></td><td id="LC639" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L640" class="css-a4x74f"><span>640</span></td><td id="LC640" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (value <span class="code-keyword">instanceof</span> <span class="code-built_in">Date</span>) {
</code></td></tr><tr><td id="L641" class="css-a4x74f"><span>641</span></td><td id="LC641" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> ms = value.getTime();
</code></td></tr><tr><td id="L642" class="css-a4x74f"><span>642</span></td><td id="LC642" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> s = <span class="code-built_in">Math</span>.floor(ms / <span class="code-number">1e3</span>);
</code></td></tr><tr><td id="L643" class="css-a4x74f"><span>643</span></td><td id="LC643" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> ns = (ms - s * <span class="code-number">1e3</span>) * <span class="code-number">1e6</span>;
</code></td></tr><tr><td id="L644" class="css-a4x74f"><span>644</span></td><td id="LC644" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (s &gt;= <span class="code-number">0</span> &amp;&amp; ns &gt;= <span class="code-number">0</span> &amp;&amp; s &lt;= TIMESTAMP64_MAX_SEC) {
</code></td></tr><tr><td id="L645" class="css-a4x74f"><span>645</span></td><td id="LC645" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (ns === <span class="code-number">0</span> &amp;&amp; s &lt;= TIMESTAMP32_MAX_SEC) {
</code></td></tr><tr><td id="L646" class="css-a4x74f"><span>646</span></td><td id="LC646" class="css-1dcdqdg"><code>                        <span class="code-comment">// timestamp 32</span>
</code></td></tr><tr><td id="L647" class="css-a4x74f"><span>647</span></td><td id="LC647" class="css-1dcdqdg"><code>                        bytes.push(<span class="code-number">0xd6</span>, <span class="code-number">0xff</span>, s &gt;&gt; <span class="code-number">24</span>, s &gt;&gt; <span class="code-number">16</span>, s &gt;&gt; <span class="code-number">8</span>, s);
</code></td></tr><tr><td id="L648" class="css-a4x74f"><span>648</span></td><td id="LC648" class="css-1dcdqdg"><code>                        <span class="code-keyword">return</span> <span class="code-number">6</span>;
</code></td></tr><tr><td id="L649" class="css-a4x74f"><span>649</span></td><td id="LC649" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L650" class="css-a4x74f"><span>650</span></td><td id="LC650" class="css-1dcdqdg"><code>                    <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L651" class="css-a4x74f"><span>651</span></td><td id="LC651" class="css-1dcdqdg"><code>                        <span class="code-comment">// timestamp 64</span>
</code></td></tr><tr><td id="L652" class="css-a4x74f"><span>652</span></td><td id="LC652" class="css-1dcdqdg"><code>                        hi = s / <span class="code-number">0x100000000</span>;
</code></td></tr><tr><td id="L653" class="css-a4x74f"><span>653</span></td><td id="LC653" class="css-1dcdqdg"><code>                        lo = s &amp; <span class="code-number">0xffffffff</span>;
</code></td></tr><tr><td id="L654" class="css-a4x74f"><span>654</span></td><td id="LC654" class="css-1dcdqdg"><code>                        bytes.push(<span class="code-number">0xd7</span>, <span class="code-number">0xff</span>, ns &gt;&gt; <span class="code-number">22</span>, ns &gt;&gt; <span class="code-number">14</span>, ns &gt;&gt; <span class="code-number">6</span>, hi, lo &gt;&gt; <span class="code-number">24</span>, lo &gt;&gt; <span class="code-number">16</span>, lo &gt;&gt; <span class="code-number">8</span>, lo);
</code></td></tr><tr><td id="L655" class="css-a4x74f"><span>655</span></td><td id="LC655" class="css-1dcdqdg"><code>                        <span class="code-keyword">return</span> <span class="code-number">10</span>;
</code></td></tr><tr><td id="L656" class="css-a4x74f"><span>656</span></td><td id="LC656" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L657" class="css-a4x74f"><span>657</span></td><td id="LC657" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L658" class="css-a4x74f"><span>658</span></td><td id="LC658" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L659" class="css-a4x74f"><span>659</span></td><td id="LC659" class="css-1dcdqdg"><code>                    <span class="code-comment">// timestamp 96</span>
</code></td></tr><tr><td id="L660" class="css-a4x74f"><span>660</span></td><td id="LC660" class="css-1dcdqdg"><code>                    hi = <span class="code-built_in">Math</span>.floor(s / <span class="code-number">0x100000000</span>);
</code></td></tr><tr><td id="L661" class="css-a4x74f"><span>661</span></td><td id="LC661" class="css-1dcdqdg"><code>                    lo = s &gt;&gt;&gt; <span class="code-number">0</span>;
</code></td></tr><tr><td id="L662" class="css-a4x74f"><span>662</span></td><td id="LC662" class="css-1dcdqdg"><code>                    bytes.push(<span class="code-number">0xc7</span>, <span class="code-number">0x0c</span>, <span class="code-number">0xff</span>, ns &gt;&gt; <span class="code-number">24</span>, ns &gt;&gt; <span class="code-number">16</span>, ns &gt;&gt; <span class="code-number">8</span>, ns, hi &gt;&gt; <span class="code-number">24</span>, hi &gt;&gt; <span class="code-number">16</span>, hi &gt;&gt; <span class="code-number">8</span>, hi, lo &gt;&gt; <span class="code-number">24</span>, lo &gt;&gt; <span class="code-number">16</span>, lo &gt;&gt; <span class="code-number">8</span>, lo);
</code></td></tr><tr><td id="L663" class="css-a4x74f"><span>663</span></td><td id="LC663" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-number">15</span>;
</code></td></tr><tr><td id="L664" class="css-a4x74f"><span>664</span></td><td id="LC664" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L665" class="css-a4x74f"><span>665</span></td><td id="LC665" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L666" class="css-a4x74f"><span>666</span></td><td id="LC666" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (value <span class="code-keyword">instanceof</span> <span class="code-built_in">ArrayBuffer</span>) {
</code></td></tr><tr><td id="L667" class="css-a4x74f"><span>667</span></td><td id="LC667" class="css-1dcdqdg"><code>                length = value.byteLength;
</code></td></tr><tr><td id="L668" class="css-a4x74f"><span>668</span></td><td id="LC668" class="css-1dcdqdg"><code>                <span class="code-comment">// bin 8</span>
</code></td></tr><tr><td id="L669" class="css-a4x74f"><span>669</span></td><td id="LC669" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (length &lt; <span class="code-number">0x100</span>) {
</code></td></tr><tr><td id="L670" class="css-a4x74f"><span>670</span></td><td id="LC670" class="css-1dcdqdg"><code>                    bytes.push(<span class="code-number">0xc4</span>, length);
</code></td></tr><tr><td id="L671" class="css-a4x74f"><span>671</span></td><td id="LC671" class="css-1dcdqdg"><code>                    size = <span class="code-number">2</span>;
</code></td></tr><tr><td id="L672" class="css-a4x74f"><span>672</span></td><td id="LC672" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L673" class="css-a4x74f"><span>673</span></td><td id="LC673" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> 
</code></td></tr><tr><td id="L674" class="css-a4x74f"><span>674</span></td><td id="LC674" class="css-1dcdqdg"><code>                <span class="code-comment">// bin 16</span>
</code></td></tr><tr><td id="L675" class="css-a4x74f"><span>675</span></td><td id="LC675" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (length &lt; <span class="code-number">0x10000</span>) {
</code></td></tr><tr><td id="L676" class="css-a4x74f"><span>676</span></td><td id="LC676" class="css-1dcdqdg"><code>                    bytes.push(<span class="code-number">0xc5</span>, length &gt;&gt; <span class="code-number">8</span>, length);
</code></td></tr><tr><td id="L677" class="css-a4x74f"><span>677</span></td><td id="LC677" class="css-1dcdqdg"><code>                    size = <span class="code-number">3</span>;
</code></td></tr><tr><td id="L678" class="css-a4x74f"><span>678</span></td><td id="LC678" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L679" class="css-a4x74f"><span>679</span></td><td id="LC679" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> 
</code></td></tr><tr><td id="L680" class="css-a4x74f"><span>680</span></td><td id="LC680" class="css-1dcdqdg"><code>                <span class="code-comment">// bin 32</span>
</code></td></tr><tr><td id="L681" class="css-a4x74f"><span>681</span></td><td id="LC681" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (length &lt; <span class="code-number">0x100000000</span>) {
</code></td></tr><tr><td id="L682" class="css-a4x74f"><span>682</span></td><td id="LC682" class="css-1dcdqdg"><code>                    bytes.push(<span class="code-number">0xc6</span>, length &gt;&gt; <span class="code-number">24</span>, length &gt;&gt; <span class="code-number">16</span>, length &gt;&gt; <span class="code-number">8</span>, length);
</code></td></tr><tr><td id="L683" class="css-a4x74f"><span>683</span></td><td id="LC683" class="css-1dcdqdg"><code>                    size = <span class="code-number">5</span>;
</code></td></tr><tr><td id="L684" class="css-a4x74f"><span>684</span></td><td id="LC684" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L685" class="css-a4x74f"><span>685</span></td><td id="LC685" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L686" class="css-a4x74f"><span>686</span></td><td id="LC686" class="css-1dcdqdg"><code>                    <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">'Buffer too large'</span>);
</code></td></tr><tr><td id="L687" class="css-a4x74f"><span>687</span></td><td id="LC687" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L688" class="css-a4x74f"><span>688</span></td><td id="LC688" class="css-1dcdqdg"><code>                defers.push({ <span class="code-attr">_bin</span>: value, <span class="code-attr">_length</span>: length, <span class="code-attr">_offset</span>: bytes.length });
</code></td></tr><tr><td id="L689" class="css-a4x74f"><span>689</span></td><td id="LC689" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> size + length;
</code></td></tr><tr><td id="L690" class="css-a4x74f"><span>690</span></td><td id="LC690" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L691" class="css-a4x74f"><span>691</span></td><td id="LC691" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> value.toJSON === <span class="code-string">'function'</span>) {
</code></td></tr><tr><td id="L692" class="css-a4x74f"><span>692</span></td><td id="LC692" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> _encode(bytes, defers, value.toJSON());
</code></td></tr><tr><td id="L693" class="css-a4x74f"><span>693</span></td><td id="LC693" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L694" class="css-a4x74f"><span>694</span></td><td id="LC694" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> keys = [], key = <span class="code-string">''</span>;
</code></td></tr><tr><td id="L695" class="css-a4x74f"><span>695</span></td><td id="LC695" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> allKeys = <span class="code-built_in">Object</span>.keys(value);
</code></td></tr><tr><td id="L696" class="css-a4x74f"><span>696</span></td><td id="LC696" class="css-1dcdqdg"><code>            <span class="code-keyword">for</span> (i = <span class="code-number">0</span>, l = allKeys.length; i &lt; l; i++) {
</code></td></tr><tr><td id="L697" class="css-a4x74f"><span>697</span></td><td id="LC697" class="css-1dcdqdg"><code>                key = allKeys[i];
</code></td></tr><tr><td id="L698" class="css-a4x74f"><span>698</span></td><td id="LC698" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (value[key] !== <span class="code-literal">undefined</span> &amp;&amp; <span class="code-keyword">typeof</span> value[key] !== <span class="code-string">'function'</span>) {
</code></td></tr><tr><td id="L699" class="css-a4x74f"><span>699</span></td><td id="LC699" class="css-1dcdqdg"><code>                    keys.push(key);
</code></td></tr><tr><td id="L700" class="css-a4x74f"><span>700</span></td><td id="LC700" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L701" class="css-a4x74f"><span>701</span></td><td id="LC701" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L702" class="css-a4x74f"><span>702</span></td><td id="LC702" class="css-1dcdqdg"><code>            length = keys.length;
</code></td></tr><tr><td id="L703" class="css-a4x74f"><span>703</span></td><td id="LC703" class="css-1dcdqdg"><code>            <span class="code-comment">// fixmap</span>
</code></td></tr><tr><td id="L704" class="css-a4x74f"><span>704</span></td><td id="LC704" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (length &lt; <span class="code-number">0x10</span>) {
</code></td></tr><tr><td id="L705" class="css-a4x74f"><span>705</span></td><td id="LC705" class="css-1dcdqdg"><code>                bytes.push(length | <span class="code-number">0x80</span>);
</code></td></tr><tr><td id="L706" class="css-a4x74f"><span>706</span></td><td id="LC706" class="css-1dcdqdg"><code>                size = <span class="code-number">1</span>;
</code></td></tr><tr><td id="L707" class="css-a4x74f"><span>707</span></td><td id="LC707" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L708" class="css-a4x74f"><span>708</span></td><td id="LC708" class="css-1dcdqdg"><code>            <span class="code-comment">// map 16</span>
</code></td></tr><tr><td id="L709" class="css-a4x74f"><span>709</span></td><td id="LC709" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (length &lt; <span class="code-number">0x10000</span>) {
</code></td></tr><tr><td id="L710" class="css-a4x74f"><span>710</span></td><td id="LC710" class="css-1dcdqdg"><code>                bytes.push(<span class="code-number">0xde</span>, length &gt;&gt; <span class="code-number">8</span>, length);
</code></td></tr><tr><td id="L711" class="css-a4x74f"><span>711</span></td><td id="LC711" class="css-1dcdqdg"><code>                size = <span class="code-number">3</span>;
</code></td></tr><tr><td id="L712" class="css-a4x74f"><span>712</span></td><td id="LC712" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L713" class="css-a4x74f"><span>713</span></td><td id="LC713" class="css-1dcdqdg"><code>            <span class="code-comment">// map 32</span>
</code></td></tr><tr><td id="L714" class="css-a4x74f"><span>714</span></td><td id="LC714" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (length &lt; <span class="code-number">0x100000000</span>) {
</code></td></tr><tr><td id="L715" class="css-a4x74f"><span>715</span></td><td id="LC715" class="css-1dcdqdg"><code>                bytes.push(<span class="code-number">0xdf</span>, length &gt;&gt; <span class="code-number">24</span>, length &gt;&gt; <span class="code-number">16</span>, length &gt;&gt; <span class="code-number">8</span>, length);
</code></td></tr><tr><td id="L716" class="css-a4x74f"><span>716</span></td><td id="LC716" class="css-1dcdqdg"><code>                size = <span class="code-number">5</span>;
</code></td></tr><tr><td id="L717" class="css-a4x74f"><span>717</span></td><td id="LC717" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L718" class="css-a4x74f"><span>718</span></td><td id="LC718" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L719" class="css-a4x74f"><span>719</span></td><td id="LC719" class="css-1dcdqdg"><code>                <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">'Object too large'</span>);
</code></td></tr><tr><td id="L720" class="css-a4x74f"><span>720</span></td><td id="LC720" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L721" class="css-a4x74f"><span>721</span></td><td id="LC721" class="css-1dcdqdg"><code>            <span class="code-keyword">for</span> (i = <span class="code-number">0</span>; i &lt; length; i++) {
</code></td></tr><tr><td id="L722" class="css-a4x74f"><span>722</span></td><td id="LC722" class="css-1dcdqdg"><code>                key = keys[i];
</code></td></tr><tr><td id="L723" class="css-a4x74f"><span>723</span></td><td id="LC723" class="css-1dcdqdg"><code>                size += _encode(bytes, defers, key);
</code></td></tr><tr><td id="L724" class="css-a4x74f"><span>724</span></td><td id="LC724" class="css-1dcdqdg"><code>                size += _encode(bytes, defers, value[key]);
</code></td></tr><tr><td id="L725" class="css-a4x74f"><span>725</span></td><td id="LC725" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L726" class="css-a4x74f"><span>726</span></td><td id="LC726" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> size;
</code></td></tr><tr><td id="L727" class="css-a4x74f"><span>727</span></td><td id="LC727" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L728" class="css-a4x74f"><span>728</span></td><td id="LC728" class="css-1dcdqdg"><code>        <span class="code-comment">// false/true</span>
</code></td></tr><tr><td id="L729" class="css-a4x74f"><span>729</span></td><td id="LC729" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (type === <span class="code-string">'boolean'</span>) {
</code></td></tr><tr><td id="L730" class="css-a4x74f"><span>730</span></td><td id="LC730" class="css-1dcdqdg"><code>            bytes.push(value ? <span class="code-number">0xc3</span> : <span class="code-number">0xc2</span>);
</code></td></tr><tr><td id="L731" class="css-a4x74f"><span>731</span></td><td id="LC731" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> <span class="code-number">1</span>;
</code></td></tr><tr><td id="L732" class="css-a4x74f"><span>732</span></td><td id="LC732" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L733" class="css-a4x74f"><span>733</span></td><td id="LC733" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (type === <span class="code-string">'undefined'</span>) {
</code></td></tr><tr><td id="L734" class="css-a4x74f"><span>734</span></td><td id="LC734" class="css-1dcdqdg"><code>            bytes.push(<span class="code-number">0xc0</span>);
</code></td></tr><tr><td id="L735" class="css-a4x74f"><span>735</span></td><td id="LC735" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> <span class="code-number">1</span>;
</code></td></tr><tr><td id="L736" class="css-a4x74f"><span>736</span></td><td id="LC736" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L737" class="css-a4x74f"><span>737</span></td><td id="LC737" class="css-1dcdqdg"><code>        <span class="code-comment">// custom types like BigInt (typeof value === 'bigint')</span>
</code></td></tr><tr><td id="L738" class="css-a4x74f"><span>738</span></td><td id="LC738" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> value.toJSON === <span class="code-string">'function'</span>) {
</code></td></tr><tr><td id="L739" class="css-a4x74f"><span>739</span></td><td id="LC739" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> _encode(bytes, defers, value.toJSON());
</code></td></tr><tr><td id="L740" class="css-a4x74f"><span>740</span></td><td id="LC740" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L741" class="css-a4x74f"><span>741</span></td><td id="LC741" class="css-1dcdqdg"><code>        <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">'Could not encode'</span>);
</code></td></tr><tr><td id="L742" class="css-a4x74f"><span>742</span></td><td id="LC742" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L743" class="css-a4x74f"><span>743</span></td><td id="LC743" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">encode</span>(<span class="code-params">value</span>) </span>{
</code></td></tr><tr><td id="L744" class="css-a4x74f"><span>744</span></td><td id="LC744" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> bytes = [];
</code></td></tr><tr><td id="L745" class="css-a4x74f"><span>745</span></td><td id="LC745" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> defers = [];
</code></td></tr><tr><td id="L746" class="css-a4x74f"><span>746</span></td><td id="LC746" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> size = _encode(bytes, defers, value);
</code></td></tr><tr><td id="L747" class="css-a4x74f"><span>747</span></td><td id="LC747" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> buf = <span class="code-keyword">new</span> <span class="code-built_in">ArrayBuffer</span>(size);
</code></td></tr><tr><td id="L748" class="css-a4x74f"><span>748</span></td><td id="LC748" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> view = <span class="code-keyword">new</span> <span class="code-built_in">DataView</span>(buf);
</code></td></tr><tr><td id="L749" class="css-a4x74f"><span>749</span></td><td id="LC749" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> deferIndex = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L750" class="css-a4x74f"><span>750</span></td><td id="LC750" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> deferWritten = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L751" class="css-a4x74f"><span>751</span></td><td id="LC751" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> nextOffset = <span class="code-number">-1</span>;
</code></td></tr><tr><td id="L752" class="css-a4x74f"><span>752</span></td><td id="LC752" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (defers.length &gt; <span class="code-number">0</span>) {
</code></td></tr><tr><td id="L753" class="css-a4x74f"><span>753</span></td><td id="LC753" class="css-1dcdqdg"><code>            nextOffset = defers[<span class="code-number">0</span>]._offset;
</code></td></tr><tr><td id="L754" class="css-a4x74f"><span>754</span></td><td id="LC754" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L755" class="css-a4x74f"><span>755</span></td><td id="LC755" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> defer, deferLength = <span class="code-number">0</span>, offset = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L756" class="css-a4x74f"><span>756</span></td><td id="LC756" class="css-1dcdqdg"><code>        <span class="code-keyword">for</span> (<span class="code-keyword">var</span> i = <span class="code-number">0</span>, l = bytes.length; i &lt; l; i++) {
</code></td></tr><tr><td id="L757" class="css-a4x74f"><span>757</span></td><td id="LC757" class="css-1dcdqdg"><code>            view.setUint8(deferWritten + i, bytes[i]);
</code></td></tr><tr><td id="L758" class="css-a4x74f"><span>758</span></td><td id="LC758" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (i + <span class="code-number">1</span> !== nextOffset) {
</code></td></tr><tr><td id="L759" class="css-a4x74f"><span>759</span></td><td id="LC759" class="css-1dcdqdg"><code>                <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L760" class="css-a4x74f"><span>760</span></td><td id="LC760" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L761" class="css-a4x74f"><span>761</span></td><td id="LC761" class="css-1dcdqdg"><code>            defer = defers[deferIndex];
</code></td></tr><tr><td id="L762" class="css-a4x74f"><span>762</span></td><td id="LC762" class="css-1dcdqdg"><code>            deferLength = defer._length;
</code></td></tr><tr><td id="L763" class="css-a4x74f"><span>763</span></td><td id="LC763" class="css-1dcdqdg"><code>            offset = deferWritten + nextOffset;
</code></td></tr><tr><td id="L764" class="css-a4x74f"><span>764</span></td><td id="LC764" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (defer._bin) {
</code></td></tr><tr><td id="L765" class="css-a4x74f"><span>765</span></td><td id="LC765" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> bin = <span class="code-keyword">new</span> <span class="code-built_in">Uint8Array</span>(defer._bin);
</code></td></tr><tr><td id="L766" class="css-a4x74f"><span>766</span></td><td id="LC766" class="css-1dcdqdg"><code>                <span class="code-keyword">for</span> (<span class="code-keyword">var</span> j = <span class="code-number">0</span>; j &lt; deferLength; j++) {
</code></td></tr><tr><td id="L767" class="css-a4x74f"><span>767</span></td><td id="LC767" class="css-1dcdqdg"><code>                    view.setUint8(offset + j, bin[j]);
</code></td></tr><tr><td id="L768" class="css-a4x74f"><span>768</span></td><td id="LC768" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L769" class="css-a4x74f"><span>769</span></td><td id="LC769" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L770" class="css-a4x74f"><span>770</span></td><td id="LC770" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (defer._str) {
</code></td></tr><tr><td id="L771" class="css-a4x74f"><span>771</span></td><td id="LC771" class="css-1dcdqdg"><code>                utf8Write(view, offset, defer._str);
</code></td></tr><tr><td id="L772" class="css-a4x74f"><span>772</span></td><td id="LC772" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L773" class="css-a4x74f"><span>773</span></td><td id="LC773" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (defer._float !== <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L774" class="css-a4x74f"><span>774</span></td><td id="LC774" class="css-1dcdqdg"><code>                view.setFloat64(offset, defer._float);
</code></td></tr><tr><td id="L775" class="css-a4x74f"><span>775</span></td><td id="LC775" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L776" class="css-a4x74f"><span>776</span></td><td id="LC776" class="css-1dcdqdg"><code>            deferIndex++;
</code></td></tr><tr><td id="L777" class="css-a4x74f"><span>777</span></td><td id="LC777" class="css-1dcdqdg"><code>            deferWritten += deferLength;
</code></td></tr><tr><td id="L778" class="css-a4x74f"><span>778</span></td><td id="LC778" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (defers[deferIndex]) {
</code></td></tr><tr><td id="L779" class="css-a4x74f"><span>779</span></td><td id="LC779" class="css-1dcdqdg"><code>                nextOffset = defers[deferIndex]._offset;
</code></td></tr><tr><td id="L780" class="css-a4x74f"><span>780</span></td><td id="LC780" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L781" class="css-a4x74f"><span>781</span></td><td id="LC781" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L782" class="css-a4x74f"><span>782</span></td><td id="LC782" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> buf;
</code></td></tr><tr><td id="L783" class="css-a4x74f"><span>783</span></td><td id="LC783" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L784" class="css-a4x74f"><span>784</span></td><td id="LC784" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L785" class="css-a4x74f"><span>785</span></td><td id="LC785" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> browser = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L786" class="css-a4x74f"><span>786</span></td><td id="LC786" class="css-1dcdqdg"><code>      <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(
</code></td></tr><tr><td id="L787" class="css-a4x74f"><span>787</span></td><td id="LC787" class="css-1dcdqdg"><code>        <span class="code-string">'ws does not work in the browser. Browser clients must use the native '</span> +
</code></td></tr><tr><td id="L788" class="css-a4x74f"><span>788</span></td><td id="LC788" class="css-1dcdqdg"><code>          <span class="code-string">'WebSocket object'</span>
</code></td></tr><tr><td id="L789" class="css-a4x74f"><span>789</span></td><td id="LC789" class="css-1dcdqdg"><code>      );
</code></td></tr><tr><td id="L790" class="css-a4x74f"><span>790</span></td><td id="LC790" class="css-1dcdqdg"><code>    };
</code></td></tr><tr><td id="L791" class="css-a4x74f"><span>791</span></td><td id="LC791" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L792" class="css-a4x74f"><span>792</span></td><td id="LC792" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> WebSocket = globalThis.WebSocket || browser;
</code></td></tr><tr><td id="L793" class="css-a4x74f"><span>793</span></td><td id="LC793" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> WebSocketTransport = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L794" class="css-a4x74f"><span>794</span></td><td id="LC794" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">WebSocketTransport</span>(<span class="code-params">events</span>) </span>{
</code></td></tr><tr><td id="L795" class="css-a4x74f"><span>795</span></td><td id="LC795" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.events = events;
</code></td></tr><tr><td id="L796" class="css-a4x74f"><span>796</span></td><td id="LC796" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L797" class="css-a4x74f"><span>797</span></td><td id="LC797" class="css-1dcdqdg"><code>        WebSocketTransport.prototype.send = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">data</span>) </span>{
</code></td></tr><tr><td id="L798" class="css-a4x74f"><span>798</span></td><td id="LC798" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (data <span class="code-keyword">instanceof</span> <span class="code-built_in">ArrayBuffer</span>) {
</code></td></tr><tr><td id="L799" class="css-a4x74f"><span>799</span></td><td id="LC799" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.ws.send(data);
</code></td></tr><tr><td id="L800" class="css-a4x74f"><span>800</span></td><td id="LC800" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L801" class="css-a4x74f"><span>801</span></td><td id="LC801" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (<span class="code-built_in">Array</span>.isArray(data)) {
</code></td></tr><tr><td id="L802" class="css-a4x74f"><span>802</span></td><td id="LC802" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.ws.send((<span class="code-keyword">new</span> <span class="code-built_in">Uint8Array</span>(data)).buffer);
</code></td></tr><tr><td id="L803" class="css-a4x74f"><span>803</span></td><td id="LC803" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L804" class="css-a4x74f"><span>804</span></td><td id="LC804" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L805" class="css-a4x74f"><span>805</span></td><td id="LC805" class="css-1dcdqdg"><code>        WebSocketTransport.prototype.connect = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">url</span>) </span>{
</code></td></tr><tr><td id="L806" class="css-a4x74f"><span>806</span></td><td id="LC806" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.ws = <span class="code-keyword">new</span> WebSocket(url, <span class="code-keyword">this</span>.protocols);
</code></td></tr><tr><td id="L807" class="css-a4x74f"><span>807</span></td><td id="LC807" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.ws.binaryType = <span class="code-string">'arraybuffer'</span>;
</code></td></tr><tr><td id="L808" class="css-a4x74f"><span>808</span></td><td id="LC808" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.ws.onopen = <span class="code-keyword">this</span>.events.onopen;
</code></td></tr><tr><td id="L809" class="css-a4x74f"><span>809</span></td><td id="LC809" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.ws.onmessage = <span class="code-keyword">this</span>.events.onmessage;
</code></td></tr><tr><td id="L810" class="css-a4x74f"><span>810</span></td><td id="LC810" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.ws.onclose = <span class="code-keyword">this</span>.events.onclose;
</code></td></tr><tr><td id="L811" class="css-a4x74f"><span>811</span></td><td id="LC811" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.ws.onerror = <span class="code-keyword">this</span>.events.onerror;
</code></td></tr><tr><td id="L812" class="css-a4x74f"><span>812</span></td><td id="LC812" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L813" class="css-a4x74f"><span>813</span></td><td id="LC813" class="css-1dcdqdg"><code>        WebSocketTransport.prototype.close = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">code, reason</span>) </span>{
</code></td></tr><tr><td id="L814" class="css-a4x74f"><span>814</span></td><td id="LC814" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.ws.close(code, reason);
</code></td></tr><tr><td id="L815" class="css-a4x74f"><span>815</span></td><td id="LC815" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L816" class="css-a4x74f"><span>816</span></td><td id="LC816" class="css-1dcdqdg"><code>        <span class="code-built_in">Object</span>.defineProperty(WebSocketTransport.prototype, <span class="code-string">"isOpen"</span>, {
</code></td></tr><tr><td id="L817" class="css-a4x74f"><span>817</span></td><td id="LC817" class="css-1dcdqdg"><code>            <span class="code-keyword">get</span>: function () {
</code></td></tr><tr><td id="L818" class="css-a4x74f"><span>818</span></td><td id="LC818" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.ws.readyState === WebSocket.OPEN;
</code></td></tr><tr><td id="L819" class="css-a4x74f"><span>819</span></td><td id="LC819" class="css-1dcdqdg"><code>            },
</code></td></tr><tr><td id="L820" class="css-a4x74f"><span>820</span></td><td id="LC820" class="css-1dcdqdg"><code>            enumerable: <span class="code-literal">false</span>,
</code></td></tr><tr><td id="L821" class="css-a4x74f"><span>821</span></td><td id="LC821" class="css-1dcdqdg"><code>            configurable: <span class="code-literal">true</span>
</code></td></tr><tr><td id="L822" class="css-a4x74f"><span>822</span></td><td id="LC822" class="css-1dcdqdg"><code>        });
</code></td></tr><tr><td id="L823" class="css-a4x74f"><span>823</span></td><td id="LC823" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> WebSocketTransport;
</code></td></tr><tr><td id="L824" class="css-a4x74f"><span>824</span></td><td id="LC824" class="css-1dcdqdg"><code>    }());
</code></td></tr><tr><td id="L825" class="css-a4x74f"><span>825</span></td><td id="LC825" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L826" class="css-a4x74f"><span>826</span></td><td id="LC826" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> Connection = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L827" class="css-a4x74f"><span>827</span></td><td id="LC827" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">Connection</span>(<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L828" class="css-a4x74f"><span>828</span></td><td id="LC828" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.events = {};
</code></td></tr><tr><td id="L829" class="css-a4x74f"><span>829</span></td><td id="LC829" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.transport = <span class="code-keyword">new</span> WebSocketTransport(<span class="code-keyword">this</span>.events);
</code></td></tr><tr><td id="L830" class="css-a4x74f"><span>830</span></td><td id="LC830" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L831" class="css-a4x74f"><span>831</span></td><td id="LC831" class="css-1dcdqdg"><code>        Connection.prototype.send = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">data</span>) </span>{
</code></td></tr><tr><td id="L832" class="css-a4x74f"><span>832</span></td><td id="LC832" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.transport.send(data);
</code></td></tr><tr><td id="L833" class="css-a4x74f"><span>833</span></td><td id="LC833" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L834" class="css-a4x74f"><span>834</span></td><td id="LC834" class="css-1dcdqdg"><code>        Connection.prototype.connect = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">url</span>) </span>{
</code></td></tr><tr><td id="L835" class="css-a4x74f"><span>835</span></td><td id="LC835" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.transport.connect(url);
</code></td></tr><tr><td id="L836" class="css-a4x74f"><span>836</span></td><td id="LC836" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L837" class="css-a4x74f"><span>837</span></td><td id="LC837" class="css-1dcdqdg"><code>        Connection.prototype.close = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">code, reason</span>) </span>{
</code></td></tr><tr><td id="L838" class="css-a4x74f"><span>838</span></td><td id="LC838" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.transport.close(code, reason);
</code></td></tr><tr><td id="L839" class="css-a4x74f"><span>839</span></td><td id="LC839" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L840" class="css-a4x74f"><span>840</span></td><td id="LC840" class="css-1dcdqdg"><code>        <span class="code-built_in">Object</span>.defineProperty(Connection.prototype, <span class="code-string">"isOpen"</span>, {
</code></td></tr><tr><td id="L841" class="css-a4x74f"><span>841</span></td><td id="LC841" class="css-1dcdqdg"><code>            <span class="code-keyword">get</span>: function () {
</code></td></tr><tr><td id="L842" class="css-a4x74f"><span>842</span></td><td id="LC842" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.transport.isOpen;
</code></td></tr><tr><td id="L843" class="css-a4x74f"><span>843</span></td><td id="LC843" class="css-1dcdqdg"><code>            },
</code></td></tr><tr><td id="L844" class="css-a4x74f"><span>844</span></td><td id="LC844" class="css-1dcdqdg"><code>            enumerable: <span class="code-literal">false</span>,
</code></td></tr><tr><td id="L845" class="css-a4x74f"><span>845</span></td><td id="LC845" class="css-1dcdqdg"><code>            configurable: <span class="code-literal">true</span>
</code></td></tr><tr><td id="L846" class="css-a4x74f"><span>846</span></td><td id="LC846" class="css-1dcdqdg"><code>        });
</code></td></tr><tr><td id="L847" class="css-a4x74f"><span>847</span></td><td id="LC847" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> Connection;
</code></td></tr><tr><td id="L848" class="css-a4x74f"><span>848</span></td><td id="LC848" class="css-1dcdqdg"><code>    }());
</code></td></tr><tr><td id="L849" class="css-a4x74f"><span>849</span></td><td id="LC849" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L850" class="css-a4x74f"><span>850</span></td><td id="LC850" class="css-1dcdqdg"><code>    <span class="code-comment">// Use codes between 0~127 for lesser throughput (1 byte)</span>
</code></td></tr><tr><td id="L851" class="css-a4x74f"><span>851</span></td><td id="LC851" class="css-1dcdqdg"><code>    exports.Protocol = <span class="code-keyword">void</span> <span class="code-number">0</span>;
</code></td></tr><tr><td id="L852" class="css-a4x74f"><span>852</span></td><td id="LC852" class="css-1dcdqdg"><code>    (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">Protocol</span>) </span>{
</code></td></tr><tr><td id="L853" class="css-a4x74f"><span>853</span></td><td id="LC853" class="css-1dcdqdg"><code>        <span class="code-comment">// Room-related (10~19)</span>
</code></td></tr><tr><td id="L854" class="css-a4x74f"><span>854</span></td><td id="LC854" class="css-1dcdqdg"><code>        Protocol[Protocol[<span class="code-string">"HANDSHAKE"</span>] = <span class="code-number">9</span>] = <span class="code-string">"HANDSHAKE"</span>;
</code></td></tr><tr><td id="L855" class="css-a4x74f"><span>855</span></td><td id="LC855" class="css-1dcdqdg"><code>        Protocol[Protocol[<span class="code-string">"JOIN_ROOM"</span>] = <span class="code-number">10</span>] = <span class="code-string">"JOIN_ROOM"</span>;
</code></td></tr><tr><td id="L856" class="css-a4x74f"><span>856</span></td><td id="LC856" class="css-1dcdqdg"><code>        Protocol[Protocol[<span class="code-string">"ERROR"</span>] = <span class="code-number">11</span>] = <span class="code-string">"ERROR"</span>;
</code></td></tr><tr><td id="L857" class="css-a4x74f"><span>857</span></td><td id="LC857" class="css-1dcdqdg"><code>        Protocol[Protocol[<span class="code-string">"LEAVE_ROOM"</span>] = <span class="code-number">12</span>] = <span class="code-string">"LEAVE_ROOM"</span>;
</code></td></tr><tr><td id="L858" class="css-a4x74f"><span>858</span></td><td id="LC858" class="css-1dcdqdg"><code>        Protocol[Protocol[<span class="code-string">"ROOM_DATA"</span>] = <span class="code-number">13</span>] = <span class="code-string">"ROOM_DATA"</span>;
</code></td></tr><tr><td id="L859" class="css-a4x74f"><span>859</span></td><td id="LC859" class="css-1dcdqdg"><code>        Protocol[Protocol[<span class="code-string">"ROOM_STATE"</span>] = <span class="code-number">14</span>] = <span class="code-string">"ROOM_STATE"</span>;
</code></td></tr><tr><td id="L860" class="css-a4x74f"><span>860</span></td><td id="LC860" class="css-1dcdqdg"><code>        Protocol[Protocol[<span class="code-string">"ROOM_STATE_PATCH"</span>] = <span class="code-number">15</span>] = <span class="code-string">"ROOM_STATE_PATCH"</span>;
</code></td></tr><tr><td id="L861" class="css-a4x74f"><span>861</span></td><td id="LC861" class="css-1dcdqdg"><code>        Protocol[Protocol[<span class="code-string">"ROOM_DATA_SCHEMA"</span>] = <span class="code-number">16</span>] = <span class="code-string">"ROOM_DATA_SCHEMA"</span>;
</code></td></tr><tr><td id="L862" class="css-a4x74f"><span>862</span></td><td id="LC862" class="css-1dcdqdg"><code>        Protocol[Protocol[<span class="code-string">"ROOM_DATA_BYTES"</span>] = <span class="code-number">17</span>] = <span class="code-string">"ROOM_DATA_BYTES"</span>;
</code></td></tr><tr><td id="L863" class="css-a4x74f"><span>863</span></td><td id="LC863" class="css-1dcdqdg"><code>    })(exports.Protocol || (exports.Protocol = {}));
</code></td></tr><tr><td id="L864" class="css-a4x74f"><span>864</span></td><td id="LC864" class="css-1dcdqdg"><code>    exports.ErrorCode = <span class="code-keyword">void</span> <span class="code-number">0</span>;
</code></td></tr><tr><td id="L865" class="css-a4x74f"><span>865</span></td><td id="LC865" class="css-1dcdqdg"><code>    (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">ErrorCode</span>) </span>{
</code></td></tr><tr><td id="L866" class="css-a4x74f"><span>866</span></td><td id="LC866" class="css-1dcdqdg"><code>        ErrorCode[ErrorCode[<span class="code-string">"MATCHMAKE_NO_HANDLER"</span>] = <span class="code-number">4210</span>] = <span class="code-string">"MATCHMAKE_NO_HANDLER"</span>;
</code></td></tr><tr><td id="L867" class="css-a4x74f"><span>867</span></td><td id="LC867" class="css-1dcdqdg"><code>        ErrorCode[ErrorCode[<span class="code-string">"MATCHMAKE_INVALID_CRITERIA"</span>] = <span class="code-number">4211</span>] = <span class="code-string">"MATCHMAKE_INVALID_CRITERIA"</span>;
</code></td></tr><tr><td id="L868" class="css-a4x74f"><span>868</span></td><td id="LC868" class="css-1dcdqdg"><code>        ErrorCode[ErrorCode[<span class="code-string">"MATCHMAKE_INVALID_ROOM_ID"</span>] = <span class="code-number">4212</span>] = <span class="code-string">"MATCHMAKE_INVALID_ROOM_ID"</span>;
</code></td></tr><tr><td id="L869" class="css-a4x74f"><span>869</span></td><td id="LC869" class="css-1dcdqdg"><code>        ErrorCode[ErrorCode[<span class="code-string">"MATCHMAKE_UNHANDLED"</span>] = <span class="code-number">4213</span>] = <span class="code-string">"MATCHMAKE_UNHANDLED"</span>;
</code></td></tr><tr><td id="L870" class="css-a4x74f"><span>870</span></td><td id="LC870" class="css-1dcdqdg"><code>        ErrorCode[ErrorCode[<span class="code-string">"MATCHMAKE_EXPIRED"</span>] = <span class="code-number">4214</span>] = <span class="code-string">"MATCHMAKE_EXPIRED"</span>;
</code></td></tr><tr><td id="L871" class="css-a4x74f"><span>871</span></td><td id="LC871" class="css-1dcdqdg"><code>        ErrorCode[ErrorCode[<span class="code-string">"AUTH_FAILED"</span>] = <span class="code-number">4215</span>] = <span class="code-string">"AUTH_FAILED"</span>;
</code></td></tr><tr><td id="L872" class="css-a4x74f"><span>872</span></td><td id="LC872" class="css-1dcdqdg"><code>        ErrorCode[ErrorCode[<span class="code-string">"APPLICATION_ERROR"</span>] = <span class="code-number">4216</span>] = <span class="code-string">"APPLICATION_ERROR"</span>;
</code></td></tr><tr><td id="L873" class="css-a4x74f"><span>873</span></td><td id="LC873" class="css-1dcdqdg"><code>    })(exports.ErrorCode || (exports.ErrorCode = {}));
</code></td></tr><tr><td id="L874" class="css-a4x74f"><span>874</span></td><td id="LC874" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">utf8Read</span>(<span class="code-params">view, offset</span>) </span>{
</code></td></tr><tr><td id="L875" class="css-a4x74f"><span>875</span></td><td id="LC875" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> length = view[offset++];
</code></td></tr><tr><td id="L876" class="css-a4x74f"><span>876</span></td><td id="LC876" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> string = <span class="code-string">''</span>, chr = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L877" class="css-a4x74f"><span>877</span></td><td id="LC877" class="css-1dcdqdg"><code>        <span class="code-keyword">for</span> (<span class="code-keyword">var</span> i = offset, end = offset + length; i &lt; end; i++) {
</code></td></tr><tr><td id="L878" class="css-a4x74f"><span>878</span></td><td id="LC878" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> byte = view[i];
</code></td></tr><tr><td id="L879" class="css-a4x74f"><span>879</span></td><td id="LC879" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> ((byte &amp; <span class="code-number">0x80</span>) === <span class="code-number">0x00</span>) {
</code></td></tr><tr><td id="L880" class="css-a4x74f"><span>880</span></td><td id="LC880" class="css-1dcdqdg"><code>                string += <span class="code-built_in">String</span>.fromCharCode(byte);
</code></td></tr><tr><td id="L881" class="css-a4x74f"><span>881</span></td><td id="LC881" class="css-1dcdqdg"><code>                <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L882" class="css-a4x74f"><span>882</span></td><td id="LC882" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L883" class="css-a4x74f"><span>883</span></td><td id="LC883" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> ((byte &amp; <span class="code-number">0xe0</span>) === <span class="code-number">0xc0</span>) {
</code></td></tr><tr><td id="L884" class="css-a4x74f"><span>884</span></td><td id="LC884" class="css-1dcdqdg"><code>                string += <span class="code-built_in">String</span>.fromCharCode(((byte &amp; <span class="code-number">0x1f</span>) &lt;&lt; <span class="code-number">6</span>) |
</code></td></tr><tr><td id="L885" class="css-a4x74f"><span>885</span></td><td id="LC885" class="css-1dcdqdg"><code>                    (view[++i] &amp; <span class="code-number">0x3f</span>));
</code></td></tr><tr><td id="L886" class="css-a4x74f"><span>886</span></td><td id="LC886" class="css-1dcdqdg"><code>                <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L887" class="css-a4x74f"><span>887</span></td><td id="LC887" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L888" class="css-a4x74f"><span>888</span></td><td id="LC888" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> ((byte &amp; <span class="code-number">0xf0</span>) === <span class="code-number">0xe0</span>) {
</code></td></tr><tr><td id="L889" class="css-a4x74f"><span>889</span></td><td id="LC889" class="css-1dcdqdg"><code>                string += <span class="code-built_in">String</span>.fromCharCode(((byte &amp; <span class="code-number">0x0f</span>) &lt;&lt; <span class="code-number">12</span>) |
</code></td></tr><tr><td id="L890" class="css-a4x74f"><span>890</span></td><td id="LC890" class="css-1dcdqdg"><code>                    ((view[++i] &amp; <span class="code-number">0x3f</span>) &lt;&lt; <span class="code-number">6</span>) |
</code></td></tr><tr><td id="L891" class="css-a4x74f"><span>891</span></td><td id="LC891" class="css-1dcdqdg"><code>                    ((view[++i] &amp; <span class="code-number">0x3f</span>) &lt;&lt; <span class="code-number">0</span>));
</code></td></tr><tr><td id="L892" class="css-a4x74f"><span>892</span></td><td id="LC892" class="css-1dcdqdg"><code>                <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L893" class="css-a4x74f"><span>893</span></td><td id="LC893" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L894" class="css-a4x74f"><span>894</span></td><td id="LC894" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> ((byte &amp; <span class="code-number">0xf8</span>) === <span class="code-number">0xf0</span>) {
</code></td></tr><tr><td id="L895" class="css-a4x74f"><span>895</span></td><td id="LC895" class="css-1dcdqdg"><code>                chr = ((byte &amp; <span class="code-number">0x07</span>) &lt;&lt; <span class="code-number">18</span>) |
</code></td></tr><tr><td id="L896" class="css-a4x74f"><span>896</span></td><td id="LC896" class="css-1dcdqdg"><code>                    ((view[++i] &amp; <span class="code-number">0x3f</span>) &lt;&lt; <span class="code-number">12</span>) |
</code></td></tr><tr><td id="L897" class="css-a4x74f"><span>897</span></td><td id="LC897" class="css-1dcdqdg"><code>                    ((view[++i] &amp; <span class="code-number">0x3f</span>) &lt;&lt; <span class="code-number">6</span>) |
</code></td></tr><tr><td id="L898" class="css-a4x74f"><span>898</span></td><td id="LC898" class="css-1dcdqdg"><code>                    ((view[++i] &amp; <span class="code-number">0x3f</span>) &lt;&lt; <span class="code-number">0</span>);
</code></td></tr><tr><td id="L899" class="css-a4x74f"><span>899</span></td><td id="LC899" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (chr &gt;= <span class="code-number">0x010000</span>) { <span class="code-comment">// surrogate pair</span>
</code></td></tr><tr><td id="L900" class="css-a4x74f"><span>900</span></td><td id="LC900" class="css-1dcdqdg"><code>                    chr -= <span class="code-number">0x010000</span>;
</code></td></tr><tr><td id="L901" class="css-a4x74f"><span>901</span></td><td id="LC901" class="css-1dcdqdg"><code>                    string += <span class="code-built_in">String</span>.fromCharCode((chr &gt;&gt;&gt; <span class="code-number">10</span>) + <span class="code-number">0xD800</span>, (chr &amp; <span class="code-number">0x3FF</span>) + <span class="code-number">0xDC00</span>);
</code></td></tr><tr><td id="L902" class="css-a4x74f"><span>902</span></td><td id="LC902" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L903" class="css-a4x74f"><span>903</span></td><td id="LC903" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L904" class="css-a4x74f"><span>904</span></td><td id="LC904" class="css-1dcdqdg"><code>                    string += <span class="code-built_in">String</span>.fromCharCode(chr);
</code></td></tr><tr><td id="L905" class="css-a4x74f"><span>905</span></td><td id="LC905" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L906" class="css-a4x74f"><span>906</span></td><td id="LC906" class="css-1dcdqdg"><code>                <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L907" class="css-a4x74f"><span>907</span></td><td id="LC907" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L908" class="css-a4x74f"><span>908</span></td><td id="LC908" class="css-1dcdqdg"><code>            <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">'Invalid byte '</span> + byte.toString(<span class="code-number">16</span>));
</code></td></tr><tr><td id="L909" class="css-a4x74f"><span>909</span></td><td id="LC909" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L910" class="css-a4x74f"><span>910</span></td><td id="LC910" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> string;
</code></td></tr><tr><td id="L911" class="css-a4x74f"><span>911</span></td><td id="LC911" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L912" class="css-a4x74f"><span>912</span></td><td id="LC912" class="css-1dcdqdg"><code>    <span class="code-comment">// Faster for short strings than Buffer.byteLength</span>
</code></td></tr><tr><td id="L913" class="css-a4x74f"><span>913</span></td><td id="LC913" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">utf8Length</span>(<span class="code-params">str</span>) </span>{
</code></td></tr><tr><td id="L914" class="css-a4x74f"><span>914</span></td><td id="LC914" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (str === <span class="code-keyword">void</span> <span class="code-number">0</span>) { str = <span class="code-string">''</span>; }
</code></td></tr><tr><td id="L915" class="css-a4x74f"><span>915</span></td><td id="LC915" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> c = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L916" class="css-a4x74f"><span>916</span></td><td id="LC916" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> length = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L917" class="css-a4x74f"><span>917</span></td><td id="LC917" class="css-1dcdqdg"><code>        <span class="code-keyword">for</span> (<span class="code-keyword">var</span> i = <span class="code-number">0</span>, l = str.length; i &lt; l; i++) {
</code></td></tr><tr><td id="L918" class="css-a4x74f"><span>918</span></td><td id="LC918" class="css-1dcdqdg"><code>            c = str.charCodeAt(i);
</code></td></tr><tr><td id="L919" class="css-a4x74f"><span>919</span></td><td id="LC919" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (c &lt; <span class="code-number">0x80</span>) {
</code></td></tr><tr><td id="L920" class="css-a4x74f"><span>920</span></td><td id="LC920" class="css-1dcdqdg"><code>                length += <span class="code-number">1</span>;
</code></td></tr><tr><td id="L921" class="css-a4x74f"><span>921</span></td><td id="LC921" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L922" class="css-a4x74f"><span>922</span></td><td id="LC922" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (c &lt; <span class="code-number">0x800</span>) {
</code></td></tr><tr><td id="L923" class="css-a4x74f"><span>923</span></td><td id="LC923" class="css-1dcdqdg"><code>                length += <span class="code-number">2</span>;
</code></td></tr><tr><td id="L924" class="css-a4x74f"><span>924</span></td><td id="LC924" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L925" class="css-a4x74f"><span>925</span></td><td id="LC925" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (c &lt; <span class="code-number">0xd800</span> || c &gt;= <span class="code-number">0xe000</span>) {
</code></td></tr><tr><td id="L926" class="css-a4x74f"><span>926</span></td><td id="LC926" class="css-1dcdqdg"><code>                length += <span class="code-number">3</span>;
</code></td></tr><tr><td id="L927" class="css-a4x74f"><span>927</span></td><td id="LC927" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L928" class="css-a4x74f"><span>928</span></td><td id="LC928" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L929" class="css-a4x74f"><span>929</span></td><td id="LC929" class="css-1dcdqdg"><code>                i++;
</code></td></tr><tr><td id="L930" class="css-a4x74f"><span>930</span></td><td id="LC930" class="css-1dcdqdg"><code>                length += <span class="code-number">4</span>;
</code></td></tr><tr><td id="L931" class="css-a4x74f"><span>931</span></td><td id="LC931" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L932" class="css-a4x74f"><span>932</span></td><td id="LC932" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L933" class="css-a4x74f"><span>933</span></td><td id="LC933" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> length + <span class="code-number">1</span>;
</code></td></tr><tr><td id="L934" class="css-a4x74f"><span>934</span></td><td id="LC934" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L935" class="css-a4x74f"><span>935</span></td><td id="LC935" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L936" class="css-a4x74f"><span>936</span></td><td id="LC936" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> serializers = {};
</code></td></tr><tr><td id="L937" class="css-a4x74f"><span>937</span></td><td id="LC937" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">registerSerializer</span>(<span class="code-params">id, serializer</span>) </span>{
</code></td></tr><tr><td id="L938" class="css-a4x74f"><span>938</span></td><td id="LC938" class="css-1dcdqdg"><code>        serializers[id] = serializer;
</code></td></tr><tr><td id="L939" class="css-a4x74f"><span>939</span></td><td id="LC939" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L940" class="css-a4x74f"><span>940</span></td><td id="LC940" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">getSerializer</span>(<span class="code-params">id</span>) </span>{
</code></td></tr><tr><td id="L941" class="css-a4x74f"><span>941</span></td><td id="LC941" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> serializer = serializers[id];
</code></td></tr><tr><td id="L942" class="css-a4x74f"><span>942</span></td><td id="LC942" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (!serializer) {
</code></td></tr><tr><td id="L943" class="css-a4x74f"><span>943</span></td><td id="LC943" class="css-1dcdqdg"><code>            <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">"missing serializer: "</span> + id);
</code></td></tr><tr><td id="L944" class="css-a4x74f"><span>944</span></td><td id="LC944" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L945" class="css-a4x74f"><span>945</span></td><td id="LC945" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> serializer;
</code></td></tr><tr><td id="L946" class="css-a4x74f"><span>946</span></td><td id="LC946" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L947" class="css-a4x74f"><span>947</span></td><td id="LC947" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L948" class="css-a4x74f"><span>948</span></td><td id="LC948" class="css-1dcdqdg"><code>    <span class="code-comment">/**
</span></code></td></tr><tr><td id="L949" class="css-a4x74f"><span>949</span></td><td id="LC949" class="css-1dcdqdg"><code><span class="code-comment">     * The MIT License (MIT)
</span></code></td></tr><tr><td id="L950" class="css-a4x74f"><span>950</span></td><td id="LC950" class="css-1dcdqdg"><code><span class="code-comment">     *
</span></code></td></tr><tr><td id="L951" class="css-a4x74f"><span>951</span></td><td id="LC951" class="css-1dcdqdg"><code><span class="code-comment">     * Copyright 2016 Andrey Sitnik &lt;andrey@sitnik.ru&gt;
</span></code></td></tr><tr><td id="L952" class="css-a4x74f"><span>952</span></td><td id="LC952" class="css-1dcdqdg"><code><span class="code-comment">     *
</span></code></td></tr><tr><td id="L953" class="css-a4x74f"><span>953</span></td><td id="LC953" class="css-1dcdqdg"><code><span class="code-comment">     * Permission is hereby granted, free of charge, to any person obtaining a copy of
</span></code></td></tr><tr><td id="L954" class="css-a4x74f"><span>954</span></td><td id="LC954" class="css-1dcdqdg"><code><span class="code-comment">     * this software and associated documentation files (the "Software"), to deal in
</span></code></td></tr><tr><td id="L955" class="css-a4x74f"><span>955</span></td><td id="LC955" class="css-1dcdqdg"><code><span class="code-comment">     * the Software without restriction, including without limitation the rights to
</span></code></td></tr><tr><td id="L956" class="css-a4x74f"><span>956</span></td><td id="LC956" class="css-1dcdqdg"><code><span class="code-comment">     * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
</span></code></td></tr><tr><td id="L957" class="css-a4x74f"><span>957</span></td><td id="LC957" class="css-1dcdqdg"><code><span class="code-comment">     * the Software, and to permit persons to whom the Software is furnished to do so,
</span></code></td></tr><tr><td id="L958" class="css-a4x74f"><span>958</span></td><td id="LC958" class="css-1dcdqdg"><code><span class="code-comment">     * subject to the following conditions:
</span></code></td></tr><tr><td id="L959" class="css-a4x74f"><span>959</span></td><td id="LC959" class="css-1dcdqdg"><code><span class="code-comment">     *
</span></code></td></tr><tr><td id="L960" class="css-a4x74f"><span>960</span></td><td id="LC960" class="css-1dcdqdg"><code><span class="code-comment">     * The above copyright notice and this permission notice shall be included in all
</span></code></td></tr><tr><td id="L961" class="css-a4x74f"><span>961</span></td><td id="LC961" class="css-1dcdqdg"><code><span class="code-comment">     * copies or substantial portions of the Software.
</span></code></td></tr><tr><td id="L962" class="css-a4x74f"><span>962</span></td><td id="LC962" class="css-1dcdqdg"><code><span class="code-comment">     *
</span></code></td></tr><tr><td id="L963" class="css-a4x74f"><span>963</span></td><td id="LC963" class="css-1dcdqdg"><code><span class="code-comment">     * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
</span></code></td></tr><tr><td id="L964" class="css-a4x74f"><span>964</span></td><td id="LC964" class="css-1dcdqdg"><code><span class="code-comment">     * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
</span></code></td></tr><tr><td id="L965" class="css-a4x74f"><span>965</span></td><td id="LC965" class="css-1dcdqdg"><code><span class="code-comment">     * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
</span></code></td></tr><tr><td id="L966" class="css-a4x74f"><span>966</span></td><td id="LC966" class="css-1dcdqdg"><code><span class="code-comment">     * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
</span></code></td></tr><tr><td id="L967" class="css-a4x74f"><span>967</span></td><td id="LC967" class="css-1dcdqdg"><code><span class="code-comment">     * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
</span></code></td></tr><tr><td id="L968" class="css-a4x74f"><span>968</span></td><td id="LC968" class="css-1dcdqdg"><code><span class="code-comment">     * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
</span></code></td></tr><tr><td id="L969" class="css-a4x74f"><span>969</span></td><td id="LC969" class="css-1dcdqdg"><code><span class="code-comment">     */</span>
</code></td></tr><tr><td id="L970" class="css-a4x74f"><span>970</span></td><td id="LC970" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> createNanoEvents = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{ <span class="code-keyword">return</span> ({
</code></td></tr><tr><td id="L971" class="css-a4x74f"><span>971</span></td><td id="LC971" class="css-1dcdqdg"><code>        emit: <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">event</span>) </span>{
</code></td></tr><tr><td id="L972" class="css-a4x74f"><span>972</span></td><td id="LC972" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> args = [];
</code></td></tr><tr><td id="L973" class="css-a4x74f"><span>973</span></td><td id="LC973" class="css-1dcdqdg"><code>            <span class="code-keyword">for</span> (<span class="code-keyword">var</span> _i = <span class="code-number">1</span>; _i &lt; <span class="code-built_in">arguments</span>.length; _i++) {
</code></td></tr><tr><td id="L974" class="css-a4x74f"><span>974</span></td><td id="LC974" class="css-1dcdqdg"><code>                args[_i - <span class="code-number">1</span>] = <span class="code-built_in">arguments</span>[_i];
</code></td></tr><tr><td id="L975" class="css-a4x74f"><span>975</span></td><td id="LC975" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L976" class="css-a4x74f"><span>976</span></td><td id="LC976" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> callbacks = <span class="code-keyword">this</span>.events[event] || [];
</code></td></tr><tr><td id="L977" class="css-a4x74f"><span>977</span></td><td id="LC977" class="css-1dcdqdg"><code>            <span class="code-keyword">for</span> (<span class="code-keyword">var</span> i = <span class="code-number">0</span>, length_1 = callbacks.length; i &lt; length_1; i++) {
</code></td></tr><tr><td id="L978" class="css-a4x74f"><span>978</span></td><td id="LC978" class="css-1dcdqdg"><code>                callbacks[i].apply(callbacks, args);
</code></td></tr><tr><td id="L979" class="css-a4x74f"><span>979</span></td><td id="LC979" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L980" class="css-a4x74f"><span>980</span></td><td id="LC980" class="css-1dcdqdg"><code>        },
</code></td></tr><tr><td id="L981" class="css-a4x74f"><span>981</span></td><td id="LC981" class="css-1dcdqdg"><code>        events: {},
</code></td></tr><tr><td id="L982" class="css-a4x74f"><span>982</span></td><td id="LC982" class="css-1dcdqdg"><code>        on: <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">event, cb</span>) </span>{
</code></td></tr><tr><td id="L983" class="css-a4x74f"><span>983</span></td><td id="LC983" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L984" class="css-a4x74f"><span>984</span></td><td id="LC984" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> _a;
</code></td></tr><tr><td id="L985" class="css-a4x74f"><span>985</span></td><td id="LC985" class="css-1dcdqdg"><code>            ((_a = <span class="code-keyword">this</span>.events[event]) === <span class="code-literal">null</span> || _a === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _a.push(cb)) || (<span class="code-keyword">this</span>.events[event] = [cb]);
</code></td></tr><tr><td id="L986" class="css-a4x74f"><span>986</span></td><td id="LC986" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L987" class="css-a4x74f"><span>987</span></td><td id="LC987" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _a;
</code></td></tr><tr><td id="L988" class="css-a4x74f"><span>988</span></td><td id="LC988" class="css-1dcdqdg"><code>                _this.events[event] = (_a = _this.events[event]) === <span class="code-literal">null</span> || _a === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _a.filter(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">i</span>) </span>{ <span class="code-keyword">return</span> cb !== i; });
</code></td></tr><tr><td id="L989" class="css-a4x74f"><span>989</span></td><td id="LC989" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L990" class="css-a4x74f"><span>990</span></td><td id="LC990" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L991" class="css-a4x74f"><span>991</span></td><td id="LC991" class="css-1dcdqdg"><code>    }); };
</code></td></tr><tr><td id="L992" class="css-a4x74f"><span>992</span></td><td id="LC992" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L993" class="css-a4x74f"><span>993</span></td><td id="LC993" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> EventEmitter = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L994" class="css-a4x74f"><span>994</span></td><td id="LC994" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">EventEmitter</span>(<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L995" class="css-a4x74f"><span>995</span></td><td id="LC995" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.handlers = [];
</code></td></tr><tr><td id="L996" class="css-a4x74f"><span>996</span></td><td id="LC996" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L997" class="css-a4x74f"><span>997</span></td><td id="LC997" class="css-1dcdqdg"><code>        EventEmitter.prototype.register = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">cb, once</span>) </span>{
</code></td></tr><tr><td id="L998" class="css-a4x74f"><span>998</span></td><td id="LC998" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.handlers.push(cb);
</code></td></tr><tr><td id="L999" class="css-a4x74f"><span>999</span></td><td id="LC999" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L1000" class="css-a4x74f"><span>1000</span></td><td id="LC1000" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L1001" class="css-a4x74f"><span>1001</span></td><td id="LC1001" class="css-1dcdqdg"><code>        EventEmitter.prototype.invoke = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1002" class="css-a4x74f"><span>1002</span></td><td id="LC1002" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L1003" class="css-a4x74f"><span>1003</span></td><td id="LC1003" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> args = [];
</code></td></tr><tr><td id="L1004" class="css-a4x74f"><span>1004</span></td><td id="LC1004" class="css-1dcdqdg"><code>            <span class="code-keyword">for</span> (<span class="code-keyword">var</span> _i = <span class="code-number">0</span>; _i &lt; <span class="code-built_in">arguments</span>.length; _i++) {
</code></td></tr><tr><td id="L1005" class="css-a4x74f"><span>1005</span></td><td id="LC1005" class="css-1dcdqdg"><code>                args[_i] = <span class="code-built_in">arguments</span>[_i];
</code></td></tr><tr><td id="L1006" class="css-a4x74f"><span>1006</span></td><td id="LC1006" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L1007" class="css-a4x74f"><span>1007</span></td><td id="LC1007" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.handlers.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">handler</span>) </span>{ <span class="code-keyword">return</span> handler.apply(_this, args); });
</code></td></tr><tr><td id="L1008" class="css-a4x74f"><span>1008</span></td><td id="LC1008" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L1009" class="css-a4x74f"><span>1009</span></td><td id="LC1009" class="css-1dcdqdg"><code>        EventEmitter.prototype.invokeAsync = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1010" class="css-a4x74f"><span>1010</span></td><td id="LC1010" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L1011" class="css-a4x74f"><span>1011</span></td><td id="LC1011" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> args = [];
</code></td></tr><tr><td id="L1012" class="css-a4x74f"><span>1012</span></td><td id="LC1012" class="css-1dcdqdg"><code>            <span class="code-keyword">for</span> (<span class="code-keyword">var</span> _i = <span class="code-number">0</span>; _i &lt; <span class="code-built_in">arguments</span>.length; _i++) {
</code></td></tr><tr><td id="L1013" class="css-a4x74f"><span>1013</span></td><td id="LC1013" class="css-1dcdqdg"><code>                args[_i] = <span class="code-built_in">arguments</span>[_i];
</code></td></tr><tr><td id="L1014" class="css-a4x74f"><span>1014</span></td><td id="LC1014" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L1015" class="css-a4x74f"><span>1015</span></td><td id="LC1015" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> <span class="code-built_in">Promise</span>.all(<span class="code-keyword">this</span>.handlers.map(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">handler</span>) </span>{ <span class="code-keyword">return</span> handler.apply(_this, args); }));
</code></td></tr><tr><td id="L1016" class="css-a4x74f"><span>1016</span></td><td id="LC1016" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L1017" class="css-a4x74f"><span>1017</span></td><td id="LC1017" class="css-1dcdqdg"><code>        EventEmitter.prototype.remove = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">cb</span>) </span>{
</code></td></tr><tr><td id="L1018" class="css-a4x74f"><span>1018</span></td><td id="LC1018" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> index = <span class="code-keyword">this</span>.handlers.indexOf(cb);
</code></td></tr><tr><td id="L1019" class="css-a4x74f"><span>1019</span></td><td id="LC1019" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.handlers[index] = <span class="code-keyword">this</span>.handlers[<span class="code-keyword">this</span>.handlers.length - <span class="code-number">1</span>];
</code></td></tr><tr><td id="L1020" class="css-a4x74f"><span>1020</span></td><td id="LC1020" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.handlers.pop();
</code></td></tr><tr><td id="L1021" class="css-a4x74f"><span>1021</span></td><td id="LC1021" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L1022" class="css-a4x74f"><span>1022</span></td><td id="LC1022" class="css-1dcdqdg"><code>        EventEmitter.prototype.clear = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1023" class="css-a4x74f"><span>1023</span></td><td id="LC1023" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.handlers = [];
</code></td></tr><tr><td id="L1024" class="css-a4x74f"><span>1024</span></td><td id="LC1024" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L1025" class="css-a4x74f"><span>1025</span></td><td id="LC1025" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> EventEmitter;
</code></td></tr><tr><td id="L1026" class="css-a4x74f"><span>1026</span></td><td id="LC1026" class="css-1dcdqdg"><code>    }());
</code></td></tr><tr><td id="L1027" class="css-a4x74f"><span>1027</span></td><td id="LC1027" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">createSignal</span>(<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1028" class="css-a4x74f"><span>1028</span></td><td id="LC1028" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> emitter = <span class="code-keyword">new</span> EventEmitter();
</code></td></tr><tr><td id="L1029" class="css-a4x74f"><span>1029</span></td><td id="LC1029" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">register</span>(<span class="code-params">cb</span>) </span>{
</code></td></tr><tr><td id="L1030" class="css-a4x74f"><span>1030</span></td><td id="LC1030" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> emitter.register(cb, <span class="code-keyword">this</span> === <span class="code-literal">null</span>);
</code></td></tr><tr><td id="L1031" class="css-a4x74f"><span>1031</span></td><td id="LC1031" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L1032" class="css-a4x74f"><span>1032</span></td><td id="LC1032" class="css-1dcdqdg"><code>        register.once = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">cb</span>) </span>{
</code></td></tr><tr><td id="L1033" class="css-a4x74f"><span>1033</span></td><td id="LC1033" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> callback = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1034" class="css-a4x74f"><span>1034</span></td><td id="LC1034" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> args = [];
</code></td></tr><tr><td id="L1035" class="css-a4x74f"><span>1035</span></td><td id="LC1035" class="css-1dcdqdg"><code>                <span class="code-keyword">for</span> (<span class="code-keyword">var</span> _i = <span class="code-number">0</span>; _i &lt; <span class="code-built_in">arguments</span>.length; _i++) {
</code></td></tr><tr><td id="L1036" class="css-a4x74f"><span>1036</span></td><td id="LC1036" class="css-1dcdqdg"><code>                    args[_i] = <span class="code-built_in">arguments</span>[_i];
</code></td></tr><tr><td id="L1037" class="css-a4x74f"><span>1037</span></td><td id="LC1037" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1038" class="css-a4x74f"><span>1038</span></td><td id="LC1038" class="css-1dcdqdg"><code>                cb.apply(<span class="code-keyword">this</span>, args);
</code></td></tr><tr><td id="L1039" class="css-a4x74f"><span>1039</span></td><td id="LC1039" class="css-1dcdqdg"><code>                emitter.remove(callback);
</code></td></tr><tr><td id="L1040" class="css-a4x74f"><span>1040</span></td><td id="LC1040" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1041" class="css-a4x74f"><span>1041</span></td><td id="LC1041" class="css-1dcdqdg"><code>            emitter.register(callback);
</code></td></tr><tr><td id="L1042" class="css-a4x74f"><span>1042</span></td><td id="LC1042" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L1043" class="css-a4x74f"><span>1043</span></td><td id="LC1043" class="css-1dcdqdg"><code>        register.remove = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">cb</span>) </span>{ <span class="code-keyword">return</span> emitter.remove(cb); };
</code></td></tr><tr><td id="L1044" class="css-a4x74f"><span>1044</span></td><td id="LC1044" class="css-1dcdqdg"><code>        register.invoke = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1045" class="css-a4x74f"><span>1045</span></td><td id="LC1045" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> args = [];
</code></td></tr><tr><td id="L1046" class="css-a4x74f"><span>1046</span></td><td id="LC1046" class="css-1dcdqdg"><code>            <span class="code-keyword">for</span> (<span class="code-keyword">var</span> _i = <span class="code-number">0</span>; _i &lt; <span class="code-built_in">arguments</span>.length; _i++) {
</code></td></tr><tr><td id="L1047" class="css-a4x74f"><span>1047</span></td><td id="LC1047" class="css-1dcdqdg"><code>                args[_i] = <span class="code-built_in">arguments</span>[_i];
</code></td></tr><tr><td id="L1048" class="css-a4x74f"><span>1048</span></td><td id="LC1048" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L1049" class="css-a4x74f"><span>1049</span></td><td id="LC1049" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> emitter.invoke.apply(emitter, args);
</code></td></tr><tr><td id="L1050" class="css-a4x74f"><span>1050</span></td><td id="LC1050" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L1051" class="css-a4x74f"><span>1051</span></td><td id="LC1051" class="css-1dcdqdg"><code>        register.invokeAsync = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1052" class="css-a4x74f"><span>1052</span></td><td id="LC1052" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> args = [];
</code></td></tr><tr><td id="L1053" class="css-a4x74f"><span>1053</span></td><td id="LC1053" class="css-1dcdqdg"><code>            <span class="code-keyword">for</span> (<span class="code-keyword">var</span> _i = <span class="code-number">0</span>; _i &lt; <span class="code-built_in">arguments</span>.length; _i++) {
</code></td></tr><tr><td id="L1054" class="css-a4x74f"><span>1054</span></td><td id="LC1054" class="css-1dcdqdg"><code>                args[_i] = <span class="code-built_in">arguments</span>[_i];
</code></td></tr><tr><td id="L1055" class="css-a4x74f"><span>1055</span></td><td id="LC1055" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L1056" class="css-a4x74f"><span>1056</span></td><td id="LC1056" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> emitter.invokeAsync.apply(emitter, args);
</code></td></tr><tr><td id="L1057" class="css-a4x74f"><span>1057</span></td><td id="LC1057" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L1058" class="css-a4x74f"><span>1058</span></td><td id="LC1058" class="css-1dcdqdg"><code>        register.clear = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{ <span class="code-keyword">return</span> emitter.clear(); };
</code></td></tr><tr><td id="L1059" class="css-a4x74f"><span>1059</span></td><td id="LC1059" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> register;
</code></td></tr><tr><td id="L1060" class="css-a4x74f"><span>1060</span></td><td id="LC1060" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L1061" class="css-a4x74f"><span>1061</span></td><td id="LC1061" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L1062" class="css-a4x74f"><span>1062</span></td><td id="LC1062" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> commonjsGlobal = <span class="code-keyword">typeof</span> globalThis !== <span class="code-string">'undefined'</span> ? globalThis : <span class="code-keyword">typeof</span> <span class="code-built_in">window</span> !== <span class="code-string">'undefined'</span> ? <span class="code-built_in">window</span> : <span class="code-keyword">typeof</span> global !== <span class="code-string">'undefined'</span> ? global : <span class="code-keyword">typeof</span> self !== <span class="code-string">'undefined'</span> ? self : {};
</code></td></tr><tr><td id="L1063" class="css-a4x74f"><span>1063</span></td><td id="LC1063" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L1064" class="css-a4x74f"><span>1064</span></td><td id="LC1064" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">createCommonjsModule</span>(<span class="code-params">fn</span>) </span>{
</code></td></tr><tr><td id="L1065" class="css-a4x74f"><span>1065</span></td><td id="LC1065" class="css-1dcdqdg"><code>      <span class="code-keyword">var</span> <span class="code-built_in">module</span> = { <span class="code-attr">exports</span>: {} };
</code></td></tr><tr><td id="L1066" class="css-a4x74f"><span>1066</span></td><td id="LC1066" class="css-1dcdqdg"><code>    	<span class="code-keyword">return</span> fn(<span class="code-built_in">module</span>, <span class="code-built_in">module</span>.exports), <span class="code-built_in">module</span>.exports;
</code></td></tr><tr><td id="L1067" class="css-a4x74f"><span>1067</span></td><td id="LC1067" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L1068" class="css-a4x74f"><span>1068</span></td><td id="LC1068" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L1069" class="css-a4x74f"><span>1069</span></td><td id="LC1069" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> umd = createCommonjsModule(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">module, exports</span>) </span>{
</code></td></tr><tr><td id="L1070" class="css-a4x74f"><span>1070</span></td><td id="LC1070" class="css-1dcdqdg"><code>    (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">global, factory</span>) </span>{
</code></td></tr><tr><td id="L1071" class="css-a4x74f"><span>1071</span></td><td id="LC1071" class="css-1dcdqdg"><code>        factory(exports) ;
</code></td></tr><tr><td id="L1072" class="css-a4x74f"><span>1072</span></td><td id="LC1072" class="css-1dcdqdg"><code>    })(commonjsGlobal, (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">exports</span>) </span>{
</code></td></tr><tr><td id="L1073" class="css-a4x74f"><span>1073</span></td><td id="LC1073" class="css-1dcdqdg"><code>        <span class="code-comment">/******************************************************************************
</span></code></td></tr><tr><td id="L1074" class="css-a4x74f"><span>1074</span></td><td id="LC1074" class="css-1dcdqdg"><code><span class="code-comment">        Copyright (c) Microsoft Corporation.
</span></code></td></tr><tr><td id="L1075" class="css-a4x74f"><span>1075</span></td><td id="LC1075" class="css-1dcdqdg"><code><span class="code-comment">
</span></code></td></tr><tr><td id="L1076" class="css-a4x74f"><span>1076</span></td><td id="LC1076" class="css-1dcdqdg"><code><span class="code-comment">        Permission to use, copy, modify, and/or distribute this software for any
</span></code></td></tr><tr><td id="L1077" class="css-a4x74f"><span>1077</span></td><td id="LC1077" class="css-1dcdqdg"><code><span class="code-comment">        purpose with or without fee is hereby granted.
</span></code></td></tr><tr><td id="L1078" class="css-a4x74f"><span>1078</span></td><td id="LC1078" class="css-1dcdqdg"><code><span class="code-comment">
</span></code></td></tr><tr><td id="L1079" class="css-a4x74f"><span>1079</span></td><td id="LC1079" class="css-1dcdqdg"><code><span class="code-comment">        THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
</span></code></td></tr><tr><td id="L1080" class="css-a4x74f"><span>1080</span></td><td id="LC1080" class="css-1dcdqdg"><code><span class="code-comment">        REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
</span></code></td></tr><tr><td id="L1081" class="css-a4x74f"><span>1081</span></td><td id="LC1081" class="css-1dcdqdg"><code><span class="code-comment">        AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
</span></code></td></tr><tr><td id="L1082" class="css-a4x74f"><span>1082</span></td><td id="LC1082" class="css-1dcdqdg"><code><span class="code-comment">        INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
</span></code></td></tr><tr><td id="L1083" class="css-a4x74f"><span>1083</span></td><td id="LC1083" class="css-1dcdqdg"><code><span class="code-comment">        LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
</span></code></td></tr><tr><td id="L1084" class="css-a4x74f"><span>1084</span></td><td id="LC1084" class="css-1dcdqdg"><code><span class="code-comment">        OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
</span></code></td></tr><tr><td id="L1085" class="css-a4x74f"><span>1085</span></td><td id="LC1085" class="css-1dcdqdg"><code><span class="code-comment">        PERFORMANCE OF THIS SOFTWARE.
</span></code></td></tr><tr><td id="L1086" class="css-a4x74f"><span>1086</span></td><td id="LC1086" class="css-1dcdqdg"><code><span class="code-comment">        ***************************************************************************** */</span>
</code></td></tr><tr><td id="L1087" class="css-a4x74f"><span>1087</span></td><td id="LC1087" class="css-1dcdqdg"><code>        <span class="code-comment">/* global Reflect, Promise */</span>
</code></td></tr><tr><td id="L1088" class="css-a4x74f"><span>1088</span></td><td id="LC1088" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L1089" class="css-a4x74f"><span>1089</span></td><td id="LC1089" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> extendStatics = <span class="code-function"><span class="code-keyword">function</span>(<span class="code-params">d, b</span>) </span>{
</code></td></tr><tr><td id="L1090" class="css-a4x74f"><span>1090</span></td><td id="LC1090" class="css-1dcdqdg"><code>            extendStatics = <span class="code-built_in">Object</span>.setPrototypeOf ||
</code></td></tr><tr><td id="L1091" class="css-a4x74f"><span>1091</span></td><td id="LC1091" class="css-1dcdqdg"><code>                ({ <span class="code-attr">__proto__</span>: [] } <span class="code-keyword">instanceof</span> <span class="code-built_in">Array</span> &amp;&amp; <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">d, b</span>) </span>{ d.__proto__ = b; }) ||
</code></td></tr><tr><td id="L1092" class="css-a4x74f"><span>1092</span></td><td id="LC1092" class="css-1dcdqdg"><code>                <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">d, b</span>) </span>{ <span class="code-keyword">for</span> (<span class="code-keyword">var</span> p <span class="code-keyword">in</span> b) <span class="code-keyword">if</span> (<span class="code-built_in">Object</span>.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
</code></td></tr><tr><td id="L1093" class="css-a4x74f"><span>1093</span></td><td id="LC1093" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> extendStatics(d, b);
</code></td></tr><tr><td id="L1094" class="css-a4x74f"><span>1094</span></td><td id="LC1094" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L1095" class="css-a4x74f"><span>1095</span></td><td id="LC1095" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L1096" class="css-a4x74f"><span>1096</span></td><td id="LC1096" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">__extends</span>(<span class="code-params">d, b</span>) </span>{
</code></td></tr><tr><td id="L1097" class="css-a4x74f"><span>1097</span></td><td id="LC1097" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> b !== <span class="code-string">"function"</span> &amp;&amp; b !== <span class="code-literal">null</span>)
</code></td></tr><tr><td id="L1098" class="css-a4x74f"><span>1098</span></td><td id="LC1098" class="css-1dcdqdg"><code>                <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">TypeError</span>(<span class="code-string">"Class extends value "</span> + <span class="code-built_in">String</span>(b) + <span class="code-string">" is not a constructor or null"</span>);
</code></td></tr><tr><td id="L1099" class="css-a4x74f"><span>1099</span></td><td id="LC1099" class="css-1dcdqdg"><code>            extendStatics(d, b);
</code></td></tr><tr><td id="L1100" class="css-a4x74f"><span>1100</span></td><td id="LC1100" class="css-1dcdqdg"><code>            <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">__</span>(<span class="code-params"></span>) </span>{ <span class="code-keyword">this</span>.constructor = d; }
</code></td></tr><tr><td id="L1101" class="css-a4x74f"><span>1101</span></td><td id="LC1101" class="css-1dcdqdg"><code>            d.prototype = b === <span class="code-literal">null</span> ? <span class="code-built_in">Object</span>.create(b) : (__.prototype = b.prototype, <span class="code-keyword">new</span> __());
</code></td></tr><tr><td id="L1102" class="css-a4x74f"><span>1102</span></td><td id="LC1102" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L1103" class="css-a4x74f"><span>1103</span></td><td id="LC1103" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L1104" class="css-a4x74f"><span>1104</span></td><td id="LC1104" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">__decorate</span>(<span class="code-params">decorators, target, key, desc</span>) </span>{
</code></td></tr><tr><td id="L1105" class="css-a4x74f"><span>1105</span></td><td id="LC1105" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> c = <span class="code-built_in">arguments</span>.length, r = c &lt; <span class="code-number">3</span> ? target : desc === <span class="code-literal">null</span> ? desc = <span class="code-built_in">Object</span>.getOwnPropertyDescriptor(target, key) : desc, d;
</code></td></tr><tr><td id="L1106" class="css-a4x74f"><span>1106</span></td><td id="LC1106" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> <span class="code-built_in">Reflect</span> === <span class="code-string">"object"</span> &amp;&amp; <span class="code-keyword">typeof</span> <span class="code-built_in">Reflect</span>.decorate === <span class="code-string">"function"</span>) r = <span class="code-built_in">Reflect</span>.decorate(decorators, target, key, desc);
</code></td></tr><tr><td id="L1107" class="css-a4x74f"><span>1107</span></td><td id="LC1107" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">for</span> (<span class="code-keyword">var</span> i = decorators.length - <span class="code-number">1</span>; i &gt;= <span class="code-number">0</span>; i--) <span class="code-keyword">if</span> (d = decorators[i]) r = (c &lt; <span class="code-number">3</span> ? d(r) : c &gt; <span class="code-number">3</span> ? d(target, key, r) : d(target, key)) || r;
</code></td></tr><tr><td id="L1108" class="css-a4x74f"><span>1108</span></td><td id="LC1108" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> c &gt; <span class="code-number">3</span> &amp;&amp; r &amp;&amp; <span class="code-built_in">Object</span>.defineProperty(target, key, r), r;
</code></td></tr><tr><td id="L1109" class="css-a4x74f"><span>1109</span></td><td id="LC1109" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L1110" class="css-a4x74f"><span>1110</span></td><td id="LC1110" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L1111" class="css-a4x74f"><span>1111</span></td><td id="LC1111" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">__spreadArray</span>(<span class="code-params">to, from, pack</span>) </span>{
</code></td></tr><tr><td id="L1112" class="css-a4x74f"><span>1112</span></td><td id="LC1112" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (pack || <span class="code-built_in">arguments</span>.length === <span class="code-number">2</span>) <span class="code-keyword">for</span> (<span class="code-keyword">var</span> i = <span class="code-number">0</span>, l = <span class="code-keyword">from</span>.length, ar; i &lt; l; i++) {
</code></td></tr><tr><td id="L1113" class="css-a4x74f"><span>1113</span></td><td id="LC1113" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (ar || !(i <span class="code-keyword">in</span> <span class="code-keyword">from</span>)) {
</code></td></tr><tr><td id="L1114" class="css-a4x74f"><span>1114</span></td><td id="LC1114" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (!ar) ar = <span class="code-built_in">Array</span>.prototype.slice.call(<span class="code-keyword">from</span>, <span class="code-number">0</span>, i);
</code></td></tr><tr><td id="L1115" class="css-a4x74f"><span>1115</span></td><td id="LC1115" class="css-1dcdqdg"><code>                    ar[i] = <span class="code-keyword">from</span>[i];
</code></td></tr><tr><td id="L1116" class="css-a4x74f"><span>1116</span></td><td id="LC1116" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1117" class="css-a4x74f"><span>1117</span></td><td id="LC1117" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L1118" class="css-a4x74f"><span>1118</span></td><td id="LC1118" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> to.concat(ar || <span class="code-built_in">Array</span>.prototype.slice.call(<span class="code-keyword">from</span>));
</code></td></tr><tr><td id="L1119" class="css-a4x74f"><span>1119</span></td><td id="LC1119" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L1120" class="css-a4x74f"><span>1120</span></td><td id="LC1120" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L1121" class="css-a4x74f"><span>1121</span></td><td id="LC1121" class="css-1dcdqdg"><code>        <span class="code-comment">// export const SWITCH_TO_STRUCTURE = 193; (easily collides with DELETE_AND_ADD + fieldIndex = 2)</span>
</code></td></tr><tr><td id="L1122" class="css-a4x74f"><span>1122</span></td><td id="LC1122" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> SWITCH_TO_STRUCTURE = <span class="code-number">255</span>; <span class="code-comment">// (decoding collides with DELETE_AND_ADD + fieldIndex = 63)</span>
</code></td></tr><tr><td id="L1123" class="css-a4x74f"><span>1123</span></td><td id="LC1123" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> TYPE_ID = <span class="code-number">213</span>;
</code></td></tr><tr><td id="L1124" class="css-a4x74f"><span>1124</span></td><td id="LC1124" class="css-1dcdqdg"><code>        <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1125" class="css-a4x74f"><span>1125</span></td><td id="LC1125" class="css-1dcdqdg"><code><span class="code-comment">         * Encoding Schema field operations.
</span></code></td></tr><tr><td id="L1126" class="css-a4x74f"><span>1126</span></td><td id="LC1126" class="css-1dcdqdg"><code><span class="code-comment">         */</span>
</code></td></tr><tr><td id="L1127" class="css-a4x74f"><span>1127</span></td><td id="LC1127" class="css-1dcdqdg"><code>        exports.OPERATION = <span class="code-keyword">void</span> <span class="code-number">0</span>;
</code></td></tr><tr><td id="L1128" class="css-a4x74f"><span>1128</span></td><td id="LC1128" class="css-1dcdqdg"><code>        (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">OPERATION</span>) </span>{
</code></td></tr><tr><td id="L1129" class="css-a4x74f"><span>1129</span></td><td id="LC1129" class="css-1dcdqdg"><code>            <span class="code-comment">// add new structure/primitive</span>
</code></td></tr><tr><td id="L1130" class="css-a4x74f"><span>1130</span></td><td id="LC1130" class="css-1dcdqdg"><code>            OPERATION[OPERATION[<span class="code-string">"ADD"</span>] = <span class="code-number">128</span>] = <span class="code-string">"ADD"</span>;
</code></td></tr><tr><td id="L1131" class="css-a4x74f"><span>1131</span></td><td id="LC1131" class="css-1dcdqdg"><code>            <span class="code-comment">// replace structure/primitive</span>
</code></td></tr><tr><td id="L1132" class="css-a4x74f"><span>1132</span></td><td id="LC1132" class="css-1dcdqdg"><code>            OPERATION[OPERATION[<span class="code-string">"REPLACE"</span>] = <span class="code-number">0</span>] = <span class="code-string">"REPLACE"</span>;
</code></td></tr><tr><td id="L1133" class="css-a4x74f"><span>1133</span></td><td id="LC1133" class="css-1dcdqdg"><code>            <span class="code-comment">// delete field</span>
</code></td></tr><tr><td id="L1134" class="css-a4x74f"><span>1134</span></td><td id="LC1134" class="css-1dcdqdg"><code>            OPERATION[OPERATION[<span class="code-string">"DELETE"</span>] = <span class="code-number">64</span>] = <span class="code-string">"DELETE"</span>;
</code></td></tr><tr><td id="L1135" class="css-a4x74f"><span>1135</span></td><td id="LC1135" class="css-1dcdqdg"><code>            <span class="code-comment">// DELETE field, followed by an ADD</span>
</code></td></tr><tr><td id="L1136" class="css-a4x74f"><span>1136</span></td><td id="LC1136" class="css-1dcdqdg"><code>            OPERATION[OPERATION[<span class="code-string">"DELETE_AND_ADD"</span>] = <span class="code-number">192</span>] = <span class="code-string">"DELETE_AND_ADD"</span>;
</code></td></tr><tr><td id="L1137" class="css-a4x74f"><span>1137</span></td><td id="LC1137" class="css-1dcdqdg"><code>            <span class="code-comment">// TOUCH is used to determine hierarchy of nested Schema structures during serialization.</span>
</code></td></tr><tr><td id="L1138" class="css-a4x74f"><span>1138</span></td><td id="LC1138" class="css-1dcdqdg"><code>            <span class="code-comment">// touches are NOT encoded.</span>
</code></td></tr><tr><td id="L1139" class="css-a4x74f"><span>1139</span></td><td id="LC1139" class="css-1dcdqdg"><code>            OPERATION[OPERATION[<span class="code-string">"TOUCH"</span>] = <span class="code-number">1</span>] = <span class="code-string">"TOUCH"</span>;
</code></td></tr><tr><td id="L1140" class="css-a4x74f"><span>1140</span></td><td id="LC1140" class="css-1dcdqdg"><code>            <span class="code-comment">// MapSchema Operations</span>
</code></td></tr><tr><td id="L1141" class="css-a4x74f"><span>1141</span></td><td id="LC1141" class="css-1dcdqdg"><code>            OPERATION[OPERATION[<span class="code-string">"CLEAR"</span>] = <span class="code-number">10</span>] = <span class="code-string">"CLEAR"</span>;
</code></td></tr><tr><td id="L1142" class="css-a4x74f"><span>1142</span></td><td id="LC1142" class="css-1dcdqdg"><code>        })(exports.OPERATION || (exports.OPERATION = {}));
</code></td></tr><tr><td id="L1143" class="css-a4x74f"><span>1143</span></td><td id="LC1143" class="css-1dcdqdg"><code>        <span class="code-comment">// export enum OPERATION {</span>
</code></td></tr><tr><td id="L1144" class="css-a4x74f"><span>1144</span></td><td id="LC1144" class="css-1dcdqdg"><code>        <span class="code-comment">//     // add new structure/primitive</span>
</code></td></tr><tr><td id="L1145" class="css-a4x74f"><span>1145</span></td><td id="LC1145" class="css-1dcdqdg"><code>        <span class="code-comment">//     // (128)</span>
</code></td></tr><tr><td id="L1146" class="css-a4x74f"><span>1146</span></td><td id="LC1146" class="css-1dcdqdg"><code>        <span class="code-comment">//     ADD = 128, // 10000000,</span>
</code></td></tr><tr><td id="L1147" class="css-a4x74f"><span>1147</span></td><td id="LC1147" class="css-1dcdqdg"><code>        <span class="code-comment">//     // replace structure/primitive</span>
</code></td></tr><tr><td id="L1148" class="css-a4x74f"><span>1148</span></td><td id="LC1148" class="css-1dcdqdg"><code>        <span class="code-comment">//     REPLACE = 1,// 00000001</span>
</code></td></tr><tr><td id="L1149" class="css-a4x74f"><span>1149</span></td><td id="LC1149" class="css-1dcdqdg"><code>        <span class="code-comment">//     // delete field</span>
</code></td></tr><tr><td id="L1150" class="css-a4x74f"><span>1150</span></td><td id="LC1150" class="css-1dcdqdg"><code>        <span class="code-comment">//     DELETE = 192, // 11000000</span>
</code></td></tr><tr><td id="L1151" class="css-a4x74f"><span>1151</span></td><td id="LC1151" class="css-1dcdqdg"><code>        <span class="code-comment">//     // DELETE field, followed by an ADD</span>
</code></td></tr><tr><td id="L1152" class="css-a4x74f"><span>1152</span></td><td id="LC1152" class="css-1dcdqdg"><code>        <span class="code-comment">//     DELETE_AND_ADD = 224, // 11100000</span>
</code></td></tr><tr><td id="L1153" class="css-a4x74f"><span>1153</span></td><td id="LC1153" class="css-1dcdqdg"><code>        <span class="code-comment">//     // TOUCH is used to determine hierarchy of nested Schema structures during serialization.</span>
</code></td></tr><tr><td id="L1154" class="css-a4x74f"><span>1154</span></td><td id="LC1154" class="css-1dcdqdg"><code>        <span class="code-comment">//     // touches are NOT encoded.</span>
</code></td></tr><tr><td id="L1155" class="css-a4x74f"><span>1155</span></td><td id="LC1155" class="css-1dcdqdg"><code>        <span class="code-comment">//     TOUCH = 0, // 00000000</span>
</code></td></tr><tr><td id="L1156" class="css-a4x74f"><span>1156</span></td><td id="LC1156" class="css-1dcdqdg"><code>        <span class="code-comment">//     // MapSchema Operations</span>
</code></td></tr><tr><td id="L1157" class="css-a4x74f"><span>1157</span></td><td id="LC1157" class="css-1dcdqdg"><code>        <span class="code-comment">//     CLEAR = 10,</span>
</code></td></tr><tr><td id="L1158" class="css-a4x74f"><span>1158</span></td><td id="LC1158" class="css-1dcdqdg"><code>        <span class="code-comment">// }</span>
</code></td></tr><tr><td id="L1159" class="css-a4x74f"><span>1159</span></td><td id="LC1159" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L1160" class="css-a4x74f"><span>1160</span></td><td id="LC1160" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> ChangeTree = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1161" class="css-a4x74f"><span>1161</span></td><td id="LC1161" class="css-1dcdqdg"><code>            <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">ChangeTree</span>(<span class="code-params">ref, parent, root</span>) </span>{
</code></td></tr><tr><td id="L1162" class="css-a4x74f"><span>1162</span></td><td id="LC1162" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.changed = <span class="code-literal">false</span>;
</code></td></tr><tr><td id="L1163" class="css-a4x74f"><span>1163</span></td><td id="LC1163" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.changes = <span class="code-keyword">new</span> <span class="code-built_in">Map</span>();
</code></td></tr><tr><td id="L1164" class="css-a4x74f"><span>1164</span></td><td id="LC1164" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.allChanges = <span class="code-keyword">new</span> <span class="code-built_in">Set</span>();
</code></td></tr><tr><td id="L1165" class="css-a4x74f"><span>1165</span></td><td id="LC1165" class="css-1dcdqdg"><code>                <span class="code-comment">// cached indexes for filtering</span>
</code></td></tr><tr><td id="L1166" class="css-a4x74f"><span>1166</span></td><td id="LC1166" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.caches = {};
</code></td></tr><tr><td id="L1167" class="css-a4x74f"><span>1167</span></td><td id="LC1167" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.currentCustomOperation = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L1168" class="css-a4x74f"><span>1168</span></td><td id="LC1168" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.ref = ref;
</code></td></tr><tr><td id="L1169" class="css-a4x74f"><span>1169</span></td><td id="LC1169" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.setParent(parent, root);
</code></td></tr><tr><td id="L1170" class="css-a4x74f"><span>1170</span></td><td id="LC1170" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L1171" class="css-a4x74f"><span>1171</span></td><td id="LC1171" class="css-1dcdqdg"><code>            ChangeTree.prototype.setParent = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">parent, root, parentIndex</span>) </span>{
</code></td></tr><tr><td id="L1172" class="css-a4x74f"><span>1172</span></td><td id="LC1172" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L1173" class="css-a4x74f"><span>1173</span></td><td id="LC1173" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (!<span class="code-keyword">this</span>.indexes) {
</code></td></tr><tr><td id="L1174" class="css-a4x74f"><span>1174</span></td><td id="LC1174" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.indexes = (<span class="code-keyword">this</span>.ref <span class="code-keyword">instanceof</span> Schema)
</code></td></tr><tr><td id="L1175" class="css-a4x74f"><span>1175</span></td><td id="LC1175" class="css-1dcdqdg"><code>                        ? <span class="code-keyword">this</span>.ref[<span class="code-string">'_definition'</span>].indexes
</code></td></tr><tr><td id="L1176" class="css-a4x74f"><span>1176</span></td><td id="LC1176" class="css-1dcdqdg"><code>                        : {};
</code></td></tr><tr><td id="L1177" class="css-a4x74f"><span>1177</span></td><td id="LC1177" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1178" class="css-a4x74f"><span>1178</span></td><td id="LC1178" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.parent = parent;
</code></td></tr><tr><td id="L1179" class="css-a4x74f"><span>1179</span></td><td id="LC1179" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.parentIndex = parentIndex;
</code></td></tr><tr><td id="L1180" class="css-a4x74f"><span>1180</span></td><td id="LC1180" class="css-1dcdqdg"><code>                <span class="code-comment">// avoid setting parents with empty `root`</span>
</code></td></tr><tr><td id="L1181" class="css-a4x74f"><span>1181</span></td><td id="LC1181" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (!root) {
</code></td></tr><tr><td id="L1182" class="css-a4x74f"><span>1182</span></td><td id="LC1182" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span>;
</code></td></tr><tr><td id="L1183" class="css-a4x74f"><span>1183</span></td><td id="LC1183" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1184" class="css-a4x74f"><span>1184</span></td><td id="LC1184" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.root = root;
</code></td></tr><tr><td id="L1185" class="css-a4x74f"><span>1185</span></td><td id="LC1185" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1186" class="css-a4x74f"><span>1186</span></td><td id="LC1186" class="css-1dcdqdg"><code>                <span class="code-comment">// assign same parent on child structures</span>
</code></td></tr><tr><td id="L1187" class="css-a4x74f"><span>1187</span></td><td id="LC1187" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1188" class="css-a4x74f"><span>1188</span></td><td id="LC1188" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.ref <span class="code-keyword">instanceof</span> Schema) {
</code></td></tr><tr><td id="L1189" class="css-a4x74f"><span>1189</span></td><td id="LC1189" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> definition = <span class="code-keyword">this</span>.ref[<span class="code-string">'_definition'</span>];
</code></td></tr><tr><td id="L1190" class="css-a4x74f"><span>1190</span></td><td id="LC1190" class="css-1dcdqdg"><code>                    <span class="code-keyword">for</span> (<span class="code-keyword">var</span> field <span class="code-keyword">in</span> definition.schema) {
</code></td></tr><tr><td id="L1191" class="css-a4x74f"><span>1191</span></td><td id="LC1191" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> value = <span class="code-keyword">this</span>.ref[field];
</code></td></tr><tr><td id="L1192" class="css-a4x74f"><span>1192</span></td><td id="LC1192" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (value &amp;&amp; value[<span class="code-string">'$changes'</span>]) {
</code></td></tr><tr><td id="L1193" class="css-a4x74f"><span>1193</span></td><td id="LC1193" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> parentIndex_1 = definition.indexes[field];
</code></td></tr><tr><td id="L1194" class="css-a4x74f"><span>1194</span></td><td id="LC1194" class="css-1dcdqdg"><code>                            value[<span class="code-string">'$changes'</span>].setParent(<span class="code-keyword">this</span>.ref, root, parentIndex_1);
</code></td></tr><tr><td id="L1195" class="css-a4x74f"><span>1195</span></td><td id="LC1195" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L1196" class="css-a4x74f"><span>1196</span></td><td id="LC1196" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L1197" class="css-a4x74f"><span>1197</span></td><td id="LC1197" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1198" class="css-a4x74f"><span>1198</span></td><td id="LC1198" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (<span class="code-keyword">this</span>.ref) === <span class="code-string">"object"</span>) {
</code></td></tr><tr><td id="L1199" class="css-a4x74f"><span>1199</span></td><td id="LC1199" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.ref.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">value, key</span>) </span>{
</code></td></tr><tr><td id="L1200" class="css-a4x74f"><span>1200</span></td><td id="LC1200" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (value <span class="code-keyword">instanceof</span> Schema) {
</code></td></tr><tr><td id="L1201" class="css-a4x74f"><span>1201</span></td><td id="LC1201" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> changeTreee = value[<span class="code-string">'$changes'</span>];
</code></td></tr><tr><td id="L1202" class="css-a4x74f"><span>1202</span></td><td id="LC1202" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> parentIndex_2 = _this.ref[<span class="code-string">'$changes'</span>].indexes[key];
</code></td></tr><tr><td id="L1203" class="css-a4x74f"><span>1203</span></td><td id="LC1203" class="css-1dcdqdg"><code>                            changeTreee.setParent(_this.ref, _this.root, parentIndex_2);
</code></td></tr><tr><td id="L1204" class="css-a4x74f"><span>1204</span></td><td id="LC1204" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L1205" class="css-a4x74f"><span>1205</span></td><td id="LC1205" class="css-1dcdqdg"><code>                    });
</code></td></tr><tr><td id="L1206" class="css-a4x74f"><span>1206</span></td><td id="LC1206" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1207" class="css-a4x74f"><span>1207</span></td><td id="LC1207" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1208" class="css-a4x74f"><span>1208</span></td><td id="LC1208" class="css-1dcdqdg"><code>            ChangeTree.prototype.operation = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">op</span>) </span>{
</code></td></tr><tr><td id="L1209" class="css-a4x74f"><span>1209</span></td><td id="LC1209" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.changes.set(--<span class="code-keyword">this</span>.currentCustomOperation, op);
</code></td></tr><tr><td id="L1210" class="css-a4x74f"><span>1210</span></td><td id="LC1210" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1211" class="css-a4x74f"><span>1211</span></td><td id="LC1211" class="css-1dcdqdg"><code>            ChangeTree.prototype.change = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">fieldName, operation</span>) </span>{
</code></td></tr><tr><td id="L1212" class="css-a4x74f"><span>1212</span></td><td id="LC1212" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (operation === <span class="code-keyword">void</span> <span class="code-number">0</span>) { operation = exports.OPERATION.ADD; }
</code></td></tr><tr><td id="L1213" class="css-a4x74f"><span>1213</span></td><td id="LC1213" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> index = (<span class="code-keyword">typeof</span> (fieldName) === <span class="code-string">"number"</span>)
</code></td></tr><tr><td id="L1214" class="css-a4x74f"><span>1214</span></td><td id="LC1214" class="css-1dcdqdg"><code>                    ? fieldName
</code></td></tr><tr><td id="L1215" class="css-a4x74f"><span>1215</span></td><td id="LC1215" class="css-1dcdqdg"><code>                    : <span class="code-keyword">this</span>.indexes[fieldName];
</code></td></tr><tr><td id="L1216" class="css-a4x74f"><span>1216</span></td><td id="LC1216" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.assertValidIndex(index, fieldName);
</code></td></tr><tr><td id="L1217" class="css-a4x74f"><span>1217</span></td><td id="LC1217" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> previousChange = <span class="code-keyword">this</span>.changes.get(index);
</code></td></tr><tr><td id="L1218" class="css-a4x74f"><span>1218</span></td><td id="LC1218" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (!previousChange ||
</code></td></tr><tr><td id="L1219" class="css-a4x74f"><span>1219</span></td><td id="LC1219" class="css-1dcdqdg"><code>                    previousChange.op === exports.OPERATION.DELETE ||
</code></td></tr><tr><td id="L1220" class="css-a4x74f"><span>1220</span></td><td id="LC1220" class="css-1dcdqdg"><code>                    previousChange.op === exports.OPERATION.TOUCH <span class="code-comment">// (mazmorra.io's BattleAction issue)</span>
</code></td></tr><tr><td id="L1221" class="css-a4x74f"><span>1221</span></td><td id="LC1221" class="css-1dcdqdg"><code>                ) {
</code></td></tr><tr><td id="L1222" class="css-a4x74f"><span>1222</span></td><td id="LC1222" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.changes.set(index, {
</code></td></tr><tr><td id="L1223" class="css-a4x74f"><span>1223</span></td><td id="LC1223" class="css-1dcdqdg"><code>                        op: (!previousChange)
</code></td></tr><tr><td id="L1224" class="css-a4x74f"><span>1224</span></td><td id="LC1224" class="css-1dcdqdg"><code>                            ? operation
</code></td></tr><tr><td id="L1225" class="css-a4x74f"><span>1225</span></td><td id="LC1225" class="css-1dcdqdg"><code>                            : (previousChange.op === exports.OPERATION.DELETE)
</code></td></tr><tr><td id="L1226" class="css-a4x74f"><span>1226</span></td><td id="LC1226" class="css-1dcdqdg"><code>                                ? exports.OPERATION.DELETE_AND_ADD
</code></td></tr><tr><td id="L1227" class="css-a4x74f"><span>1227</span></td><td id="LC1227" class="css-1dcdqdg"><code>                                : operation,
</code></td></tr><tr><td id="L1228" class="css-a4x74f"><span>1228</span></td><td id="LC1228" class="css-1dcdqdg"><code>                        <span class="code-comment">// : OPERATION.REPLACE,</span>
</code></td></tr><tr><td id="L1229" class="css-a4x74f"><span>1229</span></td><td id="LC1229" class="css-1dcdqdg"><code>                        index: index
</code></td></tr><tr><td id="L1230" class="css-a4x74f"><span>1230</span></td><td id="LC1230" class="css-1dcdqdg"><code>                    });
</code></td></tr><tr><td id="L1231" class="css-a4x74f"><span>1231</span></td><td id="LC1231" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1232" class="css-a4x74f"><span>1232</span></td><td id="LC1232" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.allChanges.add(index);
</code></td></tr><tr><td id="L1233" class="css-a4x74f"><span>1233</span></td><td id="LC1233" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.changed = <span class="code-literal">true</span>;
</code></td></tr><tr><td id="L1234" class="css-a4x74f"><span>1234</span></td><td id="LC1234" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.touchParents();
</code></td></tr><tr><td id="L1235" class="css-a4x74f"><span>1235</span></td><td id="LC1235" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1236" class="css-a4x74f"><span>1236</span></td><td id="LC1236" class="css-1dcdqdg"><code>            ChangeTree.prototype.touch = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">fieldName</span>) </span>{
</code></td></tr><tr><td id="L1237" class="css-a4x74f"><span>1237</span></td><td id="LC1237" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> index = (<span class="code-keyword">typeof</span> (fieldName) === <span class="code-string">"number"</span>)
</code></td></tr><tr><td id="L1238" class="css-a4x74f"><span>1238</span></td><td id="LC1238" class="css-1dcdqdg"><code>                    ? fieldName
</code></td></tr><tr><td id="L1239" class="css-a4x74f"><span>1239</span></td><td id="LC1239" class="css-1dcdqdg"><code>                    : <span class="code-keyword">this</span>.indexes[fieldName];
</code></td></tr><tr><td id="L1240" class="css-a4x74f"><span>1240</span></td><td id="LC1240" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.assertValidIndex(index, fieldName);
</code></td></tr><tr><td id="L1241" class="css-a4x74f"><span>1241</span></td><td id="LC1241" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (!<span class="code-keyword">this</span>.changes.has(index)) {
</code></td></tr><tr><td id="L1242" class="css-a4x74f"><span>1242</span></td><td id="LC1242" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.changes.set(index, { <span class="code-attr">op</span>: exports.OPERATION.TOUCH, <span class="code-attr">index</span>: index });
</code></td></tr><tr><td id="L1243" class="css-a4x74f"><span>1243</span></td><td id="LC1243" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1244" class="css-a4x74f"><span>1244</span></td><td id="LC1244" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.allChanges.add(index);
</code></td></tr><tr><td id="L1245" class="css-a4x74f"><span>1245</span></td><td id="LC1245" class="css-1dcdqdg"><code>                <span class="code-comment">// ensure touch is placed until the $root is found.</span>
</code></td></tr><tr><td id="L1246" class="css-a4x74f"><span>1246</span></td><td id="LC1246" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.touchParents();
</code></td></tr><tr><td id="L1247" class="css-a4x74f"><span>1247</span></td><td id="LC1247" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1248" class="css-a4x74f"><span>1248</span></td><td id="LC1248" class="css-1dcdqdg"><code>            ChangeTree.prototype.touchParents = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1249" class="css-a4x74f"><span>1249</span></td><td id="LC1249" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.parent) {
</code></td></tr><tr><td id="L1250" class="css-a4x74f"><span>1250</span></td><td id="LC1250" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.parent[<span class="code-string">'$changes'</span>].touch(<span class="code-keyword">this</span>.parentIndex);
</code></td></tr><tr><td id="L1251" class="css-a4x74f"><span>1251</span></td><td id="LC1251" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1252" class="css-a4x74f"><span>1252</span></td><td id="LC1252" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1253" class="css-a4x74f"><span>1253</span></td><td id="LC1253" class="css-1dcdqdg"><code>            ChangeTree.prototype.getType = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index</span>) </span>{
</code></td></tr><tr><td id="L1254" class="css-a4x74f"><span>1254</span></td><td id="LC1254" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.ref[<span class="code-string">'_definition'</span>]) {
</code></td></tr><tr><td id="L1255" class="css-a4x74f"><span>1255</span></td><td id="LC1255" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> definition = <span class="code-keyword">this</span>.ref[<span class="code-string">'_definition'</span>];
</code></td></tr><tr><td id="L1256" class="css-a4x74f"><span>1256</span></td><td id="LC1256" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> definition.schema[definition.fieldsByIndex[index]];
</code></td></tr><tr><td id="L1257" class="css-a4x74f"><span>1257</span></td><td id="LC1257" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1258" class="css-a4x74f"><span>1258</span></td><td id="LC1258" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L1259" class="css-a4x74f"><span>1259</span></td><td id="LC1259" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> definition = <span class="code-keyword">this</span>.parent[<span class="code-string">'_definition'</span>];
</code></td></tr><tr><td id="L1260" class="css-a4x74f"><span>1260</span></td><td id="LC1260" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> parentType = definition.schema[definition.fieldsByIndex[<span class="code-keyword">this</span>.parentIndex]];
</code></td></tr><tr><td id="L1261" class="css-a4x74f"><span>1261</span></td><td id="LC1261" class="css-1dcdqdg"><code>                    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1262" class="css-a4x74f"><span>1262</span></td><td id="LC1262" class="css-1dcdqdg"><code>                    <span class="code-comment">// Get the child type from parent structure.</span>
</code></td></tr><tr><td id="L1263" class="css-a4x74f"><span>1263</span></td><td id="LC1263" class="css-1dcdqdg"><code>                    <span class="code-comment">// - ["string"] =&gt; "string"</span>
</code></td></tr><tr><td id="L1264" class="css-a4x74f"><span>1264</span></td><td id="LC1264" class="css-1dcdqdg"><code>                    <span class="code-comment">// - { map: "string" } =&gt; "string"</span>
</code></td></tr><tr><td id="L1265" class="css-a4x74f"><span>1265</span></td><td id="LC1265" class="css-1dcdqdg"><code>                    <span class="code-comment">// - { set: "string" } =&gt; "string"</span>
</code></td></tr><tr><td id="L1266" class="css-a4x74f"><span>1266</span></td><td id="LC1266" class="css-1dcdqdg"><code>                    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1267" class="css-a4x74f"><span>1267</span></td><td id="LC1267" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-built_in">Object</span>.values(parentType)[<span class="code-number">0</span>];
</code></td></tr><tr><td id="L1268" class="css-a4x74f"><span>1268</span></td><td id="LC1268" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1269" class="css-a4x74f"><span>1269</span></td><td id="LC1269" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1270" class="css-a4x74f"><span>1270</span></td><td id="LC1270" class="css-1dcdqdg"><code>            ChangeTree.prototype.getChildrenFilter = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1271" class="css-a4x74f"><span>1271</span></td><td id="LC1271" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> childFilters = <span class="code-keyword">this</span>.parent[<span class="code-string">'_definition'</span>].childFilters;
</code></td></tr><tr><td id="L1272" class="css-a4x74f"><span>1272</span></td><td id="LC1272" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> childFilters &amp;&amp; childFilters[<span class="code-keyword">this</span>.parentIndex];
</code></td></tr><tr><td id="L1273" class="css-a4x74f"><span>1273</span></td><td id="LC1273" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1274" class="css-a4x74f"><span>1274</span></td><td id="LC1274" class="css-1dcdqdg"><code>            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1275" class="css-a4x74f"><span>1275</span></td><td id="LC1275" class="css-1dcdqdg"><code>            <span class="code-comment">// used during `.encode()`</span>
</code></td></tr><tr><td id="L1276" class="css-a4x74f"><span>1276</span></td><td id="LC1276" class="css-1dcdqdg"><code>            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1277" class="css-a4x74f"><span>1277</span></td><td id="LC1277" class="css-1dcdqdg"><code>            ChangeTree.prototype.getValue = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index</span>) </span>{
</code></td></tr><tr><td id="L1278" class="css-a4x74f"><span>1278</span></td><td id="LC1278" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.ref[<span class="code-string">'getByIndex'</span>](index);
</code></td></tr><tr><td id="L1279" class="css-a4x74f"><span>1279</span></td><td id="LC1279" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1280" class="css-a4x74f"><span>1280</span></td><td id="LC1280" class="css-1dcdqdg"><code>            ChangeTree.prototype.delete = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">fieldName</span>) </span>{
</code></td></tr><tr><td id="L1281" class="css-a4x74f"><span>1281</span></td><td id="LC1281" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> index = (<span class="code-keyword">typeof</span> (fieldName) === <span class="code-string">"number"</span>)
</code></td></tr><tr><td id="L1282" class="css-a4x74f"><span>1282</span></td><td id="LC1282" class="css-1dcdqdg"><code>                    ? fieldName
</code></td></tr><tr><td id="L1283" class="css-a4x74f"><span>1283</span></td><td id="LC1283" class="css-1dcdqdg"><code>                    : <span class="code-keyword">this</span>.indexes[fieldName];
</code></td></tr><tr><td id="L1284" class="css-a4x74f"><span>1284</span></td><td id="LC1284" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (index === <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L1285" class="css-a4x74f"><span>1285</span></td><td id="LC1285" class="css-1dcdqdg"><code>                    <span class="code-built_in">console</span>.warn(<span class="code-string">"@colyseus/schema "</span>.concat(<span class="code-keyword">this</span>.ref.constructor.name, <span class="code-string">": trying to delete non-existing index: "</span>).concat(fieldName, <span class="code-string">" ("</span>).concat(index, <span class="code-string">")"</span>));
</code></td></tr><tr><td id="L1286" class="css-a4x74f"><span>1286</span></td><td id="LC1286" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span>;
</code></td></tr><tr><td id="L1287" class="css-a4x74f"><span>1287</span></td><td id="LC1287" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1288" class="css-a4x74f"><span>1288</span></td><td id="LC1288" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> previousValue = <span class="code-keyword">this</span>.getValue(index);
</code></td></tr><tr><td id="L1289" class="css-a4x74f"><span>1289</span></td><td id="LC1289" class="css-1dcdqdg"><code>                <span class="code-comment">// console.log("$changes.delete =&gt;", { fieldName, index, previousValue });</span>
</code></td></tr><tr><td id="L1290" class="css-a4x74f"><span>1290</span></td><td id="LC1290" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.changes.set(index, { <span class="code-attr">op</span>: exports.OPERATION.DELETE, <span class="code-attr">index</span>: index });
</code></td></tr><tr><td id="L1291" class="css-a4x74f"><span>1291</span></td><td id="LC1291" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.allChanges.delete(index);
</code></td></tr><tr><td id="L1292" class="css-a4x74f"><span>1292</span></td><td id="LC1292" class="css-1dcdqdg"><code>                <span class="code-comment">// delete cache</span>
</code></td></tr><tr><td id="L1293" class="css-a4x74f"><span>1293</span></td><td id="LC1293" class="css-1dcdqdg"><code>                <span class="code-keyword">delete</span> <span class="code-keyword">this</span>.caches[index];
</code></td></tr><tr><td id="L1294" class="css-a4x74f"><span>1294</span></td><td id="LC1294" class="css-1dcdqdg"><code>                <span class="code-comment">// remove `root` reference</span>
</code></td></tr><tr><td id="L1295" class="css-a4x74f"><span>1295</span></td><td id="LC1295" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (previousValue &amp;&amp; previousValue[<span class="code-string">'$changes'</span>]) {
</code></td></tr><tr><td id="L1296" class="css-a4x74f"><span>1296</span></td><td id="LC1296" class="css-1dcdqdg"><code>                    previousValue[<span class="code-string">'$changes'</span>].parent = <span class="code-literal">undefined</span>;
</code></td></tr><tr><td id="L1297" class="css-a4x74f"><span>1297</span></td><td id="LC1297" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1298" class="css-a4x74f"><span>1298</span></td><td id="LC1298" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.changed = <span class="code-literal">true</span>;
</code></td></tr><tr><td id="L1299" class="css-a4x74f"><span>1299</span></td><td id="LC1299" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.touchParents();
</code></td></tr><tr><td id="L1300" class="css-a4x74f"><span>1300</span></td><td id="LC1300" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1301" class="css-a4x74f"><span>1301</span></td><td id="LC1301" class="css-1dcdqdg"><code>            ChangeTree.prototype.discard = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">changed, discardAll</span>) </span>{
</code></td></tr><tr><td id="L1302" class="css-a4x74f"><span>1302</span></td><td id="LC1302" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L1303" class="css-a4x74f"><span>1303</span></td><td id="LC1303" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (changed === <span class="code-keyword">void</span> <span class="code-number">0</span>) { changed = <span class="code-literal">false</span>; }
</code></td></tr><tr><td id="L1304" class="css-a4x74f"><span>1304</span></td><td id="LC1304" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (discardAll === <span class="code-keyword">void</span> <span class="code-number">0</span>) { discardAll = <span class="code-literal">false</span>; }
</code></td></tr><tr><td id="L1305" class="css-a4x74f"><span>1305</span></td><td id="LC1305" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1306" class="css-a4x74f"><span>1306</span></td><td id="LC1306" class="css-1dcdqdg"><code>                <span class="code-comment">// Map, Array, etc:</span>
</code></td></tr><tr><td id="L1307" class="css-a4x74f"><span>1307</span></td><td id="LC1307" class="css-1dcdqdg"><code>                <span class="code-comment">// Remove cached key to ensure ADD operations is unsed instead of</span>
</code></td></tr><tr><td id="L1308" class="css-a4x74f"><span>1308</span></td><td id="LC1308" class="css-1dcdqdg"><code>                <span class="code-comment">// REPLACE in case same key is used on next patches.</span>
</code></td></tr><tr><td id="L1309" class="css-a4x74f"><span>1309</span></td><td id="LC1309" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1310" class="css-a4x74f"><span>1310</span></td><td id="LC1310" class="css-1dcdqdg"><code>                <span class="code-comment">// <span class="code-doctag">TODO:</span> refactor this. this is not relevant for Collection and Set.</span>
</code></td></tr><tr><td id="L1311" class="css-a4x74f"><span>1311</span></td><td id="LC1311" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1312" class="css-a4x74f"><span>1312</span></td><td id="LC1312" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (!(<span class="code-keyword">this</span>.ref <span class="code-keyword">instanceof</span> Schema)) {
</code></td></tr><tr><td id="L1313" class="css-a4x74f"><span>1313</span></td><td id="LC1313" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.changes.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">change</span>) </span>{
</code></td></tr><tr><td id="L1314" class="css-a4x74f"><span>1314</span></td><td id="LC1314" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (change.op === exports.OPERATION.DELETE) {
</code></td></tr><tr><td id="L1315" class="css-a4x74f"><span>1315</span></td><td id="LC1315" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> index = _this.ref[<span class="code-string">'getIndex'</span>](change.index);
</code></td></tr><tr><td id="L1316" class="css-a4x74f"><span>1316</span></td><td id="LC1316" class="css-1dcdqdg"><code>                            <span class="code-keyword">delete</span> _this.indexes[index];
</code></td></tr><tr><td id="L1317" class="css-a4x74f"><span>1317</span></td><td id="LC1317" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L1318" class="css-a4x74f"><span>1318</span></td><td id="LC1318" class="css-1dcdqdg"><code>                    });
</code></td></tr><tr><td id="L1319" class="css-a4x74f"><span>1319</span></td><td id="LC1319" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1320" class="css-a4x74f"><span>1320</span></td><td id="LC1320" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.changes.clear();
</code></td></tr><tr><td id="L1321" class="css-a4x74f"><span>1321</span></td><td id="LC1321" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.changed = changed;
</code></td></tr><tr><td id="L1322" class="css-a4x74f"><span>1322</span></td><td id="LC1322" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (discardAll) {
</code></td></tr><tr><td id="L1323" class="css-a4x74f"><span>1323</span></td><td id="LC1323" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.allChanges.clear();
</code></td></tr><tr><td id="L1324" class="css-a4x74f"><span>1324</span></td><td id="LC1324" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1325" class="css-a4x74f"><span>1325</span></td><td id="LC1325" class="css-1dcdqdg"><code>                <span class="code-comment">// re-set `currentCustomOperation`</span>
</code></td></tr><tr><td id="L1326" class="css-a4x74f"><span>1326</span></td><td id="LC1326" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.currentCustomOperation = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L1327" class="css-a4x74f"><span>1327</span></td><td id="LC1327" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1328" class="css-a4x74f"><span>1328</span></td><td id="LC1328" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1329" class="css-a4x74f"><span>1329</span></td><td id="LC1329" class="css-1dcdqdg"><code><span class="code-comment">             * Recursively discard all changes from this, and child structures.
</span></code></td></tr><tr><td id="L1330" class="css-a4x74f"><span>1330</span></td><td id="LC1330" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1331" class="css-a4x74f"><span>1331</span></td><td id="LC1331" class="css-1dcdqdg"><code>            ChangeTree.prototype.discardAll = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1332" class="css-a4x74f"><span>1332</span></td><td id="LC1332" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L1333" class="css-a4x74f"><span>1333</span></td><td id="LC1333" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.changes.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">change</span>) </span>{
</code></td></tr><tr><td id="L1334" class="css-a4x74f"><span>1334</span></td><td id="LC1334" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> value = _this.getValue(change.index);
</code></td></tr><tr><td id="L1335" class="css-a4x74f"><span>1335</span></td><td id="LC1335" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (value &amp;&amp; value[<span class="code-string">'$changes'</span>]) {
</code></td></tr><tr><td id="L1336" class="css-a4x74f"><span>1336</span></td><td id="LC1336" class="css-1dcdqdg"><code>                        value[<span class="code-string">'$changes'</span>].discardAll();
</code></td></tr><tr><td id="L1337" class="css-a4x74f"><span>1337</span></td><td id="LC1337" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L1338" class="css-a4x74f"><span>1338</span></td><td id="LC1338" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L1339" class="css-a4x74f"><span>1339</span></td><td id="LC1339" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.discard();
</code></td></tr><tr><td id="L1340" class="css-a4x74f"><span>1340</span></td><td id="LC1340" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1341" class="css-a4x74f"><span>1341</span></td><td id="LC1341" class="css-1dcdqdg"><code>            <span class="code-comment">// cache(field: number, beginIndex: number, endIndex: number) {</span>
</code></td></tr><tr><td id="L1342" class="css-a4x74f"><span>1342</span></td><td id="LC1342" class="css-1dcdqdg"><code>            ChangeTree.prototype.cache = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">field, cachedBytes</span>) </span>{
</code></td></tr><tr><td id="L1343" class="css-a4x74f"><span>1343</span></td><td id="LC1343" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.caches[field] = cachedBytes;
</code></td></tr><tr><td id="L1344" class="css-a4x74f"><span>1344</span></td><td id="LC1344" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1345" class="css-a4x74f"><span>1345</span></td><td id="LC1345" class="css-1dcdqdg"><code>            ChangeTree.prototype.clone = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1346" class="css-a4x74f"><span>1346</span></td><td id="LC1346" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">new</span> ChangeTree(<span class="code-keyword">this</span>.ref, <span class="code-keyword">this</span>.parent, <span class="code-keyword">this</span>.root);
</code></td></tr><tr><td id="L1347" class="css-a4x74f"><span>1347</span></td><td id="LC1347" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1348" class="css-a4x74f"><span>1348</span></td><td id="LC1348" class="css-1dcdqdg"><code>            ChangeTree.prototype.ensureRefId = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1349" class="css-a4x74f"><span>1349</span></td><td id="LC1349" class="css-1dcdqdg"><code>                <span class="code-comment">// skip if refId is already set.</span>
</code></td></tr><tr><td id="L1350" class="css-a4x74f"><span>1350</span></td><td id="LC1350" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.refId !== <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L1351" class="css-a4x74f"><span>1351</span></td><td id="LC1351" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span>;
</code></td></tr><tr><td id="L1352" class="css-a4x74f"><span>1352</span></td><td id="LC1352" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1353" class="css-a4x74f"><span>1353</span></td><td id="LC1353" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.refId = <span class="code-keyword">this</span>.root.getNextUniqueId();
</code></td></tr><tr><td id="L1354" class="css-a4x74f"><span>1354</span></td><td id="LC1354" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1355" class="css-a4x74f"><span>1355</span></td><td id="LC1355" class="css-1dcdqdg"><code>            ChangeTree.prototype.assertValidIndex = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index, fieldName</span>) </span>{
</code></td></tr><tr><td id="L1356" class="css-a4x74f"><span>1356</span></td><td id="LC1356" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (index === <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L1357" class="css-a4x74f"><span>1357</span></td><td id="LC1357" class="css-1dcdqdg"><code>                    <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">"ChangeTree: missing index for field \""</span>.concat(fieldName, <span class="code-string">"\""</span>));
</code></td></tr><tr><td id="L1358" class="css-a4x74f"><span>1358</span></td><td id="LC1358" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1359" class="css-a4x74f"><span>1359</span></td><td id="LC1359" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1360" class="css-a4x74f"><span>1360</span></td><td id="LC1360" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> ChangeTree;
</code></td></tr><tr><td id="L1361" class="css-a4x74f"><span>1361</span></td><td id="LC1361" class="css-1dcdqdg"><code>        }());
</code></td></tr><tr><td id="L1362" class="css-a4x74f"><span>1362</span></td><td id="LC1362" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L1363" class="css-a4x74f"><span>1363</span></td><td id="LC1363" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">addCallback</span>(<span class="code-params">$callbacks, op, callback, existing</span>) </span>{
</code></td></tr><tr><td id="L1364" class="css-a4x74f"><span>1364</span></td><td id="LC1364" class="css-1dcdqdg"><code>            <span class="code-comment">// initialize list of callbacks</span>
</code></td></tr><tr><td id="L1365" class="css-a4x74f"><span>1365</span></td><td id="LC1365" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (!$callbacks[op]) {
</code></td></tr><tr><td id="L1366" class="css-a4x74f"><span>1366</span></td><td id="LC1366" class="css-1dcdqdg"><code>                $callbacks[op] = [];
</code></td></tr><tr><td id="L1367" class="css-a4x74f"><span>1367</span></td><td id="LC1367" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L1368" class="css-a4x74f"><span>1368</span></td><td id="LC1368" class="css-1dcdqdg"><code>            $callbacks[op].push(callback);
</code></td></tr><tr><td id="L1369" class="css-a4x74f"><span>1369</span></td><td id="LC1369" class="css-1dcdqdg"><code>            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1370" class="css-a4x74f"><span>1370</span></td><td id="LC1370" class="css-1dcdqdg"><code>            <span class="code-comment">// Trigger callback for existing elements</span>
</code></td></tr><tr><td id="L1371" class="css-a4x74f"><span>1371</span></td><td id="LC1371" class="css-1dcdqdg"><code>            <span class="code-comment">// - OPERATION.ADD</span>
</code></td></tr><tr><td id="L1372" class="css-a4x74f"><span>1372</span></td><td id="LC1372" class="css-1dcdqdg"><code>            <span class="code-comment">// - OPERATION.REPLACE</span>
</code></td></tr><tr><td id="L1373" class="css-a4x74f"><span>1373</span></td><td id="LC1373" class="css-1dcdqdg"><code>            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1374" class="css-a4x74f"><span>1374</span></td><td id="LC1374" class="css-1dcdqdg"><code>            existing === <span class="code-literal">null</span> || existing === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : existing.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">item, key</span>) </span>{ <span class="code-keyword">return</span> callback(item, key); });
</code></td></tr><tr><td id="L1375" class="css-a4x74f"><span>1375</span></td><td id="LC1375" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{ <span class="code-keyword">return</span> spliceOne($callbacks[op], $callbacks[op].indexOf(callback)); };
</code></td></tr><tr><td id="L1376" class="css-a4x74f"><span>1376</span></td><td id="LC1376" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L1377" class="css-a4x74f"><span>1377</span></td><td id="LC1377" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">removeChildRefs</span>(<span class="code-params">changes</span>) </span>{
</code></td></tr><tr><td id="L1378" class="css-a4x74f"><span>1378</span></td><td id="LC1378" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L1379" class="css-a4x74f"><span>1379</span></td><td id="LC1379" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> needRemoveRef = (<span class="code-keyword">typeof</span> (<span class="code-keyword">this</span>.$changes.getType()) !== <span class="code-string">"string"</span>);
</code></td></tr><tr><td id="L1380" class="css-a4x74f"><span>1380</span></td><td id="LC1380" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.$items.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">item, key</span>) </span>{
</code></td></tr><tr><td id="L1381" class="css-a4x74f"><span>1381</span></td><td id="LC1381" class="css-1dcdqdg"><code>                changes.push({
</code></td></tr><tr><td id="L1382" class="css-a4x74f"><span>1382</span></td><td id="LC1382" class="css-1dcdqdg"><code>                    refId: _this.$changes.refId,
</code></td></tr><tr><td id="L1383" class="css-a4x74f"><span>1383</span></td><td id="LC1383" class="css-1dcdqdg"><code>                    op: exports.OPERATION.DELETE,
</code></td></tr><tr><td id="L1384" class="css-a4x74f"><span>1384</span></td><td id="LC1384" class="css-1dcdqdg"><code>                    field: key,
</code></td></tr><tr><td id="L1385" class="css-a4x74f"><span>1385</span></td><td id="LC1385" class="css-1dcdqdg"><code>                    value: <span class="code-literal">undefined</span>,
</code></td></tr><tr><td id="L1386" class="css-a4x74f"><span>1386</span></td><td id="LC1386" class="css-1dcdqdg"><code>                    previousValue: item
</code></td></tr><tr><td id="L1387" class="css-a4x74f"><span>1387</span></td><td id="LC1387" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L1388" class="css-a4x74f"><span>1388</span></td><td id="LC1388" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (needRemoveRef) {
</code></td></tr><tr><td id="L1389" class="css-a4x74f"><span>1389</span></td><td id="LC1389" class="css-1dcdqdg"><code>                    _this.$changes.root.removeRef(item[<span class="code-string">'$changes'</span>].refId);
</code></td></tr><tr><td id="L1390" class="css-a4x74f"><span>1390</span></td><td id="LC1390" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1391" class="css-a4x74f"><span>1391</span></td><td id="LC1391" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L1392" class="css-a4x74f"><span>1392</span></td><td id="LC1392" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L1393" class="css-a4x74f"><span>1393</span></td><td id="LC1393" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">spliceOne</span>(<span class="code-params">arr, index</span>) </span>{
</code></td></tr><tr><td id="L1394" class="css-a4x74f"><span>1394</span></td><td id="LC1394" class="css-1dcdqdg"><code>            <span class="code-comment">// manually splice an array</span>
</code></td></tr><tr><td id="L1395" class="css-a4x74f"><span>1395</span></td><td id="LC1395" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (index === <span class="code-number">-1</span> || index &gt;= arr.length) {
</code></td></tr><tr><td id="L1396" class="css-a4x74f"><span>1396</span></td><td id="LC1396" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-literal">false</span>;
</code></td></tr><tr><td id="L1397" class="css-a4x74f"><span>1397</span></td><td id="LC1397" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L1398" class="css-a4x74f"><span>1398</span></td><td id="LC1398" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> len = arr.length - <span class="code-number">1</span>;
</code></td></tr><tr><td id="L1399" class="css-a4x74f"><span>1399</span></td><td id="LC1399" class="css-1dcdqdg"><code>            <span class="code-keyword">for</span> (<span class="code-keyword">var</span> i = index; i &lt; len; i++) {
</code></td></tr><tr><td id="L1400" class="css-a4x74f"><span>1400</span></td><td id="LC1400" class="css-1dcdqdg"><code>                arr[i] = arr[i + <span class="code-number">1</span>];
</code></td></tr><tr><td id="L1401" class="css-a4x74f"><span>1401</span></td><td id="LC1401" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L1402" class="css-a4x74f"><span>1402</span></td><td id="LC1402" class="css-1dcdqdg"><code>            arr.length = len;
</code></td></tr><tr><td id="L1403" class="css-a4x74f"><span>1403</span></td><td id="LC1403" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> <span class="code-literal">true</span>;
</code></td></tr><tr><td id="L1404" class="css-a4x74f"><span>1404</span></td><td id="LC1404" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L1405" class="css-a4x74f"><span>1405</span></td><td id="LC1405" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L1406" class="css-a4x74f"><span>1406</span></td><td id="LC1406" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> DEFAULT_SORT = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">a, b</span>) </span>{
</code></td></tr><tr><td id="L1407" class="css-a4x74f"><span>1407</span></td><td id="LC1407" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> A = a.toString();
</code></td></tr><tr><td id="L1408" class="css-a4x74f"><span>1408</span></td><td id="LC1408" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> B = b.toString();
</code></td></tr><tr><td id="L1409" class="css-a4x74f"><span>1409</span></td><td id="LC1409" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (A &lt; B)
</code></td></tr><tr><td id="L1410" class="css-a4x74f"><span>1410</span></td><td id="LC1410" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-number">-1</span>;
</code></td></tr><tr><td id="L1411" class="css-a4x74f"><span>1411</span></td><td id="LC1411" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (A &gt; B)
</code></td></tr><tr><td id="L1412" class="css-a4x74f"><span>1412</span></td><td id="LC1412" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-number">1</span>;
</code></td></tr><tr><td id="L1413" class="css-a4x74f"><span>1413</span></td><td id="LC1413" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span>
</code></td></tr><tr><td id="L1414" class="css-a4x74f"><span>1414</span></td><td id="LC1414" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-number">0</span>;
</code></td></tr><tr><td id="L1415" class="css-a4x74f"><span>1415</span></td><td id="LC1415" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L1416" class="css-a4x74f"><span>1416</span></td><td id="LC1416" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">getArrayProxy</span>(<span class="code-params">value</span>) </span>{
</code></td></tr><tr><td id="L1417" class="css-a4x74f"><span>1417</span></td><td id="LC1417" class="css-1dcdqdg"><code>            value[<span class="code-string">'$proxy'</span>] = <span class="code-literal">true</span>;
</code></td></tr><tr><td id="L1418" class="css-a4x74f"><span>1418</span></td><td id="LC1418" class="css-1dcdqdg"><code>            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1419" class="css-a4x74f"><span>1419</span></td><td id="LC1419" class="css-1dcdqdg"><code>            <span class="code-comment">// compatibility with @colyseus/schema 0.5.x</span>
</code></td></tr><tr><td id="L1420" class="css-a4x74f"><span>1420</span></td><td id="LC1420" class="css-1dcdqdg"><code>            <span class="code-comment">// - allow `map["key"]`</span>
</code></td></tr><tr><td id="L1421" class="css-a4x74f"><span>1421</span></td><td id="LC1421" class="css-1dcdqdg"><code>            <span class="code-comment">// - allow `map["key"] = "xxx"`</span>
</code></td></tr><tr><td id="L1422" class="css-a4x74f"><span>1422</span></td><td id="LC1422" class="css-1dcdqdg"><code>            <span class="code-comment">// - allow `delete map["key"]`</span>
</code></td></tr><tr><td id="L1423" class="css-a4x74f"><span>1423</span></td><td id="LC1423" class="css-1dcdqdg"><code>            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1424" class="css-a4x74f"><span>1424</span></td><td id="LC1424" class="css-1dcdqdg"><code>            value = <span class="code-keyword">new</span> <span class="code-built_in">Proxy</span>(value, {
</code></td></tr><tr><td id="L1425" class="css-a4x74f"><span>1425</span></td><td id="LC1425" class="css-1dcdqdg"><code>                <span class="code-keyword">get</span>: function (obj, prop) {
</code></td></tr><tr><td id="L1426" class="css-a4x74f"><span>1426</span></td><td id="LC1426" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (prop) !== <span class="code-string">"symbol"</span> &amp;&amp;
</code></td></tr><tr><td id="L1427" class="css-a4x74f"><span>1427</span></td><td id="LC1427" class="css-1dcdqdg"><code>                        !<span class="code-built_in">isNaN</span>(prop) <span class="code-comment">// https://stackoverflow.com/a/175787/892698</span>
</code></td></tr><tr><td id="L1428" class="css-a4x74f"><span>1428</span></td><td id="LC1428" class="css-1dcdqdg"><code>                    ) {
</code></td></tr><tr><td id="L1429" class="css-a4x74f"><span>1429</span></td><td id="LC1429" class="css-1dcdqdg"><code>                        <span class="code-keyword">return</span> obj.at(prop);
</code></td></tr><tr><td id="L1430" class="css-a4x74f"><span>1430</span></td><td id="LC1430" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L1431" class="css-a4x74f"><span>1431</span></td><td id="LC1431" class="css-1dcdqdg"><code>                    <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L1432" class="css-a4x74f"><span>1432</span></td><td id="LC1432" class="css-1dcdqdg"><code>                        <span class="code-keyword">return</span> obj[prop];
</code></td></tr><tr><td id="L1433" class="css-a4x74f"><span>1433</span></td><td id="LC1433" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L1434" class="css-a4x74f"><span>1434</span></td><td id="LC1434" class="css-1dcdqdg"><code>                },
</code></td></tr><tr><td id="L1435" class="css-a4x74f"><span>1435</span></td><td id="LC1435" class="css-1dcdqdg"><code>                <span class="code-keyword">set</span>: function (obj, prop, setValue) {
</code></td></tr><tr><td id="L1436" class="css-a4x74f"><span>1436</span></td><td id="LC1436" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (prop) !== <span class="code-string">"symbol"</span> &amp;&amp;
</code></td></tr><tr><td id="L1437" class="css-a4x74f"><span>1437</span></td><td id="LC1437" class="css-1dcdqdg"><code>                        !<span class="code-built_in">isNaN</span>(prop)) {
</code></td></tr><tr><td id="L1438" class="css-a4x74f"><span>1438</span></td><td id="LC1438" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> indexes = <span class="code-built_in">Array</span>.from(obj[<span class="code-string">'$items'</span>].keys());
</code></td></tr><tr><td id="L1439" class="css-a4x74f"><span>1439</span></td><td id="LC1439" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> key = <span class="code-built_in">parseInt</span>(indexes[prop] || prop);
</code></td></tr><tr><td id="L1440" class="css-a4x74f"><span>1440</span></td><td id="LC1440" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (setValue === <span class="code-literal">undefined</span> || setValue === <span class="code-literal">null</span>) {
</code></td></tr><tr><td id="L1441" class="css-a4x74f"><span>1441</span></td><td id="LC1441" class="css-1dcdqdg"><code>                            obj.deleteAt(key);
</code></td></tr><tr><td id="L1442" class="css-a4x74f"><span>1442</span></td><td id="LC1442" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L1443" class="css-a4x74f"><span>1443</span></td><td id="LC1443" class="css-1dcdqdg"><code>                        <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L1444" class="css-a4x74f"><span>1444</span></td><td id="LC1444" class="css-1dcdqdg"><code>                            obj.setAt(key, setValue);
</code></td></tr><tr><td id="L1445" class="css-a4x74f"><span>1445</span></td><td id="LC1445" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L1446" class="css-a4x74f"><span>1446</span></td><td id="LC1446" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L1447" class="css-a4x74f"><span>1447</span></td><td id="LC1447" class="css-1dcdqdg"><code>                    <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L1448" class="css-a4x74f"><span>1448</span></td><td id="LC1448" class="css-1dcdqdg"><code>                        obj[prop] = setValue;
</code></td></tr><tr><td id="L1449" class="css-a4x74f"><span>1449</span></td><td id="LC1449" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L1450" class="css-a4x74f"><span>1450</span></td><td id="LC1450" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-literal">true</span>;
</code></td></tr><tr><td id="L1451" class="css-a4x74f"><span>1451</span></td><td id="LC1451" class="css-1dcdqdg"><code>                },
</code></td></tr><tr><td id="L1452" class="css-a4x74f"><span>1452</span></td><td id="LC1452" class="css-1dcdqdg"><code>                deleteProperty: <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">obj, prop</span>) </span>{
</code></td></tr><tr><td id="L1453" class="css-a4x74f"><span>1453</span></td><td id="LC1453" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (prop) === <span class="code-string">"number"</span>) {
</code></td></tr><tr><td id="L1454" class="css-a4x74f"><span>1454</span></td><td id="LC1454" class="css-1dcdqdg"><code>                        obj.deleteAt(prop);
</code></td></tr><tr><td id="L1455" class="css-a4x74f"><span>1455</span></td><td id="LC1455" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L1456" class="css-a4x74f"><span>1456</span></td><td id="LC1456" class="css-1dcdqdg"><code>                    <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L1457" class="css-a4x74f"><span>1457</span></td><td id="LC1457" class="css-1dcdqdg"><code>                        <span class="code-keyword">delete</span> obj[prop];
</code></td></tr><tr><td id="L1458" class="css-a4x74f"><span>1458</span></td><td id="LC1458" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L1459" class="css-a4x74f"><span>1459</span></td><td id="LC1459" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-literal">true</span>;
</code></td></tr><tr><td id="L1460" class="css-a4x74f"><span>1460</span></td><td id="LC1460" class="css-1dcdqdg"><code>                },
</code></td></tr><tr><td id="L1461" class="css-a4x74f"><span>1461</span></td><td id="LC1461" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L1462" class="css-a4x74f"><span>1462</span></td><td id="LC1462" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> value;
</code></td></tr><tr><td id="L1463" class="css-a4x74f"><span>1463</span></td><td id="LC1463" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L1464" class="css-a4x74f"><span>1464</span></td><td id="LC1464" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> ArraySchema = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1465" class="css-a4x74f"><span>1465</span></td><td id="LC1465" class="css-1dcdqdg"><code>            <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">ArraySchema</span>(<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1466" class="css-a4x74f"><span>1466</span></td><td id="LC1466" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> items = [];
</code></td></tr><tr><td id="L1467" class="css-a4x74f"><span>1467</span></td><td id="LC1467" class="css-1dcdqdg"><code>                <span class="code-keyword">for</span> (<span class="code-keyword">var</span> _i = <span class="code-number">0</span>; _i &lt; <span class="code-built_in">arguments</span>.length; _i++) {
</code></td></tr><tr><td id="L1468" class="css-a4x74f"><span>1468</span></td><td id="LC1468" class="css-1dcdqdg"><code>                    items[_i] = <span class="code-built_in">arguments</span>[_i];
</code></td></tr><tr><td id="L1469" class="css-a4x74f"><span>1469</span></td><td id="LC1469" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1470" class="css-a4x74f"><span>1470</span></td><td id="LC1470" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes = <span class="code-keyword">new</span> ChangeTree(<span class="code-keyword">this</span>);
</code></td></tr><tr><td id="L1471" class="css-a4x74f"><span>1471</span></td><td id="LC1471" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$items = <span class="code-keyword">new</span> <span class="code-built_in">Map</span>();
</code></td></tr><tr><td id="L1472" class="css-a4x74f"><span>1472</span></td><td id="LC1472" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes = <span class="code-keyword">new</span> <span class="code-built_in">Map</span>();
</code></td></tr><tr><td id="L1473" class="css-a4x74f"><span>1473</span></td><td id="LC1473" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$refId = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L1474" class="css-a4x74f"><span>1474</span></td><td id="LC1474" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.push.apply(<span class="code-keyword">this</span>, items);
</code></td></tr><tr><td id="L1475" class="css-a4x74f"><span>1475</span></td><td id="LC1475" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L1476" class="css-a4x74f"><span>1476</span></td><td id="LC1476" class="css-1dcdqdg"><code>            ArraySchema.prototype.onAdd = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback, triggerAll</span>) </span>{
</code></td></tr><tr><td id="L1477" class="css-a4x74f"><span>1477</span></td><td id="LC1477" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (triggerAll === <span class="code-keyword">void</span> <span class="code-number">0</span>) { triggerAll = <span class="code-literal">true</span>; }
</code></td></tr><tr><td id="L1478" class="css-a4x74f"><span>1478</span></td><td id="LC1478" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> addCallback((<span class="code-keyword">this</span>.$callbacks || (<span class="code-keyword">this</span>.$callbacks = [])), exports.OPERATION.ADD, callback, (triggerAll)
</code></td></tr><tr><td id="L1479" class="css-a4x74f"><span>1479</span></td><td id="LC1479" class="css-1dcdqdg"><code>                    ? <span class="code-keyword">this</span>.$items
</code></td></tr><tr><td id="L1480" class="css-a4x74f"><span>1480</span></td><td id="LC1480" class="css-1dcdqdg"><code>                    : <span class="code-literal">undefined</span>);
</code></td></tr><tr><td id="L1481" class="css-a4x74f"><span>1481</span></td><td id="LC1481" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1482" class="css-a4x74f"><span>1482</span></td><td id="LC1482" class="css-1dcdqdg"><code>            ArraySchema.prototype.onRemove = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback</span>) </span>{ <span class="code-keyword">return</span> addCallback(<span class="code-keyword">this</span>.$callbacks || (<span class="code-keyword">this</span>.$callbacks = []), exports.OPERATION.DELETE, callback); };
</code></td></tr><tr><td id="L1483" class="css-a4x74f"><span>1483</span></td><td id="LC1483" class="css-1dcdqdg"><code>            ArraySchema.prototype.onChange = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback</span>) </span>{ <span class="code-keyword">return</span> addCallback(<span class="code-keyword">this</span>.$callbacks || (<span class="code-keyword">this</span>.$callbacks = []), exports.OPERATION.REPLACE, callback); };
</code></td></tr><tr><td id="L1484" class="css-a4x74f"><span>1484</span></td><td id="LC1484" class="css-1dcdqdg"><code>            ArraySchema.is = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">type</span>) </span>{
</code></td></tr><tr><td id="L1485" class="css-a4x74f"><span>1485</span></td><td id="LC1485" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> (
</code></td></tr><tr><td id="L1486" class="css-a4x74f"><span>1486</span></td><td id="LC1486" class="css-1dcdqdg"><code>                <span class="code-comment">// type format: ["string"]</span>
</code></td></tr><tr><td id="L1487" class="css-a4x74f"><span>1487</span></td><td id="LC1487" class="css-1dcdqdg"><code>                <span class="code-built_in">Array</span>.isArray(type) ||
</code></td></tr><tr><td id="L1488" class="css-a4x74f"><span>1488</span></td><td id="LC1488" class="css-1dcdqdg"><code>                    <span class="code-comment">// type format: { array: "string" }</span>
</code></td></tr><tr><td id="L1489" class="css-a4x74f"><span>1489</span></td><td id="LC1489" class="css-1dcdqdg"><code>                    (type[<span class="code-string">'array'</span>] !== <span class="code-literal">undefined</span>));
</code></td></tr><tr><td id="L1490" class="css-a4x74f"><span>1490</span></td><td id="LC1490" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1491" class="css-a4x74f"><span>1491</span></td><td id="LC1491" class="css-1dcdqdg"><code>            <span class="code-built_in">Object</span>.defineProperty(ArraySchema.prototype, <span class="code-string">"length"</span>, {
</code></td></tr><tr><td id="L1492" class="css-a4x74f"><span>1492</span></td><td id="LC1492" class="css-1dcdqdg"><code>                <span class="code-keyword">get</span>: function () {
</code></td></tr><tr><td id="L1493" class="css-a4x74f"><span>1493</span></td><td id="LC1493" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.size;
</code></td></tr><tr><td id="L1494" class="css-a4x74f"><span>1494</span></td><td id="LC1494" class="css-1dcdqdg"><code>                },
</code></td></tr><tr><td id="L1495" class="css-a4x74f"><span>1495</span></td><td id="LC1495" class="css-1dcdqdg"><code>                <span class="code-keyword">set</span>: function (value) {
</code></td></tr><tr><td id="L1496" class="css-a4x74f"><span>1496</span></td><td id="LC1496" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (value === <span class="code-number">0</span>) {
</code></td></tr><tr><td id="L1497" class="css-a4x74f"><span>1497</span></td><td id="LC1497" class="css-1dcdqdg"><code>                        <span class="code-keyword">this</span>.clear();
</code></td></tr><tr><td id="L1498" class="css-a4x74f"><span>1498</span></td><td id="LC1498" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L1499" class="css-a4x74f"><span>1499</span></td><td id="LC1499" class="css-1dcdqdg"><code>                    <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L1500" class="css-a4x74f"><span>1500</span></td><td id="LC1500" class="css-1dcdqdg"><code>                        <span class="code-keyword">this</span>.splice(value, <span class="code-keyword">this</span>.length - value);
</code></td></tr><tr><td id="L1501" class="css-a4x74f"><span>1501</span></td><td id="LC1501" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L1502" class="css-a4x74f"><span>1502</span></td><td id="LC1502" class="css-1dcdqdg"><code>                },
</code></td></tr><tr><td id="L1503" class="css-a4x74f"><span>1503</span></td><td id="LC1503" class="css-1dcdqdg"><code>                enumerable: <span class="code-literal">false</span>,
</code></td></tr><tr><td id="L1504" class="css-a4x74f"><span>1504</span></td><td id="LC1504" class="css-1dcdqdg"><code>                configurable: <span class="code-literal">true</span>
</code></td></tr><tr><td id="L1505" class="css-a4x74f"><span>1505</span></td><td id="LC1505" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L1506" class="css-a4x74f"><span>1506</span></td><td id="LC1506" class="css-1dcdqdg"><code>            ArraySchema.prototype.push = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1507" class="css-a4x74f"><span>1507</span></td><td id="LC1507" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L1508" class="css-a4x74f"><span>1508</span></td><td id="LC1508" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> values = [];
</code></td></tr><tr><td id="L1509" class="css-a4x74f"><span>1509</span></td><td id="LC1509" class="css-1dcdqdg"><code>                <span class="code-keyword">for</span> (<span class="code-keyword">var</span> _i = <span class="code-number">0</span>; _i &lt; <span class="code-built_in">arguments</span>.length; _i++) {
</code></td></tr><tr><td id="L1510" class="css-a4x74f"><span>1510</span></td><td id="LC1510" class="css-1dcdqdg"><code>                    values[_i] = <span class="code-built_in">arguments</span>[_i];
</code></td></tr><tr><td id="L1511" class="css-a4x74f"><span>1511</span></td><td id="LC1511" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1512" class="css-a4x74f"><span>1512</span></td><td id="LC1512" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> lastIndex;
</code></td></tr><tr><td id="L1513" class="css-a4x74f"><span>1513</span></td><td id="LC1513" class="css-1dcdqdg"><code>                values.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">value</span>) </span>{
</code></td></tr><tr><td id="L1514" class="css-a4x74f"><span>1514</span></td><td id="LC1514" class="css-1dcdqdg"><code>                    <span class="code-comment">// set "index" for reference.</span>
</code></td></tr><tr><td id="L1515" class="css-a4x74f"><span>1515</span></td><td id="LC1515" class="css-1dcdqdg"><code>                    lastIndex = _this.$refId++;
</code></td></tr><tr><td id="L1516" class="css-a4x74f"><span>1516</span></td><td id="LC1516" class="css-1dcdqdg"><code>                    _this.setAt(lastIndex, value);
</code></td></tr><tr><td id="L1517" class="css-a4x74f"><span>1517</span></td><td id="LC1517" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L1518" class="css-a4x74f"><span>1518</span></td><td id="LC1518" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> lastIndex;
</code></td></tr><tr><td id="L1519" class="css-a4x74f"><span>1519</span></td><td id="LC1519" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1520" class="css-a4x74f"><span>1520</span></td><td id="LC1520" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1521" class="css-a4x74f"><span>1521</span></td><td id="LC1521" class="css-1dcdqdg"><code><span class="code-comment">             * Removes the last element from an array and returns it.
</span></code></td></tr><tr><td id="L1522" class="css-a4x74f"><span>1522</span></td><td id="LC1522" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1523" class="css-a4x74f"><span>1523</span></td><td id="LC1523" class="css-1dcdqdg"><code>            ArraySchema.prototype.pop = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1524" class="css-a4x74f"><span>1524</span></td><td id="LC1524" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> key = <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$indexes.values()).pop();
</code></td></tr><tr><td id="L1525" class="css-a4x74f"><span>1525</span></td><td id="LC1525" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (key === <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L1526" class="css-a4x74f"><span>1526</span></td><td id="LC1526" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-literal">undefined</span>;
</code></td></tr><tr><td id="L1527" class="css-a4x74f"><span>1527</span></td><td id="LC1527" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1528" class="css-a4x74f"><span>1528</span></td><td id="LC1528" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.delete(key);
</code></td></tr><tr><td id="L1529" class="css-a4x74f"><span>1529</span></td><td id="LC1529" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes.delete(key);
</code></td></tr><tr><td id="L1530" class="css-a4x74f"><span>1530</span></td><td id="LC1530" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> value = <span class="code-keyword">this</span>.$items.get(key);
</code></td></tr><tr><td id="L1531" class="css-a4x74f"><span>1531</span></td><td id="LC1531" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$items.delete(key);
</code></td></tr><tr><td id="L1532" class="css-a4x74f"><span>1532</span></td><td id="LC1532" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> value;
</code></td></tr><tr><td id="L1533" class="css-a4x74f"><span>1533</span></td><td id="LC1533" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1534" class="css-a4x74f"><span>1534</span></td><td id="LC1534" class="css-1dcdqdg"><code>            ArraySchema.prototype.at = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index</span>) </span>{
</code></td></tr><tr><td id="L1535" class="css-a4x74f"><span>1535</span></td><td id="LC1535" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1536" class="css-a4x74f"><span>1536</span></td><td id="LC1536" class="css-1dcdqdg"><code>                <span class="code-comment">// <span class="code-doctag">FIXME:</span> this should be O(1)</span>
</code></td></tr><tr><td id="L1537" class="css-a4x74f"><span>1537</span></td><td id="LC1537" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1538" class="css-a4x74f"><span>1538</span></td><td id="LC1538" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> key = <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.keys())[index];
</code></td></tr><tr><td id="L1539" class="css-a4x74f"><span>1539</span></td><td id="LC1539" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.get(key);
</code></td></tr><tr><td id="L1540" class="css-a4x74f"><span>1540</span></td><td id="LC1540" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1541" class="css-a4x74f"><span>1541</span></td><td id="LC1541" class="css-1dcdqdg"><code>            ArraySchema.prototype.setAt = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index, value</span>) </span>{
</code></td></tr><tr><td id="L1542" class="css-a4x74f"><span>1542</span></td><td id="LC1542" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _a, _b;
</code></td></tr><tr><td id="L1543" class="css-a4x74f"><span>1543</span></td><td id="LC1543" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (value[<span class="code-string">'$changes'</span>] !== <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L1544" class="css-a4x74f"><span>1544</span></td><td id="LC1544" class="css-1dcdqdg"><code>                    value[<span class="code-string">'$changes'</span>].setParent(<span class="code-keyword">this</span>, <span class="code-keyword">this</span>.$changes.root, index);
</code></td></tr><tr><td id="L1545" class="css-a4x74f"><span>1545</span></td><td id="LC1545" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1546" class="css-a4x74f"><span>1546</span></td><td id="LC1546" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> operation = (_b = (_a = <span class="code-keyword">this</span>.$changes.indexes[index]) === <span class="code-literal">null</span> || _a === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _a.op) !== <span class="code-literal">null</span> &amp;&amp; _b !== <span class="code-keyword">void</span> <span class="code-number">0</span> ? _b : exports.OPERATION.ADD;
</code></td></tr><tr><td id="L1547" class="css-a4x74f"><span>1547</span></td><td id="LC1547" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.indexes[index] = index;
</code></td></tr><tr><td id="L1548" class="css-a4x74f"><span>1548</span></td><td id="LC1548" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes.set(index, index);
</code></td></tr><tr><td id="L1549" class="css-a4x74f"><span>1549</span></td><td id="LC1549" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$items.set(index, value);
</code></td></tr><tr><td id="L1550" class="css-a4x74f"><span>1550</span></td><td id="LC1550" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.change(index, operation);
</code></td></tr><tr><td id="L1551" class="css-a4x74f"><span>1551</span></td><td id="LC1551" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1552" class="css-a4x74f"><span>1552</span></td><td id="LC1552" class="css-1dcdqdg"><code>            ArraySchema.prototype.deleteAt = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index</span>) </span>{
</code></td></tr><tr><td id="L1553" class="css-a4x74f"><span>1553</span></td><td id="LC1553" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> key = <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.keys())[index];
</code></td></tr><tr><td id="L1554" class="css-a4x74f"><span>1554</span></td><td id="LC1554" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (key === <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L1555" class="css-a4x74f"><span>1555</span></td><td id="LC1555" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-literal">false</span>;
</code></td></tr><tr><td id="L1556" class="css-a4x74f"><span>1556</span></td><td id="LC1556" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1557" class="css-a4x74f"><span>1557</span></td><td id="LC1557" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$deleteAt(key);
</code></td></tr><tr><td id="L1558" class="css-a4x74f"><span>1558</span></td><td id="LC1558" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1559" class="css-a4x74f"><span>1559</span></td><td id="LC1559" class="css-1dcdqdg"><code>            ArraySchema.prototype.$deleteAt = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index</span>) </span>{
</code></td></tr><tr><td id="L1560" class="css-a4x74f"><span>1560</span></td><td id="LC1560" class="css-1dcdqdg"><code>                <span class="code-comment">// delete at internal index</span>
</code></td></tr><tr><td id="L1561" class="css-a4x74f"><span>1561</span></td><td id="LC1561" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.delete(index);
</code></td></tr><tr><td id="L1562" class="css-a4x74f"><span>1562</span></td><td id="LC1562" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes.delete(index);
</code></td></tr><tr><td id="L1563" class="css-a4x74f"><span>1563</span></td><td id="LC1563" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.delete(index);
</code></td></tr><tr><td id="L1564" class="css-a4x74f"><span>1564</span></td><td id="LC1564" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1565" class="css-a4x74f"><span>1565</span></td><td id="LC1565" class="css-1dcdqdg"><code>            ArraySchema.prototype.clear = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">changes</span>) </span>{
</code></td></tr><tr><td id="L1566" class="css-a4x74f"><span>1566</span></td><td id="LC1566" class="css-1dcdqdg"><code>                <span class="code-comment">// discard previous operations.</span>
</code></td></tr><tr><td id="L1567" class="css-a4x74f"><span>1567</span></td><td id="LC1567" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.discard(<span class="code-literal">true</span>, <span class="code-literal">true</span>);
</code></td></tr><tr><td id="L1568" class="css-a4x74f"><span>1568</span></td><td id="LC1568" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.indexes = {};
</code></td></tr><tr><td id="L1569" class="css-a4x74f"><span>1569</span></td><td id="LC1569" class="css-1dcdqdg"><code>                <span class="code-comment">// clear previous indexes</span>
</code></td></tr><tr><td id="L1570" class="css-a4x74f"><span>1570</span></td><td id="LC1570" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes.clear();
</code></td></tr><tr><td id="L1571" class="css-a4x74f"><span>1571</span></td><td id="LC1571" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1572" class="css-a4x74f"><span>1572</span></td><td id="LC1572" class="css-1dcdqdg"><code>                <span class="code-comment">// When decoding:</span>
</code></td></tr><tr><td id="L1573" class="css-a4x74f"><span>1573</span></td><td id="LC1573" class="css-1dcdqdg"><code>                <span class="code-comment">// - enqueue items for DELETE callback.</span>
</code></td></tr><tr><td id="L1574" class="css-a4x74f"><span>1574</span></td><td id="LC1574" class="css-1dcdqdg"><code>                <span class="code-comment">// - flag child items for garbage collection.</span>
</code></td></tr><tr><td id="L1575" class="css-a4x74f"><span>1575</span></td><td id="LC1575" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1576" class="css-a4x74f"><span>1576</span></td><td id="LC1576" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (changes) {
</code></td></tr><tr><td id="L1577" class="css-a4x74f"><span>1577</span></td><td id="LC1577" class="css-1dcdqdg"><code>                    removeChildRefs.call(<span class="code-keyword">this</span>, changes);
</code></td></tr><tr><td id="L1578" class="css-a4x74f"><span>1578</span></td><td id="LC1578" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1579" class="css-a4x74f"><span>1579</span></td><td id="LC1579" class="css-1dcdqdg"><code>                <span class="code-comment">// clear items</span>
</code></td></tr><tr><td id="L1580" class="css-a4x74f"><span>1580</span></td><td id="LC1580" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$items.clear();
</code></td></tr><tr><td id="L1581" class="css-a4x74f"><span>1581</span></td><td id="LC1581" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.operation({ <span class="code-attr">index</span>: <span class="code-number">0</span>, <span class="code-attr">op</span>: exports.OPERATION.CLEAR });
</code></td></tr><tr><td id="L1582" class="css-a4x74f"><span>1582</span></td><td id="LC1582" class="css-1dcdqdg"><code>                <span class="code-comment">// touch all structures until reach root</span>
</code></td></tr><tr><td id="L1583" class="css-a4x74f"><span>1583</span></td><td id="LC1583" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.touchParents();
</code></td></tr><tr><td id="L1584" class="css-a4x74f"><span>1584</span></td><td id="LC1584" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1585" class="css-a4x74f"><span>1585</span></td><td id="LC1585" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1586" class="css-a4x74f"><span>1586</span></td><td id="LC1586" class="css-1dcdqdg"><code><span class="code-comment">             * Combines two or more arrays.
</span></code></td></tr><tr><td id="L1587" class="css-a4x74f"><span>1587</span></td><td id="LC1587" class="css-1dcdqdg"><code><span class="code-comment">             * @param items Additional items to add to the end of array1.
</span></code></td></tr><tr><td id="L1588" class="css-a4x74f"><span>1588</span></td><td id="LC1588" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1589" class="css-a4x74f"><span>1589</span></td><td id="LC1589" class="css-1dcdqdg"><code>            <span class="code-comment">// @ts-ignore</span>
</code></td></tr><tr><td id="L1590" class="css-a4x74f"><span>1590</span></td><td id="LC1590" class="css-1dcdqdg"><code>            ArraySchema.prototype.concat = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1591" class="css-a4x74f"><span>1591</span></td><td id="LC1591" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _a;
</code></td></tr><tr><td id="L1592" class="css-a4x74f"><span>1592</span></td><td id="LC1592" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> items = [];
</code></td></tr><tr><td id="L1593" class="css-a4x74f"><span>1593</span></td><td id="LC1593" class="css-1dcdqdg"><code>                <span class="code-keyword">for</span> (<span class="code-keyword">var</span> _i = <span class="code-number">0</span>; _i &lt; <span class="code-built_in">arguments</span>.length; _i++) {
</code></td></tr><tr><td id="L1594" class="css-a4x74f"><span>1594</span></td><td id="LC1594" class="css-1dcdqdg"><code>                    items[_i] = <span class="code-built_in">arguments</span>[_i];
</code></td></tr><tr><td id="L1595" class="css-a4x74f"><span>1595</span></td><td id="LC1595" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1596" class="css-a4x74f"><span>1596</span></td><td id="LC1596" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">new</span> (ArraySchema.bind.apply(ArraySchema, __spreadArray([<span class="code-keyword">void</span> <span class="code-number">0</span>], (_a = <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values())).concat.apply(_a, items), <span class="code-literal">false</span>)))();
</code></td></tr><tr><td id="L1597" class="css-a4x74f"><span>1597</span></td><td id="LC1597" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1598" class="css-a4x74f"><span>1598</span></td><td id="LC1598" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1599" class="css-a4x74f"><span>1599</span></td><td id="LC1599" class="css-1dcdqdg"><code><span class="code-comment">             * Adds all the elements of an array separated by the specified separator string.
</span></code></td></tr><tr><td id="L1600" class="css-a4x74f"><span>1600</span></td><td id="LC1600" class="css-1dcdqdg"><code><span class="code-comment">             * @param separator A string used to separate one element of an array from the next in the resulting String. If omitted, the array elements are separated with a comma.
</span></code></td></tr><tr><td id="L1601" class="css-a4x74f"><span>1601</span></td><td id="LC1601" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1602" class="css-a4x74f"><span>1602</span></td><td id="LC1602" class="css-1dcdqdg"><code>            ArraySchema.prototype.join = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">separator</span>) </span>{
</code></td></tr><tr><td id="L1603" class="css-a4x74f"><span>1603</span></td><td id="LC1603" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values()).join(separator);
</code></td></tr><tr><td id="L1604" class="css-a4x74f"><span>1604</span></td><td id="LC1604" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1605" class="css-a4x74f"><span>1605</span></td><td id="LC1605" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1606" class="css-a4x74f"><span>1606</span></td><td id="LC1606" class="css-1dcdqdg"><code><span class="code-comment">             * Reverses the elements in an Array.
</span></code></td></tr><tr><td id="L1607" class="css-a4x74f"><span>1607</span></td><td id="LC1607" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1608" class="css-a4x74f"><span>1608</span></td><td id="LC1608" class="css-1dcdqdg"><code>            <span class="code-comment">// @ts-ignore</span>
</code></td></tr><tr><td id="L1609" class="css-a4x74f"><span>1609</span></td><td id="LC1609" class="css-1dcdqdg"><code>            ArraySchema.prototype.reverse = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1610" class="css-a4x74f"><span>1610</span></td><td id="LC1610" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L1611" class="css-a4x74f"><span>1611</span></td><td id="LC1611" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> indexes = <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.keys());
</code></td></tr><tr><td id="L1612" class="css-a4x74f"><span>1612</span></td><td id="LC1612" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> reversedItems = <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values()).reverse();
</code></td></tr><tr><td id="L1613" class="css-a4x74f"><span>1613</span></td><td id="LC1613" class="css-1dcdqdg"><code>                reversedItems.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">item, i</span>) </span>{
</code></td></tr><tr><td id="L1614" class="css-a4x74f"><span>1614</span></td><td id="LC1614" class="css-1dcdqdg"><code>                    _this.setAt(indexes[i], item);
</code></td></tr><tr><td id="L1615" class="css-a4x74f"><span>1615</span></td><td id="LC1615" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L1616" class="css-a4x74f"><span>1616</span></td><td id="LC1616" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L1617" class="css-a4x74f"><span>1617</span></td><td id="LC1617" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1618" class="css-a4x74f"><span>1618</span></td><td id="LC1618" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1619" class="css-a4x74f"><span>1619</span></td><td id="LC1619" class="css-1dcdqdg"><code><span class="code-comment">             * Removes the first element from an array and returns it.
</span></code></td></tr><tr><td id="L1620" class="css-a4x74f"><span>1620</span></td><td id="LC1620" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1621" class="css-a4x74f"><span>1621</span></td><td id="LC1621" class="css-1dcdqdg"><code>            ArraySchema.prototype.shift = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1622" class="css-a4x74f"><span>1622</span></td><td id="LC1622" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> indexes = <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.keys());
</code></td></tr><tr><td id="L1623" class="css-a4x74f"><span>1623</span></td><td id="LC1623" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> shiftAt = indexes.shift();
</code></td></tr><tr><td id="L1624" class="css-a4x74f"><span>1624</span></td><td id="LC1624" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (shiftAt === <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L1625" class="css-a4x74f"><span>1625</span></td><td id="LC1625" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-literal">undefined</span>;
</code></td></tr><tr><td id="L1626" class="css-a4x74f"><span>1626</span></td><td id="LC1626" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1627" class="css-a4x74f"><span>1627</span></td><td id="LC1627" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> value = <span class="code-keyword">this</span>.$items.get(shiftAt);
</code></td></tr><tr><td id="L1628" class="css-a4x74f"><span>1628</span></td><td id="LC1628" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$deleteAt(shiftAt);
</code></td></tr><tr><td id="L1629" class="css-a4x74f"><span>1629</span></td><td id="LC1629" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> value;
</code></td></tr><tr><td id="L1630" class="css-a4x74f"><span>1630</span></td><td id="LC1630" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1631" class="css-a4x74f"><span>1631</span></td><td id="LC1631" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1632" class="css-a4x74f"><span>1632</span></td><td id="LC1632" class="css-1dcdqdg"><code><span class="code-comment">             * Returns a section of an array.
</span></code></td></tr><tr><td id="L1633" class="css-a4x74f"><span>1633</span></td><td id="LC1633" class="css-1dcdqdg"><code><span class="code-comment">             * @param start The beginning of the specified portion of the array.
</span></code></td></tr><tr><td id="L1634" class="css-a4x74f"><span>1634</span></td><td id="LC1634" class="css-1dcdqdg"><code><span class="code-comment">             * @param end The end of the specified portion of the array. This is exclusive of the element at the index 'end'.
</span></code></td></tr><tr><td id="L1635" class="css-a4x74f"><span>1635</span></td><td id="LC1635" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1636" class="css-a4x74f"><span>1636</span></td><td id="LC1636" class="css-1dcdqdg"><code>            ArraySchema.prototype.slice = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">start, end</span>) </span>{
</code></td></tr><tr><td id="L1637" class="css-a4x74f"><span>1637</span></td><td id="LC1637" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> sliced = <span class="code-keyword">new</span> ArraySchema();
</code></td></tr><tr><td id="L1638" class="css-a4x74f"><span>1638</span></td><td id="LC1638" class="css-1dcdqdg"><code>                sliced.push.apply(sliced, <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values()).slice(start, end));
</code></td></tr><tr><td id="L1639" class="css-a4x74f"><span>1639</span></td><td id="LC1639" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> sliced;
</code></td></tr><tr><td id="L1640" class="css-a4x74f"><span>1640</span></td><td id="LC1640" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1641" class="css-a4x74f"><span>1641</span></td><td id="LC1641" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1642" class="css-a4x74f"><span>1642</span></td><td id="LC1642" class="css-1dcdqdg"><code><span class="code-comment">             * Sorts an array.
</span></code></td></tr><tr><td id="L1643" class="css-a4x74f"><span>1643</span></td><td id="LC1643" class="css-1dcdqdg"><code><span class="code-comment">             * @param compareFn Function used to determine the order of the elements. It is expected to return
</span></code></td></tr><tr><td id="L1644" class="css-a4x74f"><span>1644</span></td><td id="LC1644" class="css-1dcdqdg"><code><span class="code-comment">             * a negative value if first argument is less than second argument, zero if they're equal and a positive
</span></code></td></tr><tr><td id="L1645" class="css-a4x74f"><span>1645</span></td><td id="LC1645" class="css-1dcdqdg"><code><span class="code-comment">             * value otherwise. If omitted, the elements are sorted in ascending, ASCII character order.
</span></code></td></tr><tr><td id="L1646" class="css-a4x74f"><span>1646</span></td><td id="LC1646" class="css-1dcdqdg"><code><span class="code-comment">             * ```ts
</span></code></td></tr><tr><td id="L1647" class="css-a4x74f"><span>1647</span></td><td id="LC1647" class="css-1dcdqdg"><code><span class="code-comment">             * [11,2,22,1].sort((a, b) =&gt; a - b)
</span></code></td></tr><tr><td id="L1648" class="css-a4x74f"><span>1648</span></td><td id="LC1648" class="css-1dcdqdg"><code><span class="code-comment">             * ```
</span></code></td></tr><tr><td id="L1649" class="css-a4x74f"><span>1649</span></td><td id="LC1649" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1650" class="css-a4x74f"><span>1650</span></td><td id="LC1650" class="css-1dcdqdg"><code>            ArraySchema.prototype.sort = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">compareFn</span>) </span>{
</code></td></tr><tr><td id="L1651" class="css-a4x74f"><span>1651</span></td><td id="LC1651" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L1652" class="css-a4x74f"><span>1652</span></td><td id="LC1652" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (compareFn === <span class="code-keyword">void</span> <span class="code-number">0</span>) { compareFn = DEFAULT_SORT; }
</code></td></tr><tr><td id="L1653" class="css-a4x74f"><span>1653</span></td><td id="LC1653" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> indexes = <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.keys());
</code></td></tr><tr><td id="L1654" class="css-a4x74f"><span>1654</span></td><td id="LC1654" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> sortedItems = <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values()).sort(compareFn);
</code></td></tr><tr><td id="L1655" class="css-a4x74f"><span>1655</span></td><td id="LC1655" class="css-1dcdqdg"><code>                sortedItems.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">item, i</span>) </span>{
</code></td></tr><tr><td id="L1656" class="css-a4x74f"><span>1656</span></td><td id="LC1656" class="css-1dcdqdg"><code>                    _this.setAt(indexes[i], item);
</code></td></tr><tr><td id="L1657" class="css-a4x74f"><span>1657</span></td><td id="LC1657" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L1658" class="css-a4x74f"><span>1658</span></td><td id="LC1658" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L1659" class="css-a4x74f"><span>1659</span></td><td id="LC1659" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1660" class="css-a4x74f"><span>1660</span></td><td id="LC1660" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1661" class="css-a4x74f"><span>1661</span></td><td id="LC1661" class="css-1dcdqdg"><code><span class="code-comment">             * Removes elements from an array and, if necessary, inserts new elements in their place, returning the deleted elements.
</span></code></td></tr><tr><td id="L1662" class="css-a4x74f"><span>1662</span></td><td id="LC1662" class="css-1dcdqdg"><code><span class="code-comment">             * @param start The zero-based location in the array from which to start removing elements.
</span></code></td></tr><tr><td id="L1663" class="css-a4x74f"><span>1663</span></td><td id="LC1663" class="css-1dcdqdg"><code><span class="code-comment">             * @param deleteCount The number of elements to remove.
</span></code></td></tr><tr><td id="L1664" class="css-a4x74f"><span>1664</span></td><td id="LC1664" class="css-1dcdqdg"><code><span class="code-comment">             * @param items Elements to insert into the array in place of the deleted elements.
</span></code></td></tr><tr><td id="L1665" class="css-a4x74f"><span>1665</span></td><td id="LC1665" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1666" class="css-a4x74f"><span>1666</span></td><td id="LC1666" class="css-1dcdqdg"><code>            ArraySchema.prototype.splice = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">start, deleteCount</span>) </span>{
</code></td></tr><tr><td id="L1667" class="css-a4x74f"><span>1667</span></td><td id="LC1667" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (deleteCount === <span class="code-keyword">void</span> <span class="code-number">0</span>) { deleteCount = <span class="code-keyword">this</span>.length - start; }
</code></td></tr><tr><td id="L1668" class="css-a4x74f"><span>1668</span></td><td id="LC1668" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> indexes = <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.keys());
</code></td></tr><tr><td id="L1669" class="css-a4x74f"><span>1669</span></td><td id="LC1669" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> removedItems = [];
</code></td></tr><tr><td id="L1670" class="css-a4x74f"><span>1670</span></td><td id="LC1670" class="css-1dcdqdg"><code>                <span class="code-keyword">for</span> (<span class="code-keyword">var</span> i = start; i &lt; start + deleteCount; i++) {
</code></td></tr><tr><td id="L1671" class="css-a4x74f"><span>1671</span></td><td id="LC1671" class="css-1dcdqdg"><code>                    removedItems.push(<span class="code-keyword">this</span>.$items.get(indexes[i]));
</code></td></tr><tr><td id="L1672" class="css-a4x74f"><span>1672</span></td><td id="LC1672" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.$deleteAt(indexes[i]);
</code></td></tr><tr><td id="L1673" class="css-a4x74f"><span>1673</span></td><td id="LC1673" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1674" class="css-a4x74f"><span>1674</span></td><td id="LC1674" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> removedItems;
</code></td></tr><tr><td id="L1675" class="css-a4x74f"><span>1675</span></td><td id="LC1675" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1676" class="css-a4x74f"><span>1676</span></td><td id="LC1676" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1677" class="css-a4x74f"><span>1677</span></td><td id="LC1677" class="css-1dcdqdg"><code><span class="code-comment">             * Inserts new elements at the start of an array.
</span></code></td></tr><tr><td id="L1678" class="css-a4x74f"><span>1678</span></td><td id="LC1678" class="css-1dcdqdg"><code><span class="code-comment">             * @param items  Elements to insert at the start of the Array.
</span></code></td></tr><tr><td id="L1679" class="css-a4x74f"><span>1679</span></td><td id="LC1679" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1680" class="css-a4x74f"><span>1680</span></td><td id="LC1680" class="css-1dcdqdg"><code>            ArraySchema.prototype.unshift = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1681" class="css-a4x74f"><span>1681</span></td><td id="LC1681" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L1682" class="css-a4x74f"><span>1682</span></td><td id="LC1682" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> items = [];
</code></td></tr><tr><td id="L1683" class="css-a4x74f"><span>1683</span></td><td id="LC1683" class="css-1dcdqdg"><code>                <span class="code-keyword">for</span> (<span class="code-keyword">var</span> _i = <span class="code-number">0</span>; _i &lt; <span class="code-built_in">arguments</span>.length; _i++) {
</code></td></tr><tr><td id="L1684" class="css-a4x74f"><span>1684</span></td><td id="LC1684" class="css-1dcdqdg"><code>                    items[_i] = <span class="code-built_in">arguments</span>[_i];
</code></td></tr><tr><td id="L1685" class="css-a4x74f"><span>1685</span></td><td id="LC1685" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1686" class="css-a4x74f"><span>1686</span></td><td id="LC1686" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> length = <span class="code-keyword">this</span>.length;
</code></td></tr><tr><td id="L1687" class="css-a4x74f"><span>1687</span></td><td id="LC1687" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> addedLength = items.length;
</code></td></tr><tr><td id="L1688" class="css-a4x74f"><span>1688</span></td><td id="LC1688" class="css-1dcdqdg"><code>                <span class="code-comment">// const indexes = Array.from(this.$items.keys());</span>
</code></td></tr><tr><td id="L1689" class="css-a4x74f"><span>1689</span></td><td id="LC1689" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> previousValues = <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values());
</code></td></tr><tr><td id="L1690" class="css-a4x74f"><span>1690</span></td><td id="LC1690" class="css-1dcdqdg"><code>                items.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">item, i</span>) </span>{
</code></td></tr><tr><td id="L1691" class="css-a4x74f"><span>1691</span></td><td id="LC1691" class="css-1dcdqdg"><code>                    _this.setAt(i, item);
</code></td></tr><tr><td id="L1692" class="css-a4x74f"><span>1692</span></td><td id="LC1692" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L1693" class="css-a4x74f"><span>1693</span></td><td id="LC1693" class="css-1dcdqdg"><code>                previousValues.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">previousValue, i</span>) </span>{
</code></td></tr><tr><td id="L1694" class="css-a4x74f"><span>1694</span></td><td id="LC1694" class="css-1dcdqdg"><code>                    _this.setAt(addedLength + i, previousValue);
</code></td></tr><tr><td id="L1695" class="css-a4x74f"><span>1695</span></td><td id="LC1695" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L1696" class="css-a4x74f"><span>1696</span></td><td id="LC1696" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> length + addedLength;
</code></td></tr><tr><td id="L1697" class="css-a4x74f"><span>1697</span></td><td id="LC1697" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1698" class="css-a4x74f"><span>1698</span></td><td id="LC1698" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1699" class="css-a4x74f"><span>1699</span></td><td id="LC1699" class="css-1dcdqdg"><code><span class="code-comment">             * Returns the index of the first occurrence of a value in an array.
</span></code></td></tr><tr><td id="L1700" class="css-a4x74f"><span>1700</span></td><td id="LC1700" class="css-1dcdqdg"><code><span class="code-comment">             * @param searchElement The value to locate in the array.
</span></code></td></tr><tr><td id="L1701" class="css-a4x74f"><span>1701</span></td><td id="LC1701" class="css-1dcdqdg"><code><span class="code-comment">             * @param fromIndex The array index at which to begin the search. If fromIndex is omitted, the search starts at index 0.
</span></code></td></tr><tr><td id="L1702" class="css-a4x74f"><span>1702</span></td><td id="LC1702" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1703" class="css-a4x74f"><span>1703</span></td><td id="LC1703" class="css-1dcdqdg"><code>            ArraySchema.prototype.indexOf = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">searchElement, fromIndex</span>) </span>{
</code></td></tr><tr><td id="L1704" class="css-a4x74f"><span>1704</span></td><td id="LC1704" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values()).indexOf(searchElement, fromIndex);
</code></td></tr><tr><td id="L1705" class="css-a4x74f"><span>1705</span></td><td id="LC1705" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1706" class="css-a4x74f"><span>1706</span></td><td id="LC1706" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1707" class="css-a4x74f"><span>1707</span></td><td id="LC1707" class="css-1dcdqdg"><code><span class="code-comment">             * Returns the index of the last occurrence of a specified value in an array.
</span></code></td></tr><tr><td id="L1708" class="css-a4x74f"><span>1708</span></td><td id="LC1708" class="css-1dcdqdg"><code><span class="code-comment">             * @param searchElement The value to locate in the array.
</span></code></td></tr><tr><td id="L1709" class="css-a4x74f"><span>1709</span></td><td id="LC1709" class="css-1dcdqdg"><code><span class="code-comment">             * @param fromIndex The array index at which to begin the search. If fromIndex is omitted, the search starts at the last index in the array.
</span></code></td></tr><tr><td id="L1710" class="css-a4x74f"><span>1710</span></td><td id="LC1710" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1711" class="css-a4x74f"><span>1711</span></td><td id="LC1711" class="css-1dcdqdg"><code>            ArraySchema.prototype.lastIndexOf = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">searchElement, fromIndex</span>) </span>{
</code></td></tr><tr><td id="L1712" class="css-a4x74f"><span>1712</span></td><td id="LC1712" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (fromIndex === <span class="code-keyword">void</span> <span class="code-number">0</span>) { fromIndex = <span class="code-keyword">this</span>.length - <span class="code-number">1</span>; }
</code></td></tr><tr><td id="L1713" class="css-a4x74f"><span>1713</span></td><td id="LC1713" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values()).lastIndexOf(searchElement, fromIndex);
</code></td></tr><tr><td id="L1714" class="css-a4x74f"><span>1714</span></td><td id="LC1714" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1715" class="css-a4x74f"><span>1715</span></td><td id="LC1715" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1716" class="css-a4x74f"><span>1716</span></td><td id="LC1716" class="css-1dcdqdg"><code><span class="code-comment">             * Determines whether all the members of an array satisfy the specified test.
</span></code></td></tr><tr><td id="L1717" class="css-a4x74f"><span>1717</span></td><td id="LC1717" class="css-1dcdqdg"><code><span class="code-comment">             * @param callbackfn A function that accepts up to three arguments. The every method calls
</span></code></td></tr><tr><td id="L1718" class="css-a4x74f"><span>1718</span></td><td id="LC1718" class="css-1dcdqdg"><code><span class="code-comment">             * the callbackfn function for each element in the array until the callbackfn returns a value
</span></code></td></tr><tr><td id="L1719" class="css-a4x74f"><span>1719</span></td><td id="LC1719" class="css-1dcdqdg"><code><span class="code-comment">             * which is coercible to the Boolean value false, or until the end of the array.
</span></code></td></tr><tr><td id="L1720" class="css-a4x74f"><span>1720</span></td><td id="LC1720" class="css-1dcdqdg"><code><span class="code-comment">             * @param thisArg An object to which the this keyword can refer in the callbackfn function.
</span></code></td></tr><tr><td id="L1721" class="css-a4x74f"><span>1721</span></td><td id="LC1721" class="css-1dcdqdg"><code><span class="code-comment">             * If thisArg is omitted, undefined is used as the this value.
</span></code></td></tr><tr><td id="L1722" class="css-a4x74f"><span>1722</span></td><td id="LC1722" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1723" class="css-a4x74f"><span>1723</span></td><td id="LC1723" class="css-1dcdqdg"><code>            ArraySchema.prototype.every = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callbackfn, thisArg</span>) </span>{
</code></td></tr><tr><td id="L1724" class="css-a4x74f"><span>1724</span></td><td id="LC1724" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values()).every(callbackfn, thisArg);
</code></td></tr><tr><td id="L1725" class="css-a4x74f"><span>1725</span></td><td id="LC1725" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1726" class="css-a4x74f"><span>1726</span></td><td id="LC1726" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1727" class="css-a4x74f"><span>1727</span></td><td id="LC1727" class="css-1dcdqdg"><code><span class="code-comment">             * Determines whether the specified callback function returns true for any element of an array.
</span></code></td></tr><tr><td id="L1728" class="css-a4x74f"><span>1728</span></td><td id="LC1728" class="css-1dcdqdg"><code><span class="code-comment">             * @param callbackfn A function that accepts up to three arguments. The some method calls
</span></code></td></tr><tr><td id="L1729" class="css-a4x74f"><span>1729</span></td><td id="LC1729" class="css-1dcdqdg"><code><span class="code-comment">             * the callbackfn function for each element in the array until the callbackfn returns a value
</span></code></td></tr><tr><td id="L1730" class="css-a4x74f"><span>1730</span></td><td id="LC1730" class="css-1dcdqdg"><code><span class="code-comment">             * which is coercible to the Boolean value true, or until the end of the array.
</span></code></td></tr><tr><td id="L1731" class="css-a4x74f"><span>1731</span></td><td id="LC1731" class="css-1dcdqdg"><code><span class="code-comment">             * @param thisArg An object to which the this keyword can refer in the callbackfn function.
</span></code></td></tr><tr><td id="L1732" class="css-a4x74f"><span>1732</span></td><td id="LC1732" class="css-1dcdqdg"><code><span class="code-comment">             * If thisArg is omitted, undefined is used as the this value.
</span></code></td></tr><tr><td id="L1733" class="css-a4x74f"><span>1733</span></td><td id="LC1733" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1734" class="css-a4x74f"><span>1734</span></td><td id="LC1734" class="css-1dcdqdg"><code>            ArraySchema.prototype.some = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callbackfn, thisArg</span>) </span>{
</code></td></tr><tr><td id="L1735" class="css-a4x74f"><span>1735</span></td><td id="LC1735" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values()).some(callbackfn, thisArg);
</code></td></tr><tr><td id="L1736" class="css-a4x74f"><span>1736</span></td><td id="LC1736" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1737" class="css-a4x74f"><span>1737</span></td><td id="LC1737" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1738" class="css-a4x74f"><span>1738</span></td><td id="LC1738" class="css-1dcdqdg"><code><span class="code-comment">             * Performs the specified action for each element in an array.
</span></code></td></tr><tr><td id="L1739" class="css-a4x74f"><span>1739</span></td><td id="LC1739" class="css-1dcdqdg"><code><span class="code-comment">             * @param callbackfn  A function that accepts up to three arguments. forEach calls the callbackfn function one time for each element in the array.
</span></code></td></tr><tr><td id="L1740" class="css-a4x74f"><span>1740</span></td><td id="LC1740" class="css-1dcdqdg"><code><span class="code-comment">             * @param thisArg  An object to which the this keyword can refer in the callbackfn function. If thisArg is omitted, undefined is used as the this value.
</span></code></td></tr><tr><td id="L1741" class="css-a4x74f"><span>1741</span></td><td id="LC1741" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1742" class="css-a4x74f"><span>1742</span></td><td id="LC1742" class="css-1dcdqdg"><code>            ArraySchema.prototype.forEach = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callbackfn, thisArg</span>) </span>{
</code></td></tr><tr><td id="L1743" class="css-a4x74f"><span>1743</span></td><td id="LC1743" class="css-1dcdqdg"><code>                <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values()).forEach(callbackfn, thisArg);
</code></td></tr><tr><td id="L1744" class="css-a4x74f"><span>1744</span></td><td id="LC1744" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1745" class="css-a4x74f"><span>1745</span></td><td id="LC1745" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1746" class="css-a4x74f"><span>1746</span></td><td id="LC1746" class="css-1dcdqdg"><code><span class="code-comment">             * Calls a defined callback function on each element of an array, and returns an array that contains the results.
</span></code></td></tr><tr><td id="L1747" class="css-a4x74f"><span>1747</span></td><td id="LC1747" class="css-1dcdqdg"><code><span class="code-comment">             * @param callbackfn A function that accepts up to three arguments. The map method calls the callbackfn function one time for each element in the array.
</span></code></td></tr><tr><td id="L1748" class="css-a4x74f"><span>1748</span></td><td id="LC1748" class="css-1dcdqdg"><code><span class="code-comment">             * @param thisArg An object to which the this keyword can refer in the callbackfn function. If thisArg is omitted, undefined is used as the this value.
</span></code></td></tr><tr><td id="L1749" class="css-a4x74f"><span>1749</span></td><td id="LC1749" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1750" class="css-a4x74f"><span>1750</span></td><td id="LC1750" class="css-1dcdqdg"><code>            ArraySchema.prototype.map = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callbackfn, thisArg</span>) </span>{
</code></td></tr><tr><td id="L1751" class="css-a4x74f"><span>1751</span></td><td id="LC1751" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values()).map(callbackfn, thisArg);
</code></td></tr><tr><td id="L1752" class="css-a4x74f"><span>1752</span></td><td id="LC1752" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1753" class="css-a4x74f"><span>1753</span></td><td id="LC1753" class="css-1dcdqdg"><code>            ArraySchema.prototype.filter = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callbackfn, thisArg</span>) </span>{
</code></td></tr><tr><td id="L1754" class="css-a4x74f"><span>1754</span></td><td id="LC1754" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values()).filter(callbackfn, thisArg);
</code></td></tr><tr><td id="L1755" class="css-a4x74f"><span>1755</span></td><td id="LC1755" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1756" class="css-a4x74f"><span>1756</span></td><td id="LC1756" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1757" class="css-a4x74f"><span>1757</span></td><td id="LC1757" class="css-1dcdqdg"><code><span class="code-comment">             * Calls the specified callback function for all the elements in an array. The return value of the callback function is the accumulated result, and is provided as an argument in the next call to the callback function.
</span></code></td></tr><tr><td id="L1758" class="css-a4x74f"><span>1758</span></td><td id="LC1758" class="css-1dcdqdg"><code><span class="code-comment">             * @param callbackfn A function that accepts up to four arguments. The reduce method calls the callbackfn function one time for each element in the array.
</span></code></td></tr><tr><td id="L1759" class="css-a4x74f"><span>1759</span></td><td id="LC1759" class="css-1dcdqdg"><code><span class="code-comment">             * @param initialValue If initialValue is specified, it is used as the initial value to start the accumulation. The first call to the callbackfn function provides this value as an argument instead of an array value.
</span></code></td></tr><tr><td id="L1760" class="css-a4x74f"><span>1760</span></td><td id="LC1760" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1761" class="css-a4x74f"><span>1761</span></td><td id="LC1761" class="css-1dcdqdg"><code>            ArraySchema.prototype.reduce = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callbackfn, initialValue</span>) </span>{
</code></td></tr><tr><td id="L1762" class="css-a4x74f"><span>1762</span></td><td id="LC1762" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-built_in">Array</span>.prototype.reduce.apply(<span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values()), <span class="code-built_in">arguments</span>);
</code></td></tr><tr><td id="L1763" class="css-a4x74f"><span>1763</span></td><td id="LC1763" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1764" class="css-a4x74f"><span>1764</span></td><td id="LC1764" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1765" class="css-a4x74f"><span>1765</span></td><td id="LC1765" class="css-1dcdqdg"><code><span class="code-comment">             * Calls the specified callback function for all the elements in an array, in descending order. The return value of the callback function is the accumulated result, and is provided as an argument in the next call to the callback function.
</span></code></td></tr><tr><td id="L1766" class="css-a4x74f"><span>1766</span></td><td id="LC1766" class="css-1dcdqdg"><code><span class="code-comment">             * @param callbackfn A function that accepts up to four arguments. The reduceRight method calls the callbackfn function one time for each element in the array.
</span></code></td></tr><tr><td id="L1767" class="css-a4x74f"><span>1767</span></td><td id="LC1767" class="css-1dcdqdg"><code><span class="code-comment">             * @param initialValue If initialValue is specified, it is used as the initial value to start the accumulation. The first call to the callbackfn function provides this value as an argument instead of an array value.
</span></code></td></tr><tr><td id="L1768" class="css-a4x74f"><span>1768</span></td><td id="LC1768" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1769" class="css-a4x74f"><span>1769</span></td><td id="LC1769" class="css-1dcdqdg"><code>            ArraySchema.prototype.reduceRight = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callbackfn, initialValue</span>) </span>{
</code></td></tr><tr><td id="L1770" class="css-a4x74f"><span>1770</span></td><td id="LC1770" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-built_in">Array</span>.prototype.reduceRight.apply(<span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values()), <span class="code-built_in">arguments</span>);
</code></td></tr><tr><td id="L1771" class="css-a4x74f"><span>1771</span></td><td id="LC1771" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1772" class="css-a4x74f"><span>1772</span></td><td id="LC1772" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1773" class="css-a4x74f"><span>1773</span></td><td id="LC1773" class="css-1dcdqdg"><code><span class="code-comment">             * Returns the value of the first element in the array where predicate is true, and undefined
</span></code></td></tr><tr><td id="L1774" class="css-a4x74f"><span>1774</span></td><td id="LC1774" class="css-1dcdqdg"><code><span class="code-comment">             * otherwise.
</span></code></td></tr><tr><td id="L1775" class="css-a4x74f"><span>1775</span></td><td id="LC1775" class="css-1dcdqdg"><code><span class="code-comment">             * @param predicate find calls predicate once for each element of the array, in ascending
</span></code></td></tr><tr><td id="L1776" class="css-a4x74f"><span>1776</span></td><td id="LC1776" class="css-1dcdqdg"><code><span class="code-comment">             * order, until it finds one where predicate returns true. If such an element is found, find
</span></code></td></tr><tr><td id="L1777" class="css-a4x74f"><span>1777</span></td><td id="LC1777" class="css-1dcdqdg"><code><span class="code-comment">             * immediately returns that element value. Otherwise, find returns undefined.
</span></code></td></tr><tr><td id="L1778" class="css-a4x74f"><span>1778</span></td><td id="LC1778" class="css-1dcdqdg"><code><span class="code-comment">             * @param thisArg If provided, it will be used as the this value for each invocation of
</span></code></td></tr><tr><td id="L1779" class="css-a4x74f"><span>1779</span></td><td id="LC1779" class="css-1dcdqdg"><code><span class="code-comment">             * predicate. If it is not provided, undefined is used instead.
</span></code></td></tr><tr><td id="L1780" class="css-a4x74f"><span>1780</span></td><td id="LC1780" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1781" class="css-a4x74f"><span>1781</span></td><td id="LC1781" class="css-1dcdqdg"><code>            ArraySchema.prototype.find = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">predicate, thisArg</span>) </span>{
</code></td></tr><tr><td id="L1782" class="css-a4x74f"><span>1782</span></td><td id="LC1782" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values()).find(predicate, thisArg);
</code></td></tr><tr><td id="L1783" class="css-a4x74f"><span>1783</span></td><td id="LC1783" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1784" class="css-a4x74f"><span>1784</span></td><td id="LC1784" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1785" class="css-a4x74f"><span>1785</span></td><td id="LC1785" class="css-1dcdqdg"><code><span class="code-comment">             * Returns the index of the first element in the array where predicate is true, and -1
</span></code></td></tr><tr><td id="L1786" class="css-a4x74f"><span>1786</span></td><td id="LC1786" class="css-1dcdqdg"><code><span class="code-comment">             * otherwise.
</span></code></td></tr><tr><td id="L1787" class="css-a4x74f"><span>1787</span></td><td id="LC1787" class="css-1dcdqdg"><code><span class="code-comment">             * @param predicate find calls predicate once for each element of the array, in ascending
</span></code></td></tr><tr><td id="L1788" class="css-a4x74f"><span>1788</span></td><td id="LC1788" class="css-1dcdqdg"><code><span class="code-comment">             * order, until it finds one where predicate returns true. If such an element is found,
</span></code></td></tr><tr><td id="L1789" class="css-a4x74f"><span>1789</span></td><td id="LC1789" class="css-1dcdqdg"><code><span class="code-comment">             * findIndex immediately returns that element index. Otherwise, findIndex returns -1.
</span></code></td></tr><tr><td id="L1790" class="css-a4x74f"><span>1790</span></td><td id="LC1790" class="css-1dcdqdg"><code><span class="code-comment">             * @param thisArg If provided, it will be used as the this value for each invocation of
</span></code></td></tr><tr><td id="L1791" class="css-a4x74f"><span>1791</span></td><td id="LC1791" class="css-1dcdqdg"><code><span class="code-comment">             * predicate. If it is not provided, undefined is used instead.
</span></code></td></tr><tr><td id="L1792" class="css-a4x74f"><span>1792</span></td><td id="LC1792" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1793" class="css-a4x74f"><span>1793</span></td><td id="LC1793" class="css-1dcdqdg"><code>            ArraySchema.prototype.findIndex = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">predicate, thisArg</span>) </span>{
</code></td></tr><tr><td id="L1794" class="css-a4x74f"><span>1794</span></td><td id="LC1794" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values()).findIndex(predicate, thisArg);
</code></td></tr><tr><td id="L1795" class="css-a4x74f"><span>1795</span></td><td id="LC1795" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1796" class="css-a4x74f"><span>1796</span></td><td id="LC1796" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1797" class="css-a4x74f"><span>1797</span></td><td id="LC1797" class="css-1dcdqdg"><code><span class="code-comment">             * Returns the this object after filling the section identified by start and end with value
</span></code></td></tr><tr><td id="L1798" class="css-a4x74f"><span>1798</span></td><td id="LC1798" class="css-1dcdqdg"><code><span class="code-comment">             * @param value value to fill array section with
</span></code></td></tr><tr><td id="L1799" class="css-a4x74f"><span>1799</span></td><td id="LC1799" class="css-1dcdqdg"><code><span class="code-comment">             * @param start index to start filling the array at. If start is negative, it is treated as
</span></code></td></tr><tr><td id="L1800" class="css-a4x74f"><span>1800</span></td><td id="LC1800" class="css-1dcdqdg"><code><span class="code-comment">             * length+start where length is the length of the array.
</span></code></td></tr><tr><td id="L1801" class="css-a4x74f"><span>1801</span></td><td id="LC1801" class="css-1dcdqdg"><code><span class="code-comment">             * @param end index to stop filling the array at. If end is negative, it is treated as
</span></code></td></tr><tr><td id="L1802" class="css-a4x74f"><span>1802</span></td><td id="LC1802" class="css-1dcdqdg"><code><span class="code-comment">             * length+end.
</span></code></td></tr><tr><td id="L1803" class="css-a4x74f"><span>1803</span></td><td id="LC1803" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1804" class="css-a4x74f"><span>1804</span></td><td id="LC1804" class="css-1dcdqdg"><code>            ArraySchema.prototype.fill = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">value, start, end</span>) </span>{
</code></td></tr><tr><td id="L1805" class="css-a4x74f"><span>1805</span></td><td id="LC1805" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1806" class="css-a4x74f"><span>1806</span></td><td id="LC1806" class="css-1dcdqdg"><code>                <span class="code-comment">// TODO</span>
</code></td></tr><tr><td id="L1807" class="css-a4x74f"><span>1807</span></td><td id="LC1807" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1808" class="css-a4x74f"><span>1808</span></td><td id="LC1808" class="css-1dcdqdg"><code>                <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">"ArraySchema#fill() not implemented"</span>);
</code></td></tr><tr><td id="L1809" class="css-a4x74f"><span>1809</span></td><td id="LC1809" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1810" class="css-a4x74f"><span>1810</span></td><td id="LC1810" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1811" class="css-a4x74f"><span>1811</span></td><td id="LC1811" class="css-1dcdqdg"><code><span class="code-comment">             * Returns the this object after copying a section of the array identified by start and end
</span></code></td></tr><tr><td id="L1812" class="css-a4x74f"><span>1812</span></td><td id="LC1812" class="css-1dcdqdg"><code><span class="code-comment">             * to the same array starting at position target
</span></code></td></tr><tr><td id="L1813" class="css-a4x74f"><span>1813</span></td><td id="LC1813" class="css-1dcdqdg"><code><span class="code-comment">             * @param target If target is negative, it is treated as length+target where length is the
</span></code></td></tr><tr><td id="L1814" class="css-a4x74f"><span>1814</span></td><td id="LC1814" class="css-1dcdqdg"><code><span class="code-comment">             * length of the array.
</span></code></td></tr><tr><td id="L1815" class="css-a4x74f"><span>1815</span></td><td id="LC1815" class="css-1dcdqdg"><code><span class="code-comment">             * @param start If start is negative, it is treated as length+start. If end is negative, it
</span></code></td></tr><tr><td id="L1816" class="css-a4x74f"><span>1816</span></td><td id="LC1816" class="css-1dcdqdg"><code><span class="code-comment">             * is treated as length+end.
</span></code></td></tr><tr><td id="L1817" class="css-a4x74f"><span>1817</span></td><td id="LC1817" class="css-1dcdqdg"><code><span class="code-comment">             * @param end If not specified, length of the this object is used as its default value.
</span></code></td></tr><tr><td id="L1818" class="css-a4x74f"><span>1818</span></td><td id="LC1818" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1819" class="css-a4x74f"><span>1819</span></td><td id="LC1819" class="css-1dcdqdg"><code>            ArraySchema.prototype.copyWithin = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">target, start, end</span>) </span>{
</code></td></tr><tr><td id="L1820" class="css-a4x74f"><span>1820</span></td><td id="LC1820" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1821" class="css-a4x74f"><span>1821</span></td><td id="LC1821" class="css-1dcdqdg"><code>                <span class="code-comment">// TODO</span>
</code></td></tr><tr><td id="L1822" class="css-a4x74f"><span>1822</span></td><td id="LC1822" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1823" class="css-a4x74f"><span>1823</span></td><td id="LC1823" class="css-1dcdqdg"><code>                <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">"ArraySchema#copyWithin() not implemented"</span>);
</code></td></tr><tr><td id="L1824" class="css-a4x74f"><span>1824</span></td><td id="LC1824" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1825" class="css-a4x74f"><span>1825</span></td><td id="LC1825" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1826" class="css-a4x74f"><span>1826</span></td><td id="LC1826" class="css-1dcdqdg"><code><span class="code-comment">             * Returns a string representation of an array.
</span></code></td></tr><tr><td id="L1827" class="css-a4x74f"><span>1827</span></td><td id="LC1827" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1828" class="css-a4x74f"><span>1828</span></td><td id="LC1828" class="css-1dcdqdg"><code>            ArraySchema.prototype.toString = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{ <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.toString(); };
</code></td></tr><tr><td id="L1829" class="css-a4x74f"><span>1829</span></td><td id="LC1829" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1830" class="css-a4x74f"><span>1830</span></td><td id="LC1830" class="css-1dcdqdg"><code><span class="code-comment">             * Returns a string representation of an array. The elements are converted to string using their toLocalString methods.
</span></code></td></tr><tr><td id="L1831" class="css-a4x74f"><span>1831</span></td><td id="LC1831" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1832" class="css-a4x74f"><span>1832</span></td><td id="LC1832" class="css-1dcdqdg"><code>            ArraySchema.prototype.toLocaleString = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{ <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.toLocaleString(); };
</code></td></tr><tr><td id="L1833" class="css-a4x74f"><span>1833</span></td><td id="LC1833" class="css-1dcdqdg"><code>            <span class="code-comment">/** Iterator */</span>
</code></td></tr><tr><td id="L1834" class="css-a4x74f"><span>1834</span></td><td id="LC1834" class="css-1dcdqdg"><code>            ArraySchema.prototype[<span class="code-built_in">Symbol</span>.iterator] = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1835" class="css-a4x74f"><span>1835</span></td><td id="LC1835" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values())[<span class="code-built_in">Symbol</span>.iterator]();
</code></td></tr><tr><td id="L1836" class="css-a4x74f"><span>1836</span></td><td id="LC1836" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1837" class="css-a4x74f"><span>1837</span></td><td id="LC1837" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1838" class="css-a4x74f"><span>1838</span></td><td id="LC1838" class="css-1dcdqdg"><code><span class="code-comment">             * Returns an iterable of key, value pairs for every entry in the array
</span></code></td></tr><tr><td id="L1839" class="css-a4x74f"><span>1839</span></td><td id="LC1839" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1840" class="css-a4x74f"><span>1840</span></td><td id="LC1840" class="css-1dcdqdg"><code>            ArraySchema.prototype.entries = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{ <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.entries(); };
</code></td></tr><tr><td id="L1841" class="css-a4x74f"><span>1841</span></td><td id="LC1841" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1842" class="css-a4x74f"><span>1842</span></td><td id="LC1842" class="css-1dcdqdg"><code><span class="code-comment">             * Returns an iterable of keys in the array
</span></code></td></tr><tr><td id="L1843" class="css-a4x74f"><span>1843</span></td><td id="LC1843" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1844" class="css-a4x74f"><span>1844</span></td><td id="LC1844" class="css-1dcdqdg"><code>            ArraySchema.prototype.keys = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{ <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.keys(); };
</code></td></tr><tr><td id="L1845" class="css-a4x74f"><span>1845</span></td><td id="LC1845" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1846" class="css-a4x74f"><span>1846</span></td><td id="LC1846" class="css-1dcdqdg"><code><span class="code-comment">             * Returns an iterable of values in the array
</span></code></td></tr><tr><td id="L1847" class="css-a4x74f"><span>1847</span></td><td id="LC1847" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1848" class="css-a4x74f"><span>1848</span></td><td id="LC1848" class="css-1dcdqdg"><code>            ArraySchema.prototype.values = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{ <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.values(); };
</code></td></tr><tr><td id="L1849" class="css-a4x74f"><span>1849</span></td><td id="LC1849" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1850" class="css-a4x74f"><span>1850</span></td><td id="LC1850" class="css-1dcdqdg"><code><span class="code-comment">             * Determines whether an array includes a certain element, returning true or false as appropriate.
</span></code></td></tr><tr><td id="L1851" class="css-a4x74f"><span>1851</span></td><td id="LC1851" class="css-1dcdqdg"><code><span class="code-comment">             * @param searchElement The element to search for.
</span></code></td></tr><tr><td id="L1852" class="css-a4x74f"><span>1852</span></td><td id="LC1852" class="css-1dcdqdg"><code><span class="code-comment">             * @param fromIndex The position in this array at which to begin searching for searchElement.
</span></code></td></tr><tr><td id="L1853" class="css-a4x74f"><span>1853</span></td><td id="LC1853" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1854" class="css-a4x74f"><span>1854</span></td><td id="LC1854" class="css-1dcdqdg"><code>            ArraySchema.prototype.includes = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">searchElement, fromIndex</span>) </span>{
</code></td></tr><tr><td id="L1855" class="css-a4x74f"><span>1855</span></td><td id="LC1855" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values()).includes(searchElement, fromIndex);
</code></td></tr><tr><td id="L1856" class="css-a4x74f"><span>1856</span></td><td id="LC1856" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1857" class="css-a4x74f"><span>1857</span></td><td id="LC1857" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1858" class="css-a4x74f"><span>1858</span></td><td id="LC1858" class="css-1dcdqdg"><code><span class="code-comment">             * Calls a defined callback function on each element of an array. Then, flattens the result into
</span></code></td></tr><tr><td id="L1859" class="css-a4x74f"><span>1859</span></td><td id="LC1859" class="css-1dcdqdg"><code><span class="code-comment">             * a new array.
</span></code></td></tr><tr><td id="L1860" class="css-a4x74f"><span>1860</span></td><td id="LC1860" class="css-1dcdqdg"><code><span class="code-comment">             * This is identical to a map followed by flat with depth 1.
</span></code></td></tr><tr><td id="L1861" class="css-a4x74f"><span>1861</span></td><td id="LC1861" class="css-1dcdqdg"><code><span class="code-comment">             *
</span></code></td></tr><tr><td id="L1862" class="css-a4x74f"><span>1862</span></td><td id="LC1862" class="css-1dcdqdg"><code><span class="code-comment">             * @param callback A function that accepts up to three arguments. The flatMap method calls the
</span></code></td></tr><tr><td id="L1863" class="css-a4x74f"><span>1863</span></td><td id="LC1863" class="css-1dcdqdg"><code><span class="code-comment">             * callback function one time for each element in the array.
</span></code></td></tr><tr><td id="L1864" class="css-a4x74f"><span>1864</span></td><td id="LC1864" class="css-1dcdqdg"><code><span class="code-comment">             * @param thisArg An object to which the this keyword can refer in the callback function. If
</span></code></td></tr><tr><td id="L1865" class="css-a4x74f"><span>1865</span></td><td id="LC1865" class="css-1dcdqdg"><code><span class="code-comment">             * thisArg is omitted, undefined is used as the this value.
</span></code></td></tr><tr><td id="L1866" class="css-a4x74f"><span>1866</span></td><td id="LC1866" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1867" class="css-a4x74f"><span>1867</span></td><td id="LC1867" class="css-1dcdqdg"><code>            <span class="code-comment">// @ts-ignore</span>
</code></td></tr><tr><td id="L1868" class="css-a4x74f"><span>1868</span></td><td id="LC1868" class="css-1dcdqdg"><code>            ArraySchema.prototype.flatMap = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback, thisArg</span>) </span>{
</code></td></tr><tr><td id="L1869" class="css-a4x74f"><span>1869</span></td><td id="LC1869" class="css-1dcdqdg"><code>                <span class="code-comment">// @ts-ignore</span>
</code></td></tr><tr><td id="L1870" class="css-a4x74f"><span>1870</span></td><td id="LC1870" class="css-1dcdqdg"><code>                <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">"ArraySchema#flatMap() is not supported."</span>);
</code></td></tr><tr><td id="L1871" class="css-a4x74f"><span>1871</span></td><td id="LC1871" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1872" class="css-a4x74f"><span>1872</span></td><td id="LC1872" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L1873" class="css-a4x74f"><span>1873</span></td><td id="LC1873" class="css-1dcdqdg"><code><span class="code-comment">             * Returns a new array with all sub-array elements concatenated into it recursively up to the
</span></code></td></tr><tr><td id="L1874" class="css-a4x74f"><span>1874</span></td><td id="LC1874" class="css-1dcdqdg"><code><span class="code-comment">             * specified depth.
</span></code></td></tr><tr><td id="L1875" class="css-a4x74f"><span>1875</span></td><td id="LC1875" class="css-1dcdqdg"><code><span class="code-comment">             *
</span></code></td></tr><tr><td id="L1876" class="css-a4x74f"><span>1876</span></td><td id="LC1876" class="css-1dcdqdg"><code><span class="code-comment">             * @param depth The maximum recursion depth
</span></code></td></tr><tr><td id="L1877" class="css-a4x74f"><span>1877</span></td><td id="LC1877" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L1878" class="css-a4x74f"><span>1878</span></td><td id="LC1878" class="css-1dcdqdg"><code>            <span class="code-comment">// @ts-ignore</span>
</code></td></tr><tr><td id="L1879" class="css-a4x74f"><span>1879</span></td><td id="LC1879" class="css-1dcdqdg"><code>            ArraySchema.prototype.flat = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">depth</span>) </span>{
</code></td></tr><tr><td id="L1880" class="css-a4x74f"><span>1880</span></td><td id="LC1880" class="css-1dcdqdg"><code>                <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">"ArraySchema#flat() is not supported."</span>);
</code></td></tr><tr><td id="L1881" class="css-a4x74f"><span>1881</span></td><td id="LC1881" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1882" class="css-a4x74f"><span>1882</span></td><td id="LC1882" class="css-1dcdqdg"><code>            ArraySchema.prototype.findLast = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1883" class="css-a4x74f"><span>1883</span></td><td id="LC1883" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> arr = <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values());
</code></td></tr><tr><td id="L1884" class="css-a4x74f"><span>1884</span></td><td id="LC1884" class="css-1dcdqdg"><code>                <span class="code-comment">// @ts-ignore</span>
</code></td></tr><tr><td id="L1885" class="css-a4x74f"><span>1885</span></td><td id="LC1885" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> arr.findLast.apply(arr, <span class="code-built_in">arguments</span>);
</code></td></tr><tr><td id="L1886" class="css-a4x74f"><span>1886</span></td><td id="LC1886" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1887" class="css-a4x74f"><span>1887</span></td><td id="LC1887" class="css-1dcdqdg"><code>            ArraySchema.prototype.findLastIndex = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1888" class="css-a4x74f"><span>1888</span></td><td id="LC1888" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> arr = <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values());
</code></td></tr><tr><td id="L1889" class="css-a4x74f"><span>1889</span></td><td id="LC1889" class="css-1dcdqdg"><code>                <span class="code-comment">// @ts-ignore</span>
</code></td></tr><tr><td id="L1890" class="css-a4x74f"><span>1890</span></td><td id="LC1890" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> arr.findLastIndex.apply(arr, <span class="code-built_in">arguments</span>);
</code></td></tr><tr><td id="L1891" class="css-a4x74f"><span>1891</span></td><td id="LC1891" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1892" class="css-a4x74f"><span>1892</span></td><td id="LC1892" class="css-1dcdqdg"><code>            <span class="code-comment">// get size () {</span>
</code></td></tr><tr><td id="L1893" class="css-a4x74f"><span>1893</span></td><td id="LC1893" class="css-1dcdqdg"><code>            <span class="code-comment">//     return this.$items.size;</span>
</code></td></tr><tr><td id="L1894" class="css-a4x74f"><span>1894</span></td><td id="LC1894" class="css-1dcdqdg"><code>            <span class="code-comment">// }</span>
</code></td></tr><tr><td id="L1895" class="css-a4x74f"><span>1895</span></td><td id="LC1895" class="css-1dcdqdg"><code>            ArraySchema.prototype.setIndex = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index, key</span>) </span>{
</code></td></tr><tr><td id="L1896" class="css-a4x74f"><span>1896</span></td><td id="LC1896" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes.set(index, key);
</code></td></tr><tr><td id="L1897" class="css-a4x74f"><span>1897</span></td><td id="LC1897" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1898" class="css-a4x74f"><span>1898</span></td><td id="LC1898" class="css-1dcdqdg"><code>            ArraySchema.prototype.getIndex = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index</span>) </span>{
</code></td></tr><tr><td id="L1899" class="css-a4x74f"><span>1899</span></td><td id="LC1899" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$indexes.get(index);
</code></td></tr><tr><td id="L1900" class="css-a4x74f"><span>1900</span></td><td id="LC1900" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1901" class="css-a4x74f"><span>1901</span></td><td id="LC1901" class="css-1dcdqdg"><code>            ArraySchema.prototype.getByIndex = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index</span>) </span>{
</code></td></tr><tr><td id="L1902" class="css-a4x74f"><span>1902</span></td><td id="LC1902" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.get(<span class="code-keyword">this</span>.$indexes.get(index));
</code></td></tr><tr><td id="L1903" class="css-a4x74f"><span>1903</span></td><td id="LC1903" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1904" class="css-a4x74f"><span>1904</span></td><td id="LC1904" class="css-1dcdqdg"><code>            ArraySchema.prototype.deleteByIndex = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index</span>) </span>{
</code></td></tr><tr><td id="L1905" class="css-a4x74f"><span>1905</span></td><td id="LC1905" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> key = <span class="code-keyword">this</span>.$indexes.get(index);
</code></td></tr><tr><td id="L1906" class="css-a4x74f"><span>1906</span></td><td id="LC1906" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$items.delete(key);
</code></td></tr><tr><td id="L1907" class="css-a4x74f"><span>1907</span></td><td id="LC1907" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes.delete(index);
</code></td></tr><tr><td id="L1908" class="css-a4x74f"><span>1908</span></td><td id="LC1908" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1909" class="css-a4x74f"><span>1909</span></td><td id="LC1909" class="css-1dcdqdg"><code>            ArraySchema.prototype.toArray = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1910" class="css-a4x74f"><span>1910</span></td><td id="LC1910" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values());
</code></td></tr><tr><td id="L1911" class="css-a4x74f"><span>1911</span></td><td id="LC1911" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1912" class="css-a4x74f"><span>1912</span></td><td id="LC1912" class="css-1dcdqdg"><code>            ArraySchema.prototype.toJSON = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1913" class="css-a4x74f"><span>1913</span></td><td id="LC1913" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.toArray().map(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">value</span>) </span>{
</code></td></tr><tr><td id="L1914" class="css-a4x74f"><span>1914</span></td><td id="LC1914" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> (<span class="code-keyword">typeof</span> (value[<span class="code-string">'toJSON'</span>]) === <span class="code-string">"function"</span>)
</code></td></tr><tr><td id="L1915" class="css-a4x74f"><span>1915</span></td><td id="LC1915" class="css-1dcdqdg"><code>                        ? value[<span class="code-string">'toJSON'</span>]()
</code></td></tr><tr><td id="L1916" class="css-a4x74f"><span>1916</span></td><td id="LC1916" class="css-1dcdqdg"><code>                        : value;
</code></td></tr><tr><td id="L1917" class="css-a4x74f"><span>1917</span></td><td id="LC1917" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L1918" class="css-a4x74f"><span>1918</span></td><td id="LC1918" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1919" class="css-a4x74f"><span>1919</span></td><td id="LC1919" class="css-1dcdqdg"><code>            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1920" class="css-a4x74f"><span>1920</span></td><td id="LC1920" class="css-1dcdqdg"><code>            <span class="code-comment">// Decoding utilities</span>
</code></td></tr><tr><td id="L1921" class="css-a4x74f"><span>1921</span></td><td id="LC1921" class="css-1dcdqdg"><code>            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L1922" class="css-a4x74f"><span>1922</span></td><td id="LC1922" class="css-1dcdqdg"><code>            ArraySchema.prototype.clone = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">isDecoding</span>) </span>{
</code></td></tr><tr><td id="L1923" class="css-a4x74f"><span>1923</span></td><td id="LC1923" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> cloned;
</code></td></tr><tr><td id="L1924" class="css-a4x74f"><span>1924</span></td><td id="LC1924" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (isDecoding) {
</code></td></tr><tr><td id="L1925" class="css-a4x74f"><span>1925</span></td><td id="LC1925" class="css-1dcdqdg"><code>                    cloned = <span class="code-keyword">new</span> (ArraySchema.bind.apply(ArraySchema, __spreadArray([<span class="code-keyword">void</span> <span class="code-number">0</span>], <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values()), <span class="code-literal">false</span>)))();
</code></td></tr><tr><td id="L1926" class="css-a4x74f"><span>1926</span></td><td id="LC1926" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1927" class="css-a4x74f"><span>1927</span></td><td id="LC1927" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L1928" class="css-a4x74f"><span>1928</span></td><td id="LC1928" class="css-1dcdqdg"><code>                    cloned = <span class="code-keyword">new</span> (ArraySchema.bind.apply(ArraySchema, __spreadArray([<span class="code-keyword">void</span> <span class="code-number">0</span>], <span class="code-keyword">this</span>.map(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">item</span>) </span>{ <span class="code-keyword">return</span> ((item[<span class="code-string">'$changes'</span>])
</code></td></tr><tr><td id="L1929" class="css-a4x74f"><span>1929</span></td><td id="LC1929" class="css-1dcdqdg"><code>                        ? item.clone()
</code></td></tr><tr><td id="L1930" class="css-a4x74f"><span>1930</span></td><td id="LC1930" class="css-1dcdqdg"><code>                        : item); }), <span class="code-literal">false</span>)))();
</code></td></tr><tr><td id="L1931" class="css-a4x74f"><span>1931</span></td><td id="LC1931" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1932" class="css-a4x74f"><span>1932</span></td><td id="LC1932" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> cloned;
</code></td></tr><tr><td id="L1933" class="css-a4x74f"><span>1933</span></td><td id="LC1933" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1934" class="css-a4x74f"><span>1934</span></td><td id="LC1934" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> ArraySchema;
</code></td></tr><tr><td id="L1935" class="css-a4x74f"><span>1935</span></td><td id="LC1935" class="css-1dcdqdg"><code>        }());
</code></td></tr><tr><td id="L1936" class="css-a4x74f"><span>1936</span></td><td id="LC1936" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L1937" class="css-a4x74f"><span>1937</span></td><td id="LC1937" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">getMapProxy</span>(<span class="code-params">value</span>) </span>{
</code></td></tr><tr><td id="L1938" class="css-a4x74f"><span>1938</span></td><td id="LC1938" class="css-1dcdqdg"><code>            value[<span class="code-string">'$proxy'</span>] = <span class="code-literal">true</span>;
</code></td></tr><tr><td id="L1939" class="css-a4x74f"><span>1939</span></td><td id="LC1939" class="css-1dcdqdg"><code>            value = <span class="code-keyword">new</span> <span class="code-built_in">Proxy</span>(value, {
</code></td></tr><tr><td id="L1940" class="css-a4x74f"><span>1940</span></td><td id="LC1940" class="css-1dcdqdg"><code>                <span class="code-keyword">get</span>: function (obj, prop) {
</code></td></tr><tr><td id="L1941" class="css-a4x74f"><span>1941</span></td><td id="LC1941" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (prop) !== <span class="code-string">"symbol"</span> &amp;&amp; <span class="code-comment">// accessing properties</span>
</code></td></tr><tr><td id="L1942" class="css-a4x74f"><span>1942</span></td><td id="LC1942" class="css-1dcdqdg"><code>                        <span class="code-keyword">typeof</span> (obj[prop]) === <span class="code-string">"undefined"</span>) {
</code></td></tr><tr><td id="L1943" class="css-a4x74f"><span>1943</span></td><td id="LC1943" class="css-1dcdqdg"><code>                        <span class="code-keyword">return</span> obj.get(prop);
</code></td></tr><tr><td id="L1944" class="css-a4x74f"><span>1944</span></td><td id="LC1944" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L1945" class="css-a4x74f"><span>1945</span></td><td id="LC1945" class="css-1dcdqdg"><code>                    <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L1946" class="css-a4x74f"><span>1946</span></td><td id="LC1946" class="css-1dcdqdg"><code>                        <span class="code-keyword">return</span> obj[prop];
</code></td></tr><tr><td id="L1947" class="css-a4x74f"><span>1947</span></td><td id="LC1947" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L1948" class="css-a4x74f"><span>1948</span></td><td id="LC1948" class="css-1dcdqdg"><code>                },
</code></td></tr><tr><td id="L1949" class="css-a4x74f"><span>1949</span></td><td id="LC1949" class="css-1dcdqdg"><code>                <span class="code-keyword">set</span>: function (obj, prop, setValue) {
</code></td></tr><tr><td id="L1950" class="css-a4x74f"><span>1950</span></td><td id="LC1950" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (prop) !== <span class="code-string">"symbol"</span> &amp;&amp;
</code></td></tr><tr><td id="L1951" class="css-a4x74f"><span>1951</span></td><td id="LC1951" class="css-1dcdqdg"><code>                        (prop.indexOf(<span class="code-string">"$"</span>) === <span class="code-number">-1</span> &amp;&amp;
</code></td></tr><tr><td id="L1952" class="css-a4x74f"><span>1952</span></td><td id="LC1952" class="css-1dcdqdg"><code>                            prop !== <span class="code-string">"onAdd"</span> &amp;&amp;
</code></td></tr><tr><td id="L1953" class="css-a4x74f"><span>1953</span></td><td id="LC1953" class="css-1dcdqdg"><code>                            prop !== <span class="code-string">"onRemove"</span> &amp;&amp;
</code></td></tr><tr><td id="L1954" class="css-a4x74f"><span>1954</span></td><td id="LC1954" class="css-1dcdqdg"><code>                            prop !== <span class="code-string">"onChange"</span>)) {
</code></td></tr><tr><td id="L1955" class="css-a4x74f"><span>1955</span></td><td id="LC1955" class="css-1dcdqdg"><code>                        obj.set(prop, setValue);
</code></td></tr><tr><td id="L1956" class="css-a4x74f"><span>1956</span></td><td id="LC1956" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L1957" class="css-a4x74f"><span>1957</span></td><td id="LC1957" class="css-1dcdqdg"><code>                    <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L1958" class="css-a4x74f"><span>1958</span></td><td id="LC1958" class="css-1dcdqdg"><code>                        obj[prop] = setValue;
</code></td></tr><tr><td id="L1959" class="css-a4x74f"><span>1959</span></td><td id="LC1959" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L1960" class="css-a4x74f"><span>1960</span></td><td id="LC1960" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-literal">true</span>;
</code></td></tr><tr><td id="L1961" class="css-a4x74f"><span>1961</span></td><td id="LC1961" class="css-1dcdqdg"><code>                },
</code></td></tr><tr><td id="L1962" class="css-a4x74f"><span>1962</span></td><td id="LC1962" class="css-1dcdqdg"><code>                deleteProperty: <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">obj, prop</span>) </span>{
</code></td></tr><tr><td id="L1963" class="css-a4x74f"><span>1963</span></td><td id="LC1963" class="css-1dcdqdg"><code>                    obj.delete(prop);
</code></td></tr><tr><td id="L1964" class="css-a4x74f"><span>1964</span></td><td id="LC1964" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-literal">true</span>;
</code></td></tr><tr><td id="L1965" class="css-a4x74f"><span>1965</span></td><td id="LC1965" class="css-1dcdqdg"><code>                },
</code></td></tr><tr><td id="L1966" class="css-a4x74f"><span>1966</span></td><td id="LC1966" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L1967" class="css-a4x74f"><span>1967</span></td><td id="LC1967" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> value;
</code></td></tr><tr><td id="L1968" class="css-a4x74f"><span>1968</span></td><td id="LC1968" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L1969" class="css-a4x74f"><span>1969</span></td><td id="LC1969" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> MapSchema = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L1970" class="css-a4x74f"><span>1970</span></td><td id="LC1970" class="css-1dcdqdg"><code>            <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">MapSchema</span>(<span class="code-params">initialValues</span>) </span>{
</code></td></tr><tr><td id="L1971" class="css-a4x74f"><span>1971</span></td><td id="LC1971" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L1972" class="css-a4x74f"><span>1972</span></td><td id="LC1972" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes = <span class="code-keyword">new</span> ChangeTree(<span class="code-keyword">this</span>);
</code></td></tr><tr><td id="L1973" class="css-a4x74f"><span>1973</span></td><td id="LC1973" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$items = <span class="code-keyword">new</span> <span class="code-built_in">Map</span>();
</code></td></tr><tr><td id="L1974" class="css-a4x74f"><span>1974</span></td><td id="LC1974" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes = <span class="code-keyword">new</span> <span class="code-built_in">Map</span>();
</code></td></tr><tr><td id="L1975" class="css-a4x74f"><span>1975</span></td><td id="LC1975" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$refId = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L1976" class="css-a4x74f"><span>1976</span></td><td id="LC1976" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (initialValues) {
</code></td></tr><tr><td id="L1977" class="css-a4x74f"><span>1977</span></td><td id="LC1977" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (initialValues <span class="code-keyword">instanceof</span> <span class="code-built_in">Map</span> ||
</code></td></tr><tr><td id="L1978" class="css-a4x74f"><span>1978</span></td><td id="LC1978" class="css-1dcdqdg"><code>                        initialValues <span class="code-keyword">instanceof</span> MapSchema) {
</code></td></tr><tr><td id="L1979" class="css-a4x74f"><span>1979</span></td><td id="LC1979" class="css-1dcdqdg"><code>                        initialValues.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">v, k</span>) </span>{ <span class="code-keyword">return</span> _this.set(k, v); });
</code></td></tr><tr><td id="L1980" class="css-a4x74f"><span>1980</span></td><td id="LC1980" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L1981" class="css-a4x74f"><span>1981</span></td><td id="LC1981" class="css-1dcdqdg"><code>                    <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L1982" class="css-a4x74f"><span>1982</span></td><td id="LC1982" class="css-1dcdqdg"><code>                        <span class="code-keyword">for</span> (<span class="code-keyword">var</span> k <span class="code-keyword">in</span> initialValues) {
</code></td></tr><tr><td id="L1983" class="css-a4x74f"><span>1983</span></td><td id="LC1983" class="css-1dcdqdg"><code>                            <span class="code-keyword">this</span>.set(k, initialValues[k]);
</code></td></tr><tr><td id="L1984" class="css-a4x74f"><span>1984</span></td><td id="LC1984" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L1985" class="css-a4x74f"><span>1985</span></td><td id="LC1985" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L1986" class="css-a4x74f"><span>1986</span></td><td id="LC1986" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L1987" class="css-a4x74f"><span>1987</span></td><td id="LC1987" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L1988" class="css-a4x74f"><span>1988</span></td><td id="LC1988" class="css-1dcdqdg"><code>            MapSchema.prototype.onAdd = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback, triggerAll</span>) </span>{
</code></td></tr><tr><td id="L1989" class="css-a4x74f"><span>1989</span></td><td id="LC1989" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (triggerAll === <span class="code-keyword">void</span> <span class="code-number">0</span>) { triggerAll = <span class="code-literal">true</span>; }
</code></td></tr><tr><td id="L1990" class="css-a4x74f"><span>1990</span></td><td id="LC1990" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> addCallback((<span class="code-keyword">this</span>.$callbacks || (<span class="code-keyword">this</span>.$callbacks = [])), exports.OPERATION.ADD, callback, (triggerAll)
</code></td></tr><tr><td id="L1991" class="css-a4x74f"><span>1991</span></td><td id="LC1991" class="css-1dcdqdg"><code>                    ? <span class="code-keyword">this</span>.$items
</code></td></tr><tr><td id="L1992" class="css-a4x74f"><span>1992</span></td><td id="LC1992" class="css-1dcdqdg"><code>                    : <span class="code-literal">undefined</span>);
</code></td></tr><tr><td id="L1993" class="css-a4x74f"><span>1993</span></td><td id="LC1993" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1994" class="css-a4x74f"><span>1994</span></td><td id="LC1994" class="css-1dcdqdg"><code>            MapSchema.prototype.onRemove = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback</span>) </span>{ <span class="code-keyword">return</span> addCallback(<span class="code-keyword">this</span>.$callbacks || (<span class="code-keyword">this</span>.$callbacks = []), exports.OPERATION.DELETE, callback); };
</code></td></tr><tr><td id="L1995" class="css-a4x74f"><span>1995</span></td><td id="LC1995" class="css-1dcdqdg"><code>            MapSchema.prototype.onChange = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback</span>) </span>{ <span class="code-keyword">return</span> addCallback(<span class="code-keyword">this</span>.$callbacks || (<span class="code-keyword">this</span>.$callbacks = []), exports.OPERATION.REPLACE, callback); };
</code></td></tr><tr><td id="L1996" class="css-a4x74f"><span>1996</span></td><td id="LC1996" class="css-1dcdqdg"><code>            MapSchema.is = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">type</span>) </span>{
</code></td></tr><tr><td id="L1997" class="css-a4x74f"><span>1997</span></td><td id="LC1997" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> type[<span class="code-string">'map'</span>] !== <span class="code-literal">undefined</span>;
</code></td></tr><tr><td id="L1998" class="css-a4x74f"><span>1998</span></td><td id="LC1998" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L1999" class="css-a4x74f"><span>1999</span></td><td id="LC1999" class="css-1dcdqdg"><code>            <span class="code-comment">/** Iterator */</span>
</code></td></tr><tr><td id="L2000" class="css-a4x74f"><span>2000</span></td><td id="LC2000" class="css-1dcdqdg"><code>            MapSchema.prototype[<span class="code-built_in">Symbol</span>.iterator] = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{ <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items[<span class="code-built_in">Symbol</span>.iterator](); };
</code></td></tr><tr><td id="L2001" class="css-a4x74f"><span>2001</span></td><td id="LC2001" class="css-1dcdqdg"><code>            <span class="code-built_in">Object</span>.defineProperty(MapSchema.prototype, <span class="code-built_in">Symbol</span>.toStringTag, {
</code></td></tr><tr><td id="L2002" class="css-a4x74f"><span>2002</span></td><td id="LC2002" class="css-1dcdqdg"><code>                <span class="code-keyword">get</span>: function () { <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items[<span class="code-built_in">Symbol</span>.toStringTag]; },
</code></td></tr><tr><td id="L2003" class="css-a4x74f"><span>2003</span></td><td id="LC2003" class="css-1dcdqdg"><code>                enumerable: <span class="code-literal">false</span>,
</code></td></tr><tr><td id="L2004" class="css-a4x74f"><span>2004</span></td><td id="LC2004" class="css-1dcdqdg"><code>                configurable: <span class="code-literal">true</span>
</code></td></tr><tr><td id="L2005" class="css-a4x74f"><span>2005</span></td><td id="LC2005" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L2006" class="css-a4x74f"><span>2006</span></td><td id="LC2006" class="css-1dcdqdg"><code>            MapSchema.prototype.set = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">key, value</span>) </span>{
</code></td></tr><tr><td id="L2007" class="css-a4x74f"><span>2007</span></td><td id="LC2007" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (value === <span class="code-literal">undefined</span> || value === <span class="code-literal">null</span>) {
</code></td></tr><tr><td id="L2008" class="css-a4x74f"><span>2008</span></td><td id="LC2008" class="css-1dcdqdg"><code>                    <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">"MapSchema#set('"</span>.concat(key, <span class="code-string">"', "</span>).concat(value, <span class="code-string">"): trying to set "</span>).concat(value, <span class="code-string">" value on '"</span>).concat(key, <span class="code-string">"'."</span>));
</code></td></tr><tr><td id="L2009" class="css-a4x74f"><span>2009</span></td><td id="LC2009" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2010" class="css-a4x74f"><span>2010</span></td><td id="LC2010" class="css-1dcdqdg"><code>                <span class="code-comment">// get "index" for this value.</span>
</code></td></tr><tr><td id="L2011" class="css-a4x74f"><span>2011</span></td><td id="LC2011" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> hasIndex = <span class="code-keyword">typeof</span> (<span class="code-keyword">this</span>.$changes.indexes[key]) !== <span class="code-string">"undefined"</span>;
</code></td></tr><tr><td id="L2012" class="css-a4x74f"><span>2012</span></td><td id="LC2012" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> index = (hasIndex)
</code></td></tr><tr><td id="L2013" class="css-a4x74f"><span>2013</span></td><td id="LC2013" class="css-1dcdqdg"><code>                    ? <span class="code-keyword">this</span>.$changes.indexes[key]
</code></td></tr><tr><td id="L2014" class="css-a4x74f"><span>2014</span></td><td id="LC2014" class="css-1dcdqdg"><code>                    : <span class="code-keyword">this</span>.$refId++;
</code></td></tr><tr><td id="L2015" class="css-a4x74f"><span>2015</span></td><td id="LC2015" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> operation = (hasIndex)
</code></td></tr><tr><td id="L2016" class="css-a4x74f"><span>2016</span></td><td id="LC2016" class="css-1dcdqdg"><code>                    ? exports.OPERATION.REPLACE
</code></td></tr><tr><td id="L2017" class="css-a4x74f"><span>2017</span></td><td id="LC2017" class="css-1dcdqdg"><code>                    : exports.OPERATION.ADD;
</code></td></tr><tr><td id="L2018" class="css-a4x74f"><span>2018</span></td><td id="LC2018" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> isRef = (value[<span class="code-string">'$changes'</span>]) !== <span class="code-literal">undefined</span>;
</code></td></tr><tr><td id="L2019" class="css-a4x74f"><span>2019</span></td><td id="LC2019" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (isRef) {
</code></td></tr><tr><td id="L2020" class="css-a4x74f"><span>2020</span></td><td id="LC2020" class="css-1dcdqdg"><code>                    value[<span class="code-string">'$changes'</span>].setParent(<span class="code-keyword">this</span>, <span class="code-keyword">this</span>.$changes.root, index);
</code></td></tr><tr><td id="L2021" class="css-a4x74f"><span>2021</span></td><td id="LC2021" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2022" class="css-a4x74f"><span>2022</span></td><td id="LC2022" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L2023" class="css-a4x74f"><span>2023</span></td><td id="LC2023" class="css-1dcdqdg"><code>                <span class="code-comment">// (encoding)</span>
</code></td></tr><tr><td id="L2024" class="css-a4x74f"><span>2024</span></td><td id="LC2024" class="css-1dcdqdg"><code>                <span class="code-comment">// set a unique id to relate directly with this key/value.</span>
</code></td></tr><tr><td id="L2025" class="css-a4x74f"><span>2025</span></td><td id="LC2025" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L2026" class="css-a4x74f"><span>2026</span></td><td id="LC2026" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (!hasIndex) {
</code></td></tr><tr><td id="L2027" class="css-a4x74f"><span>2027</span></td><td id="LC2027" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.$changes.indexes[key] = index;
</code></td></tr><tr><td id="L2028" class="css-a4x74f"><span>2028</span></td><td id="LC2028" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.$indexes.set(index, key);
</code></td></tr><tr><td id="L2029" class="css-a4x74f"><span>2029</span></td><td id="LC2029" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2030" class="css-a4x74f"><span>2030</span></td><td id="LC2030" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> <span class="code-keyword">if</span> (isRef &amp;&amp; <span class="code-comment">// if is schema, force ADD operation if value differ from previous one.</span>
</code></td></tr><tr><td id="L2031" class="css-a4x74f"><span>2031</span></td><td id="LC2031" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.$items.get(key) !== value) {
</code></td></tr><tr><td id="L2032" class="css-a4x74f"><span>2032</span></td><td id="LC2032" class="css-1dcdqdg"><code>                    operation = exports.OPERATION.ADD;
</code></td></tr><tr><td id="L2033" class="css-a4x74f"><span>2033</span></td><td id="LC2033" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2034" class="css-a4x74f"><span>2034</span></td><td id="LC2034" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$items.set(key, value);
</code></td></tr><tr><td id="L2035" class="css-a4x74f"><span>2035</span></td><td id="LC2035" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.change(key, operation);
</code></td></tr><tr><td id="L2036" class="css-a4x74f"><span>2036</span></td><td id="LC2036" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L2037" class="css-a4x74f"><span>2037</span></td><td id="LC2037" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2038" class="css-a4x74f"><span>2038</span></td><td id="LC2038" class="css-1dcdqdg"><code>            MapSchema.prototype.get = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">key</span>) </span>{
</code></td></tr><tr><td id="L2039" class="css-a4x74f"><span>2039</span></td><td id="LC2039" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.get(key);
</code></td></tr><tr><td id="L2040" class="css-a4x74f"><span>2040</span></td><td id="LC2040" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2041" class="css-a4x74f"><span>2041</span></td><td id="LC2041" class="css-1dcdqdg"><code>            MapSchema.prototype.delete = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">key</span>) </span>{
</code></td></tr><tr><td id="L2042" class="css-a4x74f"><span>2042</span></td><td id="LC2042" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L2043" class="css-a4x74f"><span>2043</span></td><td id="LC2043" class="css-1dcdqdg"><code>                <span class="code-comment">// <span class="code-doctag">TODO:</span> add a "purge" method after .encode() runs, to cleanup removed `$indexes`</span>
</code></td></tr><tr><td id="L2044" class="css-a4x74f"><span>2044</span></td><td id="LC2044" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L2045" class="css-a4x74f"><span>2045</span></td><td id="LC2045" class="css-1dcdqdg"><code>                <span class="code-comment">// We don't remove $indexes to allow setting the same key in the same patch</span>
</code></td></tr><tr><td id="L2046" class="css-a4x74f"><span>2046</span></td><td id="LC2046" class="css-1dcdqdg"><code>                <span class="code-comment">// (See "should allow to remove and set an item in the same place" test)</span>
</code></td></tr><tr><td id="L2047" class="css-a4x74f"><span>2047</span></td><td id="LC2047" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L2048" class="css-a4x74f"><span>2048</span></td><td id="LC2048" class="css-1dcdqdg"><code>                <span class="code-comment">// // const index = this.$changes.indexes[key];</span>
</code></td></tr><tr><td id="L2049" class="css-a4x74f"><span>2049</span></td><td id="LC2049" class="css-1dcdqdg"><code>                <span class="code-comment">// // this.$indexes.delete(index);</span>
</code></td></tr><tr><td id="L2050" class="css-a4x74f"><span>2050</span></td><td id="LC2050" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.delete(key);
</code></td></tr><tr><td id="L2051" class="css-a4x74f"><span>2051</span></td><td id="LC2051" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.delete(key);
</code></td></tr><tr><td id="L2052" class="css-a4x74f"><span>2052</span></td><td id="LC2052" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2053" class="css-a4x74f"><span>2053</span></td><td id="LC2053" class="css-1dcdqdg"><code>            MapSchema.prototype.clear = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">changes</span>) </span>{
</code></td></tr><tr><td id="L2054" class="css-a4x74f"><span>2054</span></td><td id="LC2054" class="css-1dcdqdg"><code>                <span class="code-comment">// discard previous operations.</span>
</code></td></tr><tr><td id="L2055" class="css-a4x74f"><span>2055</span></td><td id="LC2055" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.discard(<span class="code-literal">true</span>, <span class="code-literal">true</span>);
</code></td></tr><tr><td id="L2056" class="css-a4x74f"><span>2056</span></td><td id="LC2056" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.indexes = {};
</code></td></tr><tr><td id="L2057" class="css-a4x74f"><span>2057</span></td><td id="LC2057" class="css-1dcdqdg"><code>                <span class="code-comment">// clear previous indexes</span>
</code></td></tr><tr><td id="L2058" class="css-a4x74f"><span>2058</span></td><td id="LC2058" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes.clear();
</code></td></tr><tr><td id="L2059" class="css-a4x74f"><span>2059</span></td><td id="LC2059" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L2060" class="css-a4x74f"><span>2060</span></td><td id="LC2060" class="css-1dcdqdg"><code>                <span class="code-comment">// When decoding:</span>
</code></td></tr><tr><td id="L2061" class="css-a4x74f"><span>2061</span></td><td id="LC2061" class="css-1dcdqdg"><code>                <span class="code-comment">// - enqueue items for DELETE callback.</span>
</code></td></tr><tr><td id="L2062" class="css-a4x74f"><span>2062</span></td><td id="LC2062" class="css-1dcdqdg"><code>                <span class="code-comment">// - flag child items for garbage collection.</span>
</code></td></tr><tr><td id="L2063" class="css-a4x74f"><span>2063</span></td><td id="LC2063" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L2064" class="css-a4x74f"><span>2064</span></td><td id="LC2064" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (changes) {
</code></td></tr><tr><td id="L2065" class="css-a4x74f"><span>2065</span></td><td id="LC2065" class="css-1dcdqdg"><code>                    removeChildRefs.call(<span class="code-keyword">this</span>, changes);
</code></td></tr><tr><td id="L2066" class="css-a4x74f"><span>2066</span></td><td id="LC2066" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2067" class="css-a4x74f"><span>2067</span></td><td id="LC2067" class="css-1dcdqdg"><code>                <span class="code-comment">// clear items</span>
</code></td></tr><tr><td id="L2068" class="css-a4x74f"><span>2068</span></td><td id="LC2068" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$items.clear();
</code></td></tr><tr><td id="L2069" class="css-a4x74f"><span>2069</span></td><td id="LC2069" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.operation({ <span class="code-attr">index</span>: <span class="code-number">0</span>, <span class="code-attr">op</span>: exports.OPERATION.CLEAR });
</code></td></tr><tr><td id="L2070" class="css-a4x74f"><span>2070</span></td><td id="LC2070" class="css-1dcdqdg"><code>                <span class="code-comment">// touch all structures until reach root</span>
</code></td></tr><tr><td id="L2071" class="css-a4x74f"><span>2071</span></td><td id="LC2071" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.touchParents();
</code></td></tr><tr><td id="L2072" class="css-a4x74f"><span>2072</span></td><td id="LC2072" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2073" class="css-a4x74f"><span>2073</span></td><td id="LC2073" class="css-1dcdqdg"><code>            MapSchema.prototype.has = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">key</span>) </span>{
</code></td></tr><tr><td id="L2074" class="css-a4x74f"><span>2074</span></td><td id="LC2074" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.has(key);
</code></td></tr><tr><td id="L2075" class="css-a4x74f"><span>2075</span></td><td id="LC2075" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2076" class="css-a4x74f"><span>2076</span></td><td id="LC2076" class="css-1dcdqdg"><code>            MapSchema.prototype.forEach = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callbackfn</span>) </span>{
</code></td></tr><tr><td id="L2077" class="css-a4x74f"><span>2077</span></td><td id="LC2077" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$items.forEach(callbackfn);
</code></td></tr><tr><td id="L2078" class="css-a4x74f"><span>2078</span></td><td id="LC2078" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2079" class="css-a4x74f"><span>2079</span></td><td id="LC2079" class="css-1dcdqdg"><code>            MapSchema.prototype.entries = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L2080" class="css-a4x74f"><span>2080</span></td><td id="LC2080" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.entries();
</code></td></tr><tr><td id="L2081" class="css-a4x74f"><span>2081</span></td><td id="LC2081" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2082" class="css-a4x74f"><span>2082</span></td><td id="LC2082" class="css-1dcdqdg"><code>            MapSchema.prototype.keys = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L2083" class="css-a4x74f"><span>2083</span></td><td id="LC2083" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.keys();
</code></td></tr><tr><td id="L2084" class="css-a4x74f"><span>2084</span></td><td id="LC2084" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2085" class="css-a4x74f"><span>2085</span></td><td id="LC2085" class="css-1dcdqdg"><code>            MapSchema.prototype.values = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L2086" class="css-a4x74f"><span>2086</span></td><td id="LC2086" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.values();
</code></td></tr><tr><td id="L2087" class="css-a4x74f"><span>2087</span></td><td id="LC2087" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2088" class="css-a4x74f"><span>2088</span></td><td id="LC2088" class="css-1dcdqdg"><code>            <span class="code-built_in">Object</span>.defineProperty(MapSchema.prototype, <span class="code-string">"size"</span>, {
</code></td></tr><tr><td id="L2089" class="css-a4x74f"><span>2089</span></td><td id="LC2089" class="css-1dcdqdg"><code>                <span class="code-keyword">get</span>: function () {
</code></td></tr><tr><td id="L2090" class="css-a4x74f"><span>2090</span></td><td id="LC2090" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.size;
</code></td></tr><tr><td id="L2091" class="css-a4x74f"><span>2091</span></td><td id="LC2091" class="css-1dcdqdg"><code>                },
</code></td></tr><tr><td id="L2092" class="css-a4x74f"><span>2092</span></td><td id="LC2092" class="css-1dcdqdg"><code>                enumerable: <span class="code-literal">false</span>,
</code></td></tr><tr><td id="L2093" class="css-a4x74f"><span>2093</span></td><td id="LC2093" class="css-1dcdqdg"><code>                configurable: <span class="code-literal">true</span>
</code></td></tr><tr><td id="L2094" class="css-a4x74f"><span>2094</span></td><td id="LC2094" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L2095" class="css-a4x74f"><span>2095</span></td><td id="LC2095" class="css-1dcdqdg"><code>            MapSchema.prototype.setIndex = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index, key</span>) </span>{
</code></td></tr><tr><td id="L2096" class="css-a4x74f"><span>2096</span></td><td id="LC2096" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes.set(index, key);
</code></td></tr><tr><td id="L2097" class="css-a4x74f"><span>2097</span></td><td id="LC2097" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2098" class="css-a4x74f"><span>2098</span></td><td id="LC2098" class="css-1dcdqdg"><code>            MapSchema.prototype.getIndex = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index</span>) </span>{
</code></td></tr><tr><td id="L2099" class="css-a4x74f"><span>2099</span></td><td id="LC2099" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$indexes.get(index);
</code></td></tr><tr><td id="L2100" class="css-a4x74f"><span>2100</span></td><td id="LC2100" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2101" class="css-a4x74f"><span>2101</span></td><td id="LC2101" class="css-1dcdqdg"><code>            MapSchema.prototype.getByIndex = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index</span>) </span>{
</code></td></tr><tr><td id="L2102" class="css-a4x74f"><span>2102</span></td><td id="LC2102" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.get(<span class="code-keyword">this</span>.$indexes.get(index));
</code></td></tr><tr><td id="L2103" class="css-a4x74f"><span>2103</span></td><td id="LC2103" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2104" class="css-a4x74f"><span>2104</span></td><td id="LC2104" class="css-1dcdqdg"><code>            MapSchema.prototype.deleteByIndex = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index</span>) </span>{
</code></td></tr><tr><td id="L2105" class="css-a4x74f"><span>2105</span></td><td id="LC2105" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> key = <span class="code-keyword">this</span>.$indexes.get(index);
</code></td></tr><tr><td id="L2106" class="css-a4x74f"><span>2106</span></td><td id="LC2106" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$items.delete(key);
</code></td></tr><tr><td id="L2107" class="css-a4x74f"><span>2107</span></td><td id="LC2107" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes.delete(index);
</code></td></tr><tr><td id="L2108" class="css-a4x74f"><span>2108</span></td><td id="LC2108" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2109" class="css-a4x74f"><span>2109</span></td><td id="LC2109" class="css-1dcdqdg"><code>            MapSchema.prototype.toJSON = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L2110" class="css-a4x74f"><span>2110</span></td><td id="LC2110" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> map = {};
</code></td></tr><tr><td id="L2111" class="css-a4x74f"><span>2111</span></td><td id="LC2111" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">value, key</span>) </span>{
</code></td></tr><tr><td id="L2112" class="css-a4x74f"><span>2112</span></td><td id="LC2112" class="css-1dcdqdg"><code>                    map[key] = (<span class="code-keyword">typeof</span> (value[<span class="code-string">'toJSON'</span>]) === <span class="code-string">"function"</span>)
</code></td></tr><tr><td id="L2113" class="css-a4x74f"><span>2113</span></td><td id="LC2113" class="css-1dcdqdg"><code>                        ? value[<span class="code-string">'toJSON'</span>]()
</code></td></tr><tr><td id="L2114" class="css-a4x74f"><span>2114</span></td><td id="LC2114" class="css-1dcdqdg"><code>                        : value;
</code></td></tr><tr><td id="L2115" class="css-a4x74f"><span>2115</span></td><td id="LC2115" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L2116" class="css-a4x74f"><span>2116</span></td><td id="LC2116" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> map;
</code></td></tr><tr><td id="L2117" class="css-a4x74f"><span>2117</span></td><td id="LC2117" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2118" class="css-a4x74f"><span>2118</span></td><td id="LC2118" class="css-1dcdqdg"><code>            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L2119" class="css-a4x74f"><span>2119</span></td><td id="LC2119" class="css-1dcdqdg"><code>            <span class="code-comment">// Decoding utilities</span>
</code></td></tr><tr><td id="L2120" class="css-a4x74f"><span>2120</span></td><td id="LC2120" class="css-1dcdqdg"><code>            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L2121" class="css-a4x74f"><span>2121</span></td><td id="LC2121" class="css-1dcdqdg"><code>            MapSchema.prototype.clone = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">isDecoding</span>) </span>{
</code></td></tr><tr><td id="L2122" class="css-a4x74f"><span>2122</span></td><td id="LC2122" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> cloned;
</code></td></tr><tr><td id="L2123" class="css-a4x74f"><span>2123</span></td><td id="LC2123" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (isDecoding) {
</code></td></tr><tr><td id="L2124" class="css-a4x74f"><span>2124</span></td><td id="LC2124" class="css-1dcdqdg"><code>                    <span class="code-comment">// client-side</span>
</code></td></tr><tr><td id="L2125" class="css-a4x74f"><span>2125</span></td><td id="LC2125" class="css-1dcdqdg"><code>                    cloned = <span class="code-built_in">Object</span>.assign(<span class="code-keyword">new</span> MapSchema(), <span class="code-keyword">this</span>);
</code></td></tr><tr><td id="L2126" class="css-a4x74f"><span>2126</span></td><td id="LC2126" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2127" class="css-a4x74f"><span>2127</span></td><td id="LC2127" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L2128" class="css-a4x74f"><span>2128</span></td><td id="LC2128" class="css-1dcdqdg"><code>                    <span class="code-comment">// server-side</span>
</code></td></tr><tr><td id="L2129" class="css-a4x74f"><span>2129</span></td><td id="LC2129" class="css-1dcdqdg"><code>                    cloned = <span class="code-keyword">new</span> MapSchema();
</code></td></tr><tr><td id="L2130" class="css-a4x74f"><span>2130</span></td><td id="LC2130" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">value, key</span>) </span>{
</code></td></tr><tr><td id="L2131" class="css-a4x74f"><span>2131</span></td><td id="LC2131" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (value[<span class="code-string">'$changes'</span>]) {
</code></td></tr><tr><td id="L2132" class="css-a4x74f"><span>2132</span></td><td id="LC2132" class="css-1dcdqdg"><code>                            cloned.set(key, value[<span class="code-string">'clone'</span>]());
</code></td></tr><tr><td id="L2133" class="css-a4x74f"><span>2133</span></td><td id="LC2133" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L2134" class="css-a4x74f"><span>2134</span></td><td id="LC2134" class="css-1dcdqdg"><code>                        <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L2135" class="css-a4x74f"><span>2135</span></td><td id="LC2135" class="css-1dcdqdg"><code>                            cloned.set(key, value);
</code></td></tr><tr><td id="L2136" class="css-a4x74f"><span>2136</span></td><td id="LC2136" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L2137" class="css-a4x74f"><span>2137</span></td><td id="LC2137" class="css-1dcdqdg"><code>                    });
</code></td></tr><tr><td id="L2138" class="css-a4x74f"><span>2138</span></td><td id="LC2138" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2139" class="css-a4x74f"><span>2139</span></td><td id="LC2139" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> cloned;
</code></td></tr><tr><td id="L2140" class="css-a4x74f"><span>2140</span></td><td id="LC2140" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2141" class="css-a4x74f"><span>2141</span></td><td id="LC2141" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> MapSchema;
</code></td></tr><tr><td id="L2142" class="css-a4x74f"><span>2142</span></td><td id="LC2142" class="css-1dcdqdg"><code>        }());
</code></td></tr><tr><td id="L2143" class="css-a4x74f"><span>2143</span></td><td id="LC2143" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L2144" class="css-a4x74f"><span>2144</span></td><td id="LC2144" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> registeredTypes = {};
</code></td></tr><tr><td id="L2145" class="css-a4x74f"><span>2145</span></td><td id="LC2145" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">registerType</span>(<span class="code-params">identifier, definition</span>) </span>{
</code></td></tr><tr><td id="L2146" class="css-a4x74f"><span>2146</span></td><td id="LC2146" class="css-1dcdqdg"><code>            registeredTypes[identifier] = definition;
</code></td></tr><tr><td id="L2147" class="css-a4x74f"><span>2147</span></td><td id="LC2147" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2148" class="css-a4x74f"><span>2148</span></td><td id="LC2148" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">getType</span>(<span class="code-params">identifier</span>) </span>{
</code></td></tr><tr><td id="L2149" class="css-a4x74f"><span>2149</span></td><td id="LC2149" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> registeredTypes[identifier];
</code></td></tr><tr><td id="L2150" class="css-a4x74f"><span>2150</span></td><td id="LC2150" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2151" class="css-a4x74f"><span>2151</span></td><td id="LC2151" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L2152" class="css-a4x74f"><span>2152</span></td><td id="LC2152" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> SchemaDefinition = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L2153" class="css-a4x74f"><span>2153</span></td><td id="LC2153" class="css-1dcdqdg"><code>            <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">SchemaDefinition</span>(<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L2154" class="css-a4x74f"><span>2154</span></td><td id="LC2154" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L2155" class="css-a4x74f"><span>2155</span></td><td id="LC2155" class="css-1dcdqdg"><code>                <span class="code-comment">// <span class="code-doctag">TODO:</span> use a "field" structure combining all these properties per-field.</span>
</code></td></tr><tr><td id="L2156" class="css-a4x74f"><span>2156</span></td><td id="LC2156" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L2157" class="css-a4x74f"><span>2157</span></td><td id="LC2157" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.indexes = {};
</code></td></tr><tr><td id="L2158" class="css-a4x74f"><span>2158</span></td><td id="LC2158" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.fieldsByIndex = {};
</code></td></tr><tr><td id="L2159" class="css-a4x74f"><span>2159</span></td><td id="LC2159" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.deprecated = {};
</code></td></tr><tr><td id="L2160" class="css-a4x74f"><span>2160</span></td><td id="LC2160" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.descriptors = {};
</code></td></tr><tr><td id="L2161" class="css-a4x74f"><span>2161</span></td><td id="LC2161" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2162" class="css-a4x74f"><span>2162</span></td><td id="LC2162" class="css-1dcdqdg"><code>            SchemaDefinition.create = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">parent</span>) </span>{
</code></td></tr><tr><td id="L2163" class="css-a4x74f"><span>2163</span></td><td id="LC2163" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> definition = <span class="code-keyword">new</span> SchemaDefinition();
</code></td></tr><tr><td id="L2164" class="css-a4x74f"><span>2164</span></td><td id="LC2164" class="css-1dcdqdg"><code>                <span class="code-comment">// support inheritance</span>
</code></td></tr><tr><td id="L2165" class="css-a4x74f"><span>2165</span></td><td id="LC2165" class="css-1dcdqdg"><code>                definition.schema = <span class="code-built_in">Object</span>.assign({}, parent &amp;&amp; parent.schema || {});
</code></td></tr><tr><td id="L2166" class="css-a4x74f"><span>2166</span></td><td id="LC2166" class="css-1dcdqdg"><code>                definition.indexes = <span class="code-built_in">Object</span>.assign({}, parent &amp;&amp; parent.indexes || {});
</code></td></tr><tr><td id="L2167" class="css-a4x74f"><span>2167</span></td><td id="LC2167" class="css-1dcdqdg"><code>                definition.fieldsByIndex = <span class="code-built_in">Object</span>.assign({}, parent &amp;&amp; parent.fieldsByIndex || {});
</code></td></tr><tr><td id="L2168" class="css-a4x74f"><span>2168</span></td><td id="LC2168" class="css-1dcdqdg"><code>                definition.descriptors = <span class="code-built_in">Object</span>.assign({}, parent &amp;&amp; parent.descriptors || {});
</code></td></tr><tr><td id="L2169" class="css-a4x74f"><span>2169</span></td><td id="LC2169" class="css-1dcdqdg"><code>                definition.deprecated = <span class="code-built_in">Object</span>.assign({}, parent &amp;&amp; parent.deprecated || {});
</code></td></tr><tr><td id="L2170" class="css-a4x74f"><span>2170</span></td><td id="LC2170" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> definition;
</code></td></tr><tr><td id="L2171" class="css-a4x74f"><span>2171</span></td><td id="LC2171" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2172" class="css-a4x74f"><span>2172</span></td><td id="LC2172" class="css-1dcdqdg"><code>            SchemaDefinition.prototype.addField = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">field, type</span>) </span>{
</code></td></tr><tr><td id="L2173" class="css-a4x74f"><span>2173</span></td><td id="LC2173" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> index = <span class="code-keyword">this</span>.getNextFieldIndex();
</code></td></tr><tr><td id="L2174" class="css-a4x74f"><span>2174</span></td><td id="LC2174" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.fieldsByIndex[index] = field;
</code></td></tr><tr><td id="L2175" class="css-a4x74f"><span>2175</span></td><td id="LC2175" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.indexes[field] = index;
</code></td></tr><tr><td id="L2176" class="css-a4x74f"><span>2176</span></td><td id="LC2176" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.schema[field] = (<span class="code-built_in">Array</span>.isArray(type))
</code></td></tr><tr><td id="L2177" class="css-a4x74f"><span>2177</span></td><td id="LC2177" class="css-1dcdqdg"><code>                    ? { <span class="code-attr">array</span>: type[<span class="code-number">0</span>] }
</code></td></tr><tr><td id="L2178" class="css-a4x74f"><span>2178</span></td><td id="LC2178" class="css-1dcdqdg"><code>                    : type;
</code></td></tr><tr><td id="L2179" class="css-a4x74f"><span>2179</span></td><td id="LC2179" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2180" class="css-a4x74f"><span>2180</span></td><td id="LC2180" class="css-1dcdqdg"><code>            SchemaDefinition.prototype.hasField = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">field</span>) </span>{
</code></td></tr><tr><td id="L2181" class="css-a4x74f"><span>2181</span></td><td id="LC2181" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.indexes[field] !== <span class="code-literal">undefined</span>;
</code></td></tr><tr><td id="L2182" class="css-a4x74f"><span>2182</span></td><td id="LC2182" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2183" class="css-a4x74f"><span>2183</span></td><td id="LC2183" class="css-1dcdqdg"><code>            SchemaDefinition.prototype.addFilter = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">field, cb</span>) </span>{
</code></td></tr><tr><td id="L2184" class="css-a4x74f"><span>2184</span></td><td id="LC2184" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (!<span class="code-keyword">this</span>.filters) {
</code></td></tr><tr><td id="L2185" class="css-a4x74f"><span>2185</span></td><td id="LC2185" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.filters = {};
</code></td></tr><tr><td id="L2186" class="css-a4x74f"><span>2186</span></td><td id="LC2186" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.indexesWithFilters = [];
</code></td></tr><tr><td id="L2187" class="css-a4x74f"><span>2187</span></td><td id="LC2187" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2188" class="css-a4x74f"><span>2188</span></td><td id="LC2188" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.filters[<span class="code-keyword">this</span>.indexes[field]] = cb;
</code></td></tr><tr><td id="L2189" class="css-a4x74f"><span>2189</span></td><td id="LC2189" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.indexesWithFilters.push(<span class="code-keyword">this</span>.indexes[field]);
</code></td></tr><tr><td id="L2190" class="css-a4x74f"><span>2190</span></td><td id="LC2190" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-literal">true</span>;
</code></td></tr><tr><td id="L2191" class="css-a4x74f"><span>2191</span></td><td id="LC2191" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2192" class="css-a4x74f"><span>2192</span></td><td id="LC2192" class="css-1dcdqdg"><code>            SchemaDefinition.prototype.addChildrenFilter = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">field, cb</span>) </span>{
</code></td></tr><tr><td id="L2193" class="css-a4x74f"><span>2193</span></td><td id="LC2193" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> index = <span class="code-keyword">this</span>.indexes[field];
</code></td></tr><tr><td id="L2194" class="css-a4x74f"><span>2194</span></td><td id="LC2194" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> type = <span class="code-keyword">this</span>.schema[field];
</code></td></tr><tr><td id="L2195" class="css-a4x74f"><span>2195</span></td><td id="LC2195" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (getType(<span class="code-built_in">Object</span>.keys(type)[<span class="code-number">0</span>])) {
</code></td></tr><tr><td id="L2196" class="css-a4x74f"><span>2196</span></td><td id="LC2196" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (!<span class="code-keyword">this</span>.childFilters) {
</code></td></tr><tr><td id="L2197" class="css-a4x74f"><span>2197</span></td><td id="LC2197" class="css-1dcdqdg"><code>                        <span class="code-keyword">this</span>.childFilters = {};
</code></td></tr><tr><td id="L2198" class="css-a4x74f"><span>2198</span></td><td id="LC2198" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L2199" class="css-a4x74f"><span>2199</span></td><td id="LC2199" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.childFilters[index] = cb;
</code></td></tr><tr><td id="L2200" class="css-a4x74f"><span>2200</span></td><td id="LC2200" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-literal">true</span>;
</code></td></tr><tr><td id="L2201" class="css-a4x74f"><span>2201</span></td><td id="LC2201" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2202" class="css-a4x74f"><span>2202</span></td><td id="LC2202" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L2203" class="css-a4x74f"><span>2203</span></td><td id="LC2203" class="css-1dcdqdg"><code>                    <span class="code-built_in">console</span>.warn(<span class="code-string">"@filterChildren: field '"</span>.concat(field, <span class="code-string">"' can't have children. Ignoring filter."</span>));
</code></td></tr><tr><td id="L2204" class="css-a4x74f"><span>2204</span></td><td id="LC2204" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2205" class="css-a4x74f"><span>2205</span></td><td id="LC2205" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2206" class="css-a4x74f"><span>2206</span></td><td id="LC2206" class="css-1dcdqdg"><code>            SchemaDefinition.prototype.getChildrenFilter = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">field</span>) </span>{
</code></td></tr><tr><td id="L2207" class="css-a4x74f"><span>2207</span></td><td id="LC2207" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.childFilters &amp;&amp; <span class="code-keyword">this</span>.childFilters[<span class="code-keyword">this</span>.indexes[field]];
</code></td></tr><tr><td id="L2208" class="css-a4x74f"><span>2208</span></td><td id="LC2208" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2209" class="css-a4x74f"><span>2209</span></td><td id="LC2209" class="css-1dcdqdg"><code>            SchemaDefinition.prototype.getNextFieldIndex = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L2210" class="css-a4x74f"><span>2210</span></td><td id="LC2210" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-built_in">Object</span>.keys(<span class="code-keyword">this</span>.schema || {}).length;
</code></td></tr><tr><td id="L2211" class="css-a4x74f"><span>2211</span></td><td id="LC2211" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2212" class="css-a4x74f"><span>2212</span></td><td id="LC2212" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> SchemaDefinition;
</code></td></tr><tr><td id="L2213" class="css-a4x74f"><span>2213</span></td><td id="LC2213" class="css-1dcdqdg"><code>        }());
</code></td></tr><tr><td id="L2214" class="css-a4x74f"><span>2214</span></td><td id="LC2214" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">hasFilter</span>(<span class="code-params">klass</span>) </span>{
</code></td></tr><tr><td id="L2215" class="css-a4x74f"><span>2215</span></td><td id="LC2215" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> klass._context &amp;&amp; klass._context.useFilters;
</code></td></tr><tr><td id="L2216" class="css-a4x74f"><span>2216</span></td><td id="LC2216" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2217" class="css-a4x74f"><span>2217</span></td><td id="LC2217" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> Context = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L2218" class="css-a4x74f"><span>2218</span></td><td id="LC2218" class="css-1dcdqdg"><code>            <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">Context</span>(<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L2219" class="css-a4x74f"><span>2219</span></td><td id="LC2219" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.types = {};
</code></td></tr><tr><td id="L2220" class="css-a4x74f"><span>2220</span></td><td id="LC2220" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.schemas = <span class="code-keyword">new</span> <span class="code-built_in">Map</span>();
</code></td></tr><tr><td id="L2221" class="css-a4x74f"><span>2221</span></td><td id="LC2221" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.useFilters = <span class="code-literal">false</span>;
</code></td></tr><tr><td id="L2222" class="css-a4x74f"><span>2222</span></td><td id="LC2222" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2223" class="css-a4x74f"><span>2223</span></td><td id="LC2223" class="css-1dcdqdg"><code>            Context.prototype.has = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">schema</span>) </span>{
</code></td></tr><tr><td id="L2224" class="css-a4x74f"><span>2224</span></td><td id="LC2224" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.schemas.has(schema);
</code></td></tr><tr><td id="L2225" class="css-a4x74f"><span>2225</span></td><td id="LC2225" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2226" class="css-a4x74f"><span>2226</span></td><td id="LC2226" class="css-1dcdqdg"><code>            Context.prototype.get = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">typeid</span>) </span>{
</code></td></tr><tr><td id="L2227" class="css-a4x74f"><span>2227</span></td><td id="LC2227" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.types[typeid];
</code></td></tr><tr><td id="L2228" class="css-a4x74f"><span>2228</span></td><td id="LC2228" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2229" class="css-a4x74f"><span>2229</span></td><td id="LC2229" class="css-1dcdqdg"><code>            Context.prototype.add = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">schema, typeid</span>) </span>{
</code></td></tr><tr><td id="L2230" class="css-a4x74f"><span>2230</span></td><td id="LC2230" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (typeid === <span class="code-keyword">void</span> <span class="code-number">0</span>) { typeid = <span class="code-keyword">this</span>.schemas.size; }
</code></td></tr><tr><td id="L2231" class="css-a4x74f"><span>2231</span></td><td id="LC2231" class="css-1dcdqdg"><code>                <span class="code-comment">// <span class="code-doctag">FIXME:</span> move this to somewhere else?</span>
</code></td></tr><tr><td id="L2232" class="css-a4x74f"><span>2232</span></td><td id="LC2232" class="css-1dcdqdg"><code>                <span class="code-comment">// support inheritance</span>
</code></td></tr><tr><td id="L2233" class="css-a4x74f"><span>2233</span></td><td id="LC2233" class="css-1dcdqdg"><code>                schema._definition = SchemaDefinition.create(schema._definition);
</code></td></tr><tr><td id="L2234" class="css-a4x74f"><span>2234</span></td><td id="LC2234" class="css-1dcdqdg"><code>                schema._typeid = typeid;
</code></td></tr><tr><td id="L2235" class="css-a4x74f"><span>2235</span></td><td id="LC2235" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.types[typeid] = schema;
</code></td></tr><tr><td id="L2236" class="css-a4x74f"><span>2236</span></td><td id="LC2236" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.schemas.set(schema, typeid);
</code></td></tr><tr><td id="L2237" class="css-a4x74f"><span>2237</span></td><td id="LC2237" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2238" class="css-a4x74f"><span>2238</span></td><td id="LC2238" class="css-1dcdqdg"><code>            Context.create = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">options</span>) </span>{
</code></td></tr><tr><td id="L2239" class="css-a4x74f"><span>2239</span></td><td id="LC2239" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (options === <span class="code-keyword">void</span> <span class="code-number">0</span>) { options = {}; }
</code></td></tr><tr><td id="L2240" class="css-a4x74f"><span>2240</span></td><td id="LC2240" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">definition</span>) </span>{
</code></td></tr><tr><td id="L2241" class="css-a4x74f"><span>2241</span></td><td id="LC2241" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (!options.context) {
</code></td></tr><tr><td id="L2242" class="css-a4x74f"><span>2242</span></td><td id="LC2242" class="css-1dcdqdg"><code>                        options.context = <span class="code-keyword">new</span> Context();
</code></td></tr><tr><td id="L2243" class="css-a4x74f"><span>2243</span></td><td id="LC2243" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L2244" class="css-a4x74f"><span>2244</span></td><td id="LC2244" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> type(definition, options);
</code></td></tr><tr><td id="L2245" class="css-a4x74f"><span>2245</span></td><td id="LC2245" class="css-1dcdqdg"><code>                };
</code></td></tr><tr><td id="L2246" class="css-a4x74f"><span>2246</span></td><td id="LC2246" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2247" class="css-a4x74f"><span>2247</span></td><td id="LC2247" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> Context;
</code></td></tr><tr><td id="L2248" class="css-a4x74f"><span>2248</span></td><td id="LC2248" class="css-1dcdqdg"><code>        }());
</code></td></tr><tr><td id="L2249" class="css-a4x74f"><span>2249</span></td><td id="LC2249" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> globalContext = <span class="code-keyword">new</span> Context();
</code></td></tr><tr><td id="L2250" class="css-a4x74f"><span>2250</span></td><td id="LC2250" class="css-1dcdqdg"><code>        <span class="code-comment">/**
</span></code></td></tr><tr><td id="L2251" class="css-a4x74f"><span>2251</span></td><td id="LC2251" class="css-1dcdqdg"><code><span class="code-comment">         * [See documentation](https://docs.colyseus.io/state/schema/)
</span></code></td></tr><tr><td id="L2252" class="css-a4x74f"><span>2252</span></td><td id="LC2252" class="css-1dcdqdg"><code><span class="code-comment">         *
</span></code></td></tr><tr><td id="L2253" class="css-a4x74f"><span>2253</span></td><td id="LC2253" class="css-1dcdqdg"><code><span class="code-comment">         * Annotate a Schema property to be serializeable.
</span></code></td></tr><tr><td id="L2254" class="css-a4x74f"><span>2254</span></td><td id="LC2254" class="css-1dcdqdg"><code><span class="code-comment">         * \@type()'d fields are automatically flagged as "dirty" for the next patch.
</span></code></td></tr><tr><td id="L2255" class="css-a4x74f"><span>2255</span></td><td id="LC2255" class="css-1dcdqdg"><code><span class="code-comment">         *
</span></code></td></tr><tr><td id="L2256" class="css-a4x74f"><span>2256</span></td><td id="LC2256" class="css-1dcdqdg"><code><span class="code-comment">         * @example Standard usage, with automatic change tracking.
</span></code></td></tr><tr><td id="L2257" class="css-a4x74f"><span>2257</span></td><td id="LC2257" class="css-1dcdqdg"><code><span class="code-comment">         * ```
</span></code></td></tr><tr><td id="L2258" class="css-a4x74f"><span>2258</span></td><td id="LC2258" class="css-1dcdqdg"><code><span class="code-comment">         * \@type("string") propertyName: string;
</span></code></td></tr><tr><td id="L2259" class="css-a4x74f"><span>2259</span></td><td id="LC2259" class="css-1dcdqdg"><code><span class="code-comment">         * ```
</span></code></td></tr><tr><td id="L2260" class="css-a4x74f"><span>2260</span></td><td id="LC2260" class="css-1dcdqdg"><code><span class="code-comment">         *
</span></code></td></tr><tr><td id="L2261" class="css-a4x74f"><span>2261</span></td><td id="LC2261" class="css-1dcdqdg"><code><span class="code-comment">         * @example You can provide the "manual" option if you'd like to manually control your patches via .setDirty().
</span></code></td></tr><tr><td id="L2262" class="css-a4x74f"><span>2262</span></td><td id="LC2262" class="css-1dcdqdg"><code><span class="code-comment">         * ```
</span></code></td></tr><tr><td id="L2263" class="css-a4x74f"><span>2263</span></td><td id="LC2263" class="css-1dcdqdg"><code><span class="code-comment">         * \@type("string", { manual: true })
</span></code></td></tr><tr><td id="L2264" class="css-a4x74f"><span>2264</span></td><td id="LC2264" class="css-1dcdqdg"><code><span class="code-comment">         * ```
</span></code></td></tr><tr><td id="L2265" class="css-a4x74f"><span>2265</span></td><td id="LC2265" class="css-1dcdqdg"><code><span class="code-comment">         */</span>
</code></td></tr><tr><td id="L2266" class="css-a4x74f"><span>2266</span></td><td id="LC2266" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">type</span>(<span class="code-params">type, options</span>) </span>{
</code></td></tr><tr><td id="L2267" class="css-a4x74f"><span>2267</span></td><td id="LC2267" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (options === <span class="code-keyword">void</span> <span class="code-number">0</span>) { options = {}; }
</code></td></tr><tr><td id="L2268" class="css-a4x74f"><span>2268</span></td><td id="LC2268" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">target, field</span>) </span>{
</code></td></tr><tr><td id="L2269" class="css-a4x74f"><span>2269</span></td><td id="LC2269" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> context = options.context || globalContext;
</code></td></tr><tr><td id="L2270" class="css-a4x74f"><span>2270</span></td><td id="LC2270" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> <span class="code-keyword">constructor</span> = target.<span class="code-keyword">constructor</span>;
</code></td></tr><tr><td id="L2271" class="css-a4x74f"><span>2271</span></td><td id="LC2271" class="css-1dcdqdg"><code>                <span class="code-keyword">constructor</span>._context = context;
</code></td></tr><tr><td id="L2272" class="css-a4x74f"><span>2272</span></td><td id="LC2272" class="css-1dcdqdg"><code>                if (!type) {
</code></td></tr><tr><td id="L2273" class="css-a4x74f"><span>2273</span></td><td id="LC2273" class="css-1dcdqdg"><code>                    <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">""</span>.concat(<span class="code-keyword">constructor</span>.name, ": @type() reference provided for \"").concat(field, "\" is undefined. Make sure you don't have any circular dependencies."));
</code></td></tr><tr><td id="L2274" class="css-a4x74f"><span>2274</span></td><td id="LC2274" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2275" class="css-a4x74f"><span>2275</span></td><td id="LC2275" class="css-1dcdqdg"><code>                /*
</code></td></tr><tr><td id="L2276" class="css-a4x74f"><span>2276</span></td><td id="LC2276" class="css-1dcdqdg"><code>                 * static schema
</code></td></tr><tr><td id="L2277" class="css-a4x74f"><span>2277</span></td><td id="LC2277" class="css-1dcdqdg"><code>                 */
</code></td></tr><tr><td id="L2278" class="css-a4x74f"><span>2278</span></td><td id="LC2278" class="css-1dcdqdg"><code>                if (!context.has(<span class="code-keyword">constructor</span>)) {
</code></td></tr><tr><td id="L2279" class="css-a4x74f"><span>2279</span></td><td id="LC2279" class="css-1dcdqdg"><code>                    context.add(<span class="code-keyword">constructor</span>);
</code></td></tr><tr><td id="L2280" class="css-a4x74f"><span>2280</span></td><td id="LC2280" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2281" class="css-a4x74f"><span>2281</span></td><td id="LC2281" class="css-1dcdqdg"><code>                var definition = <span class="code-keyword">constructor</span>._definition;
</code></td></tr><tr><td id="L2282" class="css-a4x74f"><span>2282</span></td><td id="LC2282" class="css-1dcdqdg"><code>                definition.addField(field, type);
</code></td></tr><tr><td id="L2283" class="css-a4x74f"><span>2283</span></td><td id="LC2283" class="css-1dcdqdg"><code>                /**
</code></td></tr><tr><td id="L2284" class="css-a4x74f"><span>2284</span></td><td id="LC2284" class="css-1dcdqdg"><code>                 * skip if descriptor already exists for this field (`@deprecated()`)
</code></td></tr><tr><td id="L2285" class="css-a4x74f"><span>2285</span></td><td id="LC2285" class="css-1dcdqdg"><code>                 */
</code></td></tr><tr><td id="L2286" class="css-a4x74f"><span>2286</span></td><td id="LC2286" class="css-1dcdqdg"><code>                if (definition.descriptors[field]) {
</code></td></tr><tr><td id="L2287" class="css-a4x74f"><span>2287</span></td><td id="LC2287" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (definition.deprecated[field]) {
</code></td></tr><tr><td id="L2288" class="css-a4x74f"><span>2288</span></td><td id="LC2288" class="css-1dcdqdg"><code>                        <span class="code-comment">// do not create accessors for deprecated properties.</span>
</code></td></tr><tr><td id="L2289" class="css-a4x74f"><span>2289</span></td><td id="LC2289" class="css-1dcdqdg"><code>                        <span class="code-keyword">return</span>;
</code></td></tr><tr><td id="L2290" class="css-a4x74f"><span>2290</span></td><td id="LC2290" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L2291" class="css-a4x74f"><span>2291</span></td><td id="LC2291" class="css-1dcdqdg"><code>                    <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L2292" class="css-a4x74f"><span>2292</span></td><td id="LC2292" class="css-1dcdqdg"><code>                        <span class="code-comment">// trying to define same property multiple times across inheritance.</span>
</code></td></tr><tr><td id="L2293" class="css-a4x74f"><span>2293</span></td><td id="LC2293" class="css-1dcdqdg"><code>                        <span class="code-comment">// https://github.com/colyseus/colyseus-unity3d/issues/131#issuecomment-814308572</span>
</code></td></tr><tr><td id="L2294" class="css-a4x74f"><span>2294</span></td><td id="LC2294" class="css-1dcdqdg"><code>                        <span class="code-keyword">try</span> {
</code></td></tr><tr><td id="L2295" class="css-a4x74f"><span>2295</span></td><td id="LC2295" class="css-1dcdqdg"><code>                            <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">"@colyseus/schema: Duplicate '"</span>.concat(field, <span class="code-string">"' definition on '"</span>).concat(<span class="code-keyword">constructor</span>.name, "'.\nCheck @type() annotation"));
</code></td></tr><tr><td id="L2296" class="css-a4x74f"><span>2296</span></td><td id="LC2296" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L2297" class="css-a4x74f"><span>2297</span></td><td id="LC2297" class="css-1dcdqdg"><code>                        catch (e) {
</code></td></tr><tr><td id="L2298" class="css-a4x74f"><span>2298</span></td><td id="LC2298" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> definitionAtLine = e.stack.split(<span class="code-string">"\n"</span>)[<span class="code-number">4</span>].trim();
</code></td></tr><tr><td id="L2299" class="css-a4x74f"><span>2299</span></td><td id="LC2299" class="css-1dcdqdg"><code>                            <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">""</span>.concat(e.message, <span class="code-string">" "</span>).concat(definitionAtLine));
</code></td></tr><tr><td id="L2300" class="css-a4x74f"><span>2300</span></td><td id="LC2300" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L2301" class="css-a4x74f"><span>2301</span></td><td id="LC2301" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L2302" class="css-a4x74f"><span>2302</span></td><td id="LC2302" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2303" class="css-a4x74f"><span>2303</span></td><td id="LC2303" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> isArray = ArraySchema.is(type);
</code></td></tr><tr><td id="L2304" class="css-a4x74f"><span>2304</span></td><td id="LC2304" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> isMap = !isArray &amp;&amp; MapSchema.is(type);
</code></td></tr><tr><td id="L2305" class="css-a4x74f"><span>2305</span></td><td id="LC2305" class="css-1dcdqdg"><code>                <span class="code-comment">// <span class="code-doctag">TODO:</span> refactor me.</span>
</code></td></tr><tr><td id="L2306" class="css-a4x74f"><span>2306</span></td><td id="LC2306" class="css-1dcdqdg"><code>                <span class="code-comment">// Allow abstract intermediary classes with no fields to be serialized</span>
</code></td></tr><tr><td id="L2307" class="css-a4x74f"><span>2307</span></td><td id="LC2307" class="css-1dcdqdg"><code>                <span class="code-comment">// (See "should support an inheritance with a Schema type without fields" test)</span>
</code></td></tr><tr><td id="L2308" class="css-a4x74f"><span>2308</span></td><td id="LC2308" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (type) !== <span class="code-string">"string"</span> &amp;&amp; !Schema.is(type)) {
</code></td></tr><tr><td id="L2309" class="css-a4x74f"><span>2309</span></td><td id="LC2309" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> childType = <span class="code-built_in">Object</span>.values(type)[<span class="code-number">0</span>];
</code></td></tr><tr><td id="L2310" class="css-a4x74f"><span>2310</span></td><td id="LC2310" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (childType) !== <span class="code-string">"string"</span> &amp;&amp; !context.has(childType)) {
</code></td></tr><tr><td id="L2311" class="css-a4x74f"><span>2311</span></td><td id="LC2311" class="css-1dcdqdg"><code>                        context.add(childType);
</code></td></tr><tr><td id="L2312" class="css-a4x74f"><span>2312</span></td><td id="LC2312" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L2313" class="css-a4x74f"><span>2313</span></td><td id="LC2313" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2314" class="css-a4x74f"><span>2314</span></td><td id="LC2314" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (options.manual) {
</code></td></tr><tr><td id="L2315" class="css-a4x74f"><span>2315</span></td><td id="LC2315" class="css-1dcdqdg"><code>                    <span class="code-comment">// do not declare getter/setter descriptor</span>
</code></td></tr><tr><td id="L2316" class="css-a4x74f"><span>2316</span></td><td id="LC2316" class="css-1dcdqdg"><code>                    definition.descriptors[field] = {
</code></td></tr><tr><td id="L2317" class="css-a4x74f"><span>2317</span></td><td id="LC2317" class="css-1dcdqdg"><code>                        enumerable: <span class="code-literal">true</span>,
</code></td></tr><tr><td id="L2318" class="css-a4x74f"><span>2318</span></td><td id="LC2318" class="css-1dcdqdg"><code>                        configurable: <span class="code-literal">true</span>,
</code></td></tr><tr><td id="L2319" class="css-a4x74f"><span>2319</span></td><td id="LC2319" class="css-1dcdqdg"><code>                        writable: <span class="code-literal">true</span>,
</code></td></tr><tr><td id="L2320" class="css-a4x74f"><span>2320</span></td><td id="LC2320" class="css-1dcdqdg"><code>                    };
</code></td></tr><tr><td id="L2321" class="css-a4x74f"><span>2321</span></td><td id="LC2321" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span>;
</code></td></tr><tr><td id="L2322" class="css-a4x74f"><span>2322</span></td><td id="LC2322" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2323" class="css-a4x74f"><span>2323</span></td><td id="LC2323" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> fieldCached = <span class="code-string">"_"</span>.concat(field);
</code></td></tr><tr><td id="L2324" class="css-a4x74f"><span>2324</span></td><td id="LC2324" class="css-1dcdqdg"><code>                definition.descriptors[fieldCached] = {
</code></td></tr><tr><td id="L2325" class="css-a4x74f"><span>2325</span></td><td id="LC2325" class="css-1dcdqdg"><code>                    enumerable: <span class="code-literal">false</span>,
</code></td></tr><tr><td id="L2326" class="css-a4x74f"><span>2326</span></td><td id="LC2326" class="css-1dcdqdg"><code>                    configurable: <span class="code-literal">false</span>,
</code></td></tr><tr><td id="L2327" class="css-a4x74f"><span>2327</span></td><td id="LC2327" class="css-1dcdqdg"><code>                    writable: <span class="code-literal">true</span>,
</code></td></tr><tr><td id="L2328" class="css-a4x74f"><span>2328</span></td><td id="LC2328" class="css-1dcdqdg"><code>                };
</code></td></tr><tr><td id="L2329" class="css-a4x74f"><span>2329</span></td><td id="LC2329" class="css-1dcdqdg"><code>                definition.descriptors[field] = {
</code></td></tr><tr><td id="L2330" class="css-a4x74f"><span>2330</span></td><td id="LC2330" class="css-1dcdqdg"><code>                    <span class="code-keyword">get</span>: function () {
</code></td></tr><tr><td id="L2331" class="css-a4x74f"><span>2331</span></td><td id="LC2331" class="css-1dcdqdg"><code>                        <span class="code-keyword">return</span> <span class="code-keyword">this</span>[fieldCached];
</code></td></tr><tr><td id="L2332" class="css-a4x74f"><span>2332</span></td><td id="LC2332" class="css-1dcdqdg"><code>                    },
</code></td></tr><tr><td id="L2333" class="css-a4x74f"><span>2333</span></td><td id="LC2333" class="css-1dcdqdg"><code>                    <span class="code-keyword">set</span>: function (value) {
</code></td></tr><tr><td id="L2334" class="css-a4x74f"><span>2334</span></td><td id="LC2334" class="css-1dcdqdg"><code>                        <span class="code-comment">/**
</span></code></td></tr><tr><td id="L2335" class="css-a4x74f"><span>2335</span></td><td id="LC2335" class="css-1dcdqdg"><code><span class="code-comment">                         * Create Proxy for array or map items
</span></code></td></tr><tr><td id="L2336" class="css-a4x74f"><span>2336</span></td><td id="LC2336" class="css-1dcdqdg"><code><span class="code-comment">                         */</span>
</code></td></tr><tr><td id="L2337" class="css-a4x74f"><span>2337</span></td><td id="LC2337" class="css-1dcdqdg"><code>                        <span class="code-comment">// skip if value is the same as cached.</span>
</code></td></tr><tr><td id="L2338" class="css-a4x74f"><span>2338</span></td><td id="LC2338" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (value === <span class="code-keyword">this</span>[fieldCached]) {
</code></td></tr><tr><td id="L2339" class="css-a4x74f"><span>2339</span></td><td id="LC2339" class="css-1dcdqdg"><code>                            <span class="code-keyword">return</span>;
</code></td></tr><tr><td id="L2340" class="css-a4x74f"><span>2340</span></td><td id="LC2340" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L2341" class="css-a4x74f"><span>2341</span></td><td id="LC2341" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (value !== <span class="code-literal">undefined</span> &amp;&amp;
</code></td></tr><tr><td id="L2342" class="css-a4x74f"><span>2342</span></td><td id="LC2342" class="css-1dcdqdg"><code>                            value !== <span class="code-literal">null</span>) {
</code></td></tr><tr><td id="L2343" class="css-a4x74f"><span>2343</span></td><td id="LC2343" class="css-1dcdqdg"><code>                            <span class="code-comment">// automaticallty transform Array into ArraySchema</span>
</code></td></tr><tr><td id="L2344" class="css-a4x74f"><span>2344</span></td><td id="LC2344" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (isArray &amp;&amp; !(value <span class="code-keyword">instanceof</span> ArraySchema)) {
</code></td></tr><tr><td id="L2345" class="css-a4x74f"><span>2345</span></td><td id="LC2345" class="css-1dcdqdg"><code>                                value = <span class="code-keyword">new</span> (ArraySchema.bind.apply(ArraySchema, __spreadArray([<span class="code-keyword">void</span> <span class="code-number">0</span>], value, <span class="code-literal">false</span>)))();
</code></td></tr><tr><td id="L2346" class="css-a4x74f"><span>2346</span></td><td id="LC2346" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L2347" class="css-a4x74f"><span>2347</span></td><td id="LC2347" class="css-1dcdqdg"><code>                            <span class="code-comment">// automaticallty transform Map into MapSchema</span>
</code></td></tr><tr><td id="L2348" class="css-a4x74f"><span>2348</span></td><td id="LC2348" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (isMap &amp;&amp; !(value <span class="code-keyword">instanceof</span> MapSchema)) {
</code></td></tr><tr><td id="L2349" class="css-a4x74f"><span>2349</span></td><td id="LC2349" class="css-1dcdqdg"><code>                                value = <span class="code-keyword">new</span> MapSchema(value);
</code></td></tr><tr><td id="L2350" class="css-a4x74f"><span>2350</span></td><td id="LC2350" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L2351" class="css-a4x74f"><span>2351</span></td><td id="LC2351" class="css-1dcdqdg"><code>                            <span class="code-comment">// try to turn provided structure into a Proxy</span>
</code></td></tr><tr><td id="L2352" class="css-a4x74f"><span>2352</span></td><td id="LC2352" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (value[<span class="code-string">'$proxy'</span>] === <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L2353" class="css-a4x74f"><span>2353</span></td><td id="LC2353" class="css-1dcdqdg"><code>                                <span class="code-keyword">if</span> (isMap) {
</code></td></tr><tr><td id="L2354" class="css-a4x74f"><span>2354</span></td><td id="LC2354" class="css-1dcdqdg"><code>                                    value = getMapProxy(value);
</code></td></tr><tr><td id="L2355" class="css-a4x74f"><span>2355</span></td><td id="LC2355" class="css-1dcdqdg"><code>                                }
</code></td></tr><tr><td id="L2356" class="css-a4x74f"><span>2356</span></td><td id="LC2356" class="css-1dcdqdg"><code>                                <span class="code-keyword">else</span> <span class="code-keyword">if</span> (isArray) {
</code></td></tr><tr><td id="L2357" class="css-a4x74f"><span>2357</span></td><td id="LC2357" class="css-1dcdqdg"><code>                                    value = getArrayProxy(value);
</code></td></tr><tr><td id="L2358" class="css-a4x74f"><span>2358</span></td><td id="LC2358" class="css-1dcdqdg"><code>                                }
</code></td></tr><tr><td id="L2359" class="css-a4x74f"><span>2359</span></td><td id="LC2359" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L2360" class="css-a4x74f"><span>2360</span></td><td id="LC2360" class="css-1dcdqdg"><code>                            <span class="code-comment">// flag the change for encoding.</span>
</code></td></tr><tr><td id="L2361" class="css-a4x74f"><span>2361</span></td><td id="LC2361" class="css-1dcdqdg"><code>                            <span class="code-keyword">this</span>.$changes.change(field);
</code></td></tr><tr><td id="L2362" class="css-a4x74f"><span>2362</span></td><td id="LC2362" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L2363" class="css-a4x74f"><span>2363</span></td><td id="LC2363" class="css-1dcdqdg"><code>                            <span class="code-comment">// call setParent() recursively for this and its child</span>
</code></td></tr><tr><td id="L2364" class="css-a4x74f"><span>2364</span></td><td id="LC2364" class="css-1dcdqdg"><code>                            <span class="code-comment">// structures.</span>
</code></td></tr><tr><td id="L2365" class="css-a4x74f"><span>2365</span></td><td id="LC2365" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L2366" class="css-a4x74f"><span>2366</span></td><td id="LC2366" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (value[<span class="code-string">'$changes'</span>]) {
</code></td></tr><tr><td id="L2367" class="css-a4x74f"><span>2367</span></td><td id="LC2367" class="css-1dcdqdg"><code>                                value[<span class="code-string">'$changes'</span>].setParent(<span class="code-keyword">this</span>, <span class="code-keyword">this</span>.$changes.root, <span class="code-keyword">this</span>._definition.indexes[field]);
</code></td></tr><tr><td id="L2368" class="css-a4x74f"><span>2368</span></td><td id="LC2368" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L2369" class="css-a4x74f"><span>2369</span></td><td id="LC2369" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L2370" class="css-a4x74f"><span>2370</span></td><td id="LC2370" class="css-1dcdqdg"><code>                        <span class="code-keyword">else</span> <span class="code-keyword">if</span> (<span class="code-keyword">this</span>[fieldCached]) {
</code></td></tr><tr><td id="L2371" class="css-a4x74f"><span>2371</span></td><td id="LC2371" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L2372" class="css-a4x74f"><span>2372</span></td><td id="LC2372" class="css-1dcdqdg"><code>                            <span class="code-comment">// Setting a field to `null` or `undefined` will delete it.</span>
</code></td></tr><tr><td id="L2373" class="css-a4x74f"><span>2373</span></td><td id="LC2373" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L2374" class="css-a4x74f"><span>2374</span></td><td id="LC2374" class="css-1dcdqdg"><code>                            <span class="code-keyword">this</span>.$changes.delete(field);
</code></td></tr><tr><td id="L2375" class="css-a4x74f"><span>2375</span></td><td id="LC2375" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L2376" class="css-a4x74f"><span>2376</span></td><td id="LC2376" class="css-1dcdqdg"><code>                        <span class="code-keyword">this</span>[fieldCached] = value;
</code></td></tr><tr><td id="L2377" class="css-a4x74f"><span>2377</span></td><td id="LC2377" class="css-1dcdqdg"><code>                    },
</code></td></tr><tr><td id="L2378" class="css-a4x74f"><span>2378</span></td><td id="LC2378" class="css-1dcdqdg"><code>                    enumerable: <span class="code-literal">true</span>,
</code></td></tr><tr><td id="L2379" class="css-a4x74f"><span>2379</span></td><td id="LC2379" class="css-1dcdqdg"><code>                    configurable: <span class="code-literal">true</span>
</code></td></tr><tr><td id="L2380" class="css-a4x74f"><span>2380</span></td><td id="LC2380" class="css-1dcdqdg"><code>                };
</code></td></tr><tr><td id="L2381" class="css-a4x74f"><span>2381</span></td><td id="LC2381" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2382" class="css-a4x74f"><span>2382</span></td><td id="LC2382" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2383" class="css-a4x74f"><span>2383</span></td><td id="LC2383" class="css-1dcdqdg"><code>        <span class="code-comment">/**
</span></code></td></tr><tr><td id="L2384" class="css-a4x74f"><span>2384</span></td><td id="LC2384" class="css-1dcdqdg"><code><span class="code-comment">         * `@filter()` decorator for defining data filters per client
</span></code></td></tr><tr><td id="L2385" class="css-a4x74f"><span>2385</span></td><td id="LC2385" class="css-1dcdqdg"><code><span class="code-comment">         */</span>
</code></td></tr><tr><td id="L2386" class="css-a4x74f"><span>2386</span></td><td id="LC2386" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">filter</span>(<span class="code-params">cb</span>) </span>{
</code></td></tr><tr><td id="L2387" class="css-a4x74f"><span>2387</span></td><td id="LC2387" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">target, field</span>) </span>{
</code></td></tr><tr><td id="L2388" class="css-a4x74f"><span>2388</span></td><td id="LC2388" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> <span class="code-keyword">constructor</span> = target.<span class="code-keyword">constructor</span>;
</code></td></tr><tr><td id="L2389" class="css-a4x74f"><span>2389</span></td><td id="LC2389" class="css-1dcdqdg"><code>                var definition = <span class="code-keyword">constructor</span>._definition;
</code></td></tr><tr><td id="L2390" class="css-a4x74f"><span>2390</span></td><td id="LC2390" class="css-1dcdqdg"><code>                if (definition.addFilter(field, cb)) {
</code></td></tr><tr><td id="L2391" class="css-a4x74f"><span>2391</span></td><td id="LC2391" class="css-1dcdqdg"><code>                    <span class="code-keyword">constructor</span>._context.useFilters = true;
</code></td></tr><tr><td id="L2392" class="css-a4x74f"><span>2392</span></td><td id="LC2392" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2393" class="css-a4x74f"><span>2393</span></td><td id="LC2393" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2394" class="css-a4x74f"><span>2394</span></td><td id="LC2394" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2395" class="css-a4x74f"><span>2395</span></td><td id="LC2395" class="css-1dcdqdg"><code>        function filterChildren(cb) {
</code></td></tr><tr><td id="L2396" class="css-a4x74f"><span>2396</span></td><td id="LC2396" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">target, field</span>) </span>{
</code></td></tr><tr><td id="L2397" class="css-a4x74f"><span>2397</span></td><td id="LC2397" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> <span class="code-keyword">constructor</span> = target.<span class="code-keyword">constructor</span>;
</code></td></tr><tr><td id="L2398" class="css-a4x74f"><span>2398</span></td><td id="LC2398" class="css-1dcdqdg"><code>                var definition = <span class="code-keyword">constructor</span>._definition;
</code></td></tr><tr><td id="L2399" class="css-a4x74f"><span>2399</span></td><td id="LC2399" class="css-1dcdqdg"><code>                if (definition.addChildrenFilter(field, cb)) {
</code></td></tr><tr><td id="L2400" class="css-a4x74f"><span>2400</span></td><td id="LC2400" class="css-1dcdqdg"><code>                    <span class="code-keyword">constructor</span>._context.useFilters = true;
</code></td></tr><tr><td id="L2401" class="css-a4x74f"><span>2401</span></td><td id="LC2401" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2402" class="css-a4x74f"><span>2402</span></td><td id="LC2402" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2403" class="css-a4x74f"><span>2403</span></td><td id="LC2403" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2404" class="css-a4x74f"><span>2404</span></td><td id="LC2404" class="css-1dcdqdg"><code>        /**
</code></td></tr><tr><td id="L2405" class="css-a4x74f"><span>2405</span></td><td id="LC2405" class="css-1dcdqdg"><code>         * `@deprecated()` flag a field as deprecated.
</code></td></tr><tr><td id="L2406" class="css-a4x74f"><span>2406</span></td><td id="LC2406" class="css-1dcdqdg"><code>         * The previous `@type()` annotation should remain along with this one.
</code></td></tr><tr><td id="L2407" class="css-a4x74f"><span>2407</span></td><td id="LC2407" class="css-1dcdqdg"><code>         */
</code></td></tr><tr><td id="L2408" class="css-a4x74f"><span>2408</span></td><td id="LC2408" class="css-1dcdqdg"><code>        function deprecated(throws) {
</code></td></tr><tr><td id="L2409" class="css-a4x74f"><span>2409</span></td><td id="LC2409" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (throws === <span class="code-keyword">void</span> <span class="code-number">0</span>) { throws = <span class="code-literal">true</span>; }
</code></td></tr><tr><td id="L2410" class="css-a4x74f"><span>2410</span></td><td id="LC2410" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">target, field</span>) </span>{
</code></td></tr><tr><td id="L2411" class="css-a4x74f"><span>2411</span></td><td id="LC2411" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> <span class="code-keyword">constructor</span> = target.<span class="code-keyword">constructor</span>;
</code></td></tr><tr><td id="L2412" class="css-a4x74f"><span>2412</span></td><td id="LC2412" class="css-1dcdqdg"><code>                var definition = <span class="code-keyword">constructor</span>._definition;
</code></td></tr><tr><td id="L2413" class="css-a4x74f"><span>2413</span></td><td id="LC2413" class="css-1dcdqdg"><code>                definition.deprecated[field] = true;
</code></td></tr><tr><td id="L2414" class="css-a4x74f"><span>2414</span></td><td id="LC2414" class="css-1dcdqdg"><code>                if (throws) {
</code></td></tr><tr><td id="L2415" class="css-a4x74f"><span>2415</span></td><td id="LC2415" class="css-1dcdqdg"><code>                    definition.descriptors[field] = {
</code></td></tr><tr><td id="L2416" class="css-a4x74f"><span>2416</span></td><td id="LC2416" class="css-1dcdqdg"><code>                        <span class="code-keyword">get</span>: function () { <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">""</span>.concat(field, <span class="code-string">" is deprecated."</span>)); },
</code></td></tr><tr><td id="L2417" class="css-a4x74f"><span>2417</span></td><td id="LC2417" class="css-1dcdqdg"><code>                        <span class="code-keyword">set</span>: function (value) { },
</code></td></tr><tr><td id="L2418" class="css-a4x74f"><span>2418</span></td><td id="LC2418" class="css-1dcdqdg"><code>                        enumerable: <span class="code-literal">false</span>,
</code></td></tr><tr><td id="L2419" class="css-a4x74f"><span>2419</span></td><td id="LC2419" class="css-1dcdqdg"><code>                        configurable: <span class="code-literal">true</span>
</code></td></tr><tr><td id="L2420" class="css-a4x74f"><span>2420</span></td><td id="LC2420" class="css-1dcdqdg"><code>                    };
</code></td></tr><tr><td id="L2421" class="css-a4x74f"><span>2421</span></td><td id="LC2421" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2422" class="css-a4x74f"><span>2422</span></td><td id="LC2422" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2423" class="css-a4x74f"><span>2423</span></td><td id="LC2423" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2424" class="css-a4x74f"><span>2424</span></td><td id="LC2424" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">defineTypes</span>(<span class="code-params">target, fields, options</span>) </span>{
</code></td></tr><tr><td id="L2425" class="css-a4x74f"><span>2425</span></td><td id="LC2425" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (options === <span class="code-keyword">void</span> <span class="code-number">0</span>) { options = {}; }
</code></td></tr><tr><td id="L2426" class="css-a4x74f"><span>2426</span></td><td id="LC2426" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (!options.context) {
</code></td></tr><tr><td id="L2427" class="css-a4x74f"><span>2427</span></td><td id="LC2427" class="css-1dcdqdg"><code>                options.context = target._context || options.context || globalContext;
</code></td></tr><tr><td id="L2428" class="css-a4x74f"><span>2428</span></td><td id="LC2428" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2429" class="css-a4x74f"><span>2429</span></td><td id="LC2429" class="css-1dcdqdg"><code>            <span class="code-keyword">for</span> (<span class="code-keyword">var</span> field <span class="code-keyword">in</span> fields) {
</code></td></tr><tr><td id="L2430" class="css-a4x74f"><span>2430</span></td><td id="LC2430" class="css-1dcdqdg"><code>                type(fields[field], options)(target.prototype, field);
</code></td></tr><tr><td id="L2431" class="css-a4x74f"><span>2431</span></td><td id="LC2431" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2432" class="css-a4x74f"><span>2432</span></td><td id="LC2432" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> target;
</code></td></tr><tr><td id="L2433" class="css-a4x74f"><span>2433</span></td><td id="LC2433" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2434" class="css-a4x74f"><span>2434</span></td><td id="LC2434" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L2435" class="css-a4x74f"><span>2435</span></td><td id="LC2435" class="css-1dcdqdg"><code>        <span class="code-comment">/**
</span></code></td></tr><tr><td id="L2436" class="css-a4x74f"><span>2436</span></td><td id="LC2436" class="css-1dcdqdg"><code><span class="code-comment">         * Copyright (c) 2018 Endel Dreyer
</span></code></td></tr><tr><td id="L2437" class="css-a4x74f"><span>2437</span></td><td id="LC2437" class="css-1dcdqdg"><code><span class="code-comment">         * Copyright (c) 2014 Ion Drive Software Ltd.
</span></code></td></tr><tr><td id="L2438" class="css-a4x74f"><span>2438</span></td><td id="LC2438" class="css-1dcdqdg"><code><span class="code-comment">         *
</span></code></td></tr><tr><td id="L2439" class="css-a4x74f"><span>2439</span></td><td id="LC2439" class="css-1dcdqdg"><code><span class="code-comment">         * Permission is hereby granted, free of charge, to any person obtaining a copy
</span></code></td></tr><tr><td id="L2440" class="css-a4x74f"><span>2440</span></td><td id="LC2440" class="css-1dcdqdg"><code><span class="code-comment">         * of this software and associated documentation files (the "Software"), to deal
</span></code></td></tr><tr><td id="L2441" class="css-a4x74f"><span>2441</span></td><td id="LC2441" class="css-1dcdqdg"><code><span class="code-comment">         * in the Software without restriction, including without limitation the rights
</span></code></td></tr><tr><td id="L2442" class="css-a4x74f"><span>2442</span></td><td id="LC2442" class="css-1dcdqdg"><code><span class="code-comment">         * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
</span></code></td></tr><tr><td id="L2443" class="css-a4x74f"><span>2443</span></td><td id="LC2443" class="css-1dcdqdg"><code><span class="code-comment">         * copies of the Software, and to permit persons to whom the Software is
</span></code></td></tr><tr><td id="L2444" class="css-a4x74f"><span>2444</span></td><td id="LC2444" class="css-1dcdqdg"><code><span class="code-comment">         * furnished to do so, subject to the following conditions:
</span></code></td></tr><tr><td id="L2445" class="css-a4x74f"><span>2445</span></td><td id="LC2445" class="css-1dcdqdg"><code><span class="code-comment">         *
</span></code></td></tr><tr><td id="L2446" class="css-a4x74f"><span>2446</span></td><td id="LC2446" class="css-1dcdqdg"><code><span class="code-comment">         * The above copyright notice and this permission notice shall be included in all
</span></code></td></tr><tr><td id="L2447" class="css-a4x74f"><span>2447</span></td><td id="LC2447" class="css-1dcdqdg"><code><span class="code-comment">         * copies or substantial portions of the Software.
</span></code></td></tr><tr><td id="L2448" class="css-a4x74f"><span>2448</span></td><td id="LC2448" class="css-1dcdqdg"><code><span class="code-comment">         *
</span></code></td></tr><tr><td id="L2449" class="css-a4x74f"><span>2449</span></td><td id="LC2449" class="css-1dcdqdg"><code><span class="code-comment">         * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
</span></code></td></tr><tr><td id="L2450" class="css-a4x74f"><span>2450</span></td><td id="LC2450" class="css-1dcdqdg"><code><span class="code-comment">         * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
</span></code></td></tr><tr><td id="L2451" class="css-a4x74f"><span>2451</span></td><td id="LC2451" class="css-1dcdqdg"><code><span class="code-comment">         * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
</span></code></td></tr><tr><td id="L2452" class="css-a4x74f"><span>2452</span></td><td id="LC2452" class="css-1dcdqdg"><code><span class="code-comment">         * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
</span></code></td></tr><tr><td id="L2453" class="css-a4x74f"><span>2453</span></td><td id="LC2453" class="css-1dcdqdg"><code><span class="code-comment">         * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
</span></code></td></tr><tr><td id="L2454" class="css-a4x74f"><span>2454</span></td><td id="LC2454" class="css-1dcdqdg"><code><span class="code-comment">         * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
</span></code></td></tr><tr><td id="L2455" class="css-a4x74f"><span>2455</span></td><td id="LC2455" class="css-1dcdqdg"><code><span class="code-comment">         * SOFTWARE
</span></code></td></tr><tr><td id="L2456" class="css-a4x74f"><span>2456</span></td><td id="LC2456" class="css-1dcdqdg"><code><span class="code-comment">         */</span>
</code></td></tr><tr><td id="L2457" class="css-a4x74f"><span>2457</span></td><td id="LC2457" class="css-1dcdqdg"><code>        <span class="code-comment">/**
</span></code></td></tr><tr><td id="L2458" class="css-a4x74f"><span>2458</span></td><td id="LC2458" class="css-1dcdqdg"><code><span class="code-comment">         * msgpack implementation highly based on notepack.io
</span></code></td></tr><tr><td id="L2459" class="css-a4x74f"><span>2459</span></td><td id="LC2459" class="css-1dcdqdg"><code><span class="code-comment">         * https://github.com/darrachequesne/notepack
</span></code></td></tr><tr><td id="L2460" class="css-a4x74f"><span>2460</span></td><td id="LC2460" class="css-1dcdqdg"><code><span class="code-comment">         */</span>
</code></td></tr><tr><td id="L2461" class="css-a4x74f"><span>2461</span></td><td id="LC2461" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">utf8Length</span>(<span class="code-params">str</span>) </span>{
</code></td></tr><tr><td id="L2462" class="css-a4x74f"><span>2462</span></td><td id="LC2462" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> c = <span class="code-number">0</span>, length = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L2463" class="css-a4x74f"><span>2463</span></td><td id="LC2463" class="css-1dcdqdg"><code>            <span class="code-keyword">for</span> (<span class="code-keyword">var</span> i = <span class="code-number">0</span>, l = str.length; i &lt; l; i++) {
</code></td></tr><tr><td id="L2464" class="css-a4x74f"><span>2464</span></td><td id="LC2464" class="css-1dcdqdg"><code>                c = str.charCodeAt(i);
</code></td></tr><tr><td id="L2465" class="css-a4x74f"><span>2465</span></td><td id="LC2465" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (c &lt; <span class="code-number">0x80</span>) {
</code></td></tr><tr><td id="L2466" class="css-a4x74f"><span>2466</span></td><td id="LC2466" class="css-1dcdqdg"><code>                    length += <span class="code-number">1</span>;
</code></td></tr><tr><td id="L2467" class="css-a4x74f"><span>2467</span></td><td id="LC2467" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2468" class="css-a4x74f"><span>2468</span></td><td id="LC2468" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> <span class="code-keyword">if</span> (c &lt; <span class="code-number">0x800</span>) {
</code></td></tr><tr><td id="L2469" class="css-a4x74f"><span>2469</span></td><td id="LC2469" class="css-1dcdqdg"><code>                    length += <span class="code-number">2</span>;
</code></td></tr><tr><td id="L2470" class="css-a4x74f"><span>2470</span></td><td id="LC2470" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2471" class="css-a4x74f"><span>2471</span></td><td id="LC2471" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> <span class="code-keyword">if</span> (c &lt; <span class="code-number">0xd800</span> || c &gt;= <span class="code-number">0xe000</span>) {
</code></td></tr><tr><td id="L2472" class="css-a4x74f"><span>2472</span></td><td id="LC2472" class="css-1dcdqdg"><code>                    length += <span class="code-number">3</span>;
</code></td></tr><tr><td id="L2473" class="css-a4x74f"><span>2473</span></td><td id="LC2473" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2474" class="css-a4x74f"><span>2474</span></td><td id="LC2474" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L2475" class="css-a4x74f"><span>2475</span></td><td id="LC2475" class="css-1dcdqdg"><code>                    i++;
</code></td></tr><tr><td id="L2476" class="css-a4x74f"><span>2476</span></td><td id="LC2476" class="css-1dcdqdg"><code>                    length += <span class="code-number">4</span>;
</code></td></tr><tr><td id="L2477" class="css-a4x74f"><span>2477</span></td><td id="LC2477" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2478" class="css-a4x74f"><span>2478</span></td><td id="LC2478" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2479" class="css-a4x74f"><span>2479</span></td><td id="LC2479" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> length;
</code></td></tr><tr><td id="L2480" class="css-a4x74f"><span>2480</span></td><td id="LC2480" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2481" class="css-a4x74f"><span>2481</span></td><td id="LC2481" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">utf8Write</span>(<span class="code-params">view, offset, str</span>) </span>{
</code></td></tr><tr><td id="L2482" class="css-a4x74f"><span>2482</span></td><td id="LC2482" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> c = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L2483" class="css-a4x74f"><span>2483</span></td><td id="LC2483" class="css-1dcdqdg"><code>            <span class="code-keyword">for</span> (<span class="code-keyword">var</span> i = <span class="code-number">0</span>, l = str.length; i &lt; l; i++) {
</code></td></tr><tr><td id="L2484" class="css-a4x74f"><span>2484</span></td><td id="LC2484" class="css-1dcdqdg"><code>                c = str.charCodeAt(i);
</code></td></tr><tr><td id="L2485" class="css-a4x74f"><span>2485</span></td><td id="LC2485" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (c &lt; <span class="code-number">0x80</span>) {
</code></td></tr><tr><td id="L2486" class="css-a4x74f"><span>2486</span></td><td id="LC2486" class="css-1dcdqdg"><code>                    view[offset++] = c;
</code></td></tr><tr><td id="L2487" class="css-a4x74f"><span>2487</span></td><td id="LC2487" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2488" class="css-a4x74f"><span>2488</span></td><td id="LC2488" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> <span class="code-keyword">if</span> (c &lt; <span class="code-number">0x800</span>) {
</code></td></tr><tr><td id="L2489" class="css-a4x74f"><span>2489</span></td><td id="LC2489" class="css-1dcdqdg"><code>                    view[offset++] = <span class="code-number">0xc0</span> | (c &gt;&gt; <span class="code-number">6</span>);
</code></td></tr><tr><td id="L2490" class="css-a4x74f"><span>2490</span></td><td id="LC2490" class="css-1dcdqdg"><code>                    view[offset++] = <span class="code-number">0x80</span> | (c &amp; <span class="code-number">0x3f</span>);
</code></td></tr><tr><td id="L2491" class="css-a4x74f"><span>2491</span></td><td id="LC2491" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2492" class="css-a4x74f"><span>2492</span></td><td id="LC2492" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> <span class="code-keyword">if</span> (c &lt; <span class="code-number">0xd800</span> || c &gt;= <span class="code-number">0xe000</span>) {
</code></td></tr><tr><td id="L2493" class="css-a4x74f"><span>2493</span></td><td id="LC2493" class="css-1dcdqdg"><code>                    view[offset++] = <span class="code-number">0xe0</span> | (c &gt;&gt; <span class="code-number">12</span>);
</code></td></tr><tr><td id="L2494" class="css-a4x74f"><span>2494</span></td><td id="LC2494" class="css-1dcdqdg"><code>                    view[offset++] = <span class="code-number">0x80</span> | (c &gt;&gt; <span class="code-number">6</span> &amp; <span class="code-number">0x3f</span>);
</code></td></tr><tr><td id="L2495" class="css-a4x74f"><span>2495</span></td><td id="LC2495" class="css-1dcdqdg"><code>                    view[offset++] = <span class="code-number">0x80</span> | (c &amp; <span class="code-number">0x3f</span>);
</code></td></tr><tr><td id="L2496" class="css-a4x74f"><span>2496</span></td><td id="LC2496" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2497" class="css-a4x74f"><span>2497</span></td><td id="LC2497" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L2498" class="css-a4x74f"><span>2498</span></td><td id="LC2498" class="css-1dcdqdg"><code>                    i++;
</code></td></tr><tr><td id="L2499" class="css-a4x74f"><span>2499</span></td><td id="LC2499" class="css-1dcdqdg"><code>                    c = <span class="code-number">0x10000</span> + (((c &amp; <span class="code-number">0x3ff</span>) &lt;&lt; <span class="code-number">10</span>) | (str.charCodeAt(i) &amp; <span class="code-number">0x3ff</span>));
</code></td></tr><tr><td id="L2500" class="css-a4x74f"><span>2500</span></td><td id="LC2500" class="css-1dcdqdg"><code>                    view[offset++] = <span class="code-number">0xf0</span> | (c &gt;&gt; <span class="code-number">18</span>);
</code></td></tr><tr><td id="L2501" class="css-a4x74f"><span>2501</span></td><td id="LC2501" class="css-1dcdqdg"><code>                    view[offset++] = <span class="code-number">0x80</span> | (c &gt;&gt; <span class="code-number">12</span> &amp; <span class="code-number">0x3f</span>);
</code></td></tr><tr><td id="L2502" class="css-a4x74f"><span>2502</span></td><td id="LC2502" class="css-1dcdqdg"><code>                    view[offset++] = <span class="code-number">0x80</span> | (c &gt;&gt; <span class="code-number">6</span> &amp; <span class="code-number">0x3f</span>);
</code></td></tr><tr><td id="L2503" class="css-a4x74f"><span>2503</span></td><td id="LC2503" class="css-1dcdqdg"><code>                    view[offset++] = <span class="code-number">0x80</span> | (c &amp; <span class="code-number">0x3f</span>);
</code></td></tr><tr><td id="L2504" class="css-a4x74f"><span>2504</span></td><td id="LC2504" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2505" class="css-a4x74f"><span>2505</span></td><td id="LC2505" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2506" class="css-a4x74f"><span>2506</span></td><td id="LC2506" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2507" class="css-a4x74f"><span>2507</span></td><td id="LC2507" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">int8$1</span>(<span class="code-params">bytes, value</span>) </span>{
</code></td></tr><tr><td id="L2508" class="css-a4x74f"><span>2508</span></td><td id="LC2508" class="css-1dcdqdg"><code>            bytes.push(value &amp; <span class="code-number">255</span>);
</code></td></tr><tr><td id="L2509" class="css-a4x74f"><span>2509</span></td><td id="LC2509" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2510" class="css-a4x74f"><span>2510</span></td><td id="LC2510" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">uint8$1</span>(<span class="code-params">bytes, value</span>) </span>{
</code></td></tr><tr><td id="L2511" class="css-a4x74f"><span>2511</span></td><td id="LC2511" class="css-1dcdqdg"><code>            bytes.push(value &amp; <span class="code-number">255</span>);
</code></td></tr><tr><td id="L2512" class="css-a4x74f"><span>2512</span></td><td id="LC2512" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2513" class="css-a4x74f"><span>2513</span></td><td id="LC2513" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">int16$1</span>(<span class="code-params">bytes, value</span>) </span>{
</code></td></tr><tr><td id="L2514" class="css-a4x74f"><span>2514</span></td><td id="LC2514" class="css-1dcdqdg"><code>            bytes.push(value &amp; <span class="code-number">255</span>);
</code></td></tr><tr><td id="L2515" class="css-a4x74f"><span>2515</span></td><td id="LC2515" class="css-1dcdqdg"><code>            bytes.push((value &gt;&gt; <span class="code-number">8</span>) &amp; <span class="code-number">255</span>);
</code></td></tr><tr><td id="L2516" class="css-a4x74f"><span>2516</span></td><td id="LC2516" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2517" class="css-a4x74f"><span>2517</span></td><td id="LC2517" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">uint16$1</span>(<span class="code-params">bytes, value</span>) </span>{
</code></td></tr><tr><td id="L2518" class="css-a4x74f"><span>2518</span></td><td id="LC2518" class="css-1dcdqdg"><code>            bytes.push(value &amp; <span class="code-number">255</span>);
</code></td></tr><tr><td id="L2519" class="css-a4x74f"><span>2519</span></td><td id="LC2519" class="css-1dcdqdg"><code>            bytes.push((value &gt;&gt; <span class="code-number">8</span>) &amp; <span class="code-number">255</span>);
</code></td></tr><tr><td id="L2520" class="css-a4x74f"><span>2520</span></td><td id="LC2520" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2521" class="css-a4x74f"><span>2521</span></td><td id="LC2521" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">int32$1</span>(<span class="code-params">bytes, value</span>) </span>{
</code></td></tr><tr><td id="L2522" class="css-a4x74f"><span>2522</span></td><td id="LC2522" class="css-1dcdqdg"><code>            bytes.push(value &amp; <span class="code-number">255</span>);
</code></td></tr><tr><td id="L2523" class="css-a4x74f"><span>2523</span></td><td id="LC2523" class="css-1dcdqdg"><code>            bytes.push((value &gt;&gt; <span class="code-number">8</span>) &amp; <span class="code-number">255</span>);
</code></td></tr><tr><td id="L2524" class="css-a4x74f"><span>2524</span></td><td id="LC2524" class="css-1dcdqdg"><code>            bytes.push((value &gt;&gt; <span class="code-number">16</span>) &amp; <span class="code-number">255</span>);
</code></td></tr><tr><td id="L2525" class="css-a4x74f"><span>2525</span></td><td id="LC2525" class="css-1dcdqdg"><code>            bytes.push((value &gt;&gt; <span class="code-number">24</span>) &amp; <span class="code-number">255</span>);
</code></td></tr><tr><td id="L2526" class="css-a4x74f"><span>2526</span></td><td id="LC2526" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2527" class="css-a4x74f"><span>2527</span></td><td id="LC2527" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">uint32$1</span>(<span class="code-params">bytes, value</span>) </span>{
</code></td></tr><tr><td id="L2528" class="css-a4x74f"><span>2528</span></td><td id="LC2528" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> b4 = value &gt;&gt; <span class="code-number">24</span>;
</code></td></tr><tr><td id="L2529" class="css-a4x74f"><span>2529</span></td><td id="LC2529" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> b3 = value &gt;&gt; <span class="code-number">16</span>;
</code></td></tr><tr><td id="L2530" class="css-a4x74f"><span>2530</span></td><td id="LC2530" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> b2 = value &gt;&gt; <span class="code-number">8</span>;
</code></td></tr><tr><td id="L2531" class="css-a4x74f"><span>2531</span></td><td id="LC2531" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> b1 = value;
</code></td></tr><tr><td id="L2532" class="css-a4x74f"><span>2532</span></td><td id="LC2532" class="css-1dcdqdg"><code>            bytes.push(b1 &amp; <span class="code-number">255</span>);
</code></td></tr><tr><td id="L2533" class="css-a4x74f"><span>2533</span></td><td id="LC2533" class="css-1dcdqdg"><code>            bytes.push(b2 &amp; <span class="code-number">255</span>);
</code></td></tr><tr><td id="L2534" class="css-a4x74f"><span>2534</span></td><td id="LC2534" class="css-1dcdqdg"><code>            bytes.push(b3 &amp; <span class="code-number">255</span>);
</code></td></tr><tr><td id="L2535" class="css-a4x74f"><span>2535</span></td><td id="LC2535" class="css-1dcdqdg"><code>            bytes.push(b4 &amp; <span class="code-number">255</span>);
</code></td></tr><tr><td id="L2536" class="css-a4x74f"><span>2536</span></td><td id="LC2536" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2537" class="css-a4x74f"><span>2537</span></td><td id="LC2537" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">int64$1</span>(<span class="code-params">bytes, value</span>) </span>{
</code></td></tr><tr><td id="L2538" class="css-a4x74f"><span>2538</span></td><td id="LC2538" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> high = <span class="code-built_in">Math</span>.floor(value / <span class="code-built_in">Math</span>.pow(<span class="code-number">2</span>, <span class="code-number">32</span>));
</code></td></tr><tr><td id="L2539" class="css-a4x74f"><span>2539</span></td><td id="LC2539" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> low = value &gt;&gt;&gt; <span class="code-number">0</span>;
</code></td></tr><tr><td id="L2540" class="css-a4x74f"><span>2540</span></td><td id="LC2540" class="css-1dcdqdg"><code>            uint32$<span class="code-number">1</span>(bytes, low);
</code></td></tr><tr><td id="L2541" class="css-a4x74f"><span>2541</span></td><td id="LC2541" class="css-1dcdqdg"><code>            uint32$<span class="code-number">1</span>(bytes, high);
</code></td></tr><tr><td id="L2542" class="css-a4x74f"><span>2542</span></td><td id="LC2542" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2543" class="css-a4x74f"><span>2543</span></td><td id="LC2543" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">uint64$1</span>(<span class="code-params">bytes, value</span>) </span>{
</code></td></tr><tr><td id="L2544" class="css-a4x74f"><span>2544</span></td><td id="LC2544" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> high = (value / <span class="code-built_in">Math</span>.pow(<span class="code-number">2</span>, <span class="code-number">32</span>)) &gt;&gt; <span class="code-number">0</span>;
</code></td></tr><tr><td id="L2545" class="css-a4x74f"><span>2545</span></td><td id="LC2545" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> low = value &gt;&gt;&gt; <span class="code-number">0</span>;
</code></td></tr><tr><td id="L2546" class="css-a4x74f"><span>2546</span></td><td id="LC2546" class="css-1dcdqdg"><code>            uint32$<span class="code-number">1</span>(bytes, low);
</code></td></tr><tr><td id="L2547" class="css-a4x74f"><span>2547</span></td><td id="LC2547" class="css-1dcdqdg"><code>            uint32$<span class="code-number">1</span>(bytes, high);
</code></td></tr><tr><td id="L2548" class="css-a4x74f"><span>2548</span></td><td id="LC2548" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2549" class="css-a4x74f"><span>2549</span></td><td id="LC2549" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">float32$1</span>(<span class="code-params">bytes, value</span>) </span>{
</code></td></tr><tr><td id="L2550" class="css-a4x74f"><span>2550</span></td><td id="LC2550" class="css-1dcdqdg"><code>            writeFloat32(bytes, value);
</code></td></tr><tr><td id="L2551" class="css-a4x74f"><span>2551</span></td><td id="LC2551" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2552" class="css-a4x74f"><span>2552</span></td><td id="LC2552" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">float64$1</span>(<span class="code-params">bytes, value</span>) </span>{
</code></td></tr><tr><td id="L2553" class="css-a4x74f"><span>2553</span></td><td id="LC2553" class="css-1dcdqdg"><code>            writeFloat64(bytes, value);
</code></td></tr><tr><td id="L2554" class="css-a4x74f"><span>2554</span></td><td id="LC2554" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2555" class="css-a4x74f"><span>2555</span></td><td id="LC2555" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> _int32$<span class="code-number">1</span> = <span class="code-keyword">new</span> <span class="code-built_in">Int32Array</span>(<span class="code-number">2</span>);
</code></td></tr><tr><td id="L2556" class="css-a4x74f"><span>2556</span></td><td id="LC2556" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> _float32$<span class="code-number">1</span> = <span class="code-keyword">new</span> <span class="code-built_in">Float32Array</span>(_int32$<span class="code-number">1.</span>buffer);
</code></td></tr><tr><td id="L2557" class="css-a4x74f"><span>2557</span></td><td id="LC2557" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> _float64$<span class="code-number">1</span> = <span class="code-keyword">new</span> <span class="code-built_in">Float64Array</span>(_int32$<span class="code-number">1.</span>buffer);
</code></td></tr><tr><td id="L2558" class="css-a4x74f"><span>2558</span></td><td id="LC2558" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">writeFloat32</span>(<span class="code-params">bytes, value</span>) </span>{
</code></td></tr><tr><td id="L2559" class="css-a4x74f"><span>2559</span></td><td id="LC2559" class="css-1dcdqdg"><code>            _float32$<span class="code-number">1</span>[<span class="code-number">0</span>] = value;
</code></td></tr><tr><td id="L2560" class="css-a4x74f"><span>2560</span></td><td id="LC2560" class="css-1dcdqdg"><code>            int32$<span class="code-number">1</span>(bytes, _int32$<span class="code-number">1</span>[<span class="code-number">0</span>]);
</code></td></tr><tr><td id="L2561" class="css-a4x74f"><span>2561</span></td><td id="LC2561" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2562" class="css-a4x74f"><span>2562</span></td><td id="LC2562" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">writeFloat64</span>(<span class="code-params">bytes, value</span>) </span>{
</code></td></tr><tr><td id="L2563" class="css-a4x74f"><span>2563</span></td><td id="LC2563" class="css-1dcdqdg"><code>            _float64$<span class="code-number">1</span>[<span class="code-number">0</span>] = value;
</code></td></tr><tr><td id="L2564" class="css-a4x74f"><span>2564</span></td><td id="LC2564" class="css-1dcdqdg"><code>            int32$<span class="code-number">1</span>(bytes, _int32$<span class="code-number">1</span>[<span class="code-number">0</span> ]);
</code></td></tr><tr><td id="L2565" class="css-a4x74f"><span>2565</span></td><td id="LC2565" class="css-1dcdqdg"><code>            int32$<span class="code-number">1</span>(bytes, _int32$<span class="code-number">1</span>[<span class="code-number">1</span> ]);
</code></td></tr><tr><td id="L2566" class="css-a4x74f"><span>2566</span></td><td id="LC2566" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2567" class="css-a4x74f"><span>2567</span></td><td id="LC2567" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">boolean$1</span>(<span class="code-params">bytes, value</span>) </span>{
</code></td></tr><tr><td id="L2568" class="css-a4x74f"><span>2568</span></td><td id="LC2568" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> uint8$<span class="code-number">1</span>(bytes, value ? <span class="code-number">1</span> : <span class="code-number">0</span>);
</code></td></tr><tr><td id="L2569" class="css-a4x74f"><span>2569</span></td><td id="LC2569" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2570" class="css-a4x74f"><span>2570</span></td><td id="LC2570" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">string$1</span>(<span class="code-params">bytes, value</span>) </span>{
</code></td></tr><tr><td id="L2571" class="css-a4x74f"><span>2571</span></td><td id="LC2571" class="css-1dcdqdg"><code>            <span class="code-comment">// encode `null` strings as empty.</span>
</code></td></tr><tr><td id="L2572" class="css-a4x74f"><span>2572</span></td><td id="LC2572" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (!value) {
</code></td></tr><tr><td id="L2573" class="css-a4x74f"><span>2573</span></td><td id="LC2573" class="css-1dcdqdg"><code>                value = <span class="code-string">""</span>;
</code></td></tr><tr><td id="L2574" class="css-a4x74f"><span>2574</span></td><td id="LC2574" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2575" class="css-a4x74f"><span>2575</span></td><td id="LC2575" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> length = utf8Length(value);
</code></td></tr><tr><td id="L2576" class="css-a4x74f"><span>2576</span></td><td id="LC2576" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> size = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L2577" class="css-a4x74f"><span>2577</span></td><td id="LC2577" class="css-1dcdqdg"><code>            <span class="code-comment">// fixstr</span>
</code></td></tr><tr><td id="L2578" class="css-a4x74f"><span>2578</span></td><td id="LC2578" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (length &lt; <span class="code-number">0x20</span>) {
</code></td></tr><tr><td id="L2579" class="css-a4x74f"><span>2579</span></td><td id="LC2579" class="css-1dcdqdg"><code>                bytes.push(length | <span class="code-number">0xa0</span>);
</code></td></tr><tr><td id="L2580" class="css-a4x74f"><span>2580</span></td><td id="LC2580" class="css-1dcdqdg"><code>                size = <span class="code-number">1</span>;
</code></td></tr><tr><td id="L2581" class="css-a4x74f"><span>2581</span></td><td id="LC2581" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2582" class="css-a4x74f"><span>2582</span></td><td id="LC2582" class="css-1dcdqdg"><code>            <span class="code-comment">// str 8</span>
</code></td></tr><tr><td id="L2583" class="css-a4x74f"><span>2583</span></td><td id="LC2583" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (length &lt; <span class="code-number">0x100</span>) {
</code></td></tr><tr><td id="L2584" class="css-a4x74f"><span>2584</span></td><td id="LC2584" class="css-1dcdqdg"><code>                bytes.push(<span class="code-number">0xd9</span>);
</code></td></tr><tr><td id="L2585" class="css-a4x74f"><span>2585</span></td><td id="LC2585" class="css-1dcdqdg"><code>                uint8$<span class="code-number">1</span>(bytes, length);
</code></td></tr><tr><td id="L2586" class="css-a4x74f"><span>2586</span></td><td id="LC2586" class="css-1dcdqdg"><code>                size = <span class="code-number">2</span>;
</code></td></tr><tr><td id="L2587" class="css-a4x74f"><span>2587</span></td><td id="LC2587" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2588" class="css-a4x74f"><span>2588</span></td><td id="LC2588" class="css-1dcdqdg"><code>            <span class="code-comment">// str 16</span>
</code></td></tr><tr><td id="L2589" class="css-a4x74f"><span>2589</span></td><td id="LC2589" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (length &lt; <span class="code-number">0x10000</span>) {
</code></td></tr><tr><td id="L2590" class="css-a4x74f"><span>2590</span></td><td id="LC2590" class="css-1dcdqdg"><code>                bytes.push(<span class="code-number">0xda</span>);
</code></td></tr><tr><td id="L2591" class="css-a4x74f"><span>2591</span></td><td id="LC2591" class="css-1dcdqdg"><code>                uint16$<span class="code-number">1</span>(bytes, length);
</code></td></tr><tr><td id="L2592" class="css-a4x74f"><span>2592</span></td><td id="LC2592" class="css-1dcdqdg"><code>                size = <span class="code-number">3</span>;
</code></td></tr><tr><td id="L2593" class="css-a4x74f"><span>2593</span></td><td id="LC2593" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2594" class="css-a4x74f"><span>2594</span></td><td id="LC2594" class="css-1dcdqdg"><code>            <span class="code-comment">// str 32</span>
</code></td></tr><tr><td id="L2595" class="css-a4x74f"><span>2595</span></td><td id="LC2595" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (length &lt; <span class="code-number">0x100000000</span>) {
</code></td></tr><tr><td id="L2596" class="css-a4x74f"><span>2596</span></td><td id="LC2596" class="css-1dcdqdg"><code>                bytes.push(<span class="code-number">0xdb</span>);
</code></td></tr><tr><td id="L2597" class="css-a4x74f"><span>2597</span></td><td id="LC2597" class="css-1dcdqdg"><code>                uint32$<span class="code-number">1</span>(bytes, length);
</code></td></tr><tr><td id="L2598" class="css-a4x74f"><span>2598</span></td><td id="LC2598" class="css-1dcdqdg"><code>                size = <span class="code-number">5</span>;
</code></td></tr><tr><td id="L2599" class="css-a4x74f"><span>2599</span></td><td id="LC2599" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2600" class="css-a4x74f"><span>2600</span></td><td id="LC2600" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L2601" class="css-a4x74f"><span>2601</span></td><td id="LC2601" class="css-1dcdqdg"><code>                <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">'String too long'</span>);
</code></td></tr><tr><td id="L2602" class="css-a4x74f"><span>2602</span></td><td id="LC2602" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2603" class="css-a4x74f"><span>2603</span></td><td id="LC2603" class="css-1dcdqdg"><code>            utf8Write(bytes, bytes.length, value);
</code></td></tr><tr><td id="L2604" class="css-a4x74f"><span>2604</span></td><td id="LC2604" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> size + length;
</code></td></tr><tr><td id="L2605" class="css-a4x74f"><span>2605</span></td><td id="LC2605" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2606" class="css-a4x74f"><span>2606</span></td><td id="LC2606" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">number$1</span>(<span class="code-params">bytes, value</span>) </span>{
</code></td></tr><tr><td id="L2607" class="css-a4x74f"><span>2607</span></td><td id="LC2607" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (<span class="code-built_in">isNaN</span>(value)) {
</code></td></tr><tr><td id="L2608" class="css-a4x74f"><span>2608</span></td><td id="LC2608" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> number$<span class="code-number">1</span>(bytes, <span class="code-number">0</span>);
</code></td></tr><tr><td id="L2609" class="css-a4x74f"><span>2609</span></td><td id="LC2609" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2610" class="css-a4x74f"><span>2610</span></td><td id="LC2610" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (!<span class="code-built_in">isFinite</span>(value)) {
</code></td></tr><tr><td id="L2611" class="css-a4x74f"><span>2611</span></td><td id="LC2611" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> number$<span class="code-number">1</span>(bytes, (value &gt; <span class="code-number">0</span>) ? <span class="code-built_in">Number</span>.MAX_SAFE_INTEGER : -<span class="code-built_in">Number</span>.MAX_SAFE_INTEGER);
</code></td></tr><tr><td id="L2612" class="css-a4x74f"><span>2612</span></td><td id="LC2612" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2613" class="css-a4x74f"><span>2613</span></td><td id="LC2613" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (value !== (value | <span class="code-number">0</span>)) {
</code></td></tr><tr><td id="L2614" class="css-a4x74f"><span>2614</span></td><td id="LC2614" class="css-1dcdqdg"><code>                bytes.push(<span class="code-number">0xcb</span>);
</code></td></tr><tr><td id="L2615" class="css-a4x74f"><span>2615</span></td><td id="LC2615" class="css-1dcdqdg"><code>                writeFloat64(bytes, value);
</code></td></tr><tr><td id="L2616" class="css-a4x74f"><span>2616</span></td><td id="LC2616" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-number">9</span>;
</code></td></tr><tr><td id="L2617" class="css-a4x74f"><span>2617</span></td><td id="LC2617" class="css-1dcdqdg"><code>                <span class="code-comment">// <span class="code-doctag">TODO:</span> encode float 32?</span>
</code></td></tr><tr><td id="L2618" class="css-a4x74f"><span>2618</span></td><td id="LC2618" class="css-1dcdqdg"><code>                <span class="code-comment">// is it possible to differentiate between float32 / float64 here?</span>
</code></td></tr><tr><td id="L2619" class="css-a4x74f"><span>2619</span></td><td id="LC2619" class="css-1dcdqdg"><code>                <span class="code-comment">// // float 32</span>
</code></td></tr><tr><td id="L2620" class="css-a4x74f"><span>2620</span></td><td id="LC2620" class="css-1dcdqdg"><code>                <span class="code-comment">// bytes.push(0xca);</span>
</code></td></tr><tr><td id="L2621" class="css-a4x74f"><span>2621</span></td><td id="LC2621" class="css-1dcdqdg"><code>                <span class="code-comment">// writeFloat32(bytes, value);</span>
</code></td></tr><tr><td id="L2622" class="css-a4x74f"><span>2622</span></td><td id="LC2622" class="css-1dcdqdg"><code>                <span class="code-comment">// return 5;</span>
</code></td></tr><tr><td id="L2623" class="css-a4x74f"><span>2623</span></td><td id="LC2623" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2624" class="css-a4x74f"><span>2624</span></td><td id="LC2624" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (value &gt;= <span class="code-number">0</span>) {
</code></td></tr><tr><td id="L2625" class="css-a4x74f"><span>2625</span></td><td id="LC2625" class="css-1dcdqdg"><code>                <span class="code-comment">// positive fixnum</span>
</code></td></tr><tr><td id="L2626" class="css-a4x74f"><span>2626</span></td><td id="LC2626" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (value &lt; <span class="code-number">0x80</span>) {
</code></td></tr><tr><td id="L2627" class="css-a4x74f"><span>2627</span></td><td id="LC2627" class="css-1dcdqdg"><code>                    uint8$<span class="code-number">1</span>(bytes, value);
</code></td></tr><tr><td id="L2628" class="css-a4x74f"><span>2628</span></td><td id="LC2628" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-number">1</span>;
</code></td></tr><tr><td id="L2629" class="css-a4x74f"><span>2629</span></td><td id="LC2629" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2630" class="css-a4x74f"><span>2630</span></td><td id="LC2630" class="css-1dcdqdg"><code>                <span class="code-comment">// uint 8</span>
</code></td></tr><tr><td id="L2631" class="css-a4x74f"><span>2631</span></td><td id="LC2631" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (value &lt; <span class="code-number">0x100</span>) {
</code></td></tr><tr><td id="L2632" class="css-a4x74f"><span>2632</span></td><td id="LC2632" class="css-1dcdqdg"><code>                    bytes.push(<span class="code-number">0xcc</span>);
</code></td></tr><tr><td id="L2633" class="css-a4x74f"><span>2633</span></td><td id="LC2633" class="css-1dcdqdg"><code>                    uint8$<span class="code-number">1</span>(bytes, value);
</code></td></tr><tr><td id="L2634" class="css-a4x74f"><span>2634</span></td><td id="LC2634" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-number">2</span>;
</code></td></tr><tr><td id="L2635" class="css-a4x74f"><span>2635</span></td><td id="LC2635" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2636" class="css-a4x74f"><span>2636</span></td><td id="LC2636" class="css-1dcdqdg"><code>                <span class="code-comment">// uint 16</span>
</code></td></tr><tr><td id="L2637" class="css-a4x74f"><span>2637</span></td><td id="LC2637" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (value &lt; <span class="code-number">0x10000</span>) {
</code></td></tr><tr><td id="L2638" class="css-a4x74f"><span>2638</span></td><td id="LC2638" class="css-1dcdqdg"><code>                    bytes.push(<span class="code-number">0xcd</span>);
</code></td></tr><tr><td id="L2639" class="css-a4x74f"><span>2639</span></td><td id="LC2639" class="css-1dcdqdg"><code>                    uint16$<span class="code-number">1</span>(bytes, value);
</code></td></tr><tr><td id="L2640" class="css-a4x74f"><span>2640</span></td><td id="LC2640" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-number">3</span>;
</code></td></tr><tr><td id="L2641" class="css-a4x74f"><span>2641</span></td><td id="LC2641" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2642" class="css-a4x74f"><span>2642</span></td><td id="LC2642" class="css-1dcdqdg"><code>                <span class="code-comment">// uint 32</span>
</code></td></tr><tr><td id="L2643" class="css-a4x74f"><span>2643</span></td><td id="LC2643" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (value &lt; <span class="code-number">0x100000000</span>) {
</code></td></tr><tr><td id="L2644" class="css-a4x74f"><span>2644</span></td><td id="LC2644" class="css-1dcdqdg"><code>                    bytes.push(<span class="code-number">0xce</span>);
</code></td></tr><tr><td id="L2645" class="css-a4x74f"><span>2645</span></td><td id="LC2645" class="css-1dcdqdg"><code>                    uint32$<span class="code-number">1</span>(bytes, value);
</code></td></tr><tr><td id="L2646" class="css-a4x74f"><span>2646</span></td><td id="LC2646" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-number">5</span>;
</code></td></tr><tr><td id="L2647" class="css-a4x74f"><span>2647</span></td><td id="LC2647" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2648" class="css-a4x74f"><span>2648</span></td><td id="LC2648" class="css-1dcdqdg"><code>                <span class="code-comment">// uint 64</span>
</code></td></tr><tr><td id="L2649" class="css-a4x74f"><span>2649</span></td><td id="LC2649" class="css-1dcdqdg"><code>                bytes.push(<span class="code-number">0xcf</span>);
</code></td></tr><tr><td id="L2650" class="css-a4x74f"><span>2650</span></td><td id="LC2650" class="css-1dcdqdg"><code>                uint64$<span class="code-number">1</span>(bytes, value);
</code></td></tr><tr><td id="L2651" class="css-a4x74f"><span>2651</span></td><td id="LC2651" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-number">9</span>;
</code></td></tr><tr><td id="L2652" class="css-a4x74f"><span>2652</span></td><td id="LC2652" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2653" class="css-a4x74f"><span>2653</span></td><td id="LC2653" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L2654" class="css-a4x74f"><span>2654</span></td><td id="LC2654" class="css-1dcdqdg"><code>                <span class="code-comment">// negative fixnum</span>
</code></td></tr><tr><td id="L2655" class="css-a4x74f"><span>2655</span></td><td id="LC2655" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (value &gt;= <span class="code-number">-0x20</span>) {
</code></td></tr><tr><td id="L2656" class="css-a4x74f"><span>2656</span></td><td id="LC2656" class="css-1dcdqdg"><code>                    bytes.push(<span class="code-number">0xe0</span> | (value + <span class="code-number">0x20</span>));
</code></td></tr><tr><td id="L2657" class="css-a4x74f"><span>2657</span></td><td id="LC2657" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-number">1</span>;
</code></td></tr><tr><td id="L2658" class="css-a4x74f"><span>2658</span></td><td id="LC2658" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2659" class="css-a4x74f"><span>2659</span></td><td id="LC2659" class="css-1dcdqdg"><code>                <span class="code-comment">// int 8</span>
</code></td></tr><tr><td id="L2660" class="css-a4x74f"><span>2660</span></td><td id="LC2660" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (value &gt;= <span class="code-number">-0x80</span>) {
</code></td></tr><tr><td id="L2661" class="css-a4x74f"><span>2661</span></td><td id="LC2661" class="css-1dcdqdg"><code>                    bytes.push(<span class="code-number">0xd0</span>);
</code></td></tr><tr><td id="L2662" class="css-a4x74f"><span>2662</span></td><td id="LC2662" class="css-1dcdqdg"><code>                    int8$<span class="code-number">1</span>(bytes, value);
</code></td></tr><tr><td id="L2663" class="css-a4x74f"><span>2663</span></td><td id="LC2663" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-number">2</span>;
</code></td></tr><tr><td id="L2664" class="css-a4x74f"><span>2664</span></td><td id="LC2664" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2665" class="css-a4x74f"><span>2665</span></td><td id="LC2665" class="css-1dcdqdg"><code>                <span class="code-comment">// int 16</span>
</code></td></tr><tr><td id="L2666" class="css-a4x74f"><span>2666</span></td><td id="LC2666" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (value &gt;= <span class="code-number">-0x8000</span>) {
</code></td></tr><tr><td id="L2667" class="css-a4x74f"><span>2667</span></td><td id="LC2667" class="css-1dcdqdg"><code>                    bytes.push(<span class="code-number">0xd1</span>);
</code></td></tr><tr><td id="L2668" class="css-a4x74f"><span>2668</span></td><td id="LC2668" class="css-1dcdqdg"><code>                    int16$<span class="code-number">1</span>(bytes, value);
</code></td></tr><tr><td id="L2669" class="css-a4x74f"><span>2669</span></td><td id="LC2669" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-number">3</span>;
</code></td></tr><tr><td id="L2670" class="css-a4x74f"><span>2670</span></td><td id="LC2670" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2671" class="css-a4x74f"><span>2671</span></td><td id="LC2671" class="css-1dcdqdg"><code>                <span class="code-comment">// int 32</span>
</code></td></tr><tr><td id="L2672" class="css-a4x74f"><span>2672</span></td><td id="LC2672" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (value &gt;= <span class="code-number">-0x80000000</span>) {
</code></td></tr><tr><td id="L2673" class="css-a4x74f"><span>2673</span></td><td id="LC2673" class="css-1dcdqdg"><code>                    bytes.push(<span class="code-number">0xd2</span>);
</code></td></tr><tr><td id="L2674" class="css-a4x74f"><span>2674</span></td><td id="LC2674" class="css-1dcdqdg"><code>                    int32$<span class="code-number">1</span>(bytes, value);
</code></td></tr><tr><td id="L2675" class="css-a4x74f"><span>2675</span></td><td id="LC2675" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-number">5</span>;
</code></td></tr><tr><td id="L2676" class="css-a4x74f"><span>2676</span></td><td id="LC2676" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2677" class="css-a4x74f"><span>2677</span></td><td id="LC2677" class="css-1dcdqdg"><code>                <span class="code-comment">// int 64</span>
</code></td></tr><tr><td id="L2678" class="css-a4x74f"><span>2678</span></td><td id="LC2678" class="css-1dcdqdg"><code>                bytes.push(<span class="code-number">0xd3</span>);
</code></td></tr><tr><td id="L2679" class="css-a4x74f"><span>2679</span></td><td id="LC2679" class="css-1dcdqdg"><code>                int64$<span class="code-number">1</span>(bytes, value);
</code></td></tr><tr><td id="L2680" class="css-a4x74f"><span>2680</span></td><td id="LC2680" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-number">9</span>;
</code></td></tr><tr><td id="L2681" class="css-a4x74f"><span>2681</span></td><td id="LC2681" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2682" class="css-a4x74f"><span>2682</span></td><td id="LC2682" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2683" class="css-a4x74f"><span>2683</span></td><td id="LC2683" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L2684" class="css-a4x74f"><span>2684</span></td><td id="LC2684" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> encode = <span class="code-comment">/*#__PURE__*/</span><span class="code-built_in">Object</span>.freeze({
</code></td></tr><tr><td id="L2685" class="css-a4x74f"><span>2685</span></td><td id="LC2685" class="css-1dcdqdg"><code>            __proto__: <span class="code-literal">null</span>,
</code></td></tr><tr><td id="L2686" class="css-a4x74f"><span>2686</span></td><td id="LC2686" class="css-1dcdqdg"><code>            utf8Write: utf8Write,
</code></td></tr><tr><td id="L2687" class="css-a4x74f"><span>2687</span></td><td id="LC2687" class="css-1dcdqdg"><code>            int8: int8$<span class="code-number">1</span>,
</code></td></tr><tr><td id="L2688" class="css-a4x74f"><span>2688</span></td><td id="LC2688" class="css-1dcdqdg"><code>            uint8: uint8$<span class="code-number">1</span>,
</code></td></tr><tr><td id="L2689" class="css-a4x74f"><span>2689</span></td><td id="LC2689" class="css-1dcdqdg"><code>            int16: int16$<span class="code-number">1</span>,
</code></td></tr><tr><td id="L2690" class="css-a4x74f"><span>2690</span></td><td id="LC2690" class="css-1dcdqdg"><code>            uint16: uint16$<span class="code-number">1</span>,
</code></td></tr><tr><td id="L2691" class="css-a4x74f"><span>2691</span></td><td id="LC2691" class="css-1dcdqdg"><code>            int32: int32$<span class="code-number">1</span>,
</code></td></tr><tr><td id="L2692" class="css-a4x74f"><span>2692</span></td><td id="LC2692" class="css-1dcdqdg"><code>            uint32: uint32$<span class="code-number">1</span>,
</code></td></tr><tr><td id="L2693" class="css-a4x74f"><span>2693</span></td><td id="LC2693" class="css-1dcdqdg"><code>            int64: int64$<span class="code-number">1</span>,
</code></td></tr><tr><td id="L2694" class="css-a4x74f"><span>2694</span></td><td id="LC2694" class="css-1dcdqdg"><code>            uint64: uint64$<span class="code-number">1</span>,
</code></td></tr><tr><td id="L2695" class="css-a4x74f"><span>2695</span></td><td id="LC2695" class="css-1dcdqdg"><code>            float32: float32$<span class="code-number">1</span>,
</code></td></tr><tr><td id="L2696" class="css-a4x74f"><span>2696</span></td><td id="LC2696" class="css-1dcdqdg"><code>            float64: float64$<span class="code-number">1</span>,
</code></td></tr><tr><td id="L2697" class="css-a4x74f"><span>2697</span></td><td id="LC2697" class="css-1dcdqdg"><code>            writeFloat32: writeFloat32,
</code></td></tr><tr><td id="L2698" class="css-a4x74f"><span>2698</span></td><td id="LC2698" class="css-1dcdqdg"><code>            writeFloat64: writeFloat64,
</code></td></tr><tr><td id="L2699" class="css-a4x74f"><span>2699</span></td><td id="LC2699" class="css-1dcdqdg"><code>            boolean: boolean$<span class="code-number">1</span>,
</code></td></tr><tr><td id="L2700" class="css-a4x74f"><span>2700</span></td><td id="LC2700" class="css-1dcdqdg"><code>            string: string$<span class="code-number">1</span>,
</code></td></tr><tr><td id="L2701" class="css-a4x74f"><span>2701</span></td><td id="LC2701" class="css-1dcdqdg"><code>            number: number$<span class="code-number">1</span>
</code></td></tr><tr><td id="L2702" class="css-a4x74f"><span>2702</span></td><td id="LC2702" class="css-1dcdqdg"><code>        });
</code></td></tr><tr><td id="L2703" class="css-a4x74f"><span>2703</span></td><td id="LC2703" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L2704" class="css-a4x74f"><span>2704</span></td><td id="LC2704" class="css-1dcdqdg"><code>        <span class="code-comment">/**
</span></code></td></tr><tr><td id="L2705" class="css-a4x74f"><span>2705</span></td><td id="LC2705" class="css-1dcdqdg"><code><span class="code-comment">         * Copyright (c) 2018 Endel Dreyer
</span></code></td></tr><tr><td id="L2706" class="css-a4x74f"><span>2706</span></td><td id="LC2706" class="css-1dcdqdg"><code><span class="code-comment">         * Copyright (c) 2014 Ion Drive Software Ltd.
</span></code></td></tr><tr><td id="L2707" class="css-a4x74f"><span>2707</span></td><td id="LC2707" class="css-1dcdqdg"><code><span class="code-comment">         *
</span></code></td></tr><tr><td id="L2708" class="css-a4x74f"><span>2708</span></td><td id="LC2708" class="css-1dcdqdg"><code><span class="code-comment">         * Permission is hereby granted, free of charge, to any person obtaining a copy
</span></code></td></tr><tr><td id="L2709" class="css-a4x74f"><span>2709</span></td><td id="LC2709" class="css-1dcdqdg"><code><span class="code-comment">         * of this software and associated documentation files (the "Software"), to deal
</span></code></td></tr><tr><td id="L2710" class="css-a4x74f"><span>2710</span></td><td id="LC2710" class="css-1dcdqdg"><code><span class="code-comment">         * in the Software without restriction, including without limitation the rights
</span></code></td></tr><tr><td id="L2711" class="css-a4x74f"><span>2711</span></td><td id="LC2711" class="css-1dcdqdg"><code><span class="code-comment">         * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
</span></code></td></tr><tr><td id="L2712" class="css-a4x74f"><span>2712</span></td><td id="LC2712" class="css-1dcdqdg"><code><span class="code-comment">         * copies of the Software, and to permit persons to whom the Software is
</span></code></td></tr><tr><td id="L2713" class="css-a4x74f"><span>2713</span></td><td id="LC2713" class="css-1dcdqdg"><code><span class="code-comment">         * furnished to do so, subject to the following conditions:
</span></code></td></tr><tr><td id="L2714" class="css-a4x74f"><span>2714</span></td><td id="LC2714" class="css-1dcdqdg"><code><span class="code-comment">         *
</span></code></td></tr><tr><td id="L2715" class="css-a4x74f"><span>2715</span></td><td id="LC2715" class="css-1dcdqdg"><code><span class="code-comment">         * The above copyright notice and this permission notice shall be included in all
</span></code></td></tr><tr><td id="L2716" class="css-a4x74f"><span>2716</span></td><td id="LC2716" class="css-1dcdqdg"><code><span class="code-comment">         * copies or substantial portions of the Software.
</span></code></td></tr><tr><td id="L2717" class="css-a4x74f"><span>2717</span></td><td id="LC2717" class="css-1dcdqdg"><code><span class="code-comment">         *
</span></code></td></tr><tr><td id="L2718" class="css-a4x74f"><span>2718</span></td><td id="LC2718" class="css-1dcdqdg"><code><span class="code-comment">         * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
</span></code></td></tr><tr><td id="L2719" class="css-a4x74f"><span>2719</span></td><td id="LC2719" class="css-1dcdqdg"><code><span class="code-comment">         * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
</span></code></td></tr><tr><td id="L2720" class="css-a4x74f"><span>2720</span></td><td id="LC2720" class="css-1dcdqdg"><code><span class="code-comment">         * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
</span></code></td></tr><tr><td id="L2721" class="css-a4x74f"><span>2721</span></td><td id="LC2721" class="css-1dcdqdg"><code><span class="code-comment">         * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
</span></code></td></tr><tr><td id="L2722" class="css-a4x74f"><span>2722</span></td><td id="LC2722" class="css-1dcdqdg"><code><span class="code-comment">         * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
</span></code></td></tr><tr><td id="L2723" class="css-a4x74f"><span>2723</span></td><td id="LC2723" class="css-1dcdqdg"><code><span class="code-comment">         * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
</span></code></td></tr><tr><td id="L2724" class="css-a4x74f"><span>2724</span></td><td id="LC2724" class="css-1dcdqdg"><code><span class="code-comment">         * SOFTWARE
</span></code></td></tr><tr><td id="L2725" class="css-a4x74f"><span>2725</span></td><td id="LC2725" class="css-1dcdqdg"><code><span class="code-comment">         */</span>
</code></td></tr><tr><td id="L2726" class="css-a4x74f"><span>2726</span></td><td id="LC2726" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">utf8Read</span>(<span class="code-params">bytes, offset, length</span>) </span>{
</code></td></tr><tr><td id="L2727" class="css-a4x74f"><span>2727</span></td><td id="LC2727" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> string = <span class="code-string">''</span>, chr = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L2728" class="css-a4x74f"><span>2728</span></td><td id="LC2728" class="css-1dcdqdg"><code>            <span class="code-keyword">for</span> (<span class="code-keyword">var</span> i = offset, end = offset + length; i &lt; end; i++) {
</code></td></tr><tr><td id="L2729" class="css-a4x74f"><span>2729</span></td><td id="LC2729" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> byte = bytes[i];
</code></td></tr><tr><td id="L2730" class="css-a4x74f"><span>2730</span></td><td id="LC2730" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> ((byte &amp; <span class="code-number">0x80</span>) === <span class="code-number">0x00</span>) {
</code></td></tr><tr><td id="L2731" class="css-a4x74f"><span>2731</span></td><td id="LC2731" class="css-1dcdqdg"><code>                    string += <span class="code-built_in">String</span>.fromCharCode(byte);
</code></td></tr><tr><td id="L2732" class="css-a4x74f"><span>2732</span></td><td id="LC2732" class="css-1dcdqdg"><code>                    <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L2733" class="css-a4x74f"><span>2733</span></td><td id="LC2733" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2734" class="css-a4x74f"><span>2734</span></td><td id="LC2734" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> ((byte &amp; <span class="code-number">0xe0</span>) === <span class="code-number">0xc0</span>) {
</code></td></tr><tr><td id="L2735" class="css-a4x74f"><span>2735</span></td><td id="LC2735" class="css-1dcdqdg"><code>                    string += <span class="code-built_in">String</span>.fromCharCode(((byte &amp; <span class="code-number">0x1f</span>) &lt;&lt; <span class="code-number">6</span>) |
</code></td></tr><tr><td id="L2736" class="css-a4x74f"><span>2736</span></td><td id="LC2736" class="css-1dcdqdg"><code>                        (bytes[++i] &amp; <span class="code-number">0x3f</span>));
</code></td></tr><tr><td id="L2737" class="css-a4x74f"><span>2737</span></td><td id="LC2737" class="css-1dcdqdg"><code>                    <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L2738" class="css-a4x74f"><span>2738</span></td><td id="LC2738" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2739" class="css-a4x74f"><span>2739</span></td><td id="LC2739" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> ((byte &amp; <span class="code-number">0xf0</span>) === <span class="code-number">0xe0</span>) {
</code></td></tr><tr><td id="L2740" class="css-a4x74f"><span>2740</span></td><td id="LC2740" class="css-1dcdqdg"><code>                    string += <span class="code-built_in">String</span>.fromCharCode(((byte &amp; <span class="code-number">0x0f</span>) &lt;&lt; <span class="code-number">12</span>) |
</code></td></tr><tr><td id="L2741" class="css-a4x74f"><span>2741</span></td><td id="LC2741" class="css-1dcdqdg"><code>                        ((bytes[++i] &amp; <span class="code-number">0x3f</span>) &lt;&lt; <span class="code-number">6</span>) |
</code></td></tr><tr><td id="L2742" class="css-a4x74f"><span>2742</span></td><td id="LC2742" class="css-1dcdqdg"><code>                        ((bytes[++i] &amp; <span class="code-number">0x3f</span>) &lt;&lt; <span class="code-number">0</span>));
</code></td></tr><tr><td id="L2743" class="css-a4x74f"><span>2743</span></td><td id="LC2743" class="css-1dcdqdg"><code>                    <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L2744" class="css-a4x74f"><span>2744</span></td><td id="LC2744" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2745" class="css-a4x74f"><span>2745</span></td><td id="LC2745" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> ((byte &amp; <span class="code-number">0xf8</span>) === <span class="code-number">0xf0</span>) {
</code></td></tr><tr><td id="L2746" class="css-a4x74f"><span>2746</span></td><td id="LC2746" class="css-1dcdqdg"><code>                    chr = ((byte &amp; <span class="code-number">0x07</span>) &lt;&lt; <span class="code-number">18</span>) |
</code></td></tr><tr><td id="L2747" class="css-a4x74f"><span>2747</span></td><td id="LC2747" class="css-1dcdqdg"><code>                        ((bytes[++i] &amp; <span class="code-number">0x3f</span>) &lt;&lt; <span class="code-number">12</span>) |
</code></td></tr><tr><td id="L2748" class="css-a4x74f"><span>2748</span></td><td id="LC2748" class="css-1dcdqdg"><code>                        ((bytes[++i] &amp; <span class="code-number">0x3f</span>) &lt;&lt; <span class="code-number">6</span>) |
</code></td></tr><tr><td id="L2749" class="css-a4x74f"><span>2749</span></td><td id="LC2749" class="css-1dcdqdg"><code>                        ((bytes[++i] &amp; <span class="code-number">0x3f</span>) &lt;&lt; <span class="code-number">0</span>);
</code></td></tr><tr><td id="L2750" class="css-a4x74f"><span>2750</span></td><td id="LC2750" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (chr &gt;= <span class="code-number">0x010000</span>) { <span class="code-comment">// surrogate pair</span>
</code></td></tr><tr><td id="L2751" class="css-a4x74f"><span>2751</span></td><td id="LC2751" class="css-1dcdqdg"><code>                        chr -= <span class="code-number">0x010000</span>;
</code></td></tr><tr><td id="L2752" class="css-a4x74f"><span>2752</span></td><td id="LC2752" class="css-1dcdqdg"><code>                        string += <span class="code-built_in">String</span>.fromCharCode((chr &gt;&gt;&gt; <span class="code-number">10</span>) + <span class="code-number">0xD800</span>, (chr &amp; <span class="code-number">0x3FF</span>) + <span class="code-number">0xDC00</span>);
</code></td></tr><tr><td id="L2753" class="css-a4x74f"><span>2753</span></td><td id="LC2753" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L2754" class="css-a4x74f"><span>2754</span></td><td id="LC2754" class="css-1dcdqdg"><code>                    <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L2755" class="css-a4x74f"><span>2755</span></td><td id="LC2755" class="css-1dcdqdg"><code>                        string += <span class="code-built_in">String</span>.fromCharCode(chr);
</code></td></tr><tr><td id="L2756" class="css-a4x74f"><span>2756</span></td><td id="LC2756" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L2757" class="css-a4x74f"><span>2757</span></td><td id="LC2757" class="css-1dcdqdg"><code>                    <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L2758" class="css-a4x74f"><span>2758</span></td><td id="LC2758" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2759" class="css-a4x74f"><span>2759</span></td><td id="LC2759" class="css-1dcdqdg"><code>                <span class="code-built_in">console</span>.error(<span class="code-string">'Invalid byte '</span> + byte.toString(<span class="code-number">16</span>));
</code></td></tr><tr><td id="L2760" class="css-a4x74f"><span>2760</span></td><td id="LC2760" class="css-1dcdqdg"><code>                <span class="code-comment">// (do not throw error to avoid server/client from crashing due to hack attemps)</span>
</code></td></tr><tr><td id="L2761" class="css-a4x74f"><span>2761</span></td><td id="LC2761" class="css-1dcdqdg"><code>                <span class="code-comment">// throw new Error('Invalid byte ' + byte.toString(16));</span>
</code></td></tr><tr><td id="L2762" class="css-a4x74f"><span>2762</span></td><td id="LC2762" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2763" class="css-a4x74f"><span>2763</span></td><td id="LC2763" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> string;
</code></td></tr><tr><td id="L2764" class="css-a4x74f"><span>2764</span></td><td id="LC2764" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2765" class="css-a4x74f"><span>2765</span></td><td id="LC2765" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">int8</span>(<span class="code-params">bytes, it</span>) </span>{
</code></td></tr><tr><td id="L2766" class="css-a4x74f"><span>2766</span></td><td id="LC2766" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> uint8(bytes, it) &lt;&lt; <span class="code-number">24</span> &gt;&gt; <span class="code-number">24</span>;
</code></td></tr><tr><td id="L2767" class="css-a4x74f"><span>2767</span></td><td id="LC2767" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2768" class="css-a4x74f"><span>2768</span></td><td id="LC2768" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">uint8</span>(<span class="code-params">bytes, it</span>) </span>{
</code></td></tr><tr><td id="L2769" class="css-a4x74f"><span>2769</span></td><td id="LC2769" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> bytes[it.offset++];
</code></td></tr><tr><td id="L2770" class="css-a4x74f"><span>2770</span></td><td id="LC2770" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2771" class="css-a4x74f"><span>2771</span></td><td id="LC2771" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">int16</span>(<span class="code-params">bytes, it</span>) </span>{
</code></td></tr><tr><td id="L2772" class="css-a4x74f"><span>2772</span></td><td id="LC2772" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> uint16(bytes, it) &lt;&lt; <span class="code-number">16</span> &gt;&gt; <span class="code-number">16</span>;
</code></td></tr><tr><td id="L2773" class="css-a4x74f"><span>2773</span></td><td id="LC2773" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2774" class="css-a4x74f"><span>2774</span></td><td id="LC2774" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">uint16</span>(<span class="code-params">bytes, it</span>) </span>{
</code></td></tr><tr><td id="L2775" class="css-a4x74f"><span>2775</span></td><td id="LC2775" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> bytes[it.offset++] | bytes[it.offset++] &lt;&lt; <span class="code-number">8</span>;
</code></td></tr><tr><td id="L2776" class="css-a4x74f"><span>2776</span></td><td id="LC2776" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2777" class="css-a4x74f"><span>2777</span></td><td id="LC2777" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">int32</span>(<span class="code-params">bytes, it</span>) </span>{
</code></td></tr><tr><td id="L2778" class="css-a4x74f"><span>2778</span></td><td id="LC2778" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> bytes[it.offset++] | bytes[it.offset++] &lt;&lt; <span class="code-number">8</span> | bytes[it.offset++] &lt;&lt; <span class="code-number">16</span> | bytes[it.offset++] &lt;&lt; <span class="code-number">24</span>;
</code></td></tr><tr><td id="L2779" class="css-a4x74f"><span>2779</span></td><td id="LC2779" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2780" class="css-a4x74f"><span>2780</span></td><td id="LC2780" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">uint32</span>(<span class="code-params">bytes, it</span>) </span>{
</code></td></tr><tr><td id="L2781" class="css-a4x74f"><span>2781</span></td><td id="LC2781" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> int32(bytes, it) &gt;&gt;&gt; <span class="code-number">0</span>;
</code></td></tr><tr><td id="L2782" class="css-a4x74f"><span>2782</span></td><td id="LC2782" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2783" class="css-a4x74f"><span>2783</span></td><td id="LC2783" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">float32</span>(<span class="code-params">bytes, it</span>) </span>{
</code></td></tr><tr><td id="L2784" class="css-a4x74f"><span>2784</span></td><td id="LC2784" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> readFloat32(bytes, it);
</code></td></tr><tr><td id="L2785" class="css-a4x74f"><span>2785</span></td><td id="LC2785" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2786" class="css-a4x74f"><span>2786</span></td><td id="LC2786" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">float64</span>(<span class="code-params">bytes, it</span>) </span>{
</code></td></tr><tr><td id="L2787" class="css-a4x74f"><span>2787</span></td><td id="LC2787" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> readFloat64(bytes, it);
</code></td></tr><tr><td id="L2788" class="css-a4x74f"><span>2788</span></td><td id="LC2788" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2789" class="css-a4x74f"><span>2789</span></td><td id="LC2789" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">int64</span>(<span class="code-params">bytes, it</span>) </span>{
</code></td></tr><tr><td id="L2790" class="css-a4x74f"><span>2790</span></td><td id="LC2790" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> low = uint32(bytes, it);
</code></td></tr><tr><td id="L2791" class="css-a4x74f"><span>2791</span></td><td id="LC2791" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> high = int32(bytes, it) * <span class="code-built_in">Math</span>.pow(<span class="code-number">2</span>, <span class="code-number">32</span>);
</code></td></tr><tr><td id="L2792" class="css-a4x74f"><span>2792</span></td><td id="LC2792" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> high + low;
</code></td></tr><tr><td id="L2793" class="css-a4x74f"><span>2793</span></td><td id="LC2793" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2794" class="css-a4x74f"><span>2794</span></td><td id="LC2794" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">uint64</span>(<span class="code-params">bytes, it</span>) </span>{
</code></td></tr><tr><td id="L2795" class="css-a4x74f"><span>2795</span></td><td id="LC2795" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> low = uint32(bytes, it);
</code></td></tr><tr><td id="L2796" class="css-a4x74f"><span>2796</span></td><td id="LC2796" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> high = uint32(bytes, it) * <span class="code-built_in">Math</span>.pow(<span class="code-number">2</span>, <span class="code-number">32</span>);
</code></td></tr><tr><td id="L2797" class="css-a4x74f"><span>2797</span></td><td id="LC2797" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> high + low;
</code></td></tr><tr><td id="L2798" class="css-a4x74f"><span>2798</span></td><td id="LC2798" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2799" class="css-a4x74f"><span>2799</span></td><td id="LC2799" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> _int32 = <span class="code-keyword">new</span> <span class="code-built_in">Int32Array</span>(<span class="code-number">2</span>);
</code></td></tr><tr><td id="L2800" class="css-a4x74f"><span>2800</span></td><td id="LC2800" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> _float32 = <span class="code-keyword">new</span> <span class="code-built_in">Float32Array</span>(_int32.buffer);
</code></td></tr><tr><td id="L2801" class="css-a4x74f"><span>2801</span></td><td id="LC2801" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> _float64 = <span class="code-keyword">new</span> <span class="code-built_in">Float64Array</span>(_int32.buffer);
</code></td></tr><tr><td id="L2802" class="css-a4x74f"><span>2802</span></td><td id="LC2802" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">readFloat32</span>(<span class="code-params">bytes, it</span>) </span>{
</code></td></tr><tr><td id="L2803" class="css-a4x74f"><span>2803</span></td><td id="LC2803" class="css-1dcdqdg"><code>            _int32[<span class="code-number">0</span>] = int32(bytes, it);
</code></td></tr><tr><td id="L2804" class="css-a4x74f"><span>2804</span></td><td id="LC2804" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> _float32[<span class="code-number">0</span>];
</code></td></tr><tr><td id="L2805" class="css-a4x74f"><span>2805</span></td><td id="LC2805" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2806" class="css-a4x74f"><span>2806</span></td><td id="LC2806" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">readFloat64</span>(<span class="code-params">bytes, it</span>) </span>{
</code></td></tr><tr><td id="L2807" class="css-a4x74f"><span>2807</span></td><td id="LC2807" class="css-1dcdqdg"><code>            _int32[<span class="code-number">0</span> ] = int32(bytes, it);
</code></td></tr><tr><td id="L2808" class="css-a4x74f"><span>2808</span></td><td id="LC2808" class="css-1dcdqdg"><code>            _int32[<span class="code-number">1</span> ] = int32(bytes, it);
</code></td></tr><tr><td id="L2809" class="css-a4x74f"><span>2809</span></td><td id="LC2809" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> _float64[<span class="code-number">0</span>];
</code></td></tr><tr><td id="L2810" class="css-a4x74f"><span>2810</span></td><td id="LC2810" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2811" class="css-a4x74f"><span>2811</span></td><td id="LC2811" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">boolean</span>(<span class="code-params">bytes, it</span>) </span>{
</code></td></tr><tr><td id="L2812" class="css-a4x74f"><span>2812</span></td><td id="LC2812" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> uint8(bytes, it) &gt; <span class="code-number">0</span>;
</code></td></tr><tr><td id="L2813" class="css-a4x74f"><span>2813</span></td><td id="LC2813" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2814" class="css-a4x74f"><span>2814</span></td><td id="LC2814" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">string</span>(<span class="code-params">bytes, it</span>) </span>{
</code></td></tr><tr><td id="L2815" class="css-a4x74f"><span>2815</span></td><td id="LC2815" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> prefix = bytes[it.offset++];
</code></td></tr><tr><td id="L2816" class="css-a4x74f"><span>2816</span></td><td id="LC2816" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> length;
</code></td></tr><tr><td id="L2817" class="css-a4x74f"><span>2817</span></td><td id="LC2817" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (prefix &lt; <span class="code-number">0xc0</span>) {
</code></td></tr><tr><td id="L2818" class="css-a4x74f"><span>2818</span></td><td id="LC2818" class="css-1dcdqdg"><code>                <span class="code-comment">// fixstr</span>
</code></td></tr><tr><td id="L2819" class="css-a4x74f"><span>2819</span></td><td id="LC2819" class="css-1dcdqdg"><code>                length = prefix &amp; <span class="code-number">0x1f</span>;
</code></td></tr><tr><td id="L2820" class="css-a4x74f"><span>2820</span></td><td id="LC2820" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2821" class="css-a4x74f"><span>2821</span></td><td id="LC2821" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (prefix === <span class="code-number">0xd9</span>) {
</code></td></tr><tr><td id="L2822" class="css-a4x74f"><span>2822</span></td><td id="LC2822" class="css-1dcdqdg"><code>                length = uint8(bytes, it);
</code></td></tr><tr><td id="L2823" class="css-a4x74f"><span>2823</span></td><td id="LC2823" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2824" class="css-a4x74f"><span>2824</span></td><td id="LC2824" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (prefix === <span class="code-number">0xda</span>) {
</code></td></tr><tr><td id="L2825" class="css-a4x74f"><span>2825</span></td><td id="LC2825" class="css-1dcdqdg"><code>                length = uint16(bytes, it);
</code></td></tr><tr><td id="L2826" class="css-a4x74f"><span>2826</span></td><td id="LC2826" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2827" class="css-a4x74f"><span>2827</span></td><td id="LC2827" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (prefix === <span class="code-number">0xdb</span>) {
</code></td></tr><tr><td id="L2828" class="css-a4x74f"><span>2828</span></td><td id="LC2828" class="css-1dcdqdg"><code>                length = uint32(bytes, it);
</code></td></tr><tr><td id="L2829" class="css-a4x74f"><span>2829</span></td><td id="LC2829" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2830" class="css-a4x74f"><span>2830</span></td><td id="LC2830" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> value = utf8Read(bytes, it.offset, length);
</code></td></tr><tr><td id="L2831" class="css-a4x74f"><span>2831</span></td><td id="LC2831" class="css-1dcdqdg"><code>            it.offset += length;
</code></td></tr><tr><td id="L2832" class="css-a4x74f"><span>2832</span></td><td id="LC2832" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> value;
</code></td></tr><tr><td id="L2833" class="css-a4x74f"><span>2833</span></td><td id="LC2833" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2834" class="css-a4x74f"><span>2834</span></td><td id="LC2834" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">stringCheck</span>(<span class="code-params">bytes, it</span>) </span>{
</code></td></tr><tr><td id="L2835" class="css-a4x74f"><span>2835</span></td><td id="LC2835" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> prefix = bytes[it.offset];
</code></td></tr><tr><td id="L2836" class="css-a4x74f"><span>2836</span></td><td id="LC2836" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> (
</code></td></tr><tr><td id="L2837" class="css-a4x74f"><span>2837</span></td><td id="LC2837" class="css-1dcdqdg"><code>            <span class="code-comment">// fixstr</span>
</code></td></tr><tr><td id="L2838" class="css-a4x74f"><span>2838</span></td><td id="LC2838" class="css-1dcdqdg"><code>            (prefix &lt; <span class="code-number">0xc0</span> &amp;&amp; prefix &gt; <span class="code-number">0xa0</span>) ||
</code></td></tr><tr><td id="L2839" class="css-a4x74f"><span>2839</span></td><td id="LC2839" class="css-1dcdqdg"><code>                <span class="code-comment">// str 8</span>
</code></td></tr><tr><td id="L2840" class="css-a4x74f"><span>2840</span></td><td id="LC2840" class="css-1dcdqdg"><code>                prefix === <span class="code-number">0xd9</span> ||
</code></td></tr><tr><td id="L2841" class="css-a4x74f"><span>2841</span></td><td id="LC2841" class="css-1dcdqdg"><code>                <span class="code-comment">// str 16</span>
</code></td></tr><tr><td id="L2842" class="css-a4x74f"><span>2842</span></td><td id="LC2842" class="css-1dcdqdg"><code>                prefix === <span class="code-number">0xda</span> ||
</code></td></tr><tr><td id="L2843" class="css-a4x74f"><span>2843</span></td><td id="LC2843" class="css-1dcdqdg"><code>                <span class="code-comment">// str 32</span>
</code></td></tr><tr><td id="L2844" class="css-a4x74f"><span>2844</span></td><td id="LC2844" class="css-1dcdqdg"><code>                prefix === <span class="code-number">0xdb</span>);
</code></td></tr><tr><td id="L2845" class="css-a4x74f"><span>2845</span></td><td id="LC2845" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2846" class="css-a4x74f"><span>2846</span></td><td id="LC2846" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">number</span>(<span class="code-params">bytes, it</span>) </span>{
</code></td></tr><tr><td id="L2847" class="css-a4x74f"><span>2847</span></td><td id="LC2847" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> prefix = bytes[it.offset++];
</code></td></tr><tr><td id="L2848" class="css-a4x74f"><span>2848</span></td><td id="LC2848" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (prefix &lt; <span class="code-number">0x80</span>) {
</code></td></tr><tr><td id="L2849" class="css-a4x74f"><span>2849</span></td><td id="LC2849" class="css-1dcdqdg"><code>                <span class="code-comment">// positive fixint</span>
</code></td></tr><tr><td id="L2850" class="css-a4x74f"><span>2850</span></td><td id="LC2850" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> prefix;
</code></td></tr><tr><td id="L2851" class="css-a4x74f"><span>2851</span></td><td id="LC2851" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2852" class="css-a4x74f"><span>2852</span></td><td id="LC2852" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (prefix === <span class="code-number">0xca</span>) {
</code></td></tr><tr><td id="L2853" class="css-a4x74f"><span>2853</span></td><td id="LC2853" class="css-1dcdqdg"><code>                <span class="code-comment">// float 32</span>
</code></td></tr><tr><td id="L2854" class="css-a4x74f"><span>2854</span></td><td id="LC2854" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> readFloat32(bytes, it);
</code></td></tr><tr><td id="L2855" class="css-a4x74f"><span>2855</span></td><td id="LC2855" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2856" class="css-a4x74f"><span>2856</span></td><td id="LC2856" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (prefix === <span class="code-number">0xcb</span>) {
</code></td></tr><tr><td id="L2857" class="css-a4x74f"><span>2857</span></td><td id="LC2857" class="css-1dcdqdg"><code>                <span class="code-comment">// float 64</span>
</code></td></tr><tr><td id="L2858" class="css-a4x74f"><span>2858</span></td><td id="LC2858" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> readFloat64(bytes, it);
</code></td></tr><tr><td id="L2859" class="css-a4x74f"><span>2859</span></td><td id="LC2859" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2860" class="css-a4x74f"><span>2860</span></td><td id="LC2860" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (prefix === <span class="code-number">0xcc</span>) {
</code></td></tr><tr><td id="L2861" class="css-a4x74f"><span>2861</span></td><td id="LC2861" class="css-1dcdqdg"><code>                <span class="code-comment">// uint 8</span>
</code></td></tr><tr><td id="L2862" class="css-a4x74f"><span>2862</span></td><td id="LC2862" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> uint8(bytes, it);
</code></td></tr><tr><td id="L2863" class="css-a4x74f"><span>2863</span></td><td id="LC2863" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2864" class="css-a4x74f"><span>2864</span></td><td id="LC2864" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (prefix === <span class="code-number">0xcd</span>) {
</code></td></tr><tr><td id="L2865" class="css-a4x74f"><span>2865</span></td><td id="LC2865" class="css-1dcdqdg"><code>                <span class="code-comment">// uint 16</span>
</code></td></tr><tr><td id="L2866" class="css-a4x74f"><span>2866</span></td><td id="LC2866" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> uint16(bytes, it);
</code></td></tr><tr><td id="L2867" class="css-a4x74f"><span>2867</span></td><td id="LC2867" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2868" class="css-a4x74f"><span>2868</span></td><td id="LC2868" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (prefix === <span class="code-number">0xce</span>) {
</code></td></tr><tr><td id="L2869" class="css-a4x74f"><span>2869</span></td><td id="LC2869" class="css-1dcdqdg"><code>                <span class="code-comment">// uint 32</span>
</code></td></tr><tr><td id="L2870" class="css-a4x74f"><span>2870</span></td><td id="LC2870" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> uint32(bytes, it);
</code></td></tr><tr><td id="L2871" class="css-a4x74f"><span>2871</span></td><td id="LC2871" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2872" class="css-a4x74f"><span>2872</span></td><td id="LC2872" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (prefix === <span class="code-number">0xcf</span>) {
</code></td></tr><tr><td id="L2873" class="css-a4x74f"><span>2873</span></td><td id="LC2873" class="css-1dcdqdg"><code>                <span class="code-comment">// uint 64</span>
</code></td></tr><tr><td id="L2874" class="css-a4x74f"><span>2874</span></td><td id="LC2874" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> uint64(bytes, it);
</code></td></tr><tr><td id="L2875" class="css-a4x74f"><span>2875</span></td><td id="LC2875" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2876" class="css-a4x74f"><span>2876</span></td><td id="LC2876" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (prefix === <span class="code-number">0xd0</span>) {
</code></td></tr><tr><td id="L2877" class="css-a4x74f"><span>2877</span></td><td id="LC2877" class="css-1dcdqdg"><code>                <span class="code-comment">// int 8</span>
</code></td></tr><tr><td id="L2878" class="css-a4x74f"><span>2878</span></td><td id="LC2878" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> int8(bytes, it);
</code></td></tr><tr><td id="L2879" class="css-a4x74f"><span>2879</span></td><td id="LC2879" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2880" class="css-a4x74f"><span>2880</span></td><td id="LC2880" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (prefix === <span class="code-number">0xd1</span>) {
</code></td></tr><tr><td id="L2881" class="css-a4x74f"><span>2881</span></td><td id="LC2881" class="css-1dcdqdg"><code>                <span class="code-comment">// int 16</span>
</code></td></tr><tr><td id="L2882" class="css-a4x74f"><span>2882</span></td><td id="LC2882" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> int16(bytes, it);
</code></td></tr><tr><td id="L2883" class="css-a4x74f"><span>2883</span></td><td id="LC2883" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2884" class="css-a4x74f"><span>2884</span></td><td id="LC2884" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (prefix === <span class="code-number">0xd2</span>) {
</code></td></tr><tr><td id="L2885" class="css-a4x74f"><span>2885</span></td><td id="LC2885" class="css-1dcdqdg"><code>                <span class="code-comment">// int 32</span>
</code></td></tr><tr><td id="L2886" class="css-a4x74f"><span>2886</span></td><td id="LC2886" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> int32(bytes, it);
</code></td></tr><tr><td id="L2887" class="css-a4x74f"><span>2887</span></td><td id="LC2887" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2888" class="css-a4x74f"><span>2888</span></td><td id="LC2888" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (prefix === <span class="code-number">0xd3</span>) {
</code></td></tr><tr><td id="L2889" class="css-a4x74f"><span>2889</span></td><td id="LC2889" class="css-1dcdqdg"><code>                <span class="code-comment">// int 64</span>
</code></td></tr><tr><td id="L2890" class="css-a4x74f"><span>2890</span></td><td id="LC2890" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> int64(bytes, it);
</code></td></tr><tr><td id="L2891" class="css-a4x74f"><span>2891</span></td><td id="LC2891" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2892" class="css-a4x74f"><span>2892</span></td><td id="LC2892" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (prefix &gt; <span class="code-number">0xdf</span>) {
</code></td></tr><tr><td id="L2893" class="css-a4x74f"><span>2893</span></td><td id="LC2893" class="css-1dcdqdg"><code>                <span class="code-comment">// negative fixint</span>
</code></td></tr><tr><td id="L2894" class="css-a4x74f"><span>2894</span></td><td id="LC2894" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> (<span class="code-number">0xff</span> - prefix + <span class="code-number">1</span>) * <span class="code-number">-1</span>;
</code></td></tr><tr><td id="L2895" class="css-a4x74f"><span>2895</span></td><td id="LC2895" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2896" class="css-a4x74f"><span>2896</span></td><td id="LC2896" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2897" class="css-a4x74f"><span>2897</span></td><td id="LC2897" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">numberCheck</span>(<span class="code-params">bytes, it</span>) </span>{
</code></td></tr><tr><td id="L2898" class="css-a4x74f"><span>2898</span></td><td id="LC2898" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> prefix = bytes[it.offset];
</code></td></tr><tr><td id="L2899" class="css-a4x74f"><span>2899</span></td><td id="LC2899" class="css-1dcdqdg"><code>            <span class="code-comment">// positive fixint - 0x00 - 0x7f</span>
</code></td></tr><tr><td id="L2900" class="css-a4x74f"><span>2900</span></td><td id="LC2900" class="css-1dcdqdg"><code>            <span class="code-comment">// float 32        - 0xca</span>
</code></td></tr><tr><td id="L2901" class="css-a4x74f"><span>2901</span></td><td id="LC2901" class="css-1dcdqdg"><code>            <span class="code-comment">// float 64        - 0xcb</span>
</code></td></tr><tr><td id="L2902" class="css-a4x74f"><span>2902</span></td><td id="LC2902" class="css-1dcdqdg"><code>            <span class="code-comment">// uint 8          - 0xcc</span>
</code></td></tr><tr><td id="L2903" class="css-a4x74f"><span>2903</span></td><td id="LC2903" class="css-1dcdqdg"><code>            <span class="code-comment">// uint 16         - 0xcd</span>
</code></td></tr><tr><td id="L2904" class="css-a4x74f"><span>2904</span></td><td id="LC2904" class="css-1dcdqdg"><code>            <span class="code-comment">// uint 32         - 0xce</span>
</code></td></tr><tr><td id="L2905" class="css-a4x74f"><span>2905</span></td><td id="LC2905" class="css-1dcdqdg"><code>            <span class="code-comment">// uint 64         - 0xcf</span>
</code></td></tr><tr><td id="L2906" class="css-a4x74f"><span>2906</span></td><td id="LC2906" class="css-1dcdqdg"><code>            <span class="code-comment">// int 8           - 0xd0</span>
</code></td></tr><tr><td id="L2907" class="css-a4x74f"><span>2907</span></td><td id="LC2907" class="css-1dcdqdg"><code>            <span class="code-comment">// int 16          - 0xd1</span>
</code></td></tr><tr><td id="L2908" class="css-a4x74f"><span>2908</span></td><td id="LC2908" class="css-1dcdqdg"><code>            <span class="code-comment">// int 32          - 0xd2</span>
</code></td></tr><tr><td id="L2909" class="css-a4x74f"><span>2909</span></td><td id="LC2909" class="css-1dcdqdg"><code>            <span class="code-comment">// int 64          - 0xd3</span>
</code></td></tr><tr><td id="L2910" class="css-a4x74f"><span>2910</span></td><td id="LC2910" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> (prefix &lt; <span class="code-number">0x80</span> ||
</code></td></tr><tr><td id="L2911" class="css-a4x74f"><span>2911</span></td><td id="LC2911" class="css-1dcdqdg"><code>                (prefix &gt;= <span class="code-number">0xca</span> &amp;&amp; prefix &lt;= <span class="code-number">0xd3</span>));
</code></td></tr><tr><td id="L2912" class="css-a4x74f"><span>2912</span></td><td id="LC2912" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2913" class="css-a4x74f"><span>2913</span></td><td id="LC2913" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">arrayCheck</span>(<span class="code-params">bytes, it</span>) </span>{
</code></td></tr><tr><td id="L2914" class="css-a4x74f"><span>2914</span></td><td id="LC2914" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> bytes[it.offset] &lt; <span class="code-number">0xa0</span>;
</code></td></tr><tr><td id="L2915" class="css-a4x74f"><span>2915</span></td><td id="LC2915" class="css-1dcdqdg"><code>            <span class="code-comment">// const prefix = bytes[it.offset] ;</span>
</code></td></tr><tr><td id="L2916" class="css-a4x74f"><span>2916</span></td><td id="LC2916" class="css-1dcdqdg"><code>            <span class="code-comment">// if (prefix &lt; 0xa0) {</span>
</code></td></tr><tr><td id="L2917" class="css-a4x74f"><span>2917</span></td><td id="LC2917" class="css-1dcdqdg"><code>            <span class="code-comment">//   return prefix;</span>
</code></td></tr><tr><td id="L2918" class="css-a4x74f"><span>2918</span></td><td id="LC2918" class="css-1dcdqdg"><code>            <span class="code-comment">// // array</span>
</code></td></tr><tr><td id="L2919" class="css-a4x74f"><span>2919</span></td><td id="LC2919" class="css-1dcdqdg"><code>            <span class="code-comment">// } else if (prefix === 0xdc) {</span>
</code></td></tr><tr><td id="L2920" class="css-a4x74f"><span>2920</span></td><td id="LC2920" class="css-1dcdqdg"><code>            <span class="code-comment">//   it.offset += 2;</span>
</code></td></tr><tr><td id="L2921" class="css-a4x74f"><span>2921</span></td><td id="LC2921" class="css-1dcdqdg"><code>            <span class="code-comment">// } else if (0xdd) {</span>
</code></td></tr><tr><td id="L2922" class="css-a4x74f"><span>2922</span></td><td id="LC2922" class="css-1dcdqdg"><code>            <span class="code-comment">//   it.offset += 4;</span>
</code></td></tr><tr><td id="L2923" class="css-a4x74f"><span>2923</span></td><td id="LC2923" class="css-1dcdqdg"><code>            <span class="code-comment">// }</span>
</code></td></tr><tr><td id="L2924" class="css-a4x74f"><span>2924</span></td><td id="LC2924" class="css-1dcdqdg"><code>            <span class="code-comment">// return prefix;</span>
</code></td></tr><tr><td id="L2925" class="css-a4x74f"><span>2925</span></td><td id="LC2925" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2926" class="css-a4x74f"><span>2926</span></td><td id="LC2926" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">switchStructureCheck</span>(<span class="code-params">bytes, it</span>) </span>{
</code></td></tr><tr><td id="L2927" class="css-a4x74f"><span>2927</span></td><td id="LC2927" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> (
</code></td></tr><tr><td id="L2928" class="css-a4x74f"><span>2928</span></td><td id="LC2928" class="css-1dcdqdg"><code>            <span class="code-comment">// previous byte should be `SWITCH_TO_STRUCTURE`</span>
</code></td></tr><tr><td id="L2929" class="css-a4x74f"><span>2929</span></td><td id="LC2929" class="css-1dcdqdg"><code>            bytes[it.offset - <span class="code-number">1</span>] === SWITCH_TO_STRUCTURE &amp;&amp;
</code></td></tr><tr><td id="L2930" class="css-a4x74f"><span>2930</span></td><td id="LC2930" class="css-1dcdqdg"><code>                <span class="code-comment">// next byte should be a number</span>
</code></td></tr><tr><td id="L2931" class="css-a4x74f"><span>2931</span></td><td id="LC2931" class="css-1dcdqdg"><code>                (bytes[it.offset] &lt; <span class="code-number">0x80</span> || (bytes[it.offset] &gt;= <span class="code-number">0xca</span> &amp;&amp; bytes[it.offset] &lt;= <span class="code-number">0xd3</span>)));
</code></td></tr><tr><td id="L2932" class="css-a4x74f"><span>2932</span></td><td id="LC2932" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L2933" class="css-a4x74f"><span>2933</span></td><td id="LC2933" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L2934" class="css-a4x74f"><span>2934</span></td><td id="LC2934" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> decode = <span class="code-comment">/*#__PURE__*/</span><span class="code-built_in">Object</span>.freeze({
</code></td></tr><tr><td id="L2935" class="css-a4x74f"><span>2935</span></td><td id="LC2935" class="css-1dcdqdg"><code>            __proto__: <span class="code-literal">null</span>,
</code></td></tr><tr><td id="L2936" class="css-a4x74f"><span>2936</span></td><td id="LC2936" class="css-1dcdqdg"><code>            int8: int8,
</code></td></tr><tr><td id="L2937" class="css-a4x74f"><span>2937</span></td><td id="LC2937" class="css-1dcdqdg"><code>            uint8: uint8,
</code></td></tr><tr><td id="L2938" class="css-a4x74f"><span>2938</span></td><td id="LC2938" class="css-1dcdqdg"><code>            int16: int16,
</code></td></tr><tr><td id="L2939" class="css-a4x74f"><span>2939</span></td><td id="LC2939" class="css-1dcdqdg"><code>            uint16: uint16,
</code></td></tr><tr><td id="L2940" class="css-a4x74f"><span>2940</span></td><td id="LC2940" class="css-1dcdqdg"><code>            int32: int32,
</code></td></tr><tr><td id="L2941" class="css-a4x74f"><span>2941</span></td><td id="LC2941" class="css-1dcdqdg"><code>            uint32: uint32,
</code></td></tr><tr><td id="L2942" class="css-a4x74f"><span>2942</span></td><td id="LC2942" class="css-1dcdqdg"><code>            float32: float32,
</code></td></tr><tr><td id="L2943" class="css-a4x74f"><span>2943</span></td><td id="LC2943" class="css-1dcdqdg"><code>            float64: float64,
</code></td></tr><tr><td id="L2944" class="css-a4x74f"><span>2944</span></td><td id="LC2944" class="css-1dcdqdg"><code>            int64: int64,
</code></td></tr><tr><td id="L2945" class="css-a4x74f"><span>2945</span></td><td id="LC2945" class="css-1dcdqdg"><code>            uint64: uint64,
</code></td></tr><tr><td id="L2946" class="css-a4x74f"><span>2946</span></td><td id="LC2946" class="css-1dcdqdg"><code>            readFloat32: readFloat32,
</code></td></tr><tr><td id="L2947" class="css-a4x74f"><span>2947</span></td><td id="LC2947" class="css-1dcdqdg"><code>            readFloat64: readFloat64,
</code></td></tr><tr><td id="L2948" class="css-a4x74f"><span>2948</span></td><td id="LC2948" class="css-1dcdqdg"><code>            boolean: boolean,
</code></td></tr><tr><td id="L2949" class="css-a4x74f"><span>2949</span></td><td id="LC2949" class="css-1dcdqdg"><code>            string: string,
</code></td></tr><tr><td id="L2950" class="css-a4x74f"><span>2950</span></td><td id="LC2950" class="css-1dcdqdg"><code>            stringCheck: stringCheck,
</code></td></tr><tr><td id="L2951" class="css-a4x74f"><span>2951</span></td><td id="LC2951" class="css-1dcdqdg"><code>            number: number,
</code></td></tr><tr><td id="L2952" class="css-a4x74f"><span>2952</span></td><td id="LC2952" class="css-1dcdqdg"><code>            numberCheck: numberCheck,
</code></td></tr><tr><td id="L2953" class="css-a4x74f"><span>2953</span></td><td id="LC2953" class="css-1dcdqdg"><code>            arrayCheck: arrayCheck,
</code></td></tr><tr><td id="L2954" class="css-a4x74f"><span>2954</span></td><td id="LC2954" class="css-1dcdqdg"><code>            switchStructureCheck: switchStructureCheck
</code></td></tr><tr><td id="L2955" class="css-a4x74f"><span>2955</span></td><td id="LC2955" class="css-1dcdqdg"><code>        });
</code></td></tr><tr><td id="L2956" class="css-a4x74f"><span>2956</span></td><td id="LC2956" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L2957" class="css-a4x74f"><span>2957</span></td><td id="LC2957" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> CollectionSchema = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L2958" class="css-a4x74f"><span>2958</span></td><td id="LC2958" class="css-1dcdqdg"><code>            <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">CollectionSchema</span>(<span class="code-params">initialValues</span>) </span>{
</code></td></tr><tr><td id="L2959" class="css-a4x74f"><span>2959</span></td><td id="LC2959" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L2960" class="css-a4x74f"><span>2960</span></td><td id="LC2960" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes = <span class="code-keyword">new</span> ChangeTree(<span class="code-keyword">this</span>);
</code></td></tr><tr><td id="L2961" class="css-a4x74f"><span>2961</span></td><td id="LC2961" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$items = <span class="code-keyword">new</span> <span class="code-built_in">Map</span>();
</code></td></tr><tr><td id="L2962" class="css-a4x74f"><span>2962</span></td><td id="LC2962" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes = <span class="code-keyword">new</span> <span class="code-built_in">Map</span>();
</code></td></tr><tr><td id="L2963" class="css-a4x74f"><span>2963</span></td><td id="LC2963" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$refId = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L2964" class="css-a4x74f"><span>2964</span></td><td id="LC2964" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (initialValues) {
</code></td></tr><tr><td id="L2965" class="css-a4x74f"><span>2965</span></td><td id="LC2965" class="css-1dcdqdg"><code>                    initialValues.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">v</span>) </span>{ <span class="code-keyword">return</span> _this.add(v); });
</code></td></tr><tr><td id="L2966" class="css-a4x74f"><span>2966</span></td><td id="LC2966" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2967" class="css-a4x74f"><span>2967</span></td><td id="LC2967" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L2968" class="css-a4x74f"><span>2968</span></td><td id="LC2968" class="css-1dcdqdg"><code>            CollectionSchema.prototype.onAdd = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback, triggerAll</span>) </span>{
</code></td></tr><tr><td id="L2969" class="css-a4x74f"><span>2969</span></td><td id="LC2969" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (triggerAll === <span class="code-keyword">void</span> <span class="code-number">0</span>) { triggerAll = <span class="code-literal">true</span>; }
</code></td></tr><tr><td id="L2970" class="css-a4x74f"><span>2970</span></td><td id="LC2970" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> addCallback((<span class="code-keyword">this</span>.$callbacks || (<span class="code-keyword">this</span>.$callbacks = [])), exports.OPERATION.ADD, callback, (triggerAll)
</code></td></tr><tr><td id="L2971" class="css-a4x74f"><span>2971</span></td><td id="LC2971" class="css-1dcdqdg"><code>                    ? <span class="code-keyword">this</span>.$items
</code></td></tr><tr><td id="L2972" class="css-a4x74f"><span>2972</span></td><td id="LC2972" class="css-1dcdqdg"><code>                    : <span class="code-literal">undefined</span>);
</code></td></tr><tr><td id="L2973" class="css-a4x74f"><span>2973</span></td><td id="LC2973" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2974" class="css-a4x74f"><span>2974</span></td><td id="LC2974" class="css-1dcdqdg"><code>            CollectionSchema.prototype.onRemove = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback</span>) </span>{ <span class="code-keyword">return</span> addCallback(<span class="code-keyword">this</span>.$callbacks || (<span class="code-keyword">this</span>.$callbacks = []), exports.OPERATION.DELETE, callback); };
</code></td></tr><tr><td id="L2975" class="css-a4x74f"><span>2975</span></td><td id="LC2975" class="css-1dcdqdg"><code>            CollectionSchema.prototype.onChange = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback</span>) </span>{ <span class="code-keyword">return</span> addCallback(<span class="code-keyword">this</span>.$callbacks || (<span class="code-keyword">this</span>.$callbacks = []), exports.OPERATION.REPLACE, callback); };
</code></td></tr><tr><td id="L2976" class="css-a4x74f"><span>2976</span></td><td id="LC2976" class="css-1dcdqdg"><code>            CollectionSchema.is = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">type</span>) </span>{
</code></td></tr><tr><td id="L2977" class="css-a4x74f"><span>2977</span></td><td id="LC2977" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> type[<span class="code-string">'collection'</span>] !== <span class="code-literal">undefined</span>;
</code></td></tr><tr><td id="L2978" class="css-a4x74f"><span>2978</span></td><td id="LC2978" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2979" class="css-a4x74f"><span>2979</span></td><td id="LC2979" class="css-1dcdqdg"><code>            CollectionSchema.prototype.add = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">value</span>) </span>{
</code></td></tr><tr><td id="L2980" class="css-a4x74f"><span>2980</span></td><td id="LC2980" class="css-1dcdqdg"><code>                <span class="code-comment">// set "index" for reference.</span>
</code></td></tr><tr><td id="L2981" class="css-a4x74f"><span>2981</span></td><td id="LC2981" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> index = <span class="code-keyword">this</span>.$refId++;
</code></td></tr><tr><td id="L2982" class="css-a4x74f"><span>2982</span></td><td id="LC2982" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> isRef = (value[<span class="code-string">'$changes'</span>]) !== <span class="code-literal">undefined</span>;
</code></td></tr><tr><td id="L2983" class="css-a4x74f"><span>2983</span></td><td id="LC2983" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (isRef) {
</code></td></tr><tr><td id="L2984" class="css-a4x74f"><span>2984</span></td><td id="LC2984" class="css-1dcdqdg"><code>                    value[<span class="code-string">'$changes'</span>].setParent(<span class="code-keyword">this</span>, <span class="code-keyword">this</span>.$changes.root, index);
</code></td></tr><tr><td id="L2985" class="css-a4x74f"><span>2985</span></td><td id="LC2985" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L2986" class="css-a4x74f"><span>2986</span></td><td id="LC2986" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.indexes[index] = index;
</code></td></tr><tr><td id="L2987" class="css-a4x74f"><span>2987</span></td><td id="LC2987" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes.set(index, index);
</code></td></tr><tr><td id="L2988" class="css-a4x74f"><span>2988</span></td><td id="LC2988" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$items.set(index, value);
</code></td></tr><tr><td id="L2989" class="css-a4x74f"><span>2989</span></td><td id="LC2989" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.change(index);
</code></td></tr><tr><td id="L2990" class="css-a4x74f"><span>2990</span></td><td id="LC2990" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> index;
</code></td></tr><tr><td id="L2991" class="css-a4x74f"><span>2991</span></td><td id="LC2991" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2992" class="css-a4x74f"><span>2992</span></td><td id="LC2992" class="css-1dcdqdg"><code>            CollectionSchema.prototype.at = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index</span>) </span>{
</code></td></tr><tr><td id="L2993" class="css-a4x74f"><span>2993</span></td><td id="LC2993" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> key = <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.keys())[index];
</code></td></tr><tr><td id="L2994" class="css-a4x74f"><span>2994</span></td><td id="LC2994" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.get(key);
</code></td></tr><tr><td id="L2995" class="css-a4x74f"><span>2995</span></td><td id="LC2995" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2996" class="css-a4x74f"><span>2996</span></td><td id="LC2996" class="css-1dcdqdg"><code>            CollectionSchema.prototype.entries = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L2997" class="css-a4x74f"><span>2997</span></td><td id="LC2997" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.entries();
</code></td></tr><tr><td id="L2998" class="css-a4x74f"><span>2998</span></td><td id="LC2998" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L2999" class="css-a4x74f"><span>2999</span></td><td id="LC2999" class="css-1dcdqdg"><code>            CollectionSchema.prototype.delete = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">item</span>) </span>{
</code></td></tr><tr><td id="L3000" class="css-a4x74f"><span>3000</span></td><td id="LC3000" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> entries = <span class="code-keyword">this</span>.$items.entries();
</code></td></tr><tr><td id="L3001" class="css-a4x74f"><span>3001</span></td><td id="LC3001" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> index;
</code></td></tr><tr><td id="L3002" class="css-a4x74f"><span>3002</span></td><td id="LC3002" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> entry;
</code></td></tr><tr><td id="L3003" class="css-a4x74f"><span>3003</span></td><td id="LC3003" class="css-1dcdqdg"><code>                <span class="code-keyword">while</span> (entry = entries.next()) {
</code></td></tr><tr><td id="L3004" class="css-a4x74f"><span>3004</span></td><td id="LC3004" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (entry.done) {
</code></td></tr><tr><td id="L3005" class="css-a4x74f"><span>3005</span></td><td id="LC3005" class="css-1dcdqdg"><code>                        <span class="code-keyword">break</span>;
</code></td></tr><tr><td id="L3006" class="css-a4x74f"><span>3006</span></td><td id="LC3006" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3007" class="css-a4x74f"><span>3007</span></td><td id="LC3007" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (item === entry.value[<span class="code-number">1</span>]) {
</code></td></tr><tr><td id="L3008" class="css-a4x74f"><span>3008</span></td><td id="LC3008" class="css-1dcdqdg"><code>                        index = entry.value[<span class="code-number">0</span>];
</code></td></tr><tr><td id="L3009" class="css-a4x74f"><span>3009</span></td><td id="LC3009" class="css-1dcdqdg"><code>                        <span class="code-keyword">break</span>;
</code></td></tr><tr><td id="L3010" class="css-a4x74f"><span>3010</span></td><td id="LC3010" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3011" class="css-a4x74f"><span>3011</span></td><td id="LC3011" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3012" class="css-a4x74f"><span>3012</span></td><td id="LC3012" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (index === <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L3013" class="css-a4x74f"><span>3013</span></td><td id="LC3013" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-literal">false</span>;
</code></td></tr><tr><td id="L3014" class="css-a4x74f"><span>3014</span></td><td id="LC3014" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3015" class="css-a4x74f"><span>3015</span></td><td id="LC3015" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.delete(index);
</code></td></tr><tr><td id="L3016" class="css-a4x74f"><span>3016</span></td><td id="LC3016" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes.delete(index);
</code></td></tr><tr><td id="L3017" class="css-a4x74f"><span>3017</span></td><td id="LC3017" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.delete(index);
</code></td></tr><tr><td id="L3018" class="css-a4x74f"><span>3018</span></td><td id="LC3018" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3019" class="css-a4x74f"><span>3019</span></td><td id="LC3019" class="css-1dcdqdg"><code>            CollectionSchema.prototype.clear = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">changes</span>) </span>{
</code></td></tr><tr><td id="L3020" class="css-a4x74f"><span>3020</span></td><td id="LC3020" class="css-1dcdqdg"><code>                <span class="code-comment">// discard previous operations.</span>
</code></td></tr><tr><td id="L3021" class="css-a4x74f"><span>3021</span></td><td id="LC3021" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.discard(<span class="code-literal">true</span>, <span class="code-literal">true</span>);
</code></td></tr><tr><td id="L3022" class="css-a4x74f"><span>3022</span></td><td id="LC3022" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.indexes = {};
</code></td></tr><tr><td id="L3023" class="css-a4x74f"><span>3023</span></td><td id="LC3023" class="css-1dcdqdg"><code>                <span class="code-comment">// clear previous indexes</span>
</code></td></tr><tr><td id="L3024" class="css-a4x74f"><span>3024</span></td><td id="LC3024" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes.clear();
</code></td></tr><tr><td id="L3025" class="css-a4x74f"><span>3025</span></td><td id="LC3025" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3026" class="css-a4x74f"><span>3026</span></td><td id="LC3026" class="css-1dcdqdg"><code>                <span class="code-comment">// When decoding:</span>
</code></td></tr><tr><td id="L3027" class="css-a4x74f"><span>3027</span></td><td id="LC3027" class="css-1dcdqdg"><code>                <span class="code-comment">// - enqueue items for DELETE callback.</span>
</code></td></tr><tr><td id="L3028" class="css-a4x74f"><span>3028</span></td><td id="LC3028" class="css-1dcdqdg"><code>                <span class="code-comment">// - flag child items for garbage collection.</span>
</code></td></tr><tr><td id="L3029" class="css-a4x74f"><span>3029</span></td><td id="LC3029" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3030" class="css-a4x74f"><span>3030</span></td><td id="LC3030" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (changes) {
</code></td></tr><tr><td id="L3031" class="css-a4x74f"><span>3031</span></td><td id="LC3031" class="css-1dcdqdg"><code>                    removeChildRefs.call(<span class="code-keyword">this</span>, changes);
</code></td></tr><tr><td id="L3032" class="css-a4x74f"><span>3032</span></td><td id="LC3032" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3033" class="css-a4x74f"><span>3033</span></td><td id="LC3033" class="css-1dcdqdg"><code>                <span class="code-comment">// clear items</span>
</code></td></tr><tr><td id="L3034" class="css-a4x74f"><span>3034</span></td><td id="LC3034" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$items.clear();
</code></td></tr><tr><td id="L3035" class="css-a4x74f"><span>3035</span></td><td id="LC3035" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.operation({ <span class="code-attr">index</span>: <span class="code-number">0</span>, <span class="code-attr">op</span>: exports.OPERATION.CLEAR });
</code></td></tr><tr><td id="L3036" class="css-a4x74f"><span>3036</span></td><td id="LC3036" class="css-1dcdqdg"><code>                <span class="code-comment">// touch all structures until reach root</span>
</code></td></tr><tr><td id="L3037" class="css-a4x74f"><span>3037</span></td><td id="LC3037" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.touchParents();
</code></td></tr><tr><td id="L3038" class="css-a4x74f"><span>3038</span></td><td id="LC3038" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3039" class="css-a4x74f"><span>3039</span></td><td id="LC3039" class="css-1dcdqdg"><code>            CollectionSchema.prototype.has = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">value</span>) </span>{
</code></td></tr><tr><td id="L3040" class="css-a4x74f"><span>3040</span></td><td id="LC3040" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values()).some(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">v</span>) </span>{ <span class="code-keyword">return</span> v === value; });
</code></td></tr><tr><td id="L3041" class="css-a4x74f"><span>3041</span></td><td id="LC3041" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3042" class="css-a4x74f"><span>3042</span></td><td id="LC3042" class="css-1dcdqdg"><code>            CollectionSchema.prototype.forEach = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callbackfn</span>) </span>{
</code></td></tr><tr><td id="L3043" class="css-a4x74f"><span>3043</span></td><td id="LC3043" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L3044" class="css-a4x74f"><span>3044</span></td><td id="LC3044" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$items.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">value, key, _</span>) </span>{ <span class="code-keyword">return</span> callbackfn(value, key, _this); });
</code></td></tr><tr><td id="L3045" class="css-a4x74f"><span>3045</span></td><td id="LC3045" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3046" class="css-a4x74f"><span>3046</span></td><td id="LC3046" class="css-1dcdqdg"><code>            CollectionSchema.prototype.values = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L3047" class="css-a4x74f"><span>3047</span></td><td id="LC3047" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.values();
</code></td></tr><tr><td id="L3048" class="css-a4x74f"><span>3048</span></td><td id="LC3048" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3049" class="css-a4x74f"><span>3049</span></td><td id="LC3049" class="css-1dcdqdg"><code>            <span class="code-built_in">Object</span>.defineProperty(CollectionSchema.prototype, <span class="code-string">"size"</span>, {
</code></td></tr><tr><td id="L3050" class="css-a4x74f"><span>3050</span></td><td id="LC3050" class="css-1dcdqdg"><code>                <span class="code-keyword">get</span>: function () {
</code></td></tr><tr><td id="L3051" class="css-a4x74f"><span>3051</span></td><td id="LC3051" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.size;
</code></td></tr><tr><td id="L3052" class="css-a4x74f"><span>3052</span></td><td id="LC3052" class="css-1dcdqdg"><code>                },
</code></td></tr><tr><td id="L3053" class="css-a4x74f"><span>3053</span></td><td id="LC3053" class="css-1dcdqdg"><code>                enumerable: <span class="code-literal">false</span>,
</code></td></tr><tr><td id="L3054" class="css-a4x74f"><span>3054</span></td><td id="LC3054" class="css-1dcdqdg"><code>                configurable: <span class="code-literal">true</span>
</code></td></tr><tr><td id="L3055" class="css-a4x74f"><span>3055</span></td><td id="LC3055" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L3056" class="css-a4x74f"><span>3056</span></td><td id="LC3056" class="css-1dcdqdg"><code>            CollectionSchema.prototype.setIndex = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index, key</span>) </span>{
</code></td></tr><tr><td id="L3057" class="css-a4x74f"><span>3057</span></td><td id="LC3057" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes.set(index, key);
</code></td></tr><tr><td id="L3058" class="css-a4x74f"><span>3058</span></td><td id="LC3058" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3059" class="css-a4x74f"><span>3059</span></td><td id="LC3059" class="css-1dcdqdg"><code>            CollectionSchema.prototype.getIndex = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index</span>) </span>{
</code></td></tr><tr><td id="L3060" class="css-a4x74f"><span>3060</span></td><td id="LC3060" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$indexes.get(index);
</code></td></tr><tr><td id="L3061" class="css-a4x74f"><span>3061</span></td><td id="LC3061" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3062" class="css-a4x74f"><span>3062</span></td><td id="LC3062" class="css-1dcdqdg"><code>            CollectionSchema.prototype.getByIndex = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index</span>) </span>{
</code></td></tr><tr><td id="L3063" class="css-a4x74f"><span>3063</span></td><td id="LC3063" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.get(<span class="code-keyword">this</span>.$indexes.get(index));
</code></td></tr><tr><td id="L3064" class="css-a4x74f"><span>3064</span></td><td id="LC3064" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3065" class="css-a4x74f"><span>3065</span></td><td id="LC3065" class="css-1dcdqdg"><code>            CollectionSchema.prototype.deleteByIndex = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index</span>) </span>{
</code></td></tr><tr><td id="L3066" class="css-a4x74f"><span>3066</span></td><td id="LC3066" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> key = <span class="code-keyword">this</span>.$indexes.get(index);
</code></td></tr><tr><td id="L3067" class="css-a4x74f"><span>3067</span></td><td id="LC3067" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$items.delete(key);
</code></td></tr><tr><td id="L3068" class="css-a4x74f"><span>3068</span></td><td id="LC3068" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes.delete(index);
</code></td></tr><tr><td id="L3069" class="css-a4x74f"><span>3069</span></td><td id="LC3069" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3070" class="css-a4x74f"><span>3070</span></td><td id="LC3070" class="css-1dcdqdg"><code>            CollectionSchema.prototype.toArray = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L3071" class="css-a4x74f"><span>3071</span></td><td id="LC3071" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values());
</code></td></tr><tr><td id="L3072" class="css-a4x74f"><span>3072</span></td><td id="LC3072" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3073" class="css-a4x74f"><span>3073</span></td><td id="LC3073" class="css-1dcdqdg"><code>            CollectionSchema.prototype.toJSON = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L3074" class="css-a4x74f"><span>3074</span></td><td id="LC3074" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> values = [];
</code></td></tr><tr><td id="L3075" class="css-a4x74f"><span>3075</span></td><td id="LC3075" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">value, key</span>) </span>{
</code></td></tr><tr><td id="L3076" class="css-a4x74f"><span>3076</span></td><td id="LC3076" class="css-1dcdqdg"><code>                    values.push((<span class="code-keyword">typeof</span> (value[<span class="code-string">'toJSON'</span>]) === <span class="code-string">"function"</span>)
</code></td></tr><tr><td id="L3077" class="css-a4x74f"><span>3077</span></td><td id="LC3077" class="css-1dcdqdg"><code>                        ? value[<span class="code-string">'toJSON'</span>]()
</code></td></tr><tr><td id="L3078" class="css-a4x74f"><span>3078</span></td><td id="LC3078" class="css-1dcdqdg"><code>                        : value);
</code></td></tr><tr><td id="L3079" class="css-a4x74f"><span>3079</span></td><td id="LC3079" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L3080" class="css-a4x74f"><span>3080</span></td><td id="LC3080" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> values;
</code></td></tr><tr><td id="L3081" class="css-a4x74f"><span>3081</span></td><td id="LC3081" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3082" class="css-a4x74f"><span>3082</span></td><td id="LC3082" class="css-1dcdqdg"><code>            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3083" class="css-a4x74f"><span>3083</span></td><td id="LC3083" class="css-1dcdqdg"><code>            <span class="code-comment">// Decoding utilities</span>
</code></td></tr><tr><td id="L3084" class="css-a4x74f"><span>3084</span></td><td id="LC3084" class="css-1dcdqdg"><code>            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3085" class="css-a4x74f"><span>3085</span></td><td id="LC3085" class="css-1dcdqdg"><code>            CollectionSchema.prototype.clone = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">isDecoding</span>) </span>{
</code></td></tr><tr><td id="L3086" class="css-a4x74f"><span>3086</span></td><td id="LC3086" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> cloned;
</code></td></tr><tr><td id="L3087" class="css-a4x74f"><span>3087</span></td><td id="LC3087" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (isDecoding) {
</code></td></tr><tr><td id="L3088" class="css-a4x74f"><span>3088</span></td><td id="LC3088" class="css-1dcdqdg"><code>                    <span class="code-comment">// client-side</span>
</code></td></tr><tr><td id="L3089" class="css-a4x74f"><span>3089</span></td><td id="LC3089" class="css-1dcdqdg"><code>                    cloned = <span class="code-built_in">Object</span>.assign(<span class="code-keyword">new</span> CollectionSchema(), <span class="code-keyword">this</span>);
</code></td></tr><tr><td id="L3090" class="css-a4x74f"><span>3090</span></td><td id="LC3090" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3091" class="css-a4x74f"><span>3091</span></td><td id="LC3091" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L3092" class="css-a4x74f"><span>3092</span></td><td id="LC3092" class="css-1dcdqdg"><code>                    <span class="code-comment">// server-side</span>
</code></td></tr><tr><td id="L3093" class="css-a4x74f"><span>3093</span></td><td id="LC3093" class="css-1dcdqdg"><code>                    cloned = <span class="code-keyword">new</span> CollectionSchema();
</code></td></tr><tr><td id="L3094" class="css-a4x74f"><span>3094</span></td><td id="LC3094" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">value</span>) </span>{
</code></td></tr><tr><td id="L3095" class="css-a4x74f"><span>3095</span></td><td id="LC3095" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (value[<span class="code-string">'$changes'</span>]) {
</code></td></tr><tr><td id="L3096" class="css-a4x74f"><span>3096</span></td><td id="LC3096" class="css-1dcdqdg"><code>                            cloned.add(value[<span class="code-string">'clone'</span>]());
</code></td></tr><tr><td id="L3097" class="css-a4x74f"><span>3097</span></td><td id="LC3097" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3098" class="css-a4x74f"><span>3098</span></td><td id="LC3098" class="css-1dcdqdg"><code>                        <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L3099" class="css-a4x74f"><span>3099</span></td><td id="LC3099" class="css-1dcdqdg"><code>                            cloned.add(value);
</code></td></tr><tr><td id="L3100" class="css-a4x74f"><span>3100</span></td><td id="LC3100" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3101" class="css-a4x74f"><span>3101</span></td><td id="LC3101" class="css-1dcdqdg"><code>                    });
</code></td></tr><tr><td id="L3102" class="css-a4x74f"><span>3102</span></td><td id="LC3102" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3103" class="css-a4x74f"><span>3103</span></td><td id="LC3103" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> cloned;
</code></td></tr><tr><td id="L3104" class="css-a4x74f"><span>3104</span></td><td id="LC3104" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3105" class="css-a4x74f"><span>3105</span></td><td id="LC3105" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> CollectionSchema;
</code></td></tr><tr><td id="L3106" class="css-a4x74f"><span>3106</span></td><td id="LC3106" class="css-1dcdqdg"><code>        }());
</code></td></tr><tr><td id="L3107" class="css-a4x74f"><span>3107</span></td><td id="LC3107" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L3108" class="css-a4x74f"><span>3108</span></td><td id="LC3108" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> SetSchema = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L3109" class="css-a4x74f"><span>3109</span></td><td id="LC3109" class="css-1dcdqdg"><code>            <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">SetSchema</span>(<span class="code-params">initialValues</span>) </span>{
</code></td></tr><tr><td id="L3110" class="css-a4x74f"><span>3110</span></td><td id="LC3110" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L3111" class="css-a4x74f"><span>3111</span></td><td id="LC3111" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes = <span class="code-keyword">new</span> ChangeTree(<span class="code-keyword">this</span>);
</code></td></tr><tr><td id="L3112" class="css-a4x74f"><span>3112</span></td><td id="LC3112" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$items = <span class="code-keyword">new</span> <span class="code-built_in">Map</span>();
</code></td></tr><tr><td id="L3113" class="css-a4x74f"><span>3113</span></td><td id="LC3113" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes = <span class="code-keyword">new</span> <span class="code-built_in">Map</span>();
</code></td></tr><tr><td id="L3114" class="css-a4x74f"><span>3114</span></td><td id="LC3114" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$refId = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L3115" class="css-a4x74f"><span>3115</span></td><td id="LC3115" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (initialValues) {
</code></td></tr><tr><td id="L3116" class="css-a4x74f"><span>3116</span></td><td id="LC3116" class="css-1dcdqdg"><code>                    initialValues.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">v</span>) </span>{ <span class="code-keyword">return</span> _this.add(v); });
</code></td></tr><tr><td id="L3117" class="css-a4x74f"><span>3117</span></td><td id="LC3117" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3118" class="css-a4x74f"><span>3118</span></td><td id="LC3118" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L3119" class="css-a4x74f"><span>3119</span></td><td id="LC3119" class="css-1dcdqdg"><code>            SetSchema.prototype.onAdd = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback, triggerAll</span>) </span>{
</code></td></tr><tr><td id="L3120" class="css-a4x74f"><span>3120</span></td><td id="LC3120" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (triggerAll === <span class="code-keyword">void</span> <span class="code-number">0</span>) { triggerAll = <span class="code-literal">true</span>; }
</code></td></tr><tr><td id="L3121" class="css-a4x74f"><span>3121</span></td><td id="LC3121" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> addCallback((<span class="code-keyword">this</span>.$callbacks || (<span class="code-keyword">this</span>.$callbacks = [])), exports.OPERATION.ADD, callback, (triggerAll)
</code></td></tr><tr><td id="L3122" class="css-a4x74f"><span>3122</span></td><td id="LC3122" class="css-1dcdqdg"><code>                    ? <span class="code-keyword">this</span>.$items
</code></td></tr><tr><td id="L3123" class="css-a4x74f"><span>3123</span></td><td id="LC3123" class="css-1dcdqdg"><code>                    : <span class="code-literal">undefined</span>);
</code></td></tr><tr><td id="L3124" class="css-a4x74f"><span>3124</span></td><td id="LC3124" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3125" class="css-a4x74f"><span>3125</span></td><td id="LC3125" class="css-1dcdqdg"><code>            SetSchema.prototype.onRemove = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback</span>) </span>{ <span class="code-keyword">return</span> addCallback(<span class="code-keyword">this</span>.$callbacks || (<span class="code-keyword">this</span>.$callbacks = []), exports.OPERATION.DELETE, callback); };
</code></td></tr><tr><td id="L3126" class="css-a4x74f"><span>3126</span></td><td id="LC3126" class="css-1dcdqdg"><code>            SetSchema.prototype.onChange = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback</span>) </span>{ <span class="code-keyword">return</span> addCallback(<span class="code-keyword">this</span>.$callbacks || (<span class="code-keyword">this</span>.$callbacks = []), exports.OPERATION.REPLACE, callback); };
</code></td></tr><tr><td id="L3127" class="css-a4x74f"><span>3127</span></td><td id="LC3127" class="css-1dcdqdg"><code>            SetSchema.is = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">type</span>) </span>{
</code></td></tr><tr><td id="L3128" class="css-a4x74f"><span>3128</span></td><td id="LC3128" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> type[<span class="code-string">'set'</span>] !== <span class="code-literal">undefined</span>;
</code></td></tr><tr><td id="L3129" class="css-a4x74f"><span>3129</span></td><td id="LC3129" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3130" class="css-a4x74f"><span>3130</span></td><td id="LC3130" class="css-1dcdqdg"><code>            SetSchema.prototype.add = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">value</span>) </span>{
</code></td></tr><tr><td id="L3131" class="css-a4x74f"><span>3131</span></td><td id="LC3131" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _a, _b;
</code></td></tr><tr><td id="L3132" class="css-a4x74f"><span>3132</span></td><td id="LC3132" class="css-1dcdqdg"><code>                <span class="code-comment">// immediatelly return false if value already added.</span>
</code></td></tr><tr><td id="L3133" class="css-a4x74f"><span>3133</span></td><td id="LC3133" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.has(value)) {
</code></td></tr><tr><td id="L3134" class="css-a4x74f"><span>3134</span></td><td id="LC3134" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-literal">false</span>;
</code></td></tr><tr><td id="L3135" class="css-a4x74f"><span>3135</span></td><td id="LC3135" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3136" class="css-a4x74f"><span>3136</span></td><td id="LC3136" class="css-1dcdqdg"><code>                <span class="code-comment">// set "index" for reference.</span>
</code></td></tr><tr><td id="L3137" class="css-a4x74f"><span>3137</span></td><td id="LC3137" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> index = <span class="code-keyword">this</span>.$refId++;
</code></td></tr><tr><td id="L3138" class="css-a4x74f"><span>3138</span></td><td id="LC3138" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> ((value[<span class="code-string">'$changes'</span>]) !== <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L3139" class="css-a4x74f"><span>3139</span></td><td id="LC3139" class="css-1dcdqdg"><code>                    value[<span class="code-string">'$changes'</span>].setParent(<span class="code-keyword">this</span>, <span class="code-keyword">this</span>.$changes.root, index);
</code></td></tr><tr><td id="L3140" class="css-a4x74f"><span>3140</span></td><td id="LC3140" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3141" class="css-a4x74f"><span>3141</span></td><td id="LC3141" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> operation = (_b = (_a = <span class="code-keyword">this</span>.$changes.indexes[index]) === <span class="code-literal">null</span> || _a === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _a.op) !== <span class="code-literal">null</span> &amp;&amp; _b !== <span class="code-keyword">void</span> <span class="code-number">0</span> ? _b : exports.OPERATION.ADD;
</code></td></tr><tr><td id="L3142" class="css-a4x74f"><span>3142</span></td><td id="LC3142" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.indexes[index] = index;
</code></td></tr><tr><td id="L3143" class="css-a4x74f"><span>3143</span></td><td id="LC3143" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes.set(index, index);
</code></td></tr><tr><td id="L3144" class="css-a4x74f"><span>3144</span></td><td id="LC3144" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$items.set(index, value);
</code></td></tr><tr><td id="L3145" class="css-a4x74f"><span>3145</span></td><td id="LC3145" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.change(index, operation);
</code></td></tr><tr><td id="L3146" class="css-a4x74f"><span>3146</span></td><td id="LC3146" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> index;
</code></td></tr><tr><td id="L3147" class="css-a4x74f"><span>3147</span></td><td id="LC3147" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3148" class="css-a4x74f"><span>3148</span></td><td id="LC3148" class="css-1dcdqdg"><code>            SetSchema.prototype.entries = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L3149" class="css-a4x74f"><span>3149</span></td><td id="LC3149" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.entries();
</code></td></tr><tr><td id="L3150" class="css-a4x74f"><span>3150</span></td><td id="LC3150" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3151" class="css-a4x74f"><span>3151</span></td><td id="LC3151" class="css-1dcdqdg"><code>            SetSchema.prototype.delete = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">item</span>) </span>{
</code></td></tr><tr><td id="L3152" class="css-a4x74f"><span>3152</span></td><td id="LC3152" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> entries = <span class="code-keyword">this</span>.$items.entries();
</code></td></tr><tr><td id="L3153" class="css-a4x74f"><span>3153</span></td><td id="LC3153" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> index;
</code></td></tr><tr><td id="L3154" class="css-a4x74f"><span>3154</span></td><td id="LC3154" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> entry;
</code></td></tr><tr><td id="L3155" class="css-a4x74f"><span>3155</span></td><td id="LC3155" class="css-1dcdqdg"><code>                <span class="code-keyword">while</span> (entry = entries.next()) {
</code></td></tr><tr><td id="L3156" class="css-a4x74f"><span>3156</span></td><td id="LC3156" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (entry.done) {
</code></td></tr><tr><td id="L3157" class="css-a4x74f"><span>3157</span></td><td id="LC3157" class="css-1dcdqdg"><code>                        <span class="code-keyword">break</span>;
</code></td></tr><tr><td id="L3158" class="css-a4x74f"><span>3158</span></td><td id="LC3158" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3159" class="css-a4x74f"><span>3159</span></td><td id="LC3159" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (item === entry.value[<span class="code-number">1</span>]) {
</code></td></tr><tr><td id="L3160" class="css-a4x74f"><span>3160</span></td><td id="LC3160" class="css-1dcdqdg"><code>                        index = entry.value[<span class="code-number">0</span>];
</code></td></tr><tr><td id="L3161" class="css-a4x74f"><span>3161</span></td><td id="LC3161" class="css-1dcdqdg"><code>                        <span class="code-keyword">break</span>;
</code></td></tr><tr><td id="L3162" class="css-a4x74f"><span>3162</span></td><td id="LC3162" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3163" class="css-a4x74f"><span>3163</span></td><td id="LC3163" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3164" class="css-a4x74f"><span>3164</span></td><td id="LC3164" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (index === <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L3165" class="css-a4x74f"><span>3165</span></td><td id="LC3165" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-literal">false</span>;
</code></td></tr><tr><td id="L3166" class="css-a4x74f"><span>3166</span></td><td id="LC3166" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3167" class="css-a4x74f"><span>3167</span></td><td id="LC3167" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.delete(index);
</code></td></tr><tr><td id="L3168" class="css-a4x74f"><span>3168</span></td><td id="LC3168" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes.delete(index);
</code></td></tr><tr><td id="L3169" class="css-a4x74f"><span>3169</span></td><td id="LC3169" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.delete(index);
</code></td></tr><tr><td id="L3170" class="css-a4x74f"><span>3170</span></td><td id="LC3170" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3171" class="css-a4x74f"><span>3171</span></td><td id="LC3171" class="css-1dcdqdg"><code>            SetSchema.prototype.clear = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">changes</span>) </span>{
</code></td></tr><tr><td id="L3172" class="css-a4x74f"><span>3172</span></td><td id="LC3172" class="css-1dcdqdg"><code>                <span class="code-comment">// discard previous operations.</span>
</code></td></tr><tr><td id="L3173" class="css-a4x74f"><span>3173</span></td><td id="LC3173" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.discard(<span class="code-literal">true</span>, <span class="code-literal">true</span>);
</code></td></tr><tr><td id="L3174" class="css-a4x74f"><span>3174</span></td><td id="LC3174" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.indexes = {};
</code></td></tr><tr><td id="L3175" class="css-a4x74f"><span>3175</span></td><td id="LC3175" class="css-1dcdqdg"><code>                <span class="code-comment">// clear previous indexes</span>
</code></td></tr><tr><td id="L3176" class="css-a4x74f"><span>3176</span></td><td id="LC3176" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes.clear();
</code></td></tr><tr><td id="L3177" class="css-a4x74f"><span>3177</span></td><td id="LC3177" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3178" class="css-a4x74f"><span>3178</span></td><td id="LC3178" class="css-1dcdqdg"><code>                <span class="code-comment">// When decoding:</span>
</code></td></tr><tr><td id="L3179" class="css-a4x74f"><span>3179</span></td><td id="LC3179" class="css-1dcdqdg"><code>                <span class="code-comment">// - enqueue items for DELETE callback.</span>
</code></td></tr><tr><td id="L3180" class="css-a4x74f"><span>3180</span></td><td id="LC3180" class="css-1dcdqdg"><code>                <span class="code-comment">// - flag child items for garbage collection.</span>
</code></td></tr><tr><td id="L3181" class="css-a4x74f"><span>3181</span></td><td id="LC3181" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3182" class="css-a4x74f"><span>3182</span></td><td id="LC3182" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (changes) {
</code></td></tr><tr><td id="L3183" class="css-a4x74f"><span>3183</span></td><td id="LC3183" class="css-1dcdqdg"><code>                    removeChildRefs.call(<span class="code-keyword">this</span>, changes);
</code></td></tr><tr><td id="L3184" class="css-a4x74f"><span>3184</span></td><td id="LC3184" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3185" class="css-a4x74f"><span>3185</span></td><td id="LC3185" class="css-1dcdqdg"><code>                <span class="code-comment">// clear items</span>
</code></td></tr><tr><td id="L3186" class="css-a4x74f"><span>3186</span></td><td id="LC3186" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$items.clear();
</code></td></tr><tr><td id="L3187" class="css-a4x74f"><span>3187</span></td><td id="LC3187" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.operation({ <span class="code-attr">index</span>: <span class="code-number">0</span>, <span class="code-attr">op</span>: exports.OPERATION.CLEAR });
</code></td></tr><tr><td id="L3188" class="css-a4x74f"><span>3188</span></td><td id="LC3188" class="css-1dcdqdg"><code>                <span class="code-comment">// touch all structures until reach root</span>
</code></td></tr><tr><td id="L3189" class="css-a4x74f"><span>3189</span></td><td id="LC3189" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.touchParents();
</code></td></tr><tr><td id="L3190" class="css-a4x74f"><span>3190</span></td><td id="LC3190" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3191" class="css-a4x74f"><span>3191</span></td><td id="LC3191" class="css-1dcdqdg"><code>            SetSchema.prototype.has = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">value</span>) </span>{
</code></td></tr><tr><td id="L3192" class="css-a4x74f"><span>3192</span></td><td id="LC3192" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> values = <span class="code-keyword">this</span>.$items.values();
</code></td></tr><tr><td id="L3193" class="css-a4x74f"><span>3193</span></td><td id="LC3193" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> has = <span class="code-literal">false</span>;
</code></td></tr><tr><td id="L3194" class="css-a4x74f"><span>3194</span></td><td id="LC3194" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> entry;
</code></td></tr><tr><td id="L3195" class="css-a4x74f"><span>3195</span></td><td id="LC3195" class="css-1dcdqdg"><code>                <span class="code-keyword">while</span> (entry = values.next()) {
</code></td></tr><tr><td id="L3196" class="css-a4x74f"><span>3196</span></td><td id="LC3196" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (entry.done) {
</code></td></tr><tr><td id="L3197" class="css-a4x74f"><span>3197</span></td><td id="LC3197" class="css-1dcdqdg"><code>                        <span class="code-keyword">break</span>;
</code></td></tr><tr><td id="L3198" class="css-a4x74f"><span>3198</span></td><td id="LC3198" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3199" class="css-a4x74f"><span>3199</span></td><td id="LC3199" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (value === entry.value) {
</code></td></tr><tr><td id="L3200" class="css-a4x74f"><span>3200</span></td><td id="LC3200" class="css-1dcdqdg"><code>                        has = <span class="code-literal">true</span>;
</code></td></tr><tr><td id="L3201" class="css-a4x74f"><span>3201</span></td><td id="LC3201" class="css-1dcdqdg"><code>                        <span class="code-keyword">break</span>;
</code></td></tr><tr><td id="L3202" class="css-a4x74f"><span>3202</span></td><td id="LC3202" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3203" class="css-a4x74f"><span>3203</span></td><td id="LC3203" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3204" class="css-a4x74f"><span>3204</span></td><td id="LC3204" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> has;
</code></td></tr><tr><td id="L3205" class="css-a4x74f"><span>3205</span></td><td id="LC3205" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3206" class="css-a4x74f"><span>3206</span></td><td id="LC3206" class="css-1dcdqdg"><code>            SetSchema.prototype.forEach = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callbackfn</span>) </span>{
</code></td></tr><tr><td id="L3207" class="css-a4x74f"><span>3207</span></td><td id="LC3207" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L3208" class="css-a4x74f"><span>3208</span></td><td id="LC3208" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$items.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">value, key, _</span>) </span>{ <span class="code-keyword">return</span> callbackfn(value, key, _this); });
</code></td></tr><tr><td id="L3209" class="css-a4x74f"><span>3209</span></td><td id="LC3209" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3210" class="css-a4x74f"><span>3210</span></td><td id="LC3210" class="css-1dcdqdg"><code>            SetSchema.prototype.values = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L3211" class="css-a4x74f"><span>3211</span></td><td id="LC3211" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.values();
</code></td></tr><tr><td id="L3212" class="css-a4x74f"><span>3212</span></td><td id="LC3212" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3213" class="css-a4x74f"><span>3213</span></td><td id="LC3213" class="css-1dcdqdg"><code>            <span class="code-built_in">Object</span>.defineProperty(SetSchema.prototype, <span class="code-string">"size"</span>, {
</code></td></tr><tr><td id="L3214" class="css-a4x74f"><span>3214</span></td><td id="LC3214" class="css-1dcdqdg"><code>                <span class="code-keyword">get</span>: function () {
</code></td></tr><tr><td id="L3215" class="css-a4x74f"><span>3215</span></td><td id="LC3215" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.size;
</code></td></tr><tr><td id="L3216" class="css-a4x74f"><span>3216</span></td><td id="LC3216" class="css-1dcdqdg"><code>                },
</code></td></tr><tr><td id="L3217" class="css-a4x74f"><span>3217</span></td><td id="LC3217" class="css-1dcdqdg"><code>                enumerable: <span class="code-literal">false</span>,
</code></td></tr><tr><td id="L3218" class="css-a4x74f"><span>3218</span></td><td id="LC3218" class="css-1dcdqdg"><code>                configurable: <span class="code-literal">true</span>
</code></td></tr><tr><td id="L3219" class="css-a4x74f"><span>3219</span></td><td id="LC3219" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L3220" class="css-a4x74f"><span>3220</span></td><td id="LC3220" class="css-1dcdqdg"><code>            SetSchema.prototype.setIndex = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index, key</span>) </span>{
</code></td></tr><tr><td id="L3221" class="css-a4x74f"><span>3221</span></td><td id="LC3221" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes.set(index, key);
</code></td></tr><tr><td id="L3222" class="css-a4x74f"><span>3222</span></td><td id="LC3222" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3223" class="css-a4x74f"><span>3223</span></td><td id="LC3223" class="css-1dcdqdg"><code>            SetSchema.prototype.getIndex = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index</span>) </span>{
</code></td></tr><tr><td id="L3224" class="css-a4x74f"><span>3224</span></td><td id="LC3224" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$indexes.get(index);
</code></td></tr><tr><td id="L3225" class="css-a4x74f"><span>3225</span></td><td id="LC3225" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3226" class="css-a4x74f"><span>3226</span></td><td id="LC3226" class="css-1dcdqdg"><code>            SetSchema.prototype.getByIndex = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index</span>) </span>{
</code></td></tr><tr><td id="L3227" class="css-a4x74f"><span>3227</span></td><td id="LC3227" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.$items.get(<span class="code-keyword">this</span>.$indexes.get(index));
</code></td></tr><tr><td id="L3228" class="css-a4x74f"><span>3228</span></td><td id="LC3228" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3229" class="css-a4x74f"><span>3229</span></td><td id="LC3229" class="css-1dcdqdg"><code>            SetSchema.prototype.deleteByIndex = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index</span>) </span>{
</code></td></tr><tr><td id="L3230" class="css-a4x74f"><span>3230</span></td><td id="LC3230" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> key = <span class="code-keyword">this</span>.$indexes.get(index);
</code></td></tr><tr><td id="L3231" class="css-a4x74f"><span>3231</span></td><td id="LC3231" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$items.delete(key);
</code></td></tr><tr><td id="L3232" class="css-a4x74f"><span>3232</span></td><td id="LC3232" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$indexes.delete(index);
</code></td></tr><tr><td id="L3233" class="css-a4x74f"><span>3233</span></td><td id="LC3233" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3234" class="css-a4x74f"><span>3234</span></td><td id="LC3234" class="css-1dcdqdg"><code>            SetSchema.prototype.toArray = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L3235" class="css-a4x74f"><span>3235</span></td><td id="LC3235" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-built_in">Array</span>.from(<span class="code-keyword">this</span>.$items.values());
</code></td></tr><tr><td id="L3236" class="css-a4x74f"><span>3236</span></td><td id="LC3236" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3237" class="css-a4x74f"><span>3237</span></td><td id="LC3237" class="css-1dcdqdg"><code>            SetSchema.prototype.toJSON = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L3238" class="css-a4x74f"><span>3238</span></td><td id="LC3238" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> values = [];
</code></td></tr><tr><td id="L3239" class="css-a4x74f"><span>3239</span></td><td id="LC3239" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">value, key</span>) </span>{
</code></td></tr><tr><td id="L3240" class="css-a4x74f"><span>3240</span></td><td id="LC3240" class="css-1dcdqdg"><code>                    values.push((<span class="code-keyword">typeof</span> (value[<span class="code-string">'toJSON'</span>]) === <span class="code-string">"function"</span>)
</code></td></tr><tr><td id="L3241" class="css-a4x74f"><span>3241</span></td><td id="LC3241" class="css-1dcdqdg"><code>                        ? value[<span class="code-string">'toJSON'</span>]()
</code></td></tr><tr><td id="L3242" class="css-a4x74f"><span>3242</span></td><td id="LC3242" class="css-1dcdqdg"><code>                        : value);
</code></td></tr><tr><td id="L3243" class="css-a4x74f"><span>3243</span></td><td id="LC3243" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L3244" class="css-a4x74f"><span>3244</span></td><td id="LC3244" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> values;
</code></td></tr><tr><td id="L3245" class="css-a4x74f"><span>3245</span></td><td id="LC3245" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3246" class="css-a4x74f"><span>3246</span></td><td id="LC3246" class="css-1dcdqdg"><code>            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3247" class="css-a4x74f"><span>3247</span></td><td id="LC3247" class="css-1dcdqdg"><code>            <span class="code-comment">// Decoding utilities</span>
</code></td></tr><tr><td id="L3248" class="css-a4x74f"><span>3248</span></td><td id="LC3248" class="css-1dcdqdg"><code>            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3249" class="css-a4x74f"><span>3249</span></td><td id="LC3249" class="css-1dcdqdg"><code>            SetSchema.prototype.clone = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">isDecoding</span>) </span>{
</code></td></tr><tr><td id="L3250" class="css-a4x74f"><span>3250</span></td><td id="LC3250" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> cloned;
</code></td></tr><tr><td id="L3251" class="css-a4x74f"><span>3251</span></td><td id="LC3251" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (isDecoding) {
</code></td></tr><tr><td id="L3252" class="css-a4x74f"><span>3252</span></td><td id="LC3252" class="css-1dcdqdg"><code>                    <span class="code-comment">// client-side</span>
</code></td></tr><tr><td id="L3253" class="css-a4x74f"><span>3253</span></td><td id="LC3253" class="css-1dcdqdg"><code>                    cloned = <span class="code-built_in">Object</span>.assign(<span class="code-keyword">new</span> SetSchema(), <span class="code-keyword">this</span>);
</code></td></tr><tr><td id="L3254" class="css-a4x74f"><span>3254</span></td><td id="LC3254" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3255" class="css-a4x74f"><span>3255</span></td><td id="LC3255" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L3256" class="css-a4x74f"><span>3256</span></td><td id="LC3256" class="css-1dcdqdg"><code>                    <span class="code-comment">// server-side</span>
</code></td></tr><tr><td id="L3257" class="css-a4x74f"><span>3257</span></td><td id="LC3257" class="css-1dcdqdg"><code>                    cloned = <span class="code-keyword">new</span> SetSchema();
</code></td></tr><tr><td id="L3258" class="css-a4x74f"><span>3258</span></td><td id="LC3258" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">value</span>) </span>{
</code></td></tr><tr><td id="L3259" class="css-a4x74f"><span>3259</span></td><td id="LC3259" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (value[<span class="code-string">'$changes'</span>]) {
</code></td></tr><tr><td id="L3260" class="css-a4x74f"><span>3260</span></td><td id="LC3260" class="css-1dcdqdg"><code>                            cloned.add(value[<span class="code-string">'clone'</span>]());
</code></td></tr><tr><td id="L3261" class="css-a4x74f"><span>3261</span></td><td id="LC3261" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3262" class="css-a4x74f"><span>3262</span></td><td id="LC3262" class="css-1dcdqdg"><code>                        <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L3263" class="css-a4x74f"><span>3263</span></td><td id="LC3263" class="css-1dcdqdg"><code>                            cloned.add(value);
</code></td></tr><tr><td id="L3264" class="css-a4x74f"><span>3264</span></td><td id="LC3264" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3265" class="css-a4x74f"><span>3265</span></td><td id="LC3265" class="css-1dcdqdg"><code>                    });
</code></td></tr><tr><td id="L3266" class="css-a4x74f"><span>3266</span></td><td id="LC3266" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3267" class="css-a4x74f"><span>3267</span></td><td id="LC3267" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> cloned;
</code></td></tr><tr><td id="L3268" class="css-a4x74f"><span>3268</span></td><td id="LC3268" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3269" class="css-a4x74f"><span>3269</span></td><td id="LC3269" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> SetSchema;
</code></td></tr><tr><td id="L3270" class="css-a4x74f"><span>3270</span></td><td id="LC3270" class="css-1dcdqdg"><code>        }());
</code></td></tr><tr><td id="L3271" class="css-a4x74f"><span>3271</span></td><td id="LC3271" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L3272" class="css-a4x74f"><span>3272</span></td><td id="LC3272" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> ClientState = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L3273" class="css-a4x74f"><span>3273</span></td><td id="LC3273" class="css-1dcdqdg"><code>            <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">ClientState</span>(<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L3274" class="css-a4x74f"><span>3274</span></td><td id="LC3274" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.refIds = <span class="code-keyword">new</span> <span class="code-built_in">WeakSet</span>();
</code></td></tr><tr><td id="L3275" class="css-a4x74f"><span>3275</span></td><td id="LC3275" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.containerIndexes = <span class="code-keyword">new</span> <span class="code-built_in">WeakMap</span>();
</code></td></tr><tr><td id="L3276" class="css-a4x74f"><span>3276</span></td><td id="LC3276" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L3277" class="css-a4x74f"><span>3277</span></td><td id="LC3277" class="css-1dcdqdg"><code>            <span class="code-comment">// containerIndexes = new Map&lt;ChangeTree, Set&lt;number&gt;&gt;();</span>
</code></td></tr><tr><td id="L3278" class="css-a4x74f"><span>3278</span></td><td id="LC3278" class="css-1dcdqdg"><code>            ClientState.prototype.addRefId = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">changeTree</span>) </span>{
</code></td></tr><tr><td id="L3279" class="css-a4x74f"><span>3279</span></td><td id="LC3279" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (!<span class="code-keyword">this</span>.refIds.has(changeTree)) {
</code></td></tr><tr><td id="L3280" class="css-a4x74f"><span>3280</span></td><td id="LC3280" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.refIds.add(changeTree);
</code></td></tr><tr><td id="L3281" class="css-a4x74f"><span>3281</span></td><td id="LC3281" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.containerIndexes.set(changeTree, <span class="code-keyword">new</span> <span class="code-built_in">Set</span>());
</code></td></tr><tr><td id="L3282" class="css-a4x74f"><span>3282</span></td><td id="LC3282" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3283" class="css-a4x74f"><span>3283</span></td><td id="LC3283" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3284" class="css-a4x74f"><span>3284</span></td><td id="LC3284" class="css-1dcdqdg"><code>            ClientState.get = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">client</span>) </span>{
</code></td></tr><tr><td id="L3285" class="css-a4x74f"><span>3285</span></td><td id="LC3285" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (client.$filterState === <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L3286" class="css-a4x74f"><span>3286</span></td><td id="LC3286" class="css-1dcdqdg"><code>                    client.$filterState = <span class="code-keyword">new</span> ClientState();
</code></td></tr><tr><td id="L3287" class="css-a4x74f"><span>3287</span></td><td id="LC3287" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3288" class="css-a4x74f"><span>3288</span></td><td id="LC3288" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> client.$filterState;
</code></td></tr><tr><td id="L3289" class="css-a4x74f"><span>3289</span></td><td id="LC3289" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3290" class="css-a4x74f"><span>3290</span></td><td id="LC3290" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> ClientState;
</code></td></tr><tr><td id="L3291" class="css-a4x74f"><span>3291</span></td><td id="LC3291" class="css-1dcdqdg"><code>        }());
</code></td></tr><tr><td id="L3292" class="css-a4x74f"><span>3292</span></td><td id="LC3292" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L3293" class="css-a4x74f"><span>3293</span></td><td id="LC3293" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> ReferenceTracker = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L3294" class="css-a4x74f"><span>3294</span></td><td id="LC3294" class="css-1dcdqdg"><code>            <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">ReferenceTracker</span>(<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L3295" class="css-a4x74f"><span>3295</span></td><td id="LC3295" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3296" class="css-a4x74f"><span>3296</span></td><td id="LC3296" class="css-1dcdqdg"><code>                <span class="code-comment">// Relation of refId =&gt; Schema structure</span>
</code></td></tr><tr><td id="L3297" class="css-a4x74f"><span>3297</span></td><td id="LC3297" class="css-1dcdqdg"><code>                <span class="code-comment">// For direct access of structures during decoding time.</span>
</code></td></tr><tr><td id="L3298" class="css-a4x74f"><span>3298</span></td><td id="LC3298" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3299" class="css-a4x74f"><span>3299</span></td><td id="LC3299" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.refs = <span class="code-keyword">new</span> <span class="code-built_in">Map</span>();
</code></td></tr><tr><td id="L3300" class="css-a4x74f"><span>3300</span></td><td id="LC3300" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.refCounts = {};
</code></td></tr><tr><td id="L3301" class="css-a4x74f"><span>3301</span></td><td id="LC3301" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.deletedRefs = <span class="code-keyword">new</span> <span class="code-built_in">Set</span>();
</code></td></tr><tr><td id="L3302" class="css-a4x74f"><span>3302</span></td><td id="LC3302" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.nextUniqueId = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L3303" class="css-a4x74f"><span>3303</span></td><td id="LC3303" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L3304" class="css-a4x74f"><span>3304</span></td><td id="LC3304" class="css-1dcdqdg"><code>            ReferenceTracker.prototype.getNextUniqueId = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L3305" class="css-a4x74f"><span>3305</span></td><td id="LC3305" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.nextUniqueId++;
</code></td></tr><tr><td id="L3306" class="css-a4x74f"><span>3306</span></td><td id="LC3306" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3307" class="css-a4x74f"><span>3307</span></td><td id="LC3307" class="css-1dcdqdg"><code>            <span class="code-comment">// for decoding</span>
</code></td></tr><tr><td id="L3308" class="css-a4x74f"><span>3308</span></td><td id="LC3308" class="css-1dcdqdg"><code>            ReferenceTracker.prototype.addRef = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">refId, ref, incrementCount</span>) </span>{
</code></td></tr><tr><td id="L3309" class="css-a4x74f"><span>3309</span></td><td id="LC3309" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (incrementCount === <span class="code-keyword">void</span> <span class="code-number">0</span>) { incrementCount = <span class="code-literal">true</span>; }
</code></td></tr><tr><td id="L3310" class="css-a4x74f"><span>3310</span></td><td id="LC3310" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.refs.set(refId, ref);
</code></td></tr><tr><td id="L3311" class="css-a4x74f"><span>3311</span></td><td id="LC3311" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (incrementCount) {
</code></td></tr><tr><td id="L3312" class="css-a4x74f"><span>3312</span></td><td id="LC3312" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.refCounts[refId] = (<span class="code-keyword">this</span>.refCounts[refId] || <span class="code-number">0</span>) + <span class="code-number">1</span>;
</code></td></tr><tr><td id="L3313" class="css-a4x74f"><span>3313</span></td><td id="LC3313" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3314" class="css-a4x74f"><span>3314</span></td><td id="LC3314" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3315" class="css-a4x74f"><span>3315</span></td><td id="LC3315" class="css-1dcdqdg"><code>            <span class="code-comment">// for decoding</span>
</code></td></tr><tr><td id="L3316" class="css-a4x74f"><span>3316</span></td><td id="LC3316" class="css-1dcdqdg"><code>            ReferenceTracker.prototype.removeRef = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">refId</span>) </span>{
</code></td></tr><tr><td id="L3317" class="css-a4x74f"><span>3317</span></td><td id="LC3317" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.refCounts[refId] = <span class="code-keyword">this</span>.refCounts[refId] - <span class="code-number">1</span>;
</code></td></tr><tr><td id="L3318" class="css-a4x74f"><span>3318</span></td><td id="LC3318" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.deletedRefs.add(refId);
</code></td></tr><tr><td id="L3319" class="css-a4x74f"><span>3319</span></td><td id="LC3319" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3320" class="css-a4x74f"><span>3320</span></td><td id="LC3320" class="css-1dcdqdg"><code>            ReferenceTracker.prototype.clearRefs = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L3321" class="css-a4x74f"><span>3321</span></td><td id="LC3321" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.refs.clear();
</code></td></tr><tr><td id="L3322" class="css-a4x74f"><span>3322</span></td><td id="LC3322" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.deletedRefs.clear();
</code></td></tr><tr><td id="L3323" class="css-a4x74f"><span>3323</span></td><td id="LC3323" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.refCounts = {};
</code></td></tr><tr><td id="L3324" class="css-a4x74f"><span>3324</span></td><td id="LC3324" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3325" class="css-a4x74f"><span>3325</span></td><td id="LC3325" class="css-1dcdqdg"><code>            <span class="code-comment">// for decoding</span>
</code></td></tr><tr><td id="L3326" class="css-a4x74f"><span>3326</span></td><td id="LC3326" class="css-1dcdqdg"><code>            ReferenceTracker.prototype.garbageCollectDeletedRefs = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L3327" class="css-a4x74f"><span>3327</span></td><td id="LC3327" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L3328" class="css-a4x74f"><span>3328</span></td><td id="LC3328" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.deletedRefs.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">refId</span>) </span>{
</code></td></tr><tr><td id="L3329" class="css-a4x74f"><span>3329</span></td><td id="LC3329" class="css-1dcdqdg"><code>                    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3330" class="css-a4x74f"><span>3330</span></td><td id="LC3330" class="css-1dcdqdg"><code>                    <span class="code-comment">// Skip active references.</span>
</code></td></tr><tr><td id="L3331" class="css-a4x74f"><span>3331</span></td><td id="LC3331" class="css-1dcdqdg"><code>                    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3332" class="css-a4x74f"><span>3332</span></td><td id="LC3332" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (_this.refCounts[refId] &gt; <span class="code-number">0</span>) {
</code></td></tr><tr><td id="L3333" class="css-a4x74f"><span>3333</span></td><td id="LC3333" class="css-1dcdqdg"><code>                        <span class="code-keyword">return</span>;
</code></td></tr><tr><td id="L3334" class="css-a4x74f"><span>3334</span></td><td id="LC3334" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3335" class="css-a4x74f"><span>3335</span></td><td id="LC3335" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> ref = _this.refs.get(refId);
</code></td></tr><tr><td id="L3336" class="css-a4x74f"><span>3336</span></td><td id="LC3336" class="css-1dcdqdg"><code>                    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3337" class="css-a4x74f"><span>3337</span></td><td id="LC3337" class="css-1dcdqdg"><code>                    <span class="code-comment">// Ensure child schema instances have their references removed as well.</span>
</code></td></tr><tr><td id="L3338" class="css-a4x74f"><span>3338</span></td><td id="LC3338" class="css-1dcdqdg"><code>                    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3339" class="css-a4x74f"><span>3339</span></td><td id="LC3339" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (ref <span class="code-keyword">instanceof</span> Schema) {
</code></td></tr><tr><td id="L3340" class="css-a4x74f"><span>3340</span></td><td id="LC3340" class="css-1dcdqdg"><code>                        <span class="code-keyword">for</span> (<span class="code-keyword">var</span> fieldName <span class="code-keyword">in</span> ref[<span class="code-string">'_definition'</span>].schema) {
</code></td></tr><tr><td id="L3341" class="css-a4x74f"><span>3341</span></td><td id="LC3341" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (ref[<span class="code-string">'_definition'</span>].schema[fieldName]) !== <span class="code-string">"string"</span> &amp;&amp;
</code></td></tr><tr><td id="L3342" class="css-a4x74f"><span>3342</span></td><td id="LC3342" class="css-1dcdqdg"><code>                                ref[fieldName] &amp;&amp;
</code></td></tr><tr><td id="L3343" class="css-a4x74f"><span>3343</span></td><td id="LC3343" class="css-1dcdqdg"><code>                                ref[fieldName][<span class="code-string">'$changes'</span>]) {
</code></td></tr><tr><td id="L3344" class="css-a4x74f"><span>3344</span></td><td id="LC3344" class="css-1dcdqdg"><code>                                _this.removeRef(ref[fieldName][<span class="code-string">'$changes'</span>].refId);
</code></td></tr><tr><td id="L3345" class="css-a4x74f"><span>3345</span></td><td id="LC3345" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L3346" class="css-a4x74f"><span>3346</span></td><td id="LC3346" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3347" class="css-a4x74f"><span>3347</span></td><td id="LC3347" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3348" class="css-a4x74f"><span>3348</span></td><td id="LC3348" class="css-1dcdqdg"><code>                    <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L3349" class="css-a4x74f"><span>3349</span></td><td id="LC3349" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> definition = ref[<span class="code-string">'$changes'</span>].parent._definition;
</code></td></tr><tr><td id="L3350" class="css-a4x74f"><span>3350</span></td><td id="LC3350" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> type = definition.schema[definition.fieldsByIndex[ref[<span class="code-string">'$changes'</span>].parentIndex]];
</code></td></tr><tr><td id="L3351" class="css-a4x74f"><span>3351</span></td><td id="LC3351" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (<span class="code-built_in">Object</span>.values(type)[<span class="code-number">0</span>]) === <span class="code-string">"function"</span>) {
</code></td></tr><tr><td id="L3352" class="css-a4x74f"><span>3352</span></td><td id="LC3352" class="css-1dcdqdg"><code>                            <span class="code-built_in">Array</span>.from(ref.values())
</code></td></tr><tr><td id="L3353" class="css-a4x74f"><span>3353</span></td><td id="LC3353" class="css-1dcdqdg"><code>                                .forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">child</span>) </span>{ <span class="code-keyword">return</span> _this.removeRef(child[<span class="code-string">'$changes'</span>].refId); });
</code></td></tr><tr><td id="L3354" class="css-a4x74f"><span>3354</span></td><td id="LC3354" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3355" class="css-a4x74f"><span>3355</span></td><td id="LC3355" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3356" class="css-a4x74f"><span>3356</span></td><td id="LC3356" class="css-1dcdqdg"><code>                    _this.refs.delete(refId);
</code></td></tr><tr><td id="L3357" class="css-a4x74f"><span>3357</span></td><td id="LC3357" class="css-1dcdqdg"><code>                    <span class="code-keyword">delete</span> _this.refCounts[refId];
</code></td></tr><tr><td id="L3358" class="css-a4x74f"><span>3358</span></td><td id="LC3358" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L3359" class="css-a4x74f"><span>3359</span></td><td id="LC3359" class="css-1dcdqdg"><code>                <span class="code-comment">// clear deleted refs.</span>
</code></td></tr><tr><td id="L3360" class="css-a4x74f"><span>3360</span></td><td id="LC3360" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.deletedRefs.clear();
</code></td></tr><tr><td id="L3361" class="css-a4x74f"><span>3361</span></td><td id="LC3361" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3362" class="css-a4x74f"><span>3362</span></td><td id="LC3362" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> ReferenceTracker;
</code></td></tr><tr><td id="L3363" class="css-a4x74f"><span>3363</span></td><td id="LC3363" class="css-1dcdqdg"><code>        }());
</code></td></tr><tr><td id="L3364" class="css-a4x74f"><span>3364</span></td><td id="LC3364" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L3365" class="css-a4x74f"><span>3365</span></td><td id="LC3365" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> EncodeSchemaError = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_super</span>) </span>{
</code></td></tr><tr><td id="L3366" class="css-a4x74f"><span>3366</span></td><td id="LC3366" class="css-1dcdqdg"><code>            __extends(EncodeSchemaError, _super);
</code></td></tr><tr><td id="L3367" class="css-a4x74f"><span>3367</span></td><td id="LC3367" class="css-1dcdqdg"><code>            <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">EncodeSchemaError</span>(<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L3368" class="css-a4x74f"><span>3368</span></td><td id="LC3368" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> _super !== <span class="code-literal">null</span> &amp;&amp; _super.apply(<span class="code-keyword">this</span>, <span class="code-built_in">arguments</span>) || <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L3369" class="css-a4x74f"><span>3369</span></td><td id="LC3369" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L3370" class="css-a4x74f"><span>3370</span></td><td id="LC3370" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> EncodeSchemaError;
</code></td></tr><tr><td id="L3371" class="css-a4x74f"><span>3371</span></td><td id="LC3371" class="css-1dcdqdg"><code>        }(<span class="code-built_in">Error</span>));
</code></td></tr><tr><td id="L3372" class="css-a4x74f"><span>3372</span></td><td id="LC3372" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">assertType</span>(<span class="code-params">value, type, klass, field</span>) </span>{
</code></td></tr><tr><td id="L3373" class="css-a4x74f"><span>3373</span></td><td id="LC3373" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> typeofTarget;
</code></td></tr><tr><td id="L3374" class="css-a4x74f"><span>3374</span></td><td id="LC3374" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> allowNull = <span class="code-literal">false</span>;
</code></td></tr><tr><td id="L3375" class="css-a4x74f"><span>3375</span></td><td id="LC3375" class="css-1dcdqdg"><code>            <span class="code-keyword">switch</span> (type) {
</code></td></tr><tr><td id="L3376" class="css-a4x74f"><span>3376</span></td><td id="LC3376" class="css-1dcdqdg"><code>                <span class="code-keyword">case</span> <span class="code-string">"number"</span>:
</code></td></tr><tr><td id="L3377" class="css-a4x74f"><span>3377</span></td><td id="LC3377" class="css-1dcdqdg"><code>                <span class="code-keyword">case</span> <span class="code-string">"int8"</span>:
</code></td></tr><tr><td id="L3378" class="css-a4x74f"><span>3378</span></td><td id="LC3378" class="css-1dcdqdg"><code>                <span class="code-keyword">case</span> <span class="code-string">"uint8"</span>:
</code></td></tr><tr><td id="L3379" class="css-a4x74f"><span>3379</span></td><td id="LC3379" class="css-1dcdqdg"><code>                <span class="code-keyword">case</span> <span class="code-string">"int16"</span>:
</code></td></tr><tr><td id="L3380" class="css-a4x74f"><span>3380</span></td><td id="LC3380" class="css-1dcdqdg"><code>                <span class="code-keyword">case</span> <span class="code-string">"uint16"</span>:
</code></td></tr><tr><td id="L3381" class="css-a4x74f"><span>3381</span></td><td id="LC3381" class="css-1dcdqdg"><code>                <span class="code-keyword">case</span> <span class="code-string">"int32"</span>:
</code></td></tr><tr><td id="L3382" class="css-a4x74f"><span>3382</span></td><td id="LC3382" class="css-1dcdqdg"><code>                <span class="code-keyword">case</span> <span class="code-string">"uint32"</span>:
</code></td></tr><tr><td id="L3383" class="css-a4x74f"><span>3383</span></td><td id="LC3383" class="css-1dcdqdg"><code>                <span class="code-keyword">case</span> <span class="code-string">"int64"</span>:
</code></td></tr><tr><td id="L3384" class="css-a4x74f"><span>3384</span></td><td id="LC3384" class="css-1dcdqdg"><code>                <span class="code-keyword">case</span> <span class="code-string">"uint64"</span>:
</code></td></tr><tr><td id="L3385" class="css-a4x74f"><span>3385</span></td><td id="LC3385" class="css-1dcdqdg"><code>                <span class="code-keyword">case</span> <span class="code-string">"float32"</span>:
</code></td></tr><tr><td id="L3386" class="css-a4x74f"><span>3386</span></td><td id="LC3386" class="css-1dcdqdg"><code>                <span class="code-keyword">case</span> <span class="code-string">"float64"</span>:
</code></td></tr><tr><td id="L3387" class="css-a4x74f"><span>3387</span></td><td id="LC3387" class="css-1dcdqdg"><code>                    typeofTarget = <span class="code-string">"number"</span>;
</code></td></tr><tr><td id="L3388" class="css-a4x74f"><span>3388</span></td><td id="LC3388" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (<span class="code-built_in">isNaN</span>(value)) {
</code></td></tr><tr><td id="L3389" class="css-a4x74f"><span>3389</span></td><td id="LC3389" class="css-1dcdqdg"><code>                        <span class="code-built_in">console</span>.log(<span class="code-string">"trying to encode \"NaN\" in "</span>.concat(klass.constructor.name, <span class="code-string">"#"</span>).concat(field));
</code></td></tr><tr><td id="L3390" class="css-a4x74f"><span>3390</span></td><td id="LC3390" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3391" class="css-a4x74f"><span>3391</span></td><td id="LC3391" class="css-1dcdqdg"><code>                    <span class="code-keyword">break</span>;
</code></td></tr><tr><td id="L3392" class="css-a4x74f"><span>3392</span></td><td id="LC3392" class="css-1dcdqdg"><code>                <span class="code-keyword">case</span> <span class="code-string">"string"</span>:
</code></td></tr><tr><td id="L3393" class="css-a4x74f"><span>3393</span></td><td id="LC3393" class="css-1dcdqdg"><code>                    typeofTarget = <span class="code-string">"string"</span>;
</code></td></tr><tr><td id="L3394" class="css-a4x74f"><span>3394</span></td><td id="LC3394" class="css-1dcdqdg"><code>                    allowNull = <span class="code-literal">true</span>;
</code></td></tr><tr><td id="L3395" class="css-a4x74f"><span>3395</span></td><td id="LC3395" class="css-1dcdqdg"><code>                    <span class="code-keyword">break</span>;
</code></td></tr><tr><td id="L3396" class="css-a4x74f"><span>3396</span></td><td id="LC3396" class="css-1dcdqdg"><code>                <span class="code-keyword">case</span> <span class="code-string">"boolean"</span>:
</code></td></tr><tr><td id="L3397" class="css-a4x74f"><span>3397</span></td><td id="LC3397" class="css-1dcdqdg"><code>                    <span class="code-comment">// boolean is always encoded as true/false based on truthiness</span>
</code></td></tr><tr><td id="L3398" class="css-a4x74f"><span>3398</span></td><td id="LC3398" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span>;
</code></td></tr><tr><td id="L3399" class="css-a4x74f"><span>3399</span></td><td id="LC3399" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L3400" class="css-a4x74f"><span>3400</span></td><td id="LC3400" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (value) !== typeofTarget &amp;&amp; (!allowNull || (allowNull &amp;&amp; value !== <span class="code-literal">null</span>))) {
</code></td></tr><tr><td id="L3401" class="css-a4x74f"><span>3401</span></td><td id="LC3401" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> foundValue = <span class="code-string">"'"</span>.concat(<span class="code-built_in">JSON</span>.stringify(value), <span class="code-string">"'"</span>).concat((value &amp;&amp; value.constructor &amp;&amp; <span class="code-string">" ("</span>.concat(value.constructor.name, <span class="code-string">")"</span>)) || <span class="code-string">''</span>);
</code></td></tr><tr><td id="L3402" class="css-a4x74f"><span>3402</span></td><td id="LC3402" class="css-1dcdqdg"><code>                <span class="code-keyword">throw</span> <span class="code-keyword">new</span> EncodeSchemaError(<span class="code-string">"a '"</span>.concat(typeofTarget, <span class="code-string">"' was expected, but "</span>).concat(foundValue, <span class="code-string">" was provided in "</span>).concat(klass.constructor.name, <span class="code-string">"#"</span>).concat(field));
</code></td></tr><tr><td id="L3403" class="css-a4x74f"><span>3403</span></td><td id="LC3403" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L3404" class="css-a4x74f"><span>3404</span></td><td id="LC3404" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L3405" class="css-a4x74f"><span>3405</span></td><td id="LC3405" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">assertInstanceType</span>(<span class="code-params">value, type, klass, field</span>) </span>{
</code></td></tr><tr><td id="L3406" class="css-a4x74f"><span>3406</span></td><td id="LC3406" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (!(value <span class="code-keyword">instanceof</span> type)) {
</code></td></tr><tr><td id="L3407" class="css-a4x74f"><span>3407</span></td><td id="LC3407" class="css-1dcdqdg"><code>                <span class="code-keyword">throw</span> <span class="code-keyword">new</span> EncodeSchemaError(<span class="code-string">"a '"</span>.concat(type.name, <span class="code-string">"' was expected, but '"</span>).concat(value.constructor.name, <span class="code-string">"' was provided in "</span>).concat(klass.constructor.name, <span class="code-string">"#"</span>).concat(field));
</code></td></tr><tr><td id="L3408" class="css-a4x74f"><span>3408</span></td><td id="LC3408" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L3409" class="css-a4x74f"><span>3409</span></td><td id="LC3409" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L3410" class="css-a4x74f"><span>3410</span></td><td id="LC3410" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">encodePrimitiveType</span>(<span class="code-params">type, bytes, value, klass, field</span>) </span>{
</code></td></tr><tr><td id="L3411" class="css-a4x74f"><span>3411</span></td><td id="LC3411" class="css-1dcdqdg"><code>            assertType(value, type, klass, field);
</code></td></tr><tr><td id="L3412" class="css-a4x74f"><span>3412</span></td><td id="LC3412" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> encodeFunc = encode[type];
</code></td></tr><tr><td id="L3413" class="css-a4x74f"><span>3413</span></td><td id="LC3413" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (encodeFunc) {
</code></td></tr><tr><td id="L3414" class="css-a4x74f"><span>3414</span></td><td id="LC3414" class="css-1dcdqdg"><code>                encodeFunc(bytes, value);
</code></td></tr><tr><td id="L3415" class="css-a4x74f"><span>3415</span></td><td id="LC3415" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L3416" class="css-a4x74f"><span>3416</span></td><td id="LC3416" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L3417" class="css-a4x74f"><span>3417</span></td><td id="LC3417" class="css-1dcdqdg"><code>                <span class="code-keyword">throw</span> <span class="code-keyword">new</span> EncodeSchemaError(<span class="code-string">"a '"</span>.concat(type, <span class="code-string">"' was expected, but "</span>).concat(value, <span class="code-string">" was provided in "</span>).concat(klass.constructor.name, <span class="code-string">"#"</span>).concat(field));
</code></td></tr><tr><td id="L3418" class="css-a4x74f"><span>3418</span></td><td id="LC3418" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L3419" class="css-a4x74f"><span>3419</span></td><td id="LC3419" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L3420" class="css-a4x74f"><span>3420</span></td><td id="LC3420" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">decodePrimitiveType</span>(<span class="code-params">type, bytes, it</span>) </span>{
</code></td></tr><tr><td id="L3421" class="css-a4x74f"><span>3421</span></td><td id="LC3421" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> decode[type](bytes, it);
</code></td></tr><tr><td id="L3422" class="css-a4x74f"><span>3422</span></td><td id="LC3422" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L3423" class="css-a4x74f"><span>3423</span></td><td id="LC3423" class="css-1dcdqdg"><code>        <span class="code-comment">/**
</span></code></td></tr><tr><td id="L3424" class="css-a4x74f"><span>3424</span></td><td id="LC3424" class="css-1dcdqdg"><code><span class="code-comment">         * Schema encoder / decoder
</span></code></td></tr><tr><td id="L3425" class="css-a4x74f"><span>3425</span></td><td id="LC3425" class="css-1dcdqdg"><code><span class="code-comment">         */</span>
</code></td></tr><tr><td id="L3426" class="css-a4x74f"><span>3426</span></td><td id="LC3426" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> Schema = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L3427" class="css-a4x74f"><span>3427</span></td><td id="LC3427" class="css-1dcdqdg"><code>            <span class="code-comment">// allow inherited classes to have a constructor</span>
</code></td></tr><tr><td id="L3428" class="css-a4x74f"><span>3428</span></td><td id="LC3428" class="css-1dcdqdg"><code>            <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">Schema</span>(<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L3429" class="css-a4x74f"><span>3429</span></td><td id="LC3429" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> args = [];
</code></td></tr><tr><td id="L3430" class="css-a4x74f"><span>3430</span></td><td id="LC3430" class="css-1dcdqdg"><code>                <span class="code-keyword">for</span> (<span class="code-keyword">var</span> _i = <span class="code-number">0</span>; _i &lt; <span class="code-built_in">arguments</span>.length; _i++) {
</code></td></tr><tr><td id="L3431" class="css-a4x74f"><span>3431</span></td><td id="LC3431" class="css-1dcdqdg"><code>                    args[_i] = <span class="code-built_in">arguments</span>[_i];
</code></td></tr><tr><td id="L3432" class="css-a4x74f"><span>3432</span></td><td id="LC3432" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3433" class="css-a4x74f"><span>3433</span></td><td id="LC3433" class="css-1dcdqdg"><code>                <span class="code-comment">// fix enumerability of fields for end-user</span>
</code></td></tr><tr><td id="L3434" class="css-a4x74f"><span>3434</span></td><td id="LC3434" class="css-1dcdqdg"><code>                <span class="code-built_in">Object</span>.defineProperties(<span class="code-keyword">this</span>, {
</code></td></tr><tr><td id="L3435" class="css-a4x74f"><span>3435</span></td><td id="LC3435" class="css-1dcdqdg"><code>                    $changes: {
</code></td></tr><tr><td id="L3436" class="css-a4x74f"><span>3436</span></td><td id="LC3436" class="css-1dcdqdg"><code>                        value: <span class="code-keyword">new</span> ChangeTree(<span class="code-keyword">this</span>, <span class="code-literal">undefined</span>, <span class="code-keyword">new</span> ReferenceTracker()),
</code></td></tr><tr><td id="L3437" class="css-a4x74f"><span>3437</span></td><td id="LC3437" class="css-1dcdqdg"><code>                        enumerable: <span class="code-literal">false</span>,
</code></td></tr><tr><td id="L3438" class="css-a4x74f"><span>3438</span></td><td id="LC3438" class="css-1dcdqdg"><code>                        writable: <span class="code-literal">true</span>
</code></td></tr><tr><td id="L3439" class="css-a4x74f"><span>3439</span></td><td id="LC3439" class="css-1dcdqdg"><code>                    },
</code></td></tr><tr><td id="L3440" class="css-a4x74f"><span>3440</span></td><td id="LC3440" class="css-1dcdqdg"><code>                    <span class="code-comment">// $listeners: {</span>
</code></td></tr><tr><td id="L3441" class="css-a4x74f"><span>3441</span></td><td id="LC3441" class="css-1dcdqdg"><code>                    <span class="code-comment">//     value: undefined,</span>
</code></td></tr><tr><td id="L3442" class="css-a4x74f"><span>3442</span></td><td id="LC3442" class="css-1dcdqdg"><code>                    <span class="code-comment">//     enumerable: false,</span>
</code></td></tr><tr><td id="L3443" class="css-a4x74f"><span>3443</span></td><td id="LC3443" class="css-1dcdqdg"><code>                    <span class="code-comment">//     writable: true</span>
</code></td></tr><tr><td id="L3444" class="css-a4x74f"><span>3444</span></td><td id="LC3444" class="css-1dcdqdg"><code>                    <span class="code-comment">// },</span>
</code></td></tr><tr><td id="L3445" class="css-a4x74f"><span>3445</span></td><td id="LC3445" class="css-1dcdqdg"><code>                    $callbacks: {
</code></td></tr><tr><td id="L3446" class="css-a4x74f"><span>3446</span></td><td id="LC3446" class="css-1dcdqdg"><code>                        value: <span class="code-literal">undefined</span>,
</code></td></tr><tr><td id="L3447" class="css-a4x74f"><span>3447</span></td><td id="LC3447" class="css-1dcdqdg"><code>                        enumerable: <span class="code-literal">false</span>,
</code></td></tr><tr><td id="L3448" class="css-a4x74f"><span>3448</span></td><td id="LC3448" class="css-1dcdqdg"><code>                        writable: <span class="code-literal">true</span>
</code></td></tr><tr><td id="L3449" class="css-a4x74f"><span>3449</span></td><td id="LC3449" class="css-1dcdqdg"><code>                    },
</code></td></tr><tr><td id="L3450" class="css-a4x74f"><span>3450</span></td><td id="LC3450" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L3451" class="css-a4x74f"><span>3451</span></td><td id="LC3451" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> descriptors = <span class="code-keyword">this</span>._definition.descriptors;
</code></td></tr><tr><td id="L3452" class="css-a4x74f"><span>3452</span></td><td id="LC3452" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (descriptors) {
</code></td></tr><tr><td id="L3453" class="css-a4x74f"><span>3453</span></td><td id="LC3453" class="css-1dcdqdg"><code>                    <span class="code-built_in">Object</span>.defineProperties(<span class="code-keyword">this</span>, descriptors);
</code></td></tr><tr><td id="L3454" class="css-a4x74f"><span>3454</span></td><td id="LC3454" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3455" class="css-a4x74f"><span>3455</span></td><td id="LC3455" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3456" class="css-a4x74f"><span>3456</span></td><td id="LC3456" class="css-1dcdqdg"><code>                <span class="code-comment">// Assign initial values</span>
</code></td></tr><tr><td id="L3457" class="css-a4x74f"><span>3457</span></td><td id="LC3457" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3458" class="css-a4x74f"><span>3458</span></td><td id="LC3458" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (args[<span class="code-number">0</span>]) {
</code></td></tr><tr><td id="L3459" class="css-a4x74f"><span>3459</span></td><td id="LC3459" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.assign(args[<span class="code-number">0</span>]);
</code></td></tr><tr><td id="L3460" class="css-a4x74f"><span>3460</span></td><td id="LC3460" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3461" class="css-a4x74f"><span>3461</span></td><td id="LC3461" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L3462" class="css-a4x74f"><span>3462</span></td><td id="LC3462" class="css-1dcdqdg"><code>            Schema.onError = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">e</span>) </span>{
</code></td></tr><tr><td id="L3463" class="css-a4x74f"><span>3463</span></td><td id="LC3463" class="css-1dcdqdg"><code>                <span class="code-built_in">console</span>.error(e);
</code></td></tr><tr><td id="L3464" class="css-a4x74f"><span>3464</span></td><td id="LC3464" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3465" class="css-a4x74f"><span>3465</span></td><td id="LC3465" class="css-1dcdqdg"><code>            Schema.is = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">type</span>) </span>{
</code></td></tr><tr><td id="L3466" class="css-a4x74f"><span>3466</span></td><td id="LC3466" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> (type[<span class="code-string">'_definition'</span>] &amp;&amp;
</code></td></tr><tr><td id="L3467" class="css-a4x74f"><span>3467</span></td><td id="LC3467" class="css-1dcdqdg"><code>                    type[<span class="code-string">'_definition'</span>].schema !== <span class="code-literal">undefined</span>);
</code></td></tr><tr><td id="L3468" class="css-a4x74f"><span>3468</span></td><td id="LC3468" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3469" class="css-a4x74f"><span>3469</span></td><td id="LC3469" class="css-1dcdqdg"><code>            Schema.prototype.onChange = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback</span>) </span>{
</code></td></tr><tr><td id="L3470" class="css-a4x74f"><span>3470</span></td><td id="LC3470" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> addCallback((<span class="code-keyword">this</span>.$callbacks || (<span class="code-keyword">this</span>.$callbacks = [])), exports.OPERATION.REPLACE, callback);
</code></td></tr><tr><td id="L3471" class="css-a4x74f"><span>3471</span></td><td id="LC3471" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3472" class="css-a4x74f"><span>3472</span></td><td id="LC3472" class="css-1dcdqdg"><code>            Schema.prototype.onRemove = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback</span>) </span>{
</code></td></tr><tr><td id="L3473" class="css-a4x74f"><span>3473</span></td><td id="LC3473" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> addCallback((<span class="code-keyword">this</span>.$callbacks || (<span class="code-keyword">this</span>.$callbacks = [])), exports.OPERATION.DELETE, callback);
</code></td></tr><tr><td id="L3474" class="css-a4x74f"><span>3474</span></td><td id="LC3474" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3475" class="css-a4x74f"><span>3475</span></td><td id="LC3475" class="css-1dcdqdg"><code>            Schema.prototype.assign = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">props</span>) </span>{
</code></td></tr><tr><td id="L3476" class="css-a4x74f"><span>3476</span></td><td id="LC3476" class="css-1dcdqdg"><code>                <span class="code-built_in">Object</span>.assign(<span class="code-keyword">this</span>, props);
</code></td></tr><tr><td id="L3477" class="css-a4x74f"><span>3477</span></td><td id="LC3477" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L3478" class="css-a4x74f"><span>3478</span></td><td id="LC3478" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3479" class="css-a4x74f"><span>3479</span></td><td id="LC3479" class="css-1dcdqdg"><code>            <span class="code-built_in">Object</span>.defineProperty(Schema.prototype, <span class="code-string">"_definition"</span>, {
</code></td></tr><tr><td id="L3480" class="css-a4x74f"><span>3480</span></td><td id="LC3480" class="css-1dcdqdg"><code>                <span class="code-keyword">get</span>: function () { <span class="code-keyword">return</span> <span class="code-keyword">this</span>.constructor._definition; },
</code></td></tr><tr><td id="L3481" class="css-a4x74f"><span>3481</span></td><td id="LC3481" class="css-1dcdqdg"><code>                enumerable: <span class="code-literal">false</span>,
</code></td></tr><tr><td id="L3482" class="css-a4x74f"><span>3482</span></td><td id="LC3482" class="css-1dcdqdg"><code>                configurable: <span class="code-literal">true</span>
</code></td></tr><tr><td id="L3483" class="css-a4x74f"><span>3483</span></td><td id="LC3483" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L3484" class="css-a4x74f"><span>3484</span></td><td id="LC3484" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L3485" class="css-a4x74f"><span>3485</span></td><td id="LC3485" class="css-1dcdqdg"><code><span class="code-comment">             * (Server-side): Flag a property to be encoded for the next patch.
</span></code></td></tr><tr><td id="L3486" class="css-a4x74f"><span>3486</span></td><td id="LC3486" class="css-1dcdqdg"><code><span class="code-comment">             * @param instance Schema instance
</span></code></td></tr><tr><td id="L3487" class="css-a4x74f"><span>3487</span></td><td id="LC3487" class="css-1dcdqdg"><code><span class="code-comment">             * @param property string representing the property name, or number representing the index of the property.
</span></code></td></tr><tr><td id="L3488" class="css-a4x74f"><span>3488</span></td><td id="LC3488" class="css-1dcdqdg"><code><span class="code-comment">             * @param operation OPERATION to perform (detected automatically)
</span></code></td></tr><tr><td id="L3489" class="css-a4x74f"><span>3489</span></td><td id="LC3489" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L3490" class="css-a4x74f"><span>3490</span></td><td id="LC3490" class="css-1dcdqdg"><code>            Schema.prototype.setDirty = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">property, operation</span>) </span>{
</code></td></tr><tr><td id="L3491" class="css-a4x74f"><span>3491</span></td><td id="LC3491" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.change(property, operation);
</code></td></tr><tr><td id="L3492" class="css-a4x74f"><span>3492</span></td><td id="LC3492" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3493" class="css-a4x74f"><span>3493</span></td><td id="LC3493" class="css-1dcdqdg"><code>            <span class="code-comment">/**
</span></code></td></tr><tr><td id="L3494" class="css-a4x74f"><span>3494</span></td><td id="LC3494" class="css-1dcdqdg"><code><span class="code-comment">             * Client-side: listen for changes on property.
</span></code></td></tr><tr><td id="L3495" class="css-a4x74f"><span>3495</span></td><td id="LC3495" class="css-1dcdqdg"><code><span class="code-comment">             * @param prop the property name
</span></code></td></tr><tr><td id="L3496" class="css-a4x74f"><span>3496</span></td><td id="LC3496" class="css-1dcdqdg"><code><span class="code-comment">             * @param callback callback to be triggered on property change
</span></code></td></tr><tr><td id="L3497" class="css-a4x74f"><span>3497</span></td><td id="LC3497" class="css-1dcdqdg"><code><span class="code-comment">             * @param immediate trigger immediatelly if property has been already set.
</span></code></td></tr><tr><td id="L3498" class="css-a4x74f"><span>3498</span></td><td id="LC3498" class="css-1dcdqdg"><code><span class="code-comment">             */</span>
</code></td></tr><tr><td id="L3499" class="css-a4x74f"><span>3499</span></td><td id="LC3499" class="css-1dcdqdg"><code>            Schema.prototype.listen = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">prop, callback, immediate</span>) </span>{
</code></td></tr><tr><td id="L3500" class="css-a4x74f"><span>3500</span></td><td id="LC3500" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L3501" class="css-a4x74f"><span>3501</span></td><td id="LC3501" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (immediate === <span class="code-keyword">void</span> <span class="code-number">0</span>) { immediate = <span class="code-literal">true</span>; }
</code></td></tr><tr><td id="L3502" class="css-a4x74f"><span>3502</span></td><td id="LC3502" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (!<span class="code-keyword">this</span>.$callbacks) {
</code></td></tr><tr><td id="L3503" class="css-a4x74f"><span>3503</span></td><td id="LC3503" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.$callbacks = {};
</code></td></tr><tr><td id="L3504" class="css-a4x74f"><span>3504</span></td><td id="LC3504" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3505" class="css-a4x74f"><span>3505</span></td><td id="LC3505" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (!<span class="code-keyword">this</span>.$callbacks[prop]) {
</code></td></tr><tr><td id="L3506" class="css-a4x74f"><span>3506</span></td><td id="LC3506" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.$callbacks[prop] = [];
</code></td></tr><tr><td id="L3507" class="css-a4x74f"><span>3507</span></td><td id="LC3507" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3508" class="css-a4x74f"><span>3508</span></td><td id="LC3508" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$callbacks[prop].push(callback);
</code></td></tr><tr><td id="L3509" class="css-a4x74f"><span>3509</span></td><td id="LC3509" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (immediate &amp;&amp; <span class="code-keyword">this</span>[prop] !== <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L3510" class="css-a4x74f"><span>3510</span></td><td id="LC3510" class="css-1dcdqdg"><code>                    callback(<span class="code-keyword">this</span>[prop], <span class="code-literal">undefined</span>);
</code></td></tr><tr><td id="L3511" class="css-a4x74f"><span>3511</span></td><td id="LC3511" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3512" class="css-a4x74f"><span>3512</span></td><td id="LC3512" class="css-1dcdqdg"><code>                <span class="code-comment">// return un-register callback.</span>
</code></td></tr><tr><td id="L3513" class="css-a4x74f"><span>3513</span></td><td id="LC3513" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{ <span class="code-keyword">return</span> spliceOne(_this.$callbacks[prop], _this.$callbacks[prop].indexOf(callback)); };
</code></td></tr><tr><td id="L3514" class="css-a4x74f"><span>3514</span></td><td id="LC3514" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3515" class="css-a4x74f"><span>3515</span></td><td id="LC3515" class="css-1dcdqdg"><code>            Schema.prototype.decode = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">bytes, it, ref</span>) </span>{
</code></td></tr><tr><td id="L3516" class="css-a4x74f"><span>3516</span></td><td id="LC3516" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _a;
</code></td></tr><tr><td id="L3517" class="css-a4x74f"><span>3517</span></td><td id="LC3517" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (it === <span class="code-keyword">void</span> <span class="code-number">0</span>) { it = { <span class="code-attr">offset</span>: <span class="code-number">0</span> }; }
</code></td></tr><tr><td id="L3518" class="css-a4x74f"><span>3518</span></td><td id="LC3518" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (ref === <span class="code-keyword">void</span> <span class="code-number">0</span>) { ref = <span class="code-keyword">this</span>; }
</code></td></tr><tr><td id="L3519" class="css-a4x74f"><span>3519</span></td><td id="LC3519" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> allChanges = [];
</code></td></tr><tr><td id="L3520" class="css-a4x74f"><span>3520</span></td><td id="LC3520" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> $root = <span class="code-keyword">this</span>.$changes.root;
</code></td></tr><tr><td id="L3521" class="css-a4x74f"><span>3521</span></td><td id="LC3521" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> totalBytes = bytes.length;
</code></td></tr><tr><td id="L3522" class="css-a4x74f"><span>3522</span></td><td id="LC3522" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> refId = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L3523" class="css-a4x74f"><span>3523</span></td><td id="LC3523" class="css-1dcdqdg"><code>                $root.refs.set(refId, <span class="code-keyword">this</span>);
</code></td></tr><tr><td id="L3524" class="css-a4x74f"><span>3524</span></td><td id="LC3524" class="css-1dcdqdg"><code>                <span class="code-keyword">while</span> (it.offset &lt; totalBytes) {
</code></td></tr><tr><td id="L3525" class="css-a4x74f"><span>3525</span></td><td id="LC3525" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> byte = bytes[it.offset++];
</code></td></tr><tr><td id="L3526" class="css-a4x74f"><span>3526</span></td><td id="LC3526" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (byte == SWITCH_TO_STRUCTURE) {
</code></td></tr><tr><td id="L3527" class="css-a4x74f"><span>3527</span></td><td id="LC3527" class="css-1dcdqdg"><code>                        refId = number(bytes, it);
</code></td></tr><tr><td id="L3528" class="css-a4x74f"><span>3528</span></td><td id="LC3528" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> nextRef = $root.refs.get(refId);
</code></td></tr><tr><td id="L3529" class="css-a4x74f"><span>3529</span></td><td id="LC3529" class="css-1dcdqdg"><code>                        <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3530" class="css-a4x74f"><span>3530</span></td><td id="LC3530" class="css-1dcdqdg"><code>                        <span class="code-comment">// Trying to access a reference that haven't been decoded yet.</span>
</code></td></tr><tr><td id="L3531" class="css-a4x74f"><span>3531</span></td><td id="LC3531" class="css-1dcdqdg"><code>                        <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3532" class="css-a4x74f"><span>3532</span></td><td id="LC3532" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (!nextRef) {
</code></td></tr><tr><td id="L3533" class="css-a4x74f"><span>3533</span></td><td id="LC3533" class="css-1dcdqdg"><code>                            <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">"\"refId\" not found: "</span>.concat(refId));
</code></td></tr><tr><td id="L3534" class="css-a4x74f"><span>3534</span></td><td id="LC3534" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3535" class="css-a4x74f"><span>3535</span></td><td id="LC3535" class="css-1dcdqdg"><code>                        ref = nextRef;
</code></td></tr><tr><td id="L3536" class="css-a4x74f"><span>3536</span></td><td id="LC3536" class="css-1dcdqdg"><code>                        <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L3537" class="css-a4x74f"><span>3537</span></td><td id="LC3537" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3538" class="css-a4x74f"><span>3538</span></td><td id="LC3538" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> changeTree = ref[<span class="code-string">'$changes'</span>];
</code></td></tr><tr><td id="L3539" class="css-a4x74f"><span>3539</span></td><td id="LC3539" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> isSchema = (ref[<span class="code-string">'_definition'</span>] !== <span class="code-literal">undefined</span>);
</code></td></tr><tr><td id="L3540" class="css-a4x74f"><span>3540</span></td><td id="LC3540" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> operation = (isSchema)
</code></td></tr><tr><td id="L3541" class="css-a4x74f"><span>3541</span></td><td id="LC3541" class="css-1dcdqdg"><code>                        ? (byte &gt;&gt; <span class="code-number">6</span>) &lt;&lt; <span class="code-number">6</span> <span class="code-comment">// "compressed" index + operation</span>
</code></td></tr><tr><td id="L3542" class="css-a4x74f"><span>3542</span></td><td id="LC3542" class="css-1dcdqdg"><code>                        : byte; <span class="code-comment">// "uncompressed" index + operation (array/map items)</span>
</code></td></tr><tr><td id="L3543" class="css-a4x74f"><span>3543</span></td><td id="LC3543" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (operation === exports.OPERATION.CLEAR) {
</code></td></tr><tr><td id="L3544" class="css-a4x74f"><span>3544</span></td><td id="LC3544" class="css-1dcdqdg"><code>                        <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3545" class="css-a4x74f"><span>3545</span></td><td id="LC3545" class="css-1dcdqdg"><code>                        <span class="code-comment">// <span class="code-doctag">TODO:</span> refactor me!</span>
</code></td></tr><tr><td id="L3546" class="css-a4x74f"><span>3546</span></td><td id="LC3546" class="css-1dcdqdg"><code>                        <span class="code-comment">// The `.clear()` method is calling `$root.removeRef(refId)` for</span>
</code></td></tr><tr><td id="L3547" class="css-a4x74f"><span>3547</span></td><td id="LC3547" class="css-1dcdqdg"><code>                        <span class="code-comment">// each item inside this collection</span>
</code></td></tr><tr><td id="L3548" class="css-a4x74f"><span>3548</span></td><td id="LC3548" class="css-1dcdqdg"><code>                        <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3549" class="css-a4x74f"><span>3549</span></td><td id="LC3549" class="css-1dcdqdg"><code>                        ref.clear(allChanges);
</code></td></tr><tr><td id="L3550" class="css-a4x74f"><span>3550</span></td><td id="LC3550" class="css-1dcdqdg"><code>                        <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L3551" class="css-a4x74f"><span>3551</span></td><td id="LC3551" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3552" class="css-a4x74f"><span>3552</span></td><td id="LC3552" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> fieldIndex = (isSchema)
</code></td></tr><tr><td id="L3553" class="css-a4x74f"><span>3553</span></td><td id="LC3553" class="css-1dcdqdg"><code>                        ? byte % (operation || <span class="code-number">255</span>) <span class="code-comment">// if "REPLACE" operation (0), use 255</span>
</code></td></tr><tr><td id="L3554" class="css-a4x74f"><span>3554</span></td><td id="LC3554" class="css-1dcdqdg"><code>                        : number(bytes, it);
</code></td></tr><tr><td id="L3555" class="css-a4x74f"><span>3555</span></td><td id="LC3555" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> fieldName = (isSchema)
</code></td></tr><tr><td id="L3556" class="css-a4x74f"><span>3556</span></td><td id="LC3556" class="css-1dcdqdg"><code>                        ? (ref[<span class="code-string">'_definition'</span>].fieldsByIndex[fieldIndex])
</code></td></tr><tr><td id="L3557" class="css-a4x74f"><span>3557</span></td><td id="LC3557" class="css-1dcdqdg"><code>                        : <span class="code-string">""</span>;
</code></td></tr><tr><td id="L3558" class="css-a4x74f"><span>3558</span></td><td id="LC3558" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> type = changeTree.getType(fieldIndex);
</code></td></tr><tr><td id="L3559" class="css-a4x74f"><span>3559</span></td><td id="LC3559" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> value = <span class="code-keyword">void</span> <span class="code-number">0</span>;
</code></td></tr><tr><td id="L3560" class="css-a4x74f"><span>3560</span></td><td id="LC3560" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> previousValue = <span class="code-keyword">void</span> <span class="code-number">0</span>;
</code></td></tr><tr><td id="L3561" class="css-a4x74f"><span>3561</span></td><td id="LC3561" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> dynamicIndex = <span class="code-keyword">void</span> <span class="code-number">0</span>;
</code></td></tr><tr><td id="L3562" class="css-a4x74f"><span>3562</span></td><td id="LC3562" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (!isSchema) {
</code></td></tr><tr><td id="L3563" class="css-a4x74f"><span>3563</span></td><td id="LC3563" class="css-1dcdqdg"><code>                        previousValue = ref[<span class="code-string">'getByIndex'</span>](fieldIndex);
</code></td></tr><tr><td id="L3564" class="css-a4x74f"><span>3564</span></td><td id="LC3564" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> ((operation &amp; exports.OPERATION.ADD) === exports.OPERATION.ADD) { <span class="code-comment">// ADD or DELETE_AND_ADD</span>
</code></td></tr><tr><td id="L3565" class="css-a4x74f"><span>3565</span></td><td id="LC3565" class="css-1dcdqdg"><code>                            dynamicIndex = (ref <span class="code-keyword">instanceof</span> MapSchema)
</code></td></tr><tr><td id="L3566" class="css-a4x74f"><span>3566</span></td><td id="LC3566" class="css-1dcdqdg"><code>                                ? string(bytes, it)
</code></td></tr><tr><td id="L3567" class="css-a4x74f"><span>3567</span></td><td id="LC3567" class="css-1dcdqdg"><code>                                : fieldIndex;
</code></td></tr><tr><td id="L3568" class="css-a4x74f"><span>3568</span></td><td id="LC3568" class="css-1dcdqdg"><code>                            ref[<span class="code-string">'setIndex'</span>](fieldIndex, dynamicIndex);
</code></td></tr><tr><td id="L3569" class="css-a4x74f"><span>3569</span></td><td id="LC3569" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3570" class="css-a4x74f"><span>3570</span></td><td id="LC3570" class="css-1dcdqdg"><code>                        <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L3571" class="css-a4x74f"><span>3571</span></td><td id="LC3571" class="css-1dcdqdg"><code>                            <span class="code-comment">// here</span>
</code></td></tr><tr><td id="L3572" class="css-a4x74f"><span>3572</span></td><td id="LC3572" class="css-1dcdqdg"><code>                            dynamicIndex = ref[<span class="code-string">'getIndex'</span>](fieldIndex);
</code></td></tr><tr><td id="L3573" class="css-a4x74f"><span>3573</span></td><td id="LC3573" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3574" class="css-a4x74f"><span>3574</span></td><td id="LC3574" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3575" class="css-a4x74f"><span>3575</span></td><td id="LC3575" class="css-1dcdqdg"><code>                    <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L3576" class="css-a4x74f"><span>3576</span></td><td id="LC3576" class="css-1dcdqdg"><code>                        previousValue = ref[<span class="code-string">"_"</span>.concat(fieldName)];
</code></td></tr><tr><td id="L3577" class="css-a4x74f"><span>3577</span></td><td id="LC3577" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3578" class="css-a4x74f"><span>3578</span></td><td id="LC3578" class="css-1dcdqdg"><code>                    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3579" class="css-a4x74f"><span>3579</span></td><td id="LC3579" class="css-1dcdqdg"><code>                    <span class="code-comment">// Delete operations</span>
</code></td></tr><tr><td id="L3580" class="css-a4x74f"><span>3580</span></td><td id="LC3580" class="css-1dcdqdg"><code>                    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3581" class="css-a4x74f"><span>3581</span></td><td id="LC3581" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> ((operation &amp; exports.OPERATION.DELETE) === exports.OPERATION.DELETE) {
</code></td></tr><tr><td id="L3582" class="css-a4x74f"><span>3582</span></td><td id="LC3582" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (operation !== exports.OPERATION.DELETE_AND_ADD) {
</code></td></tr><tr><td id="L3583" class="css-a4x74f"><span>3583</span></td><td id="LC3583" class="css-1dcdqdg"><code>                            ref[<span class="code-string">'deleteByIndex'</span>](fieldIndex);
</code></td></tr><tr><td id="L3584" class="css-a4x74f"><span>3584</span></td><td id="LC3584" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3585" class="css-a4x74f"><span>3585</span></td><td id="LC3585" class="css-1dcdqdg"><code>                        <span class="code-comment">// Flag `refId` for garbage collection.</span>
</code></td></tr><tr><td id="L3586" class="css-a4x74f"><span>3586</span></td><td id="LC3586" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (previousValue &amp;&amp; previousValue[<span class="code-string">'$changes'</span>]) {
</code></td></tr><tr><td id="L3587" class="css-a4x74f"><span>3587</span></td><td id="LC3587" class="css-1dcdqdg"><code>                            $root.removeRef(previousValue[<span class="code-string">'$changes'</span>].refId);
</code></td></tr><tr><td id="L3588" class="css-a4x74f"><span>3588</span></td><td id="LC3588" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3589" class="css-a4x74f"><span>3589</span></td><td id="LC3589" class="css-1dcdqdg"><code>                        value = <span class="code-literal">null</span>;
</code></td></tr><tr><td id="L3590" class="css-a4x74f"><span>3590</span></td><td id="LC3590" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3591" class="css-a4x74f"><span>3591</span></td><td id="LC3591" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (fieldName === <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L3592" class="css-a4x74f"><span>3592</span></td><td id="LC3592" class="css-1dcdqdg"><code>                        <span class="code-built_in">console</span>.warn(<span class="code-string">"@colyseus/schema: definition mismatch"</span>);
</code></td></tr><tr><td id="L3593" class="css-a4x74f"><span>3593</span></td><td id="LC3593" class="css-1dcdqdg"><code>                        <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3594" class="css-a4x74f"><span>3594</span></td><td id="LC3594" class="css-1dcdqdg"><code>                        <span class="code-comment">// keep skipping next bytes until reaches a known structure</span>
</code></td></tr><tr><td id="L3595" class="css-a4x74f"><span>3595</span></td><td id="LC3595" class="css-1dcdqdg"><code>                        <span class="code-comment">// by local decoder.</span>
</code></td></tr><tr><td id="L3596" class="css-a4x74f"><span>3596</span></td><td id="LC3596" class="css-1dcdqdg"><code>                        <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3597" class="css-a4x74f"><span>3597</span></td><td id="LC3597" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> nextIterator = { <span class="code-attr">offset</span>: it.offset };
</code></td></tr><tr><td id="L3598" class="css-a4x74f"><span>3598</span></td><td id="LC3598" class="css-1dcdqdg"><code>                        <span class="code-keyword">while</span> (it.offset &lt; totalBytes) {
</code></td></tr><tr><td id="L3599" class="css-a4x74f"><span>3599</span></td><td id="LC3599" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (switchStructureCheck(bytes, it)) {
</code></td></tr><tr><td id="L3600" class="css-a4x74f"><span>3600</span></td><td id="LC3600" class="css-1dcdqdg"><code>                                nextIterator.offset = it.offset + <span class="code-number">1</span>;
</code></td></tr><tr><td id="L3601" class="css-a4x74f"><span>3601</span></td><td id="LC3601" class="css-1dcdqdg"><code>                                <span class="code-keyword">if</span> ($root.refs.has(number(bytes, nextIterator))) {
</code></td></tr><tr><td id="L3602" class="css-a4x74f"><span>3602</span></td><td id="LC3602" class="css-1dcdqdg"><code>                                    <span class="code-keyword">break</span>;
</code></td></tr><tr><td id="L3603" class="css-a4x74f"><span>3603</span></td><td id="LC3603" class="css-1dcdqdg"><code>                                }
</code></td></tr><tr><td id="L3604" class="css-a4x74f"><span>3604</span></td><td id="LC3604" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L3605" class="css-a4x74f"><span>3605</span></td><td id="LC3605" class="css-1dcdqdg"><code>                            it.offset++;
</code></td></tr><tr><td id="L3606" class="css-a4x74f"><span>3606</span></td><td id="LC3606" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3607" class="css-a4x74f"><span>3607</span></td><td id="LC3607" class="css-1dcdqdg"><code>                        <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L3608" class="css-a4x74f"><span>3608</span></td><td id="LC3608" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3609" class="css-a4x74f"><span>3609</span></td><td id="LC3609" class="css-1dcdqdg"><code>                    <span class="code-keyword">else</span> <span class="code-keyword">if</span> (operation === exports.OPERATION.DELETE) ;
</code></td></tr><tr><td id="L3610" class="css-a4x74f"><span>3610</span></td><td id="LC3610" class="css-1dcdqdg"><code>                    <span class="code-keyword">else</span> <span class="code-keyword">if</span> (Schema.is(type)) {
</code></td></tr><tr><td id="L3611" class="css-a4x74f"><span>3611</span></td><td id="LC3611" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> refId_1 = number(bytes, it);
</code></td></tr><tr><td id="L3612" class="css-a4x74f"><span>3612</span></td><td id="LC3612" class="css-1dcdqdg"><code>                        value = $root.refs.get(refId_1);
</code></td></tr><tr><td id="L3613" class="css-a4x74f"><span>3613</span></td><td id="LC3613" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (operation !== exports.OPERATION.REPLACE) {
</code></td></tr><tr><td id="L3614" class="css-a4x74f"><span>3614</span></td><td id="LC3614" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> childType = <span class="code-keyword">this</span>.getSchemaType(bytes, it, type);
</code></td></tr><tr><td id="L3615" class="css-a4x74f"><span>3615</span></td><td id="LC3615" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (!value) {
</code></td></tr><tr><td id="L3616" class="css-a4x74f"><span>3616</span></td><td id="LC3616" class="css-1dcdqdg"><code>                                value = <span class="code-keyword">this</span>.createTypeInstance(childType);
</code></td></tr><tr><td id="L3617" class="css-a4x74f"><span>3617</span></td><td id="LC3617" class="css-1dcdqdg"><code>                                value.$changes.refId = refId_1;
</code></td></tr><tr><td id="L3618" class="css-a4x74f"><span>3618</span></td><td id="LC3618" class="css-1dcdqdg"><code>                                <span class="code-keyword">if</span> (previousValue) {
</code></td></tr><tr><td id="L3619" class="css-a4x74f"><span>3619</span></td><td id="LC3619" class="css-1dcdqdg"><code>                                    value.$callbacks = previousValue.$callbacks;
</code></td></tr><tr><td id="L3620" class="css-a4x74f"><span>3620</span></td><td id="LC3620" class="css-1dcdqdg"><code>                                    <span class="code-comment">// value.$listeners = previousValue.$listeners;</span>
</code></td></tr><tr><td id="L3621" class="css-a4x74f"><span>3621</span></td><td id="LC3621" class="css-1dcdqdg"><code>                                    <span class="code-keyword">if</span> (previousValue[<span class="code-string">'$changes'</span>].refId &amp;&amp;
</code></td></tr><tr><td id="L3622" class="css-a4x74f"><span>3622</span></td><td id="LC3622" class="css-1dcdqdg"><code>                                        refId_1 !== previousValue[<span class="code-string">'$changes'</span>].refId) {
</code></td></tr><tr><td id="L3623" class="css-a4x74f"><span>3623</span></td><td id="LC3623" class="css-1dcdqdg"><code>                                        $root.removeRef(previousValue[<span class="code-string">'$changes'</span>].refId);
</code></td></tr><tr><td id="L3624" class="css-a4x74f"><span>3624</span></td><td id="LC3624" class="css-1dcdqdg"><code>                                    }
</code></td></tr><tr><td id="L3625" class="css-a4x74f"><span>3625</span></td><td id="LC3625" class="css-1dcdqdg"><code>                                }
</code></td></tr><tr><td id="L3626" class="css-a4x74f"><span>3626</span></td><td id="LC3626" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L3627" class="css-a4x74f"><span>3627</span></td><td id="LC3627" class="css-1dcdqdg"><code>                            $root.addRef(refId_1, value, (value !== previousValue));
</code></td></tr><tr><td id="L3628" class="css-a4x74f"><span>3628</span></td><td id="LC3628" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3629" class="css-a4x74f"><span>3629</span></td><td id="LC3629" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3630" class="css-a4x74f"><span>3630</span></td><td id="LC3630" class="css-1dcdqdg"><code>                    <span class="code-keyword">else</span> <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (type) === <span class="code-string">"string"</span>) {
</code></td></tr><tr><td id="L3631" class="css-a4x74f"><span>3631</span></td><td id="LC3631" class="css-1dcdqdg"><code>                        <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3632" class="css-a4x74f"><span>3632</span></td><td id="LC3632" class="css-1dcdqdg"><code>                        <span class="code-comment">// primitive value (number, string, boolean, etc)</span>
</code></td></tr><tr><td id="L3633" class="css-a4x74f"><span>3633</span></td><td id="LC3633" class="css-1dcdqdg"><code>                        <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3634" class="css-a4x74f"><span>3634</span></td><td id="LC3634" class="css-1dcdqdg"><code>                        value = decodePrimitiveType(type, bytes, it);
</code></td></tr><tr><td id="L3635" class="css-a4x74f"><span>3635</span></td><td id="LC3635" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3636" class="css-a4x74f"><span>3636</span></td><td id="LC3636" class="css-1dcdqdg"><code>                    <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L3637" class="css-a4x74f"><span>3637</span></td><td id="LC3637" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> typeDef = getType(<span class="code-built_in">Object</span>.keys(type)[<span class="code-number">0</span>]);
</code></td></tr><tr><td id="L3638" class="css-a4x74f"><span>3638</span></td><td id="LC3638" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> refId_2 = number(bytes, it);
</code></td></tr><tr><td id="L3639" class="css-a4x74f"><span>3639</span></td><td id="LC3639" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> valueRef = ($root.refs.has(refId_2))
</code></td></tr><tr><td id="L3640" class="css-a4x74f"><span>3640</span></td><td id="LC3640" class="css-1dcdqdg"><code>                            ? previousValue || $root.refs.get(refId_2)
</code></td></tr><tr><td id="L3641" class="css-a4x74f"><span>3641</span></td><td id="LC3641" class="css-1dcdqdg"><code>                            : <span class="code-keyword">new</span> typeDef.constructor();
</code></td></tr><tr><td id="L3642" class="css-a4x74f"><span>3642</span></td><td id="LC3642" class="css-1dcdqdg"><code>                        value = valueRef.clone(<span class="code-literal">true</span>);
</code></td></tr><tr><td id="L3643" class="css-a4x74f"><span>3643</span></td><td id="LC3643" class="css-1dcdqdg"><code>                        value.$changes.refId = refId_2;
</code></td></tr><tr><td id="L3644" class="css-a4x74f"><span>3644</span></td><td id="LC3644" class="css-1dcdqdg"><code>                        <span class="code-comment">// preserve schema callbacks</span>
</code></td></tr><tr><td id="L3645" class="css-a4x74f"><span>3645</span></td><td id="LC3645" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (previousValue) {
</code></td></tr><tr><td id="L3646" class="css-a4x74f"><span>3646</span></td><td id="LC3646" class="css-1dcdqdg"><code>                            value[<span class="code-string">'$callbacks'</span>] = previousValue[<span class="code-string">'$callbacks'</span>];
</code></td></tr><tr><td id="L3647" class="css-a4x74f"><span>3647</span></td><td id="LC3647" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (previousValue[<span class="code-string">'$changes'</span>].refId &amp;&amp;
</code></td></tr><tr><td id="L3648" class="css-a4x74f"><span>3648</span></td><td id="LC3648" class="css-1dcdqdg"><code>                                refId_2 !== previousValue[<span class="code-string">'$changes'</span>].refId) {
</code></td></tr><tr><td id="L3649" class="css-a4x74f"><span>3649</span></td><td id="LC3649" class="css-1dcdqdg"><code>                                $root.removeRef(previousValue[<span class="code-string">'$changes'</span>].refId);
</code></td></tr><tr><td id="L3650" class="css-a4x74f"><span>3650</span></td><td id="LC3650" class="css-1dcdqdg"><code>                                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3651" class="css-a4x74f"><span>3651</span></td><td id="LC3651" class="css-1dcdqdg"><code>                                <span class="code-comment">// Trigger onRemove if structure has been replaced.</span>
</code></td></tr><tr><td id="L3652" class="css-a4x74f"><span>3652</span></td><td id="LC3652" class="css-1dcdqdg"><code>                                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3653" class="css-a4x74f"><span>3653</span></td><td id="LC3653" class="css-1dcdqdg"><code>                                <span class="code-keyword">var</span> entries = previousValue.entries();
</code></td></tr><tr><td id="L3654" class="css-a4x74f"><span>3654</span></td><td id="LC3654" class="css-1dcdqdg"><code>                                <span class="code-keyword">var</span> iter = <span class="code-keyword">void</span> <span class="code-number">0</span>;
</code></td></tr><tr><td id="L3655" class="css-a4x74f"><span>3655</span></td><td id="LC3655" class="css-1dcdqdg"><code>                                <span class="code-keyword">while</span> ((iter = entries.next()) &amp;&amp; !iter.done) {
</code></td></tr><tr><td id="L3656" class="css-a4x74f"><span>3656</span></td><td id="LC3656" class="css-1dcdqdg"><code>                                    <span class="code-keyword">var</span> key = (_a = iter.value, _a[<span class="code-number">0</span>]), value_1 = _a[<span class="code-number">1</span>];
</code></td></tr><tr><td id="L3657" class="css-a4x74f"><span>3657</span></td><td id="LC3657" class="css-1dcdqdg"><code>                                    allChanges.push({
</code></td></tr><tr><td id="L3658" class="css-a4x74f"><span>3658</span></td><td id="LC3658" class="css-1dcdqdg"><code>                                        refId: refId_2,
</code></td></tr><tr><td id="L3659" class="css-a4x74f"><span>3659</span></td><td id="LC3659" class="css-1dcdqdg"><code>                                        op: exports.OPERATION.DELETE,
</code></td></tr><tr><td id="L3660" class="css-a4x74f"><span>3660</span></td><td id="LC3660" class="css-1dcdqdg"><code>                                        field: key,
</code></td></tr><tr><td id="L3661" class="css-a4x74f"><span>3661</span></td><td id="LC3661" class="css-1dcdqdg"><code>                                        value: <span class="code-literal">undefined</span>,
</code></td></tr><tr><td id="L3662" class="css-a4x74f"><span>3662</span></td><td id="LC3662" class="css-1dcdqdg"><code>                                        previousValue: value_1,
</code></td></tr><tr><td id="L3663" class="css-a4x74f"><span>3663</span></td><td id="LC3663" class="css-1dcdqdg"><code>                                    });
</code></td></tr><tr><td id="L3664" class="css-a4x74f"><span>3664</span></td><td id="LC3664" class="css-1dcdqdg"><code>                                }
</code></td></tr><tr><td id="L3665" class="css-a4x74f"><span>3665</span></td><td id="LC3665" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L3666" class="css-a4x74f"><span>3666</span></td><td id="LC3666" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3667" class="css-a4x74f"><span>3667</span></td><td id="LC3667" class="css-1dcdqdg"><code>                        $root.addRef(refId_2, value, (valueRef !== previousValue));
</code></td></tr><tr><td id="L3668" class="css-a4x74f"><span>3668</span></td><td id="LC3668" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3669" class="css-a4x74f"><span>3669</span></td><td id="LC3669" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (value !== <span class="code-literal">null</span> &amp;&amp;
</code></td></tr><tr><td id="L3670" class="css-a4x74f"><span>3670</span></td><td id="LC3670" class="css-1dcdqdg"><code>                        value !== <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L3671" class="css-a4x74f"><span>3671</span></td><td id="LC3671" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (value[<span class="code-string">'$changes'</span>]) {
</code></td></tr><tr><td id="L3672" class="css-a4x74f"><span>3672</span></td><td id="LC3672" class="css-1dcdqdg"><code>                            value[<span class="code-string">'$changes'</span>].setParent(changeTree.ref, changeTree.root, fieldIndex);
</code></td></tr><tr><td id="L3673" class="css-a4x74f"><span>3673</span></td><td id="LC3673" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3674" class="css-a4x74f"><span>3674</span></td><td id="LC3674" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (ref <span class="code-keyword">instanceof</span> Schema) {
</code></td></tr><tr><td id="L3675" class="css-a4x74f"><span>3675</span></td><td id="LC3675" class="css-1dcdqdg"><code>                            ref[fieldName] = value;
</code></td></tr><tr><td id="L3676" class="css-a4x74f"><span>3676</span></td><td id="LC3676" class="css-1dcdqdg"><code>                            <span class="code-comment">// ref[`_${fieldName}`] = value;</span>
</code></td></tr><tr><td id="L3677" class="css-a4x74f"><span>3677</span></td><td id="LC3677" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3678" class="css-a4x74f"><span>3678</span></td><td id="LC3678" class="css-1dcdqdg"><code>                        <span class="code-keyword">else</span> <span class="code-keyword">if</span> (ref <span class="code-keyword">instanceof</span> MapSchema) {
</code></td></tr><tr><td id="L3679" class="css-a4x74f"><span>3679</span></td><td id="LC3679" class="css-1dcdqdg"><code>                            <span class="code-comment">// const key = ref['$indexes'].get(field);</span>
</code></td></tr><tr><td id="L3680" class="css-a4x74f"><span>3680</span></td><td id="LC3680" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> key = dynamicIndex;
</code></td></tr><tr><td id="L3681" class="css-a4x74f"><span>3681</span></td><td id="LC3681" class="css-1dcdqdg"><code>                            <span class="code-comment">// ref.set(key, value);</span>
</code></td></tr><tr><td id="L3682" class="css-a4x74f"><span>3682</span></td><td id="LC3682" class="css-1dcdqdg"><code>                            ref[<span class="code-string">'$items'</span>].set(key, value);
</code></td></tr><tr><td id="L3683" class="css-a4x74f"><span>3683</span></td><td id="LC3683" class="css-1dcdqdg"><code>                            ref[<span class="code-string">'$changes'</span>].allChanges.add(fieldIndex);
</code></td></tr><tr><td id="L3684" class="css-a4x74f"><span>3684</span></td><td id="LC3684" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3685" class="css-a4x74f"><span>3685</span></td><td id="LC3685" class="css-1dcdqdg"><code>                        <span class="code-keyword">else</span> <span class="code-keyword">if</span> (ref <span class="code-keyword">instanceof</span> ArraySchema) {
</code></td></tr><tr><td id="L3686" class="css-a4x74f"><span>3686</span></td><td id="LC3686" class="css-1dcdqdg"><code>                            <span class="code-comment">// const key = ref['$indexes'][field];</span>
</code></td></tr><tr><td id="L3687" class="css-a4x74f"><span>3687</span></td><td id="LC3687" class="css-1dcdqdg"><code>                            <span class="code-comment">// console.log("SETTING FOR ArraySchema =&gt;", { field, key, value });</span>
</code></td></tr><tr><td id="L3688" class="css-a4x74f"><span>3688</span></td><td id="LC3688" class="css-1dcdqdg"><code>                            <span class="code-comment">// ref[key] = value;</span>
</code></td></tr><tr><td id="L3689" class="css-a4x74f"><span>3689</span></td><td id="LC3689" class="css-1dcdqdg"><code>                            ref.setAt(fieldIndex, value);
</code></td></tr><tr><td id="L3690" class="css-a4x74f"><span>3690</span></td><td id="LC3690" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3691" class="css-a4x74f"><span>3691</span></td><td id="LC3691" class="css-1dcdqdg"><code>                        <span class="code-keyword">else</span> <span class="code-keyword">if</span> (ref <span class="code-keyword">instanceof</span> CollectionSchema) {
</code></td></tr><tr><td id="L3692" class="css-a4x74f"><span>3692</span></td><td id="LC3692" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> index = ref.add(value);
</code></td></tr><tr><td id="L3693" class="css-a4x74f"><span>3693</span></td><td id="LC3693" class="css-1dcdqdg"><code>                            ref[<span class="code-string">'setIndex'</span>](fieldIndex, index);
</code></td></tr><tr><td id="L3694" class="css-a4x74f"><span>3694</span></td><td id="LC3694" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3695" class="css-a4x74f"><span>3695</span></td><td id="LC3695" class="css-1dcdqdg"><code>                        <span class="code-keyword">else</span> <span class="code-keyword">if</span> (ref <span class="code-keyword">instanceof</span> SetSchema) {
</code></td></tr><tr><td id="L3696" class="css-a4x74f"><span>3696</span></td><td id="LC3696" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> index = ref.add(value);
</code></td></tr><tr><td id="L3697" class="css-a4x74f"><span>3697</span></td><td id="LC3697" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (index !== <span class="code-literal">false</span>) {
</code></td></tr><tr><td id="L3698" class="css-a4x74f"><span>3698</span></td><td id="LC3698" class="css-1dcdqdg"><code>                                ref[<span class="code-string">'setIndex'</span>](fieldIndex, index);
</code></td></tr><tr><td id="L3699" class="css-a4x74f"><span>3699</span></td><td id="LC3699" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L3700" class="css-a4x74f"><span>3700</span></td><td id="LC3700" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3701" class="css-a4x74f"><span>3701</span></td><td id="LC3701" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3702" class="css-a4x74f"><span>3702</span></td><td id="LC3702" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (previousValue !== value) {
</code></td></tr><tr><td id="L3703" class="css-a4x74f"><span>3703</span></td><td id="LC3703" class="css-1dcdqdg"><code>                        allChanges.push({
</code></td></tr><tr><td id="L3704" class="css-a4x74f"><span>3704</span></td><td id="LC3704" class="css-1dcdqdg"><code>                            refId: refId,
</code></td></tr><tr><td id="L3705" class="css-a4x74f"><span>3705</span></td><td id="LC3705" class="css-1dcdqdg"><code>                            op: operation,
</code></td></tr><tr><td id="L3706" class="css-a4x74f"><span>3706</span></td><td id="LC3706" class="css-1dcdqdg"><code>                            field: fieldName,
</code></td></tr><tr><td id="L3707" class="css-a4x74f"><span>3707</span></td><td id="LC3707" class="css-1dcdqdg"><code>                            dynamicIndex: dynamicIndex,
</code></td></tr><tr><td id="L3708" class="css-a4x74f"><span>3708</span></td><td id="LC3708" class="css-1dcdqdg"><code>                            value: value,
</code></td></tr><tr><td id="L3709" class="css-a4x74f"><span>3709</span></td><td id="LC3709" class="css-1dcdqdg"><code>                            previousValue: previousValue,
</code></td></tr><tr><td id="L3710" class="css-a4x74f"><span>3710</span></td><td id="LC3710" class="css-1dcdqdg"><code>                        });
</code></td></tr><tr><td id="L3711" class="css-a4x74f"><span>3711</span></td><td id="LC3711" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3712" class="css-a4x74f"><span>3712</span></td><td id="LC3712" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3713" class="css-a4x74f"><span>3713</span></td><td id="LC3713" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>._triggerChanges(allChanges);
</code></td></tr><tr><td id="L3714" class="css-a4x74f"><span>3714</span></td><td id="LC3714" class="css-1dcdqdg"><code>                <span class="code-comment">// drop references of unused schemas</span>
</code></td></tr><tr><td id="L3715" class="css-a4x74f"><span>3715</span></td><td id="LC3715" class="css-1dcdqdg"><code>                $root.garbageCollectDeletedRefs();
</code></td></tr><tr><td id="L3716" class="css-a4x74f"><span>3716</span></td><td id="LC3716" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> allChanges;
</code></td></tr><tr><td id="L3717" class="css-a4x74f"><span>3717</span></td><td id="LC3717" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3718" class="css-a4x74f"><span>3718</span></td><td id="LC3718" class="css-1dcdqdg"><code>            Schema.prototype.encode = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">encodeAll, bytes, useFilters</span>) </span>{
</code></td></tr><tr><td id="L3719" class="css-a4x74f"><span>3719</span></td><td id="LC3719" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (encodeAll === <span class="code-keyword">void</span> <span class="code-number">0</span>) { encodeAll = <span class="code-literal">false</span>; }
</code></td></tr><tr><td id="L3720" class="css-a4x74f"><span>3720</span></td><td id="LC3720" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (bytes === <span class="code-keyword">void</span> <span class="code-number">0</span>) { bytes = []; }
</code></td></tr><tr><td id="L3721" class="css-a4x74f"><span>3721</span></td><td id="LC3721" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (useFilters === <span class="code-keyword">void</span> <span class="code-number">0</span>) { useFilters = <span class="code-literal">false</span>; }
</code></td></tr><tr><td id="L3722" class="css-a4x74f"><span>3722</span></td><td id="LC3722" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> rootChangeTree = <span class="code-keyword">this</span>.$changes;
</code></td></tr><tr><td id="L3723" class="css-a4x74f"><span>3723</span></td><td id="LC3723" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> refIdsVisited = <span class="code-keyword">new</span> <span class="code-built_in">WeakSet</span>();
</code></td></tr><tr><td id="L3724" class="css-a4x74f"><span>3724</span></td><td id="LC3724" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> changeTrees = [rootChangeTree];
</code></td></tr><tr><td id="L3725" class="css-a4x74f"><span>3725</span></td><td id="LC3725" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> numChangeTrees = <span class="code-number">1</span>;
</code></td></tr><tr><td id="L3726" class="css-a4x74f"><span>3726</span></td><td id="LC3726" class="css-1dcdqdg"><code>                <span class="code-keyword">for</span> (<span class="code-keyword">var</span> i = <span class="code-number">0</span>; i &lt; numChangeTrees; i++) {
</code></td></tr><tr><td id="L3727" class="css-a4x74f"><span>3727</span></td><td id="LC3727" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> changeTree = changeTrees[i];
</code></td></tr><tr><td id="L3728" class="css-a4x74f"><span>3728</span></td><td id="LC3728" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> ref = changeTree.ref;
</code></td></tr><tr><td id="L3729" class="css-a4x74f"><span>3729</span></td><td id="LC3729" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> isSchema = (ref <span class="code-keyword">instanceof</span> Schema);
</code></td></tr><tr><td id="L3730" class="css-a4x74f"><span>3730</span></td><td id="LC3730" class="css-1dcdqdg"><code>                    <span class="code-comment">// Generate unique refId for the ChangeTree.</span>
</code></td></tr><tr><td id="L3731" class="css-a4x74f"><span>3731</span></td><td id="LC3731" class="css-1dcdqdg"><code>                    changeTree.ensureRefId();
</code></td></tr><tr><td id="L3732" class="css-a4x74f"><span>3732</span></td><td id="LC3732" class="css-1dcdqdg"><code>                    <span class="code-comment">// mark this ChangeTree as visited.</span>
</code></td></tr><tr><td id="L3733" class="css-a4x74f"><span>3733</span></td><td id="LC3733" class="css-1dcdqdg"><code>                    refIdsVisited.add(changeTree);
</code></td></tr><tr><td id="L3734" class="css-a4x74f"><span>3734</span></td><td id="LC3734" class="css-1dcdqdg"><code>                    <span class="code-comment">// root `refId` is skipped.</span>
</code></td></tr><tr><td id="L3735" class="css-a4x74f"><span>3735</span></td><td id="LC3735" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (changeTree !== rootChangeTree &amp;&amp;
</code></td></tr><tr><td id="L3736" class="css-a4x74f"><span>3736</span></td><td id="LC3736" class="css-1dcdqdg"><code>                        (changeTree.changed || encodeAll)) {
</code></td></tr><tr><td id="L3737" class="css-a4x74f"><span>3737</span></td><td id="LC3737" class="css-1dcdqdg"><code>                        uint8$<span class="code-number">1</span>(bytes, SWITCH_TO_STRUCTURE);
</code></td></tr><tr><td id="L3738" class="css-a4x74f"><span>3738</span></td><td id="LC3738" class="css-1dcdqdg"><code>                        number$<span class="code-number">1</span>(bytes, changeTree.refId);
</code></td></tr><tr><td id="L3739" class="css-a4x74f"><span>3739</span></td><td id="LC3739" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3740" class="css-a4x74f"><span>3740</span></td><td id="LC3740" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> changes = (encodeAll)
</code></td></tr><tr><td id="L3741" class="css-a4x74f"><span>3741</span></td><td id="LC3741" class="css-1dcdqdg"><code>                        ? <span class="code-built_in">Array</span>.from(changeTree.allChanges)
</code></td></tr><tr><td id="L3742" class="css-a4x74f"><span>3742</span></td><td id="LC3742" class="css-1dcdqdg"><code>                        : <span class="code-built_in">Array</span>.from(changeTree.changes.values());
</code></td></tr><tr><td id="L3743" class="css-a4x74f"><span>3743</span></td><td id="LC3743" class="css-1dcdqdg"><code>                    <span class="code-keyword">for</span> (<span class="code-keyword">var</span> j = <span class="code-number">0</span>, cl = changes.length; j &lt; cl; j++) {
</code></td></tr><tr><td id="L3744" class="css-a4x74f"><span>3744</span></td><td id="LC3744" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> operation = (encodeAll)
</code></td></tr><tr><td id="L3745" class="css-a4x74f"><span>3745</span></td><td id="LC3745" class="css-1dcdqdg"><code>                            ? { <span class="code-attr">op</span>: exports.OPERATION.ADD, <span class="code-attr">index</span>: changes[j] }
</code></td></tr><tr><td id="L3746" class="css-a4x74f"><span>3746</span></td><td id="LC3746" class="css-1dcdqdg"><code>                            : changes[j];
</code></td></tr><tr><td id="L3747" class="css-a4x74f"><span>3747</span></td><td id="LC3747" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> fieldIndex = operation.index;
</code></td></tr><tr><td id="L3748" class="css-a4x74f"><span>3748</span></td><td id="LC3748" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> field = (isSchema)
</code></td></tr><tr><td id="L3749" class="css-a4x74f"><span>3749</span></td><td id="LC3749" class="css-1dcdqdg"><code>                            ? ref[<span class="code-string">'_definition'</span>].fieldsByIndex &amp;&amp; ref[<span class="code-string">'_definition'</span>].fieldsByIndex[fieldIndex]
</code></td></tr><tr><td id="L3750" class="css-a4x74f"><span>3750</span></td><td id="LC3750" class="css-1dcdqdg"><code>                            : fieldIndex;
</code></td></tr><tr><td id="L3751" class="css-a4x74f"><span>3751</span></td><td id="LC3751" class="css-1dcdqdg"><code>                        <span class="code-comment">// cache begin index if `useFilters`</span>
</code></td></tr><tr><td id="L3752" class="css-a4x74f"><span>3752</span></td><td id="LC3752" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> beginIndex = bytes.length;
</code></td></tr><tr><td id="L3753" class="css-a4x74f"><span>3753</span></td><td id="LC3753" class="css-1dcdqdg"><code>                        <span class="code-comment">// encode field index + operation</span>
</code></td></tr><tr><td id="L3754" class="css-a4x74f"><span>3754</span></td><td id="LC3754" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (operation.op !== exports.OPERATION.TOUCH) {
</code></td></tr><tr><td id="L3755" class="css-a4x74f"><span>3755</span></td><td id="LC3755" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (isSchema) {
</code></td></tr><tr><td id="L3756" class="css-a4x74f"><span>3756</span></td><td id="LC3756" class="css-1dcdqdg"><code>                                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3757" class="css-a4x74f"><span>3757</span></td><td id="LC3757" class="css-1dcdqdg"><code>                                <span class="code-comment">// Compress `fieldIndex` + `operation` into a single byte.</span>
</code></td></tr><tr><td id="L3758" class="css-a4x74f"><span>3758</span></td><td id="LC3758" class="css-1dcdqdg"><code>                                <span class="code-comment">// This adds a limitaion of 64 fields per Schema structure</span>
</code></td></tr><tr><td id="L3759" class="css-a4x74f"><span>3759</span></td><td id="LC3759" class="css-1dcdqdg"><code>                                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3760" class="css-a4x74f"><span>3760</span></td><td id="LC3760" class="css-1dcdqdg"><code>                                uint8$<span class="code-number">1</span>(bytes, (fieldIndex | operation.op));
</code></td></tr><tr><td id="L3761" class="css-a4x74f"><span>3761</span></td><td id="LC3761" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L3762" class="css-a4x74f"><span>3762</span></td><td id="LC3762" class="css-1dcdqdg"><code>                            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L3763" class="css-a4x74f"><span>3763</span></td><td id="LC3763" class="css-1dcdqdg"><code>                                uint8$<span class="code-number">1</span>(bytes, operation.op);
</code></td></tr><tr><td id="L3764" class="css-a4x74f"><span>3764</span></td><td id="LC3764" class="css-1dcdqdg"><code>                                <span class="code-comment">// custom operations</span>
</code></td></tr><tr><td id="L3765" class="css-a4x74f"><span>3765</span></td><td id="LC3765" class="css-1dcdqdg"><code>                                <span class="code-keyword">if</span> (operation.op === exports.OPERATION.CLEAR) {
</code></td></tr><tr><td id="L3766" class="css-a4x74f"><span>3766</span></td><td id="LC3766" class="css-1dcdqdg"><code>                                    <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L3767" class="css-a4x74f"><span>3767</span></td><td id="LC3767" class="css-1dcdqdg"><code>                                }
</code></td></tr><tr><td id="L3768" class="css-a4x74f"><span>3768</span></td><td id="LC3768" class="css-1dcdqdg"><code>                                <span class="code-comment">// indexed operations</span>
</code></td></tr><tr><td id="L3769" class="css-a4x74f"><span>3769</span></td><td id="LC3769" class="css-1dcdqdg"><code>                                number$<span class="code-number">1</span>(bytes, fieldIndex);
</code></td></tr><tr><td id="L3770" class="css-a4x74f"><span>3770</span></td><td id="LC3770" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L3771" class="css-a4x74f"><span>3771</span></td><td id="LC3771" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3772" class="css-a4x74f"><span>3772</span></td><td id="LC3772" class="css-1dcdqdg"><code>                        <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3773" class="css-a4x74f"><span>3773</span></td><td id="LC3773" class="css-1dcdqdg"><code>                        <span class="code-comment">// encode "alias" for dynamic fields (maps)</span>
</code></td></tr><tr><td id="L3774" class="css-a4x74f"><span>3774</span></td><td id="LC3774" class="css-1dcdqdg"><code>                        <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3775" class="css-a4x74f"><span>3775</span></td><td id="LC3775" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (!isSchema &amp;&amp;
</code></td></tr><tr><td id="L3776" class="css-a4x74f"><span>3776</span></td><td id="LC3776" class="css-1dcdqdg"><code>                            (operation.op &amp; exports.OPERATION.ADD) == exports.OPERATION.ADD <span class="code-comment">// ADD or DELETE_AND_ADD</span>
</code></td></tr><tr><td id="L3777" class="css-a4x74f"><span>3777</span></td><td id="LC3777" class="css-1dcdqdg"><code>                        ) {
</code></td></tr><tr><td id="L3778" class="css-a4x74f"><span>3778</span></td><td id="LC3778" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (ref <span class="code-keyword">instanceof</span> MapSchema) {
</code></td></tr><tr><td id="L3779" class="css-a4x74f"><span>3779</span></td><td id="LC3779" class="css-1dcdqdg"><code>                                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3780" class="css-a4x74f"><span>3780</span></td><td id="LC3780" class="css-1dcdqdg"><code>                                <span class="code-comment">// MapSchema dynamic key</span>
</code></td></tr><tr><td id="L3781" class="css-a4x74f"><span>3781</span></td><td id="LC3781" class="css-1dcdqdg"><code>                                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3782" class="css-a4x74f"><span>3782</span></td><td id="LC3782" class="css-1dcdqdg"><code>                                <span class="code-keyword">var</span> dynamicIndex = changeTree.ref[<span class="code-string">'$indexes'</span>].get(fieldIndex);
</code></td></tr><tr><td id="L3783" class="css-a4x74f"><span>3783</span></td><td id="LC3783" class="css-1dcdqdg"><code>                                string$<span class="code-number">1</span>(bytes, dynamicIndex);
</code></td></tr><tr><td id="L3784" class="css-a4x74f"><span>3784</span></td><td id="LC3784" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L3785" class="css-a4x74f"><span>3785</span></td><td id="LC3785" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3786" class="css-a4x74f"><span>3786</span></td><td id="LC3786" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (operation.op === exports.OPERATION.DELETE) {
</code></td></tr><tr><td id="L3787" class="css-a4x74f"><span>3787</span></td><td id="LC3787" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3788" class="css-a4x74f"><span>3788</span></td><td id="LC3788" class="css-1dcdqdg"><code>                            <span class="code-comment">// <span class="code-doctag">TODO:</span> delete from filter cache data.</span>
</code></td></tr><tr><td id="L3789" class="css-a4x74f"><span>3789</span></td><td id="LC3789" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3790" class="css-a4x74f"><span>3790</span></td><td id="LC3790" class="css-1dcdqdg"><code>                            <span class="code-comment">// if (useFilters) {</span>
</code></td></tr><tr><td id="L3791" class="css-a4x74f"><span>3791</span></td><td id="LC3791" class="css-1dcdqdg"><code>                            <span class="code-comment">//     delete changeTree.caches[fieldIndex];</span>
</code></td></tr><tr><td id="L3792" class="css-a4x74f"><span>3792</span></td><td id="LC3792" class="css-1dcdqdg"><code>                            <span class="code-comment">// }</span>
</code></td></tr><tr><td id="L3793" class="css-a4x74f"><span>3793</span></td><td id="LC3793" class="css-1dcdqdg"><code>                            <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L3794" class="css-a4x74f"><span>3794</span></td><td id="LC3794" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3795" class="css-a4x74f"><span>3795</span></td><td id="LC3795" class="css-1dcdqdg"><code>                        <span class="code-comment">// const type = changeTree.childType || ref._schema[field];</span>
</code></td></tr><tr><td id="L3796" class="css-a4x74f"><span>3796</span></td><td id="LC3796" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> type = changeTree.getType(fieldIndex);
</code></td></tr><tr><td id="L3797" class="css-a4x74f"><span>3797</span></td><td id="LC3797" class="css-1dcdqdg"><code>                        <span class="code-comment">// const type = changeTree.getType(fieldIndex);</span>
</code></td></tr><tr><td id="L3798" class="css-a4x74f"><span>3798</span></td><td id="LC3798" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> value = changeTree.getValue(fieldIndex);
</code></td></tr><tr><td id="L3799" class="css-a4x74f"><span>3799</span></td><td id="LC3799" class="css-1dcdqdg"><code>                        <span class="code-comment">// Enqueue ChangeTree to be visited</span>
</code></td></tr><tr><td id="L3800" class="css-a4x74f"><span>3800</span></td><td id="LC3800" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (value &amp;&amp;
</code></td></tr><tr><td id="L3801" class="css-a4x74f"><span>3801</span></td><td id="LC3801" class="css-1dcdqdg"><code>                            value[<span class="code-string">'$changes'</span>] &amp;&amp;
</code></td></tr><tr><td id="L3802" class="css-a4x74f"><span>3802</span></td><td id="LC3802" class="css-1dcdqdg"><code>                            !refIdsVisited.has(value[<span class="code-string">'$changes'</span>])) {
</code></td></tr><tr><td id="L3803" class="css-a4x74f"><span>3803</span></td><td id="LC3803" class="css-1dcdqdg"><code>                            changeTrees.push(value[<span class="code-string">'$changes'</span>]);
</code></td></tr><tr><td id="L3804" class="css-a4x74f"><span>3804</span></td><td id="LC3804" class="css-1dcdqdg"><code>                            value[<span class="code-string">'$changes'</span>].ensureRefId();
</code></td></tr><tr><td id="L3805" class="css-a4x74f"><span>3805</span></td><td id="LC3805" class="css-1dcdqdg"><code>                            numChangeTrees++;
</code></td></tr><tr><td id="L3806" class="css-a4x74f"><span>3806</span></td><td id="LC3806" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3807" class="css-a4x74f"><span>3807</span></td><td id="LC3807" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (operation.op === exports.OPERATION.TOUCH) {
</code></td></tr><tr><td id="L3808" class="css-a4x74f"><span>3808</span></td><td id="LC3808" class="css-1dcdqdg"><code>                            <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L3809" class="css-a4x74f"><span>3809</span></td><td id="LC3809" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3810" class="css-a4x74f"><span>3810</span></td><td id="LC3810" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (Schema.is(type)) {
</code></td></tr><tr><td id="L3811" class="css-a4x74f"><span>3811</span></td><td id="LC3811" class="css-1dcdqdg"><code>                            assertInstanceType(value, type, ref, field);
</code></td></tr><tr><td id="L3812" class="css-a4x74f"><span>3812</span></td><td id="LC3812" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3813" class="css-a4x74f"><span>3813</span></td><td id="LC3813" class="css-1dcdqdg"><code>                            <span class="code-comment">// Encode refId for this instance.</span>
</code></td></tr><tr><td id="L3814" class="css-a4x74f"><span>3814</span></td><td id="LC3814" class="css-1dcdqdg"><code>                            <span class="code-comment">// The actual instance is going to be encoded on next `changeTree` iteration.</span>
</code></td></tr><tr><td id="L3815" class="css-a4x74f"><span>3815</span></td><td id="LC3815" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3816" class="css-a4x74f"><span>3816</span></td><td id="LC3816" class="css-1dcdqdg"><code>                            number$<span class="code-number">1</span>(bytes, value.$changes.refId);
</code></td></tr><tr><td id="L3817" class="css-a4x74f"><span>3817</span></td><td id="LC3817" class="css-1dcdqdg"><code>                            <span class="code-comment">// Try to encode inherited TYPE_ID if it's an ADD operation.</span>
</code></td></tr><tr><td id="L3818" class="css-a4x74f"><span>3818</span></td><td id="LC3818" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> ((operation.op &amp; exports.OPERATION.ADD) === exports.OPERATION.ADD) {
</code></td></tr><tr><td id="L3819" class="css-a4x74f"><span>3819</span></td><td id="LC3819" class="css-1dcdqdg"><code>                                <span class="code-keyword">this</span>.tryEncodeTypeId(bytes, type, value.constructor);
</code></td></tr><tr><td id="L3820" class="css-a4x74f"><span>3820</span></td><td id="LC3820" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L3821" class="css-a4x74f"><span>3821</span></td><td id="LC3821" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3822" class="css-a4x74f"><span>3822</span></td><td id="LC3822" class="css-1dcdqdg"><code>                        <span class="code-keyword">else</span> <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (type) === <span class="code-string">"string"</span>) {
</code></td></tr><tr><td id="L3823" class="css-a4x74f"><span>3823</span></td><td id="LC3823" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3824" class="css-a4x74f"><span>3824</span></td><td id="LC3824" class="css-1dcdqdg"><code>                            <span class="code-comment">// Primitive values</span>
</code></td></tr><tr><td id="L3825" class="css-a4x74f"><span>3825</span></td><td id="LC3825" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3826" class="css-a4x74f"><span>3826</span></td><td id="LC3826" class="css-1dcdqdg"><code>                            encodePrimitiveType(type, bytes, value, ref, field);
</code></td></tr><tr><td id="L3827" class="css-a4x74f"><span>3827</span></td><td id="LC3827" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3828" class="css-a4x74f"><span>3828</span></td><td id="LC3828" class="css-1dcdqdg"><code>                        <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L3829" class="css-a4x74f"><span>3829</span></td><td id="LC3829" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3830" class="css-a4x74f"><span>3830</span></td><td id="LC3830" class="css-1dcdqdg"><code>                            <span class="code-comment">// Custom type (MapSchema, ArraySchema, etc)</span>
</code></td></tr><tr><td id="L3831" class="css-a4x74f"><span>3831</span></td><td id="LC3831" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3832" class="css-a4x74f"><span>3832</span></td><td id="LC3832" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> definition = getType(<span class="code-built_in">Object</span>.keys(type)[<span class="code-number">0</span>]);
</code></td></tr><tr><td id="L3833" class="css-a4x74f"><span>3833</span></td><td id="LC3833" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3834" class="css-a4x74f"><span>3834</span></td><td id="LC3834" class="css-1dcdqdg"><code>                            <span class="code-comment">// ensure a ArraySchema has been provided</span>
</code></td></tr><tr><td id="L3835" class="css-a4x74f"><span>3835</span></td><td id="LC3835" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3836" class="css-a4x74f"><span>3836</span></td><td id="LC3836" class="css-1dcdqdg"><code>                            assertInstanceType(ref[<span class="code-string">"_"</span>.concat(field)], definition.constructor, ref, field);
</code></td></tr><tr><td id="L3837" class="css-a4x74f"><span>3837</span></td><td id="LC3837" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3838" class="css-a4x74f"><span>3838</span></td><td id="LC3838" class="css-1dcdqdg"><code>                            <span class="code-comment">// Encode refId for this instance.</span>
</code></td></tr><tr><td id="L3839" class="css-a4x74f"><span>3839</span></td><td id="LC3839" class="css-1dcdqdg"><code>                            <span class="code-comment">// The actual instance is going to be encoded on next `changeTree` iteration.</span>
</code></td></tr><tr><td id="L3840" class="css-a4x74f"><span>3840</span></td><td id="LC3840" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3841" class="css-a4x74f"><span>3841</span></td><td id="LC3841" class="css-1dcdqdg"><code>                            number$<span class="code-number">1</span>(bytes, value.$changes.refId);
</code></td></tr><tr><td id="L3842" class="css-a4x74f"><span>3842</span></td><td id="LC3842" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3843" class="css-a4x74f"><span>3843</span></td><td id="LC3843" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (useFilters) {
</code></td></tr><tr><td id="L3844" class="css-a4x74f"><span>3844</span></td><td id="LC3844" class="css-1dcdqdg"><code>                            <span class="code-comment">// cache begin / end index</span>
</code></td></tr><tr><td id="L3845" class="css-a4x74f"><span>3845</span></td><td id="LC3845" class="css-1dcdqdg"><code>                            changeTree.cache(fieldIndex, bytes.slice(beginIndex));
</code></td></tr><tr><td id="L3846" class="css-a4x74f"><span>3846</span></td><td id="LC3846" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3847" class="css-a4x74f"><span>3847</span></td><td id="LC3847" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3848" class="css-a4x74f"><span>3848</span></td><td id="LC3848" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (!encodeAll &amp;&amp; !useFilters) {
</code></td></tr><tr><td id="L3849" class="css-a4x74f"><span>3849</span></td><td id="LC3849" class="css-1dcdqdg"><code>                        changeTree.discard();
</code></td></tr><tr><td id="L3850" class="css-a4x74f"><span>3850</span></td><td id="LC3850" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3851" class="css-a4x74f"><span>3851</span></td><td id="LC3851" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L3852" class="css-a4x74f"><span>3852</span></td><td id="LC3852" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> bytes;
</code></td></tr><tr><td id="L3853" class="css-a4x74f"><span>3853</span></td><td id="LC3853" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3854" class="css-a4x74f"><span>3854</span></td><td id="LC3854" class="css-1dcdqdg"><code>            Schema.prototype.encodeAll = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">useFilters</span>) </span>{
</code></td></tr><tr><td id="L3855" class="css-a4x74f"><span>3855</span></td><td id="LC3855" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.encode(<span class="code-literal">true</span>, [], useFilters);
</code></td></tr><tr><td id="L3856" class="css-a4x74f"><span>3856</span></td><td id="LC3856" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L3857" class="css-a4x74f"><span>3857</span></td><td id="LC3857" class="css-1dcdqdg"><code>            Schema.prototype.applyFilters = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">client, encodeAll</span>) </span>{
</code></td></tr><tr><td id="L3858" class="css-a4x74f"><span>3858</span></td><td id="LC3858" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _a, _b;
</code></td></tr><tr><td id="L3859" class="css-a4x74f"><span>3859</span></td><td id="LC3859" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (encodeAll === <span class="code-keyword">void</span> <span class="code-number">0</span>) { encodeAll = <span class="code-literal">false</span>; }
</code></td></tr><tr><td id="L3860" class="css-a4x74f"><span>3860</span></td><td id="LC3860" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> root = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L3861" class="css-a4x74f"><span>3861</span></td><td id="LC3861" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> refIdsDissallowed = <span class="code-keyword">new</span> <span class="code-built_in">Set</span>();
</code></td></tr><tr><td id="L3862" class="css-a4x74f"><span>3862</span></td><td id="LC3862" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> $filterState = ClientState.get(client);
</code></td></tr><tr><td id="L3863" class="css-a4x74f"><span>3863</span></td><td id="LC3863" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> changeTrees = [<span class="code-keyword">this</span>.$changes];
</code></td></tr><tr><td id="L3864" class="css-a4x74f"><span>3864</span></td><td id="LC3864" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> numChangeTrees = <span class="code-number">1</span>;
</code></td></tr><tr><td id="L3865" class="css-a4x74f"><span>3865</span></td><td id="LC3865" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> filteredBytes = [];
</code></td></tr><tr><td id="L3866" class="css-a4x74f"><span>3866</span></td><td id="LC3866" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _loop_1 = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">i</span>) </span>{
</code></td></tr><tr><td id="L3867" class="css-a4x74f"><span>3867</span></td><td id="LC3867" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> changeTree = changeTrees[i];
</code></td></tr><tr><td id="L3868" class="css-a4x74f"><span>3868</span></td><td id="LC3868" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (refIdsDissallowed.has(changeTree.refId)) {
</code></td></tr><tr><td id="L3869" class="css-a4x74f"><span>3869</span></td><td id="LC3869" class="css-1dcdqdg"><code>                        <span class="code-keyword">return</span> <span class="code-string">"continue"</span>;
</code></td></tr><tr><td id="L3870" class="css-a4x74f"><span>3870</span></td><td id="LC3870" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3871" class="css-a4x74f"><span>3871</span></td><td id="LC3871" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> ref = changeTree.ref;
</code></td></tr><tr><td id="L3872" class="css-a4x74f"><span>3872</span></td><td id="LC3872" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> isSchema = ref <span class="code-keyword">instanceof</span> Schema;
</code></td></tr><tr><td id="L3873" class="css-a4x74f"><span>3873</span></td><td id="LC3873" class="css-1dcdqdg"><code>                    uint8$<span class="code-number">1</span>(filteredBytes, SWITCH_TO_STRUCTURE);
</code></td></tr><tr><td id="L3874" class="css-a4x74f"><span>3874</span></td><td id="LC3874" class="css-1dcdqdg"><code>                    number$<span class="code-number">1</span>(filteredBytes, changeTree.refId);
</code></td></tr><tr><td id="L3875" class="css-a4x74f"><span>3875</span></td><td id="LC3875" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> clientHasRefId = $filterState.refIds.has(changeTree);
</code></td></tr><tr><td id="L3876" class="css-a4x74f"><span>3876</span></td><td id="LC3876" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> isEncodeAll = (encodeAll || !clientHasRefId);
</code></td></tr><tr><td id="L3877" class="css-a4x74f"><span>3877</span></td><td id="LC3877" class="css-1dcdqdg"><code>                    <span class="code-comment">// console.log("REF:", ref.constructor.name);</span>
</code></td></tr><tr><td id="L3878" class="css-a4x74f"><span>3878</span></td><td id="LC3878" class="css-1dcdqdg"><code>                    <span class="code-comment">// console.log("Encode all?", isEncodeAll);</span>
</code></td></tr><tr><td id="L3879" class="css-a4x74f"><span>3879</span></td><td id="LC3879" class="css-1dcdqdg"><code>                    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3880" class="css-a4x74f"><span>3880</span></td><td id="LC3880" class="css-1dcdqdg"><code>                    <span class="code-comment">// include `changeTree` on list of known refIds by this client.</span>
</code></td></tr><tr><td id="L3881" class="css-a4x74f"><span>3881</span></td><td id="LC3881" class="css-1dcdqdg"><code>                    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3882" class="css-a4x74f"><span>3882</span></td><td id="LC3882" class="css-1dcdqdg"><code>                    $filterState.addRefId(changeTree);
</code></td></tr><tr><td id="L3883" class="css-a4x74f"><span>3883</span></td><td id="LC3883" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> containerIndexes = $filterState.containerIndexes.get(changeTree);
</code></td></tr><tr><td id="L3884" class="css-a4x74f"><span>3884</span></td><td id="LC3884" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> changes = (isEncodeAll)
</code></td></tr><tr><td id="L3885" class="css-a4x74f"><span>3885</span></td><td id="LC3885" class="css-1dcdqdg"><code>                        ? <span class="code-built_in">Array</span>.from(changeTree.allChanges)
</code></td></tr><tr><td id="L3886" class="css-a4x74f"><span>3886</span></td><td id="LC3886" class="css-1dcdqdg"><code>                        : <span class="code-built_in">Array</span>.from(changeTree.changes.values());
</code></td></tr><tr><td id="L3887" class="css-a4x74f"><span>3887</span></td><td id="LC3887" class="css-1dcdqdg"><code>                    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3888" class="css-a4x74f"><span>3888</span></td><td id="LC3888" class="css-1dcdqdg"><code>                    <span class="code-comment">// WORKAROUND: tries to re-evaluate previously not included @filter() attributes</span>
</code></td></tr><tr><td id="L3889" class="css-a4x74f"><span>3889</span></td><td id="LC3889" class="css-1dcdqdg"><code>                    <span class="code-comment">// - see "DELETE a field of Schema" test case.</span>
</code></td></tr><tr><td id="L3890" class="css-a4x74f"><span>3890</span></td><td id="LC3890" class="css-1dcdqdg"><code>                    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3891" class="css-a4x74f"><span>3891</span></td><td id="LC3891" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (!encodeAll &amp;&amp;
</code></td></tr><tr><td id="L3892" class="css-a4x74f"><span>3892</span></td><td id="LC3892" class="css-1dcdqdg"><code>                        isSchema &amp;&amp;
</code></td></tr><tr><td id="L3893" class="css-a4x74f"><span>3893</span></td><td id="LC3893" class="css-1dcdqdg"><code>                        ref._definition.indexesWithFilters) {
</code></td></tr><tr><td id="L3894" class="css-a4x74f"><span>3894</span></td><td id="LC3894" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> indexesWithFilters = ref._definition.indexesWithFilters;
</code></td></tr><tr><td id="L3895" class="css-a4x74f"><span>3895</span></td><td id="LC3895" class="css-1dcdqdg"><code>                        indexesWithFilters.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">indexWithFilter</span>) </span>{
</code></td></tr><tr><td id="L3896" class="css-a4x74f"><span>3896</span></td><td id="LC3896" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (!containerIndexes.has(indexWithFilter) &amp;&amp;
</code></td></tr><tr><td id="L3897" class="css-a4x74f"><span>3897</span></td><td id="LC3897" class="css-1dcdqdg"><code>                                changeTree.allChanges.has(indexWithFilter)) {
</code></td></tr><tr><td id="L3898" class="css-a4x74f"><span>3898</span></td><td id="LC3898" class="css-1dcdqdg"><code>                                <span class="code-keyword">if</span> (isEncodeAll) {
</code></td></tr><tr><td id="L3899" class="css-a4x74f"><span>3899</span></td><td id="LC3899" class="css-1dcdqdg"><code>                                    changes.push(indexWithFilter);
</code></td></tr><tr><td id="L3900" class="css-a4x74f"><span>3900</span></td><td id="LC3900" class="css-1dcdqdg"><code>                                }
</code></td></tr><tr><td id="L3901" class="css-a4x74f"><span>3901</span></td><td id="LC3901" class="css-1dcdqdg"><code>                                <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L3902" class="css-a4x74f"><span>3902</span></td><td id="LC3902" class="css-1dcdqdg"><code>                                    changes.push({ <span class="code-attr">op</span>: exports.OPERATION.ADD, <span class="code-attr">index</span>: indexWithFilter, });
</code></td></tr><tr><td id="L3903" class="css-a4x74f"><span>3903</span></td><td id="LC3903" class="css-1dcdqdg"><code>                                }
</code></td></tr><tr><td id="L3904" class="css-a4x74f"><span>3904</span></td><td id="LC3904" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L3905" class="css-a4x74f"><span>3905</span></td><td id="LC3905" class="css-1dcdqdg"><code>                        });
</code></td></tr><tr><td id="L3906" class="css-a4x74f"><span>3906</span></td><td id="LC3906" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L3907" class="css-a4x74f"><span>3907</span></td><td id="LC3907" class="css-1dcdqdg"><code>                    <span class="code-keyword">for</span> (<span class="code-keyword">var</span> j = <span class="code-number">0</span>, cl = changes.length; j &lt; cl; j++) {
</code></td></tr><tr><td id="L3908" class="css-a4x74f"><span>3908</span></td><td id="LC3908" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> change = (isEncodeAll)
</code></td></tr><tr><td id="L3909" class="css-a4x74f"><span>3909</span></td><td id="LC3909" class="css-1dcdqdg"><code>                            ? { <span class="code-attr">op</span>: exports.OPERATION.ADD, <span class="code-attr">index</span>: changes[j] }
</code></td></tr><tr><td id="L3910" class="css-a4x74f"><span>3910</span></td><td id="LC3910" class="css-1dcdqdg"><code>                            : changes[j];
</code></td></tr><tr><td id="L3911" class="css-a4x74f"><span>3911</span></td><td id="LC3911" class="css-1dcdqdg"><code>                        <span class="code-comment">// custom operations</span>
</code></td></tr><tr><td id="L3912" class="css-a4x74f"><span>3912</span></td><td id="LC3912" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (change.op === exports.OPERATION.CLEAR) {
</code></td></tr><tr><td id="L3913" class="css-a4x74f"><span>3913</span></td><td id="LC3913" class="css-1dcdqdg"><code>                            uint8$<span class="code-number">1</span>(filteredBytes, change.op);
</code></td></tr><tr><td id="L3914" class="css-a4x74f"><span>3914</span></td><td id="LC3914" class="css-1dcdqdg"><code>                            <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L3915" class="css-a4x74f"><span>3915</span></td><td id="LC3915" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3916" class="css-a4x74f"><span>3916</span></td><td id="LC3916" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> fieldIndex = change.index;
</code></td></tr><tr><td id="L3917" class="css-a4x74f"><span>3917</span></td><td id="LC3917" class="css-1dcdqdg"><code>                        <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3918" class="css-a4x74f"><span>3918</span></td><td id="LC3918" class="css-1dcdqdg"><code>                        <span class="code-comment">// Deleting fields: encode the operation + field index</span>
</code></td></tr><tr><td id="L3919" class="css-a4x74f"><span>3919</span></td><td id="LC3919" class="css-1dcdqdg"><code>                        <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3920" class="css-a4x74f"><span>3920</span></td><td id="LC3920" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (change.op === exports.OPERATION.DELETE) {
</code></td></tr><tr><td id="L3921" class="css-a4x74f"><span>3921</span></td><td id="LC3921" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3922" class="css-a4x74f"><span>3922</span></td><td id="LC3922" class="css-1dcdqdg"><code>                            <span class="code-comment">// DELETE operations also need to go through filtering.</span>
</code></td></tr><tr><td id="L3923" class="css-a4x74f"><span>3923</span></td><td id="LC3923" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3924" class="css-a4x74f"><span>3924</span></td><td id="LC3924" class="css-1dcdqdg"><code>                            <span class="code-comment">// <span class="code-doctag">TODO:</span> cache the previous value so we can access the value (primitive or `refId`)</span>
</code></td></tr><tr><td id="L3925" class="css-a4x74f"><span>3925</span></td><td id="LC3925" class="css-1dcdqdg"><code>                            <span class="code-comment">// (check against `$filterState.refIds`)</span>
</code></td></tr><tr><td id="L3926" class="css-a4x74f"><span>3926</span></td><td id="LC3926" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3927" class="css-a4x74f"><span>3927</span></td><td id="LC3927" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (isSchema) {
</code></td></tr><tr><td id="L3928" class="css-a4x74f"><span>3928</span></td><td id="LC3928" class="css-1dcdqdg"><code>                                uint8$<span class="code-number">1</span>(filteredBytes, change.op | fieldIndex);
</code></td></tr><tr><td id="L3929" class="css-a4x74f"><span>3929</span></td><td id="LC3929" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L3930" class="css-a4x74f"><span>3930</span></td><td id="LC3930" class="css-1dcdqdg"><code>                            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L3931" class="css-a4x74f"><span>3931</span></td><td id="LC3931" class="css-1dcdqdg"><code>                                uint8$<span class="code-number">1</span>(filteredBytes, change.op);
</code></td></tr><tr><td id="L3932" class="css-a4x74f"><span>3932</span></td><td id="LC3932" class="css-1dcdqdg"><code>                                number$<span class="code-number">1</span>(filteredBytes, fieldIndex);
</code></td></tr><tr><td id="L3933" class="css-a4x74f"><span>3933</span></td><td id="LC3933" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L3934" class="css-a4x74f"><span>3934</span></td><td id="LC3934" class="css-1dcdqdg"><code>                            <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L3935" class="css-a4x74f"><span>3935</span></td><td id="LC3935" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3936" class="css-a4x74f"><span>3936</span></td><td id="LC3936" class="css-1dcdqdg"><code>                        <span class="code-comment">// indexed operation</span>
</code></td></tr><tr><td id="L3937" class="css-a4x74f"><span>3937</span></td><td id="LC3937" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> value = changeTree.getValue(fieldIndex);
</code></td></tr><tr><td id="L3938" class="css-a4x74f"><span>3938</span></td><td id="LC3938" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> type = changeTree.getType(fieldIndex);
</code></td></tr><tr><td id="L3939" class="css-a4x74f"><span>3939</span></td><td id="LC3939" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (isSchema) {
</code></td></tr><tr><td id="L3940" class="css-a4x74f"><span>3940</span></td><td id="LC3940" class="css-1dcdqdg"><code>                            <span class="code-comment">// Is a Schema!</span>
</code></td></tr><tr><td id="L3941" class="css-a4x74f"><span>3941</span></td><td id="LC3941" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> filter = (ref._definition.filters &amp;&amp;
</code></td></tr><tr><td id="L3942" class="css-a4x74f"><span>3942</span></td><td id="LC3942" class="css-1dcdqdg"><code>                                ref._definition.filters[fieldIndex]);
</code></td></tr><tr><td id="L3943" class="css-a4x74f"><span>3943</span></td><td id="LC3943" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (filter &amp;&amp; !filter.call(ref, client, value, root)) {
</code></td></tr><tr><td id="L3944" class="css-a4x74f"><span>3944</span></td><td id="LC3944" class="css-1dcdqdg"><code>                                <span class="code-keyword">if</span> (value &amp;&amp; value[<span class="code-string">'$changes'</span>]) {
</code></td></tr><tr><td id="L3945" class="css-a4x74f"><span>3945</span></td><td id="LC3945" class="css-1dcdqdg"><code>                                    refIdsDissallowed.add(value[<span class="code-string">'$changes'</span>].refId);
</code></td></tr><tr><td id="L3946" class="css-a4x74f"><span>3946</span></td><td id="LC3946" class="css-1dcdqdg"><code>                                }
</code></td></tr><tr><td id="L3947" class="css-a4x74f"><span>3947</span></td><td id="LC3947" class="css-1dcdqdg"><code>                                <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L3948" class="css-a4x74f"><span>3948</span></td><td id="LC3948" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L3949" class="css-a4x74f"><span>3949</span></td><td id="LC3949" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3950" class="css-a4x74f"><span>3950</span></td><td id="LC3950" class="css-1dcdqdg"><code>                        <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L3951" class="css-a4x74f"><span>3951</span></td><td id="LC3951" class="css-1dcdqdg"><code>                            <span class="code-comment">// Is a collection! (map, array, etc.)</span>
</code></td></tr><tr><td id="L3952" class="css-a4x74f"><span>3952</span></td><td id="LC3952" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> parent = changeTree.parent;
</code></td></tr><tr><td id="L3953" class="css-a4x74f"><span>3953</span></td><td id="LC3953" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> filter = changeTree.getChildrenFilter();
</code></td></tr><tr><td id="L3954" class="css-a4x74f"><span>3954</span></td><td id="LC3954" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (filter &amp;&amp; !filter.call(parent, client, ref[<span class="code-string">'$indexes'</span>].get(fieldIndex), value, root)) {
</code></td></tr><tr><td id="L3955" class="css-a4x74f"><span>3955</span></td><td id="LC3955" class="css-1dcdqdg"><code>                                <span class="code-keyword">if</span> (value &amp;&amp; value[<span class="code-string">'$changes'</span>]) {
</code></td></tr><tr><td id="L3956" class="css-a4x74f"><span>3956</span></td><td id="LC3956" class="css-1dcdqdg"><code>                                    refIdsDissallowed.add(value[<span class="code-string">'$changes'</span>].refId);
</code></td></tr><tr><td id="L3957" class="css-a4x74f"><span>3957</span></td><td id="LC3957" class="css-1dcdqdg"><code>                                }
</code></td></tr><tr><td id="L3958" class="css-a4x74f"><span>3958</span></td><td id="LC3958" class="css-1dcdqdg"><code>                                <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L3959" class="css-a4x74f"><span>3959</span></td><td id="LC3959" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L3960" class="css-a4x74f"><span>3960</span></td><td id="LC3960" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3961" class="css-a4x74f"><span>3961</span></td><td id="LC3961" class="css-1dcdqdg"><code>                        <span class="code-comment">// visit child ChangeTree on further iteration.</span>
</code></td></tr><tr><td id="L3962" class="css-a4x74f"><span>3962</span></td><td id="LC3962" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (value[<span class="code-string">'$changes'</span>]) {
</code></td></tr><tr><td id="L3963" class="css-a4x74f"><span>3963</span></td><td id="LC3963" class="css-1dcdqdg"><code>                            changeTrees.push(value[<span class="code-string">'$changes'</span>]);
</code></td></tr><tr><td id="L3964" class="css-a4x74f"><span>3964</span></td><td id="LC3964" class="css-1dcdqdg"><code>                            numChangeTrees++;
</code></td></tr><tr><td id="L3965" class="css-a4x74f"><span>3965</span></td><td id="LC3965" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L3966" class="css-a4x74f"><span>3966</span></td><td id="LC3966" class="css-1dcdqdg"><code>                        <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3967" class="css-a4x74f"><span>3967</span></td><td id="LC3967" class="css-1dcdqdg"><code>                        <span class="code-comment">// Copy cached bytes</span>
</code></td></tr><tr><td id="L3968" class="css-a4x74f"><span>3968</span></td><td id="LC3968" class="css-1dcdqdg"><code>                        <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3969" class="css-a4x74f"><span>3969</span></td><td id="LC3969" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (change.op !== exports.OPERATION.TOUCH) {
</code></td></tr><tr><td id="L3970" class="css-a4x74f"><span>3970</span></td><td id="LC3970" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3971" class="css-a4x74f"><span>3971</span></td><td id="LC3971" class="css-1dcdqdg"><code>                            <span class="code-comment">// <span class="code-doctag">TODO:</span> refactor me!</span>
</code></td></tr><tr><td id="L3972" class="css-a4x74f"><span>3972</span></td><td id="LC3972" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3973" class="css-a4x74f"><span>3973</span></td><td id="LC3973" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (change.op === exports.OPERATION.ADD || isSchema) {
</code></td></tr><tr><td id="L3974" class="css-a4x74f"><span>3974</span></td><td id="LC3974" class="css-1dcdqdg"><code>                                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3975" class="css-a4x74f"><span>3975</span></td><td id="LC3975" class="css-1dcdqdg"><code>                                <span class="code-comment">// use cached bytes directly if is from Schema type.</span>
</code></td></tr><tr><td id="L3976" class="css-a4x74f"><span>3976</span></td><td id="LC3976" class="css-1dcdqdg"><code>                                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3977" class="css-a4x74f"><span>3977</span></td><td id="LC3977" class="css-1dcdqdg"><code>                                filteredBytes.push.apply(filteredBytes, (_a = changeTree.caches[fieldIndex]) !== <span class="code-literal">null</span> &amp;&amp; _a !== <span class="code-keyword">void</span> <span class="code-number">0</span> ? _a : []);
</code></td></tr><tr><td id="L3978" class="css-a4x74f"><span>3978</span></td><td id="LC3978" class="css-1dcdqdg"><code>                                containerIndexes.add(fieldIndex);
</code></td></tr><tr><td id="L3979" class="css-a4x74f"><span>3979</span></td><td id="LC3979" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L3980" class="css-a4x74f"><span>3980</span></td><td id="LC3980" class="css-1dcdqdg"><code>                            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L3981" class="css-a4x74f"><span>3981</span></td><td id="LC3981" class="css-1dcdqdg"><code>                                <span class="code-keyword">if</span> (containerIndexes.has(fieldIndex)) {
</code></td></tr><tr><td id="L3982" class="css-a4x74f"><span>3982</span></td><td id="LC3982" class="css-1dcdqdg"><code>                                    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3983" class="css-a4x74f"><span>3983</span></td><td id="LC3983" class="css-1dcdqdg"><code>                                    <span class="code-comment">// use cached bytes if already has the field</span>
</code></td></tr><tr><td id="L3984" class="css-a4x74f"><span>3984</span></td><td id="LC3984" class="css-1dcdqdg"><code>                                    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3985" class="css-a4x74f"><span>3985</span></td><td id="LC3985" class="css-1dcdqdg"><code>                                    filteredBytes.push.apply(filteredBytes, (_b = changeTree.caches[fieldIndex]) !== <span class="code-literal">null</span> &amp;&amp; _b !== <span class="code-keyword">void</span> <span class="code-number">0</span> ? _b : []);
</code></td></tr><tr><td id="L3986" class="css-a4x74f"><span>3986</span></td><td id="LC3986" class="css-1dcdqdg"><code>                                }
</code></td></tr><tr><td id="L3987" class="css-a4x74f"><span>3987</span></td><td id="LC3987" class="css-1dcdqdg"><code>                                <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L3988" class="css-a4x74f"><span>3988</span></td><td id="LC3988" class="css-1dcdqdg"><code>                                    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3989" class="css-a4x74f"><span>3989</span></td><td id="LC3989" class="css-1dcdqdg"><code>                                    <span class="code-comment">// force ADD operation if field is not known by this client.</span>
</code></td></tr><tr><td id="L3990" class="css-a4x74f"><span>3990</span></td><td id="LC3990" class="css-1dcdqdg"><code>                                    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3991" class="css-a4x74f"><span>3991</span></td><td id="LC3991" class="css-1dcdqdg"><code>                                    containerIndexes.add(fieldIndex);
</code></td></tr><tr><td id="L3992" class="css-a4x74f"><span>3992</span></td><td id="LC3992" class="css-1dcdqdg"><code>                                    uint8$<span class="code-number">1</span>(filteredBytes, exports.OPERATION.ADD);
</code></td></tr><tr><td id="L3993" class="css-a4x74f"><span>3993</span></td><td id="LC3993" class="css-1dcdqdg"><code>                                    number$<span class="code-number">1</span>(filteredBytes, fieldIndex);
</code></td></tr><tr><td id="L3994" class="css-a4x74f"><span>3994</span></td><td id="LC3994" class="css-1dcdqdg"><code>                                    <span class="code-keyword">if</span> (ref <span class="code-keyword">instanceof</span> MapSchema) {
</code></td></tr><tr><td id="L3995" class="css-a4x74f"><span>3995</span></td><td id="LC3995" class="css-1dcdqdg"><code>                                        <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3996" class="css-a4x74f"><span>3996</span></td><td id="LC3996" class="css-1dcdqdg"><code>                                        <span class="code-comment">// MapSchema dynamic key</span>
</code></td></tr><tr><td id="L3997" class="css-a4x74f"><span>3997</span></td><td id="LC3997" class="css-1dcdqdg"><code>                                        <span class="code-comment">//</span>
</code></td></tr><tr><td id="L3998" class="css-a4x74f"><span>3998</span></td><td id="LC3998" class="css-1dcdqdg"><code>                                        <span class="code-keyword">var</span> dynamicIndex = changeTree.ref[<span class="code-string">'$indexes'</span>].get(fieldIndex);
</code></td></tr><tr><td id="L3999" class="css-a4x74f"><span>3999</span></td><td id="LC3999" class="css-1dcdqdg"><code>                                        string$<span class="code-number">1</span>(filteredBytes, dynamicIndex);
</code></td></tr><tr><td id="L4000" class="css-a4x74f"><span>4000</span></td><td id="LC4000" class="css-1dcdqdg"><code>                                    }
</code></td></tr><tr><td id="L4001" class="css-a4x74f"><span>4001</span></td><td id="LC4001" class="css-1dcdqdg"><code>                                    <span class="code-keyword">if</span> (value[<span class="code-string">'$changes'</span>]) {
</code></td></tr><tr><td id="L4002" class="css-a4x74f"><span>4002</span></td><td id="LC4002" class="css-1dcdqdg"><code>                                        number$<span class="code-number">1</span>(filteredBytes, value[<span class="code-string">'$changes'</span>].refId);
</code></td></tr><tr><td id="L4003" class="css-a4x74f"><span>4003</span></td><td id="LC4003" class="css-1dcdqdg"><code>                                    }
</code></td></tr><tr><td id="L4004" class="css-a4x74f"><span>4004</span></td><td id="LC4004" class="css-1dcdqdg"><code>                                    <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L4005" class="css-a4x74f"><span>4005</span></td><td id="LC4005" class="css-1dcdqdg"><code>                                        <span class="code-comment">// "encodePrimitiveType" without type checking.</span>
</code></td></tr><tr><td id="L4006" class="css-a4x74f"><span>4006</span></td><td id="LC4006" class="css-1dcdqdg"><code>                                        <span class="code-comment">// the type checking has been done on the first .encode() call.</span>
</code></td></tr><tr><td id="L4007" class="css-a4x74f"><span>4007</span></td><td id="LC4007" class="css-1dcdqdg"><code>                                        encode[type](filteredBytes, value);
</code></td></tr><tr><td id="L4008" class="css-a4x74f"><span>4008</span></td><td id="LC4008" class="css-1dcdqdg"><code>                                    }
</code></td></tr><tr><td id="L4009" class="css-a4x74f"><span>4009</span></td><td id="LC4009" class="css-1dcdqdg"><code>                                }
</code></td></tr><tr><td id="L4010" class="css-a4x74f"><span>4010</span></td><td id="LC4010" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L4011" class="css-a4x74f"><span>4011</span></td><td id="LC4011" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L4012" class="css-a4x74f"><span>4012</span></td><td id="LC4012" class="css-1dcdqdg"><code>                        <span class="code-keyword">else</span> <span class="code-keyword">if</span> (value[<span class="code-string">'$changes'</span>] &amp;&amp; !isSchema) {
</code></td></tr><tr><td id="L4013" class="css-a4x74f"><span>4013</span></td><td id="LC4013" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L4014" class="css-a4x74f"><span>4014</span></td><td id="LC4014" class="css-1dcdqdg"><code>                            <span class="code-comment">// <span class="code-doctag">TODO:</span></span>
</code></td></tr><tr><td id="L4015" class="css-a4x74f"><span>4015</span></td><td id="LC4015" class="css-1dcdqdg"><code>                            <span class="code-comment">// - track ADD/REPLACE/DELETE instances on `$filterState`</span>
</code></td></tr><tr><td id="L4016" class="css-a4x74f"><span>4016</span></td><td id="LC4016" class="css-1dcdqdg"><code>                            <span class="code-comment">// - do NOT always encode dynamicIndex for MapSchema.</span>
</code></td></tr><tr><td id="L4017" class="css-a4x74f"><span>4017</span></td><td id="LC4017" class="css-1dcdqdg"><code>                            <span class="code-comment">//   (If client already has that key, only the first index is necessary.)</span>
</code></td></tr><tr><td id="L4018" class="css-a4x74f"><span>4018</span></td><td id="LC4018" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L4019" class="css-a4x74f"><span>4019</span></td><td id="LC4019" class="css-1dcdqdg"><code>                            uint8$<span class="code-number">1</span>(filteredBytes, exports.OPERATION.ADD);
</code></td></tr><tr><td id="L4020" class="css-a4x74f"><span>4020</span></td><td id="LC4020" class="css-1dcdqdg"><code>                            number$<span class="code-number">1</span>(filteredBytes, fieldIndex);
</code></td></tr><tr><td id="L4021" class="css-a4x74f"><span>4021</span></td><td id="LC4021" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (ref <span class="code-keyword">instanceof</span> MapSchema) {
</code></td></tr><tr><td id="L4022" class="css-a4x74f"><span>4022</span></td><td id="LC4022" class="css-1dcdqdg"><code>                                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L4023" class="css-a4x74f"><span>4023</span></td><td id="LC4023" class="css-1dcdqdg"><code>                                <span class="code-comment">// MapSchema dynamic key</span>
</code></td></tr><tr><td id="L4024" class="css-a4x74f"><span>4024</span></td><td id="LC4024" class="css-1dcdqdg"><code>                                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L4025" class="css-a4x74f"><span>4025</span></td><td id="LC4025" class="css-1dcdqdg"><code>                                <span class="code-keyword">var</span> dynamicIndex = changeTree.ref[<span class="code-string">'$indexes'</span>].get(fieldIndex);
</code></td></tr><tr><td id="L4026" class="css-a4x74f"><span>4026</span></td><td id="LC4026" class="css-1dcdqdg"><code>                                string$<span class="code-number">1</span>(filteredBytes, dynamicIndex);
</code></td></tr><tr><td id="L4027" class="css-a4x74f"><span>4027</span></td><td id="LC4027" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L4028" class="css-a4x74f"><span>4028</span></td><td id="LC4028" class="css-1dcdqdg"><code>                            number$<span class="code-number">1</span>(filteredBytes, value[<span class="code-string">'$changes'</span>].refId);
</code></td></tr><tr><td id="L4029" class="css-a4x74f"><span>4029</span></td><td id="LC4029" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L4030" class="css-a4x74f"><span>4030</span></td><td id="LC4030" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L4031" class="css-a4x74f"><span>4031</span></td><td id="LC4031" class="css-1dcdqdg"><code>                };
</code></td></tr><tr><td id="L4032" class="css-a4x74f"><span>4032</span></td><td id="LC4032" class="css-1dcdqdg"><code>                <span class="code-keyword">for</span> (<span class="code-keyword">var</span> i = <span class="code-number">0</span>; i &lt; numChangeTrees; i++) {
</code></td></tr><tr><td id="L4033" class="css-a4x74f"><span>4033</span></td><td id="LC4033" class="css-1dcdqdg"><code>                    _loop_1(i);
</code></td></tr><tr><td id="L4034" class="css-a4x74f"><span>4034</span></td><td id="LC4034" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L4035" class="css-a4x74f"><span>4035</span></td><td id="LC4035" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> filteredBytes;
</code></td></tr><tr><td id="L4036" class="css-a4x74f"><span>4036</span></td><td id="LC4036" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L4037" class="css-a4x74f"><span>4037</span></td><td id="LC4037" class="css-1dcdqdg"><code>            Schema.prototype.clone = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4038" class="css-a4x74f"><span>4038</span></td><td id="LC4038" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _a;
</code></td></tr><tr><td id="L4039" class="css-a4x74f"><span>4039</span></td><td id="LC4039" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> cloned = <span class="code-keyword">new</span> (<span class="code-keyword">this</span>.constructor);
</code></td></tr><tr><td id="L4040" class="css-a4x74f"><span>4040</span></td><td id="LC4040" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> schema = <span class="code-keyword">this</span>._definition.schema;
</code></td></tr><tr><td id="L4041" class="css-a4x74f"><span>4041</span></td><td id="LC4041" class="css-1dcdqdg"><code>                <span class="code-keyword">for</span> (<span class="code-keyword">var</span> field <span class="code-keyword">in</span> schema) {
</code></td></tr><tr><td id="L4042" class="css-a4x74f"><span>4042</span></td><td id="LC4042" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (<span class="code-keyword">this</span>[field]) === <span class="code-string">"object"</span> &amp;&amp;
</code></td></tr><tr><td id="L4043" class="css-a4x74f"><span>4043</span></td><td id="LC4043" class="css-1dcdqdg"><code>                        <span class="code-keyword">typeof</span> ((_a = <span class="code-keyword">this</span>[field]) === <span class="code-literal">null</span> || _a === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _a.clone) === <span class="code-string">"function"</span>) {
</code></td></tr><tr><td id="L4044" class="css-a4x74f"><span>4044</span></td><td id="LC4044" class="css-1dcdqdg"><code>                        <span class="code-comment">// deep clone</span>
</code></td></tr><tr><td id="L4045" class="css-a4x74f"><span>4045</span></td><td id="LC4045" class="css-1dcdqdg"><code>                        cloned[field] = <span class="code-keyword">this</span>[field].clone();
</code></td></tr><tr><td id="L4046" class="css-a4x74f"><span>4046</span></td><td id="LC4046" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L4047" class="css-a4x74f"><span>4047</span></td><td id="LC4047" class="css-1dcdqdg"><code>                    <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L4048" class="css-a4x74f"><span>4048</span></td><td id="LC4048" class="css-1dcdqdg"><code>                        <span class="code-comment">// primitive values</span>
</code></td></tr><tr><td id="L4049" class="css-a4x74f"><span>4049</span></td><td id="LC4049" class="css-1dcdqdg"><code>                        cloned[field] = <span class="code-keyword">this</span>[field];
</code></td></tr><tr><td id="L4050" class="css-a4x74f"><span>4050</span></td><td id="LC4050" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L4051" class="css-a4x74f"><span>4051</span></td><td id="LC4051" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L4052" class="css-a4x74f"><span>4052</span></td><td id="LC4052" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> cloned;
</code></td></tr><tr><td id="L4053" class="css-a4x74f"><span>4053</span></td><td id="LC4053" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L4054" class="css-a4x74f"><span>4054</span></td><td id="LC4054" class="css-1dcdqdg"><code>            Schema.prototype.toJSON = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4055" class="css-a4x74f"><span>4055</span></td><td id="LC4055" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> schema = <span class="code-keyword">this</span>._definition.schema;
</code></td></tr><tr><td id="L4056" class="css-a4x74f"><span>4056</span></td><td id="LC4056" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> deprecated = <span class="code-keyword">this</span>._definition.deprecated;
</code></td></tr><tr><td id="L4057" class="css-a4x74f"><span>4057</span></td><td id="LC4057" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> obj = {};
</code></td></tr><tr><td id="L4058" class="css-a4x74f"><span>4058</span></td><td id="LC4058" class="css-1dcdqdg"><code>                <span class="code-keyword">for</span> (<span class="code-keyword">var</span> field <span class="code-keyword">in</span> schema) {
</code></td></tr><tr><td id="L4059" class="css-a4x74f"><span>4059</span></td><td id="LC4059" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (!deprecated[field] &amp;&amp; <span class="code-keyword">this</span>[field] !== <span class="code-literal">null</span> &amp;&amp; <span class="code-keyword">typeof</span> (<span class="code-keyword">this</span>[field]) !== <span class="code-string">"undefined"</span>) {
</code></td></tr><tr><td id="L4060" class="css-a4x74f"><span>4060</span></td><td id="LC4060" class="css-1dcdqdg"><code>                        obj[field] = (<span class="code-keyword">typeof</span> (<span class="code-keyword">this</span>[field][<span class="code-string">'toJSON'</span>]) === <span class="code-string">"function"</span>)
</code></td></tr><tr><td id="L4061" class="css-a4x74f"><span>4061</span></td><td id="LC4061" class="css-1dcdqdg"><code>                            ? <span class="code-keyword">this</span>[field][<span class="code-string">'toJSON'</span>]()
</code></td></tr><tr><td id="L4062" class="css-a4x74f"><span>4062</span></td><td id="LC4062" class="css-1dcdqdg"><code>                            : <span class="code-keyword">this</span>[<span class="code-string">"_"</span>.concat(field)];
</code></td></tr><tr><td id="L4063" class="css-a4x74f"><span>4063</span></td><td id="LC4063" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L4064" class="css-a4x74f"><span>4064</span></td><td id="LC4064" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L4065" class="css-a4x74f"><span>4065</span></td><td id="LC4065" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> obj;
</code></td></tr><tr><td id="L4066" class="css-a4x74f"><span>4066</span></td><td id="LC4066" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L4067" class="css-a4x74f"><span>4067</span></td><td id="LC4067" class="css-1dcdqdg"><code>            Schema.prototype.discardAllChanges = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4068" class="css-a4x74f"><span>4068</span></td><td id="LC4068" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.$changes.discardAll();
</code></td></tr><tr><td id="L4069" class="css-a4x74f"><span>4069</span></td><td id="LC4069" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L4070" class="css-a4x74f"><span>4070</span></td><td id="LC4070" class="css-1dcdqdg"><code>            Schema.prototype.getByIndex = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index</span>) </span>{
</code></td></tr><tr><td id="L4071" class="css-a4x74f"><span>4071</span></td><td id="LC4071" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>[<span class="code-keyword">this</span>._definition.fieldsByIndex[index]];
</code></td></tr><tr><td id="L4072" class="css-a4x74f"><span>4072</span></td><td id="LC4072" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L4073" class="css-a4x74f"><span>4073</span></td><td id="LC4073" class="css-1dcdqdg"><code>            Schema.prototype.deleteByIndex = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">index</span>) </span>{
</code></td></tr><tr><td id="L4074" class="css-a4x74f"><span>4074</span></td><td id="LC4074" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>[<span class="code-keyword">this</span>._definition.fieldsByIndex[index]] = <span class="code-literal">undefined</span>;
</code></td></tr><tr><td id="L4075" class="css-a4x74f"><span>4075</span></td><td id="LC4075" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L4076" class="css-a4x74f"><span>4076</span></td><td id="LC4076" class="css-1dcdqdg"><code>            Schema.prototype.tryEncodeTypeId = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">bytes, type, targetType</span>) </span>{
</code></td></tr><tr><td id="L4077" class="css-a4x74f"><span>4077</span></td><td id="LC4077" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (type._typeid !== targetType._typeid) {
</code></td></tr><tr><td id="L4078" class="css-a4x74f"><span>4078</span></td><td id="LC4078" class="css-1dcdqdg"><code>                    uint8$<span class="code-number">1</span>(bytes, TYPE_ID);
</code></td></tr><tr><td id="L4079" class="css-a4x74f"><span>4079</span></td><td id="LC4079" class="css-1dcdqdg"><code>                    number$<span class="code-number">1</span>(bytes, targetType._typeid);
</code></td></tr><tr><td id="L4080" class="css-a4x74f"><span>4080</span></td><td id="LC4080" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L4081" class="css-a4x74f"><span>4081</span></td><td id="LC4081" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L4082" class="css-a4x74f"><span>4082</span></td><td id="LC4082" class="css-1dcdqdg"><code>            Schema.prototype.getSchemaType = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">bytes, it, defaultType</span>) </span>{
</code></td></tr><tr><td id="L4083" class="css-a4x74f"><span>4083</span></td><td id="LC4083" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> type;
</code></td></tr><tr><td id="L4084" class="css-a4x74f"><span>4084</span></td><td id="LC4084" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (bytes[it.offset] === TYPE_ID) {
</code></td></tr><tr><td id="L4085" class="css-a4x74f"><span>4085</span></td><td id="LC4085" class="css-1dcdqdg"><code>                    it.offset++;
</code></td></tr><tr><td id="L4086" class="css-a4x74f"><span>4086</span></td><td id="LC4086" class="css-1dcdqdg"><code>                    type = <span class="code-keyword">this</span>.constructor._context.get(number(bytes, it));
</code></td></tr><tr><td id="L4087" class="css-a4x74f"><span>4087</span></td><td id="LC4087" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L4088" class="css-a4x74f"><span>4088</span></td><td id="LC4088" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> type || defaultType;
</code></td></tr><tr><td id="L4089" class="css-a4x74f"><span>4089</span></td><td id="LC4089" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L4090" class="css-a4x74f"><span>4090</span></td><td id="LC4090" class="css-1dcdqdg"><code>            Schema.prototype.createTypeInstance = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">type</span>) </span>{
</code></td></tr><tr><td id="L4091" class="css-a4x74f"><span>4091</span></td><td id="LC4091" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> instance = <span class="code-keyword">new</span> type();
</code></td></tr><tr><td id="L4092" class="css-a4x74f"><span>4092</span></td><td id="LC4092" class="css-1dcdqdg"><code>                <span class="code-comment">// assign root on $changes</span>
</code></td></tr><tr><td id="L4093" class="css-a4x74f"><span>4093</span></td><td id="LC4093" class="css-1dcdqdg"><code>                instance.$changes.root = <span class="code-keyword">this</span>.$changes.root;
</code></td></tr><tr><td id="L4094" class="css-a4x74f"><span>4094</span></td><td id="LC4094" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> instance;
</code></td></tr><tr><td id="L4095" class="css-a4x74f"><span>4095</span></td><td id="LC4095" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L4096" class="css-a4x74f"><span>4096</span></td><td id="LC4096" class="css-1dcdqdg"><code>            Schema.prototype._triggerChanges = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">changes</span>) </span>{
</code></td></tr><tr><td id="L4097" class="css-a4x74f"><span>4097</span></td><td id="LC4097" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _a, _b, _c, _d, _e, _f, _g, _h, _j;
</code></td></tr><tr><td id="L4098" class="css-a4x74f"><span>4098</span></td><td id="LC4098" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> uniqueRefIds = <span class="code-keyword">new</span> <span class="code-built_in">Set</span>();
</code></td></tr><tr><td id="L4099" class="css-a4x74f"><span>4099</span></td><td id="LC4099" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> $refs = <span class="code-keyword">this</span>.$changes.root.refs;
</code></td></tr><tr><td id="L4100" class="css-a4x74f"><span>4100</span></td><td id="LC4100" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _loop_2 = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">i</span>) </span>{
</code></td></tr><tr><td id="L4101" class="css-a4x74f"><span>4101</span></td><td id="LC4101" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> change = changes[i];
</code></td></tr><tr><td id="L4102" class="css-a4x74f"><span>4102</span></td><td id="LC4102" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> refId = change.refId;
</code></td></tr><tr><td id="L4103" class="css-a4x74f"><span>4103</span></td><td id="LC4103" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> ref = $refs.get(refId);
</code></td></tr><tr><td id="L4104" class="css-a4x74f"><span>4104</span></td><td id="LC4104" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> $callbacks = ref[<span class="code-string">'$callbacks'</span>];
</code></td></tr><tr><td id="L4105" class="css-a4x74f"><span>4105</span></td><td id="LC4105" class="css-1dcdqdg"><code>                    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L4106" class="css-a4x74f"><span>4106</span></td><td id="LC4106" class="css-1dcdqdg"><code>                    <span class="code-comment">// trigger onRemove on child structure.</span>
</code></td></tr><tr><td id="L4107" class="css-a4x74f"><span>4107</span></td><td id="LC4107" class="css-1dcdqdg"><code>                    <span class="code-comment">//</span>
</code></td></tr><tr><td id="L4108" class="css-a4x74f"><span>4108</span></td><td id="LC4108" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> ((change.op &amp; exports.OPERATION.DELETE) === exports.OPERATION.DELETE &amp;&amp;
</code></td></tr><tr><td id="L4109" class="css-a4x74f"><span>4109</span></td><td id="LC4109" class="css-1dcdqdg"><code>                        change.previousValue <span class="code-keyword">instanceof</span> Schema) {
</code></td></tr><tr><td id="L4110" class="css-a4x74f"><span>4110</span></td><td id="LC4110" class="css-1dcdqdg"><code>                        (_b = (_a = change.previousValue[<span class="code-string">'$callbacks'</span>]) === <span class="code-literal">null</span> || _a === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _a[exports.OPERATION.DELETE]) === <span class="code-literal">null</span> || _b === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _b.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback</span>) </span>{ <span class="code-keyword">return</span> callback(); });
</code></td></tr><tr><td id="L4111" class="css-a4x74f"><span>4111</span></td><td id="LC4111" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L4112" class="css-a4x74f"><span>4112</span></td><td id="LC4112" class="css-1dcdqdg"><code>                    <span class="code-comment">// no callbacks defined, skip this structure!</span>
</code></td></tr><tr><td id="L4113" class="css-a4x74f"><span>4113</span></td><td id="LC4113" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (!$callbacks) {
</code></td></tr><tr><td id="L4114" class="css-a4x74f"><span>4114</span></td><td id="LC4114" class="css-1dcdqdg"><code>                        <span class="code-keyword">return</span> <span class="code-string">"continue"</span>;
</code></td></tr><tr><td id="L4115" class="css-a4x74f"><span>4115</span></td><td id="LC4115" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L4116" class="css-a4x74f"><span>4116</span></td><td id="LC4116" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (ref <span class="code-keyword">instanceof</span> Schema) {
</code></td></tr><tr><td id="L4117" class="css-a4x74f"><span>4117</span></td><td id="LC4117" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (!uniqueRefIds.has(refId)) {
</code></td></tr><tr><td id="L4118" class="css-a4x74f"><span>4118</span></td><td id="LC4118" class="css-1dcdqdg"><code>                            <span class="code-keyword">try</span> {
</code></td></tr><tr><td id="L4119" class="css-a4x74f"><span>4119</span></td><td id="LC4119" class="css-1dcdqdg"><code>                                <span class="code-comment">// trigger onChange</span>
</code></td></tr><tr><td id="L4120" class="css-a4x74f"><span>4120</span></td><td id="LC4120" class="css-1dcdqdg"><code>                                (_c = $callbacks === <span class="code-literal">null</span> || $callbacks === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : $callbacks[exports.OPERATION.REPLACE]) === <span class="code-literal">null</span> || _c === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _c.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback</span>) </span>{
</code></td></tr><tr><td id="L4121" class="css-a4x74f"><span>4121</span></td><td id="LC4121" class="css-1dcdqdg"><code>                                    <span class="code-keyword">return</span> callback(changes);
</code></td></tr><tr><td id="L4122" class="css-a4x74f"><span>4122</span></td><td id="LC4122" class="css-1dcdqdg"><code>                                });
</code></td></tr><tr><td id="L4123" class="css-a4x74f"><span>4123</span></td><td id="LC4123" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L4124" class="css-a4x74f"><span>4124</span></td><td id="LC4124" class="css-1dcdqdg"><code>                            <span class="code-keyword">catch</span> (e) {
</code></td></tr><tr><td id="L4125" class="css-a4x74f"><span>4125</span></td><td id="LC4125" class="css-1dcdqdg"><code>                                Schema.onError(e);
</code></td></tr><tr><td id="L4126" class="css-a4x74f"><span>4126</span></td><td id="LC4126" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L4127" class="css-a4x74f"><span>4127</span></td><td id="LC4127" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L4128" class="css-a4x74f"><span>4128</span></td><td id="LC4128" class="css-1dcdqdg"><code>                        <span class="code-keyword">try</span> {
</code></td></tr><tr><td id="L4129" class="css-a4x74f"><span>4129</span></td><td id="LC4129" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> ($callbacks.hasOwnProperty(change.field)) {
</code></td></tr><tr><td id="L4130" class="css-a4x74f"><span>4130</span></td><td id="LC4130" class="css-1dcdqdg"><code>                                (_d = $callbacks[change.field]) === <span class="code-literal">null</span> || _d === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _d.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback</span>) </span>{
</code></td></tr><tr><td id="L4131" class="css-a4x74f"><span>4131</span></td><td id="LC4131" class="css-1dcdqdg"><code>                                    <span class="code-keyword">return</span> callback(change.value, change.previousValue);
</code></td></tr><tr><td id="L4132" class="css-a4x74f"><span>4132</span></td><td id="LC4132" class="css-1dcdqdg"><code>                                });
</code></td></tr><tr><td id="L4133" class="css-a4x74f"><span>4133</span></td><td id="LC4133" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L4134" class="css-a4x74f"><span>4134</span></td><td id="LC4134" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L4135" class="css-a4x74f"><span>4135</span></td><td id="LC4135" class="css-1dcdqdg"><code>                        <span class="code-keyword">catch</span> (e) {
</code></td></tr><tr><td id="L4136" class="css-a4x74f"><span>4136</span></td><td id="LC4136" class="css-1dcdqdg"><code>                            Schema.onError(e);
</code></td></tr><tr><td id="L4137" class="css-a4x74f"><span>4137</span></td><td id="LC4137" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L4138" class="css-a4x74f"><span>4138</span></td><td id="LC4138" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L4139" class="css-a4x74f"><span>4139</span></td><td id="LC4139" class="css-1dcdqdg"><code>                    <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L4140" class="css-a4x74f"><span>4140</span></td><td id="LC4140" class="css-1dcdqdg"><code>                        <span class="code-comment">// is a collection of items</span>
</code></td></tr><tr><td id="L4141" class="css-a4x74f"><span>4141</span></td><td id="LC4141" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (change.op === exports.OPERATION.ADD &amp;&amp; change.previousValue === <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L4142" class="css-a4x74f"><span>4142</span></td><td id="LC4142" class="css-1dcdqdg"><code>                            <span class="code-comment">// triger onAdd</span>
</code></td></tr><tr><td id="L4143" class="css-a4x74f"><span>4143</span></td><td id="LC4143" class="css-1dcdqdg"><code>                            (_e = $callbacks[exports.OPERATION.ADD]) === <span class="code-literal">null</span> || _e === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _e.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback</span>) </span>{ <span class="code-keyword">var</span> _a; <span class="code-keyword">return</span> callback(change.value, (_a = change.dynamicIndex) !== <span class="code-literal">null</span> &amp;&amp; _a !== <span class="code-keyword">void</span> <span class="code-number">0</span> ? _a : change.field); });
</code></td></tr><tr><td id="L4144" class="css-a4x74f"><span>4144</span></td><td id="LC4144" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L4145" class="css-a4x74f"><span>4145</span></td><td id="LC4145" class="css-1dcdqdg"><code>                        <span class="code-keyword">else</span> <span class="code-keyword">if</span> (change.op === exports.OPERATION.DELETE) {
</code></td></tr><tr><td id="L4146" class="css-a4x74f"><span>4146</span></td><td id="LC4146" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L4147" class="css-a4x74f"><span>4147</span></td><td id="LC4147" class="css-1dcdqdg"><code>                            <span class="code-comment">// <span class="code-doctag">FIXME:</span> `previousValue` should always be available.</span>
</code></td></tr><tr><td id="L4148" class="css-a4x74f"><span>4148</span></td><td id="LC4148" class="css-1dcdqdg"><code>                            <span class="code-comment">// ADD + DELETE operations are still encoding DELETE operation.</span>
</code></td></tr><tr><td id="L4149" class="css-a4x74f"><span>4149</span></td><td id="LC4149" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L4150" class="css-a4x74f"><span>4150</span></td><td id="LC4150" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (change.previousValue !== <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L4151" class="css-a4x74f"><span>4151</span></td><td id="LC4151" class="css-1dcdqdg"><code>                                <span class="code-comment">// triger onRemove</span>
</code></td></tr><tr><td id="L4152" class="css-a4x74f"><span>4152</span></td><td id="LC4152" class="css-1dcdqdg"><code>                                (_f = $callbacks[exports.OPERATION.DELETE]) === <span class="code-literal">null</span> || _f === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _f.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback</span>) </span>{ <span class="code-keyword">var</span> _a; <span class="code-keyword">return</span> callback(change.previousValue, (_a = change.dynamicIndex) !== <span class="code-literal">null</span> &amp;&amp; _a !== <span class="code-keyword">void</span> <span class="code-number">0</span> ? _a : change.field); });
</code></td></tr><tr><td id="L4153" class="css-a4x74f"><span>4153</span></td><td id="LC4153" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L4154" class="css-a4x74f"><span>4154</span></td><td id="LC4154" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L4155" class="css-a4x74f"><span>4155</span></td><td id="LC4155" class="css-1dcdqdg"><code>                        <span class="code-keyword">else</span> <span class="code-keyword">if</span> (change.op === exports.OPERATION.DELETE_AND_ADD) {
</code></td></tr><tr><td id="L4156" class="css-a4x74f"><span>4156</span></td><td id="LC4156" class="css-1dcdqdg"><code>                            <span class="code-comment">// triger onRemove</span>
</code></td></tr><tr><td id="L4157" class="css-a4x74f"><span>4157</span></td><td id="LC4157" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (change.previousValue !== <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L4158" class="css-a4x74f"><span>4158</span></td><td id="LC4158" class="css-1dcdqdg"><code>                                (_g = $callbacks[exports.OPERATION.DELETE]) === <span class="code-literal">null</span> || _g === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _g.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback</span>) </span>{ <span class="code-keyword">var</span> _a; <span class="code-keyword">return</span> callback(change.previousValue, (_a = change.dynamicIndex) !== <span class="code-literal">null</span> &amp;&amp; _a !== <span class="code-keyword">void</span> <span class="code-number">0</span> ? _a : change.field); });
</code></td></tr><tr><td id="L4159" class="css-a4x74f"><span>4159</span></td><td id="LC4159" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L4160" class="css-a4x74f"><span>4160</span></td><td id="LC4160" class="css-1dcdqdg"><code>                            <span class="code-comment">// triger onAdd</span>
</code></td></tr><tr><td id="L4161" class="css-a4x74f"><span>4161</span></td><td id="LC4161" class="css-1dcdqdg"><code>                            (_h = $callbacks[exports.OPERATION.ADD]) === <span class="code-literal">null</span> || _h === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _h.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback</span>) </span>{ <span class="code-keyword">var</span> _a; <span class="code-keyword">return</span> callback(change.value, (_a = change.dynamicIndex) !== <span class="code-literal">null</span> &amp;&amp; _a !== <span class="code-keyword">void</span> <span class="code-number">0</span> ? _a : change.field); });
</code></td></tr><tr><td id="L4162" class="css-a4x74f"><span>4162</span></td><td id="LC4162" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L4163" class="css-a4x74f"><span>4163</span></td><td id="LC4163" class="css-1dcdqdg"><code>                        <span class="code-comment">// trigger onChange</span>
</code></td></tr><tr><td id="L4164" class="css-a4x74f"><span>4164</span></td><td id="LC4164" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (change.value !== change.previousValue) {
</code></td></tr><tr><td id="L4165" class="css-a4x74f"><span>4165</span></td><td id="LC4165" class="css-1dcdqdg"><code>                            (_j = $callbacks[exports.OPERATION.REPLACE]) === <span class="code-literal">null</span> || _j === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _j.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback</span>) </span>{ <span class="code-keyword">var</span> _a; <span class="code-keyword">return</span> callback(change.value, (_a = change.dynamicIndex) !== <span class="code-literal">null</span> &amp;&amp; _a !== <span class="code-keyword">void</span> <span class="code-number">0</span> ? _a : change.field); });
</code></td></tr><tr><td id="L4166" class="css-a4x74f"><span>4166</span></td><td id="LC4166" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L4167" class="css-a4x74f"><span>4167</span></td><td id="LC4167" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L4168" class="css-a4x74f"><span>4168</span></td><td id="LC4168" class="css-1dcdqdg"><code>                    uniqueRefIds.add(refId);
</code></td></tr><tr><td id="L4169" class="css-a4x74f"><span>4169</span></td><td id="LC4169" class="css-1dcdqdg"><code>                };
</code></td></tr><tr><td id="L4170" class="css-a4x74f"><span>4170</span></td><td id="LC4170" class="css-1dcdqdg"><code>                <span class="code-keyword">for</span> (<span class="code-keyword">var</span> i = <span class="code-number">0</span>; i &lt; changes.length; i++) {
</code></td></tr><tr><td id="L4171" class="css-a4x74f"><span>4171</span></td><td id="LC4171" class="css-1dcdqdg"><code>                    _loop_2(i);
</code></td></tr><tr><td id="L4172" class="css-a4x74f"><span>4172</span></td><td id="LC4172" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L4173" class="css-a4x74f"><span>4173</span></td><td id="LC4173" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L4174" class="css-a4x74f"><span>4174</span></td><td id="LC4174" class="css-1dcdqdg"><code>            Schema._definition = SchemaDefinition.create();
</code></td></tr><tr><td id="L4175" class="css-a4x74f"><span>4175</span></td><td id="LC4175" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> Schema;
</code></td></tr><tr><td id="L4176" class="css-a4x74f"><span>4176</span></td><td id="LC4176" class="css-1dcdqdg"><code>        }());
</code></td></tr><tr><td id="L4177" class="css-a4x74f"><span>4177</span></td><td id="LC4177" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4178" class="css-a4x74f"><span>4178</span></td><td id="LC4178" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">dumpChanges</span>(<span class="code-params">schema</span>) </span>{
</code></td></tr><tr><td id="L4179" class="css-a4x74f"><span>4179</span></td><td id="LC4179" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> changeTrees = [schema[<span class="code-string">'$changes'</span>]];
</code></td></tr><tr><td id="L4180" class="css-a4x74f"><span>4180</span></td><td id="LC4180" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> numChangeTrees = <span class="code-number">1</span>;
</code></td></tr><tr><td id="L4181" class="css-a4x74f"><span>4181</span></td><td id="LC4181" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> dump = {};
</code></td></tr><tr><td id="L4182" class="css-a4x74f"><span>4182</span></td><td id="LC4182" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> currentStructure = dump;
</code></td></tr><tr><td id="L4183" class="css-a4x74f"><span>4183</span></td><td id="LC4183" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> _loop_1 = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">i</span>) </span>{
</code></td></tr><tr><td id="L4184" class="css-a4x74f"><span>4184</span></td><td id="LC4184" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> changeTree = changeTrees[i];
</code></td></tr><tr><td id="L4185" class="css-a4x74f"><span>4185</span></td><td id="LC4185" class="css-1dcdqdg"><code>                changeTree.changes.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">change</span>) </span>{
</code></td></tr><tr><td id="L4186" class="css-a4x74f"><span>4186</span></td><td id="LC4186" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> ref = changeTree.ref;
</code></td></tr><tr><td id="L4187" class="css-a4x74f"><span>4187</span></td><td id="LC4187" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> fieldIndex = change.index;
</code></td></tr><tr><td id="L4188" class="css-a4x74f"><span>4188</span></td><td id="LC4188" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> field = (ref[<span class="code-string">'_definition'</span>])
</code></td></tr><tr><td id="L4189" class="css-a4x74f"><span>4189</span></td><td id="LC4189" class="css-1dcdqdg"><code>                        ? ref[<span class="code-string">'_definition'</span>].fieldsByIndex[fieldIndex]
</code></td></tr><tr><td id="L4190" class="css-a4x74f"><span>4190</span></td><td id="LC4190" class="css-1dcdqdg"><code>                        : ref[<span class="code-string">'$indexes'</span>].get(fieldIndex);
</code></td></tr><tr><td id="L4191" class="css-a4x74f"><span>4191</span></td><td id="LC4191" class="css-1dcdqdg"><code>                    currentStructure[field] = changeTree.getValue(fieldIndex);
</code></td></tr><tr><td id="L4192" class="css-a4x74f"><span>4192</span></td><td id="LC4192" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L4193" class="css-a4x74f"><span>4193</span></td><td id="LC4193" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L4194" class="css-a4x74f"><span>4194</span></td><td id="LC4194" class="css-1dcdqdg"><code>            <span class="code-keyword">for</span> (<span class="code-keyword">var</span> i = <span class="code-number">0</span>; i &lt; numChangeTrees; i++) {
</code></td></tr><tr><td id="L4195" class="css-a4x74f"><span>4195</span></td><td id="LC4195" class="css-1dcdqdg"><code>                _loop_1(i);
</code></td></tr><tr><td id="L4196" class="css-a4x74f"><span>4196</span></td><td id="LC4196" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4197" class="css-a4x74f"><span>4197</span></td><td id="LC4197" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> dump;
</code></td></tr><tr><td id="L4198" class="css-a4x74f"><span>4198</span></td><td id="LC4198" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L4199" class="css-a4x74f"><span>4199</span></td><td id="LC4199" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4200" class="css-a4x74f"><span>4200</span></td><td id="LC4200" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> reflectionContext = { <span class="code-attr">context</span>: <span class="code-keyword">new</span> Context() };
</code></td></tr><tr><td id="L4201" class="css-a4x74f"><span>4201</span></td><td id="LC4201" class="css-1dcdqdg"><code>        <span class="code-comment">/**
</span></code></td></tr><tr><td id="L4202" class="css-a4x74f"><span>4202</span></td><td id="LC4202" class="css-1dcdqdg"><code><span class="code-comment">         * Reflection
</span></code></td></tr><tr><td id="L4203" class="css-a4x74f"><span>4203</span></td><td id="LC4203" class="css-1dcdqdg"><code><span class="code-comment">         */</span>
</code></td></tr><tr><td id="L4204" class="css-a4x74f"><span>4204</span></td><td id="LC4204" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> ReflectionField = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_super</span>) </span>{
</code></td></tr><tr><td id="L4205" class="css-a4x74f"><span>4205</span></td><td id="LC4205" class="css-1dcdqdg"><code>            __extends(ReflectionField, _super);
</code></td></tr><tr><td id="L4206" class="css-a4x74f"><span>4206</span></td><td id="LC4206" class="css-1dcdqdg"><code>            <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">ReflectionField</span>(<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4207" class="css-a4x74f"><span>4207</span></td><td id="LC4207" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> _super !== <span class="code-literal">null</span> &amp;&amp; _super.apply(<span class="code-keyword">this</span>, <span class="code-built_in">arguments</span>) || <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L4208" class="css-a4x74f"><span>4208</span></td><td id="LC4208" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4209" class="css-a4x74f"><span>4209</span></td><td id="LC4209" class="css-1dcdqdg"><code>            __decorate([
</code></td></tr><tr><td id="L4210" class="css-a4x74f"><span>4210</span></td><td id="LC4210" class="css-1dcdqdg"><code>                type(<span class="code-string">"string"</span>, reflectionContext)
</code></td></tr><tr><td id="L4211" class="css-a4x74f"><span>4211</span></td><td id="LC4211" class="css-1dcdqdg"><code>            ], ReflectionField.prototype, <span class="code-string">"name"</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>);
</code></td></tr><tr><td id="L4212" class="css-a4x74f"><span>4212</span></td><td id="LC4212" class="css-1dcdqdg"><code>            __decorate([
</code></td></tr><tr><td id="L4213" class="css-a4x74f"><span>4213</span></td><td id="LC4213" class="css-1dcdqdg"><code>                type(<span class="code-string">"string"</span>, reflectionContext)
</code></td></tr><tr><td id="L4214" class="css-a4x74f"><span>4214</span></td><td id="LC4214" class="css-1dcdqdg"><code>            ], ReflectionField.prototype, <span class="code-string">"type"</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>);
</code></td></tr><tr><td id="L4215" class="css-a4x74f"><span>4215</span></td><td id="LC4215" class="css-1dcdqdg"><code>            __decorate([
</code></td></tr><tr><td id="L4216" class="css-a4x74f"><span>4216</span></td><td id="LC4216" class="css-1dcdqdg"><code>                type(<span class="code-string">"number"</span>, reflectionContext)
</code></td></tr><tr><td id="L4217" class="css-a4x74f"><span>4217</span></td><td id="LC4217" class="css-1dcdqdg"><code>            ], ReflectionField.prototype, <span class="code-string">"referencedType"</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>);
</code></td></tr><tr><td id="L4218" class="css-a4x74f"><span>4218</span></td><td id="LC4218" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> ReflectionField;
</code></td></tr><tr><td id="L4219" class="css-a4x74f"><span>4219</span></td><td id="LC4219" class="css-1dcdqdg"><code>        }(Schema));
</code></td></tr><tr><td id="L4220" class="css-a4x74f"><span>4220</span></td><td id="LC4220" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> ReflectionType = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_super</span>) </span>{
</code></td></tr><tr><td id="L4221" class="css-a4x74f"><span>4221</span></td><td id="LC4221" class="css-1dcdqdg"><code>            __extends(ReflectionType, _super);
</code></td></tr><tr><td id="L4222" class="css-a4x74f"><span>4222</span></td><td id="LC4222" class="css-1dcdqdg"><code>            <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">ReflectionType</span>(<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4223" class="css-a4x74f"><span>4223</span></td><td id="LC4223" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _this = _super !== <span class="code-literal">null</span> &amp;&amp; _super.apply(<span class="code-keyword">this</span>, <span class="code-built_in">arguments</span>) || <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L4224" class="css-a4x74f"><span>4224</span></td><td id="LC4224" class="css-1dcdqdg"><code>                _this.fields = <span class="code-keyword">new</span> ArraySchema();
</code></td></tr><tr><td id="L4225" class="css-a4x74f"><span>4225</span></td><td id="LC4225" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> _this;
</code></td></tr><tr><td id="L4226" class="css-a4x74f"><span>4226</span></td><td id="LC4226" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4227" class="css-a4x74f"><span>4227</span></td><td id="LC4227" class="css-1dcdqdg"><code>            __decorate([
</code></td></tr><tr><td id="L4228" class="css-a4x74f"><span>4228</span></td><td id="LC4228" class="css-1dcdqdg"><code>                type(<span class="code-string">"number"</span>, reflectionContext)
</code></td></tr><tr><td id="L4229" class="css-a4x74f"><span>4229</span></td><td id="LC4229" class="css-1dcdqdg"><code>            ], ReflectionType.prototype, <span class="code-string">"id"</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>);
</code></td></tr><tr><td id="L4230" class="css-a4x74f"><span>4230</span></td><td id="LC4230" class="css-1dcdqdg"><code>            __decorate([
</code></td></tr><tr><td id="L4231" class="css-a4x74f"><span>4231</span></td><td id="LC4231" class="css-1dcdqdg"><code>                type([ReflectionField], reflectionContext)
</code></td></tr><tr><td id="L4232" class="css-a4x74f"><span>4232</span></td><td id="LC4232" class="css-1dcdqdg"><code>            ], ReflectionType.prototype, <span class="code-string">"fields"</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>);
</code></td></tr><tr><td id="L4233" class="css-a4x74f"><span>4233</span></td><td id="LC4233" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> ReflectionType;
</code></td></tr><tr><td id="L4234" class="css-a4x74f"><span>4234</span></td><td id="LC4234" class="css-1dcdqdg"><code>        }(Schema));
</code></td></tr><tr><td id="L4235" class="css-a4x74f"><span>4235</span></td><td id="LC4235" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> Reflection = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_super</span>) </span>{
</code></td></tr><tr><td id="L4236" class="css-a4x74f"><span>4236</span></td><td id="LC4236" class="css-1dcdqdg"><code>            __extends(Reflection, _super);
</code></td></tr><tr><td id="L4237" class="css-a4x74f"><span>4237</span></td><td id="LC4237" class="css-1dcdqdg"><code>            <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">Reflection</span>(<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4238" class="css-a4x74f"><span>4238</span></td><td id="LC4238" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _this = _super !== <span class="code-literal">null</span> &amp;&amp; _super.apply(<span class="code-keyword">this</span>, <span class="code-built_in">arguments</span>) || <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L4239" class="css-a4x74f"><span>4239</span></td><td id="LC4239" class="css-1dcdqdg"><code>                _this.types = <span class="code-keyword">new</span> ArraySchema();
</code></td></tr><tr><td id="L4240" class="css-a4x74f"><span>4240</span></td><td id="LC4240" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> _this;
</code></td></tr><tr><td id="L4241" class="css-a4x74f"><span>4241</span></td><td id="LC4241" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4242" class="css-a4x74f"><span>4242</span></td><td id="LC4242" class="css-1dcdqdg"><code>            Reflection.encode = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">instance</span>) </span>{
</code></td></tr><tr><td id="L4243" class="css-a4x74f"><span>4243</span></td><td id="LC4243" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> rootSchemaType = instance.constructor;
</code></td></tr><tr><td id="L4244" class="css-a4x74f"><span>4244</span></td><td id="LC4244" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> reflection = <span class="code-keyword">new</span> Reflection();
</code></td></tr><tr><td id="L4245" class="css-a4x74f"><span>4245</span></td><td id="LC4245" class="css-1dcdqdg"><code>                reflection.rootType = rootSchemaType._typeid;
</code></td></tr><tr><td id="L4246" class="css-a4x74f"><span>4246</span></td><td id="LC4246" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> buildType = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">currentType, schema</span>) </span>{
</code></td></tr><tr><td id="L4247" class="css-a4x74f"><span>4247</span></td><td id="LC4247" class="css-1dcdqdg"><code>                    <span class="code-keyword">for</span> (<span class="code-keyword">var</span> fieldName <span class="code-keyword">in</span> schema) {
</code></td></tr><tr><td id="L4248" class="css-a4x74f"><span>4248</span></td><td id="LC4248" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> field = <span class="code-keyword">new</span> ReflectionField();
</code></td></tr><tr><td id="L4249" class="css-a4x74f"><span>4249</span></td><td id="LC4249" class="css-1dcdqdg"><code>                        field.name = fieldName;
</code></td></tr><tr><td id="L4250" class="css-a4x74f"><span>4250</span></td><td id="LC4250" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> fieldType = <span class="code-keyword">void</span> <span class="code-number">0</span>;
</code></td></tr><tr><td id="L4251" class="css-a4x74f"><span>4251</span></td><td id="LC4251" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (schema[fieldName]) === <span class="code-string">"string"</span>) {
</code></td></tr><tr><td id="L4252" class="css-a4x74f"><span>4252</span></td><td id="LC4252" class="css-1dcdqdg"><code>                            fieldType = schema[fieldName];
</code></td></tr><tr><td id="L4253" class="css-a4x74f"><span>4253</span></td><td id="LC4253" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L4254" class="css-a4x74f"><span>4254</span></td><td id="LC4254" class="css-1dcdqdg"><code>                        <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L4255" class="css-a4x74f"><span>4255</span></td><td id="LC4255" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> type_1 = schema[fieldName];
</code></td></tr><tr><td id="L4256" class="css-a4x74f"><span>4256</span></td><td id="LC4256" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> childTypeSchema = <span class="code-keyword">void</span> <span class="code-number">0</span>;
</code></td></tr><tr><td id="L4257" class="css-a4x74f"><span>4257</span></td><td id="LC4257" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L4258" class="css-a4x74f"><span>4258</span></td><td id="LC4258" class="css-1dcdqdg"><code>                            <span class="code-comment">// <span class="code-doctag">TODO:</span> refactor below.</span>
</code></td></tr><tr><td id="L4259" class="css-a4x74f"><span>4259</span></td><td id="LC4259" class="css-1dcdqdg"><code>                            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L4260" class="css-a4x74f"><span>4260</span></td><td id="LC4260" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (Schema.is(type_1)) {
</code></td></tr><tr><td id="L4261" class="css-a4x74f"><span>4261</span></td><td id="LC4261" class="css-1dcdqdg"><code>                                fieldType = <span class="code-string">"ref"</span>;
</code></td></tr><tr><td id="L4262" class="css-a4x74f"><span>4262</span></td><td id="LC4262" class="css-1dcdqdg"><code>                                childTypeSchema = schema[fieldName];
</code></td></tr><tr><td id="L4263" class="css-a4x74f"><span>4263</span></td><td id="LC4263" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L4264" class="css-a4x74f"><span>4264</span></td><td id="LC4264" class="css-1dcdqdg"><code>                            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L4265" class="css-a4x74f"><span>4265</span></td><td id="LC4265" class="css-1dcdqdg"><code>                                fieldType = <span class="code-built_in">Object</span>.keys(type_1)[<span class="code-number">0</span>];
</code></td></tr><tr><td id="L4266" class="css-a4x74f"><span>4266</span></td><td id="LC4266" class="css-1dcdqdg"><code>                                <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (type_1[fieldType]) === <span class="code-string">"string"</span>) {
</code></td></tr><tr><td id="L4267" class="css-a4x74f"><span>4267</span></td><td id="LC4267" class="css-1dcdqdg"><code>                                    fieldType += <span class="code-string">":"</span> + type_1[fieldType]; <span class="code-comment">// array:string</span>
</code></td></tr><tr><td id="L4268" class="css-a4x74f"><span>4268</span></td><td id="LC4268" class="css-1dcdqdg"><code>                                }
</code></td></tr><tr><td id="L4269" class="css-a4x74f"><span>4269</span></td><td id="LC4269" class="css-1dcdqdg"><code>                                <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L4270" class="css-a4x74f"><span>4270</span></td><td id="LC4270" class="css-1dcdqdg"><code>                                    childTypeSchema = type_1[fieldType];
</code></td></tr><tr><td id="L4271" class="css-a4x74f"><span>4271</span></td><td id="LC4271" class="css-1dcdqdg"><code>                                }
</code></td></tr><tr><td id="L4272" class="css-a4x74f"><span>4272</span></td><td id="LC4272" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L4273" class="css-a4x74f"><span>4273</span></td><td id="LC4273" class="css-1dcdqdg"><code>                            field.referencedType = (childTypeSchema)
</code></td></tr><tr><td id="L4274" class="css-a4x74f"><span>4274</span></td><td id="LC4274" class="css-1dcdqdg"><code>                                ? childTypeSchema._typeid
</code></td></tr><tr><td id="L4275" class="css-a4x74f"><span>4275</span></td><td id="LC4275" class="css-1dcdqdg"><code>                                : <span class="code-number">-1</span>;
</code></td></tr><tr><td id="L4276" class="css-a4x74f"><span>4276</span></td><td id="LC4276" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L4277" class="css-a4x74f"><span>4277</span></td><td id="LC4277" class="css-1dcdqdg"><code>                        field.type = fieldType;
</code></td></tr><tr><td id="L4278" class="css-a4x74f"><span>4278</span></td><td id="LC4278" class="css-1dcdqdg"><code>                        currentType.fields.push(field);
</code></td></tr><tr><td id="L4279" class="css-a4x74f"><span>4279</span></td><td id="LC4279" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L4280" class="css-a4x74f"><span>4280</span></td><td id="LC4280" class="css-1dcdqdg"><code>                    reflection.types.push(currentType);
</code></td></tr><tr><td id="L4281" class="css-a4x74f"><span>4281</span></td><td id="LC4281" class="css-1dcdqdg"><code>                };
</code></td></tr><tr><td id="L4282" class="css-a4x74f"><span>4282</span></td><td id="LC4282" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> types = rootSchemaType._context.types;
</code></td></tr><tr><td id="L4283" class="css-a4x74f"><span>4283</span></td><td id="LC4283" class="css-1dcdqdg"><code>                <span class="code-keyword">for</span> (<span class="code-keyword">var</span> typeid <span class="code-keyword">in</span> types) {
</code></td></tr><tr><td id="L4284" class="css-a4x74f"><span>4284</span></td><td id="LC4284" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> type_2 = <span class="code-keyword">new</span> ReflectionType();
</code></td></tr><tr><td id="L4285" class="css-a4x74f"><span>4285</span></td><td id="LC4285" class="css-1dcdqdg"><code>                    type_2.id = <span class="code-built_in">Number</span>(typeid);
</code></td></tr><tr><td id="L4286" class="css-a4x74f"><span>4286</span></td><td id="LC4286" class="css-1dcdqdg"><code>                    buildType(type_2, types[typeid]._definition.schema);
</code></td></tr><tr><td id="L4287" class="css-a4x74f"><span>4287</span></td><td id="LC4287" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L4288" class="css-a4x74f"><span>4288</span></td><td id="LC4288" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> reflection.encodeAll();
</code></td></tr><tr><td id="L4289" class="css-a4x74f"><span>4289</span></td><td id="LC4289" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L4290" class="css-a4x74f"><span>4290</span></td><td id="LC4290" class="css-1dcdqdg"><code>            Reflection.decode = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">bytes, it</span>) </span>{
</code></td></tr><tr><td id="L4291" class="css-a4x74f"><span>4291</span></td><td id="LC4291" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> context = <span class="code-keyword">new</span> Context();
</code></td></tr><tr><td id="L4292" class="css-a4x74f"><span>4292</span></td><td id="LC4292" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> reflection = <span class="code-keyword">new</span> Reflection();
</code></td></tr><tr><td id="L4293" class="css-a4x74f"><span>4293</span></td><td id="LC4293" class="css-1dcdqdg"><code>                reflection.decode(bytes, it);
</code></td></tr><tr><td id="L4294" class="css-a4x74f"><span>4294</span></td><td id="LC4294" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> schemaTypes = reflection.types.reduce(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">types, reflectionType</span>) </span>{
</code></td></tr><tr><td id="L4295" class="css-a4x74f"><span>4295</span></td><td id="LC4295" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> schema = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_super</span>) </span>{
</code></td></tr><tr><td id="L4296" class="css-a4x74f"><span>4296</span></td><td id="LC4296" class="css-1dcdqdg"><code>                        __extends(_, _super);
</code></td></tr><tr><td id="L4297" class="css-a4x74f"><span>4297</span></td><td id="LC4297" class="css-1dcdqdg"><code>                        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">_</span>(<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4298" class="css-a4x74f"><span>4298</span></td><td id="LC4298" class="css-1dcdqdg"><code>                            <span class="code-keyword">return</span> _super !== <span class="code-literal">null</span> &amp;&amp; _super.apply(<span class="code-keyword">this</span>, <span class="code-built_in">arguments</span>) || <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L4299" class="css-a4x74f"><span>4299</span></td><td id="LC4299" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L4300" class="css-a4x74f"><span>4300</span></td><td id="LC4300" class="css-1dcdqdg"><code>                        <span class="code-keyword">return</span> _;
</code></td></tr><tr><td id="L4301" class="css-a4x74f"><span>4301</span></td><td id="LC4301" class="css-1dcdqdg"><code>                    }(Schema));
</code></td></tr><tr><td id="L4302" class="css-a4x74f"><span>4302</span></td><td id="LC4302" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> typeid = reflectionType.id;
</code></td></tr><tr><td id="L4303" class="css-a4x74f"><span>4303</span></td><td id="LC4303" class="css-1dcdqdg"><code>                    types[typeid] = schema;
</code></td></tr><tr><td id="L4304" class="css-a4x74f"><span>4304</span></td><td id="LC4304" class="css-1dcdqdg"><code>                    context.add(schema, typeid);
</code></td></tr><tr><td id="L4305" class="css-a4x74f"><span>4305</span></td><td id="LC4305" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> types;
</code></td></tr><tr><td id="L4306" class="css-a4x74f"><span>4306</span></td><td id="LC4306" class="css-1dcdqdg"><code>                }, {});
</code></td></tr><tr><td id="L4307" class="css-a4x74f"><span>4307</span></td><td id="LC4307" class="css-1dcdqdg"><code>                reflection.types.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">reflectionType</span>) </span>{
</code></td></tr><tr><td id="L4308" class="css-a4x74f"><span>4308</span></td><td id="LC4308" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> schemaType = schemaTypes[reflectionType.id];
</code></td></tr><tr><td id="L4309" class="css-a4x74f"><span>4309</span></td><td id="LC4309" class="css-1dcdqdg"><code>                    reflectionType.fields.forEach(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">field</span>) </span>{
</code></td></tr><tr><td id="L4310" class="css-a4x74f"><span>4310</span></td><td id="LC4310" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> _a;
</code></td></tr><tr><td id="L4311" class="css-a4x74f"><span>4311</span></td><td id="LC4311" class="css-1dcdqdg"><code>                        <span class="code-keyword">if</span> (field.referencedType !== <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L4312" class="css-a4x74f"><span>4312</span></td><td id="LC4312" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> fieldType = field.type;
</code></td></tr><tr><td id="L4313" class="css-a4x74f"><span>4313</span></td><td id="LC4313" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> refType = schemaTypes[field.referencedType];
</code></td></tr><tr><td id="L4314" class="css-a4x74f"><span>4314</span></td><td id="LC4314" class="css-1dcdqdg"><code>                            <span class="code-comment">// map or array of primitive type (-1)</span>
</code></td></tr><tr><td id="L4315" class="css-a4x74f"><span>4315</span></td><td id="LC4315" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (!refType) {
</code></td></tr><tr><td id="L4316" class="css-a4x74f"><span>4316</span></td><td id="LC4316" class="css-1dcdqdg"><code>                                <span class="code-keyword">var</span> typeInfo = field.type.split(<span class="code-string">":"</span>);
</code></td></tr><tr><td id="L4317" class="css-a4x74f"><span>4317</span></td><td id="LC4317" class="css-1dcdqdg"><code>                                fieldType = typeInfo[<span class="code-number">0</span>];
</code></td></tr><tr><td id="L4318" class="css-a4x74f"><span>4318</span></td><td id="LC4318" class="css-1dcdqdg"><code>                                refType = typeInfo[<span class="code-number">1</span>];
</code></td></tr><tr><td id="L4319" class="css-a4x74f"><span>4319</span></td><td id="LC4319" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L4320" class="css-a4x74f"><span>4320</span></td><td id="LC4320" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (fieldType === <span class="code-string">"ref"</span>) {
</code></td></tr><tr><td id="L4321" class="css-a4x74f"><span>4321</span></td><td id="LC4321" class="css-1dcdqdg"><code>                                type(refType, { <span class="code-attr">context</span>: context })(schemaType.prototype, field.name);
</code></td></tr><tr><td id="L4322" class="css-a4x74f"><span>4322</span></td><td id="LC4322" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L4323" class="css-a4x74f"><span>4323</span></td><td id="LC4323" class="css-1dcdqdg"><code>                            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L4324" class="css-a4x74f"><span>4324</span></td><td id="LC4324" class="css-1dcdqdg"><code>                                type((_a = {}, _a[fieldType] = refType, _a), { <span class="code-attr">context</span>: context })(schemaType.prototype, field.name);
</code></td></tr><tr><td id="L4325" class="css-a4x74f"><span>4325</span></td><td id="LC4325" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L4326" class="css-a4x74f"><span>4326</span></td><td id="LC4326" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L4327" class="css-a4x74f"><span>4327</span></td><td id="LC4327" class="css-1dcdqdg"><code>                        <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L4328" class="css-a4x74f"><span>4328</span></td><td id="LC4328" class="css-1dcdqdg"><code>                            type(field.type, { <span class="code-attr">context</span>: context })(schemaType.prototype, field.name);
</code></td></tr><tr><td id="L4329" class="css-a4x74f"><span>4329</span></td><td id="LC4329" class="css-1dcdqdg"><code>                        }
</code></td></tr><tr><td id="L4330" class="css-a4x74f"><span>4330</span></td><td id="LC4330" class="css-1dcdqdg"><code>                    });
</code></td></tr><tr><td id="L4331" class="css-a4x74f"><span>4331</span></td><td id="LC4331" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L4332" class="css-a4x74f"><span>4332</span></td><td id="LC4332" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> rootType = schemaTypes[reflection.rootType];
</code></td></tr><tr><td id="L4333" class="css-a4x74f"><span>4333</span></td><td id="LC4333" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> rootInstance = <span class="code-keyword">new</span> rootType();
</code></td></tr><tr><td id="L4334" class="css-a4x74f"><span>4334</span></td><td id="LC4334" class="css-1dcdqdg"><code>                <span class="code-comment">/**
</span></code></td></tr><tr><td id="L4335" class="css-a4x74f"><span>4335</span></td><td id="LC4335" class="css-1dcdqdg"><code><span class="code-comment">                 * auto-initialize referenced types on root type
</span></code></td></tr><tr><td id="L4336" class="css-a4x74f"><span>4336</span></td><td id="LC4336" class="css-1dcdqdg"><code><span class="code-comment">                 * to allow registering listeners immediatelly on client-side
</span></code></td></tr><tr><td id="L4337" class="css-a4x74f"><span>4337</span></td><td id="LC4337" class="css-1dcdqdg"><code><span class="code-comment">                 */</span>
</code></td></tr><tr><td id="L4338" class="css-a4x74f"><span>4338</span></td><td id="LC4338" class="css-1dcdqdg"><code>                <span class="code-keyword">for</span> (<span class="code-keyword">var</span> fieldName <span class="code-keyword">in</span> rootType._definition.schema) {
</code></td></tr><tr><td id="L4339" class="css-a4x74f"><span>4339</span></td><td id="LC4339" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> fieldType = rootType._definition.schema[fieldName];
</code></td></tr><tr><td id="L4340" class="css-a4x74f"><span>4340</span></td><td id="LC4340" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (fieldType) !== <span class="code-string">"string"</span>) {
</code></td></tr><tr><td id="L4341" class="css-a4x74f"><span>4341</span></td><td id="LC4341" class="css-1dcdqdg"><code>                        rootInstance[fieldName] = (<span class="code-keyword">typeof</span> (fieldType) === <span class="code-string">"function"</span>)
</code></td></tr><tr><td id="L4342" class="css-a4x74f"><span>4342</span></td><td id="LC4342" class="css-1dcdqdg"><code>                            ? <span class="code-keyword">new</span> fieldType() <span class="code-comment">// is a schema reference</span>
</code></td></tr><tr><td id="L4343" class="css-a4x74f"><span>4343</span></td><td id="LC4343" class="css-1dcdqdg"><code>                            : <span class="code-keyword">new</span> (getType(<span class="code-built_in">Object</span>.keys(fieldType)[<span class="code-number">0</span>])).constructor(); <span class="code-comment">// is a "collection"</span>
</code></td></tr><tr><td id="L4344" class="css-a4x74f"><span>4344</span></td><td id="LC4344" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L4345" class="css-a4x74f"><span>4345</span></td><td id="LC4345" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L4346" class="css-a4x74f"><span>4346</span></td><td id="LC4346" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> rootInstance;
</code></td></tr><tr><td id="L4347" class="css-a4x74f"><span>4347</span></td><td id="LC4347" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L4348" class="css-a4x74f"><span>4348</span></td><td id="LC4348" class="css-1dcdqdg"><code>            __decorate([
</code></td></tr><tr><td id="L4349" class="css-a4x74f"><span>4349</span></td><td id="LC4349" class="css-1dcdqdg"><code>                type([ReflectionType], reflectionContext)
</code></td></tr><tr><td id="L4350" class="css-a4x74f"><span>4350</span></td><td id="LC4350" class="css-1dcdqdg"><code>            ], Reflection.prototype, <span class="code-string">"types"</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>);
</code></td></tr><tr><td id="L4351" class="css-a4x74f"><span>4351</span></td><td id="LC4351" class="css-1dcdqdg"><code>            __decorate([
</code></td></tr><tr><td id="L4352" class="css-a4x74f"><span>4352</span></td><td id="LC4352" class="css-1dcdqdg"><code>                type(<span class="code-string">"number"</span>, reflectionContext)
</code></td></tr><tr><td id="L4353" class="css-a4x74f"><span>4353</span></td><td id="LC4353" class="css-1dcdqdg"><code>            ], Reflection.prototype, <span class="code-string">"rootType"</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>);
</code></td></tr><tr><td id="L4354" class="css-a4x74f"><span>4354</span></td><td id="LC4354" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> Reflection;
</code></td></tr><tr><td id="L4355" class="css-a4x74f"><span>4355</span></td><td id="LC4355" class="css-1dcdqdg"><code>        }(Schema));
</code></td></tr><tr><td id="L4356" class="css-a4x74f"><span>4356</span></td><td id="LC4356" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4357" class="css-a4x74f"><span>4357</span></td><td id="LC4357" class="css-1dcdqdg"><code>        registerType(<span class="code-string">"map"</span>, { <span class="code-attr">constructor</span>: MapSchema });
</code></td></tr><tr><td id="L4358" class="css-a4x74f"><span>4358</span></td><td id="LC4358" class="css-1dcdqdg"><code>        registerType(<span class="code-string">"array"</span>, { <span class="code-attr">constructor</span>: ArraySchema });
</code></td></tr><tr><td id="L4359" class="css-a4x74f"><span>4359</span></td><td id="LC4359" class="css-1dcdqdg"><code>        registerType(<span class="code-string">"set"</span>, { <span class="code-attr">constructor</span>: SetSchema });
</code></td></tr><tr><td id="L4360" class="css-a4x74f"><span>4360</span></td><td id="LC4360" class="css-1dcdqdg"><code>        registerType(<span class="code-string">"collection"</span>, { <span class="code-attr">constructor</span>: CollectionSchema, });
</code></td></tr><tr><td id="L4361" class="css-a4x74f"><span>4361</span></td><td id="LC4361" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4362" class="css-a4x74f"><span>4362</span></td><td id="LC4362" class="css-1dcdqdg"><code>        exports.ArraySchema = ArraySchema;
</code></td></tr><tr><td id="L4363" class="css-a4x74f"><span>4363</span></td><td id="LC4363" class="css-1dcdqdg"><code>        exports.CollectionSchema = CollectionSchema;
</code></td></tr><tr><td id="L4364" class="css-a4x74f"><span>4364</span></td><td id="LC4364" class="css-1dcdqdg"><code>        exports.Context = Context;
</code></td></tr><tr><td id="L4365" class="css-a4x74f"><span>4365</span></td><td id="LC4365" class="css-1dcdqdg"><code>        exports.MapSchema = MapSchema;
</code></td></tr><tr><td id="L4366" class="css-a4x74f"><span>4366</span></td><td id="LC4366" class="css-1dcdqdg"><code>        exports.Reflection = Reflection;
</code></td></tr><tr><td id="L4367" class="css-a4x74f"><span>4367</span></td><td id="LC4367" class="css-1dcdqdg"><code>        exports.ReflectionField = ReflectionField;
</code></td></tr><tr><td id="L4368" class="css-a4x74f"><span>4368</span></td><td id="LC4368" class="css-1dcdqdg"><code>        exports.ReflectionType = ReflectionType;
</code></td></tr><tr><td id="L4369" class="css-a4x74f"><span>4369</span></td><td id="LC4369" class="css-1dcdqdg"><code>        exports.Schema = Schema;
</code></td></tr><tr><td id="L4370" class="css-a4x74f"><span>4370</span></td><td id="LC4370" class="css-1dcdqdg"><code>        exports.SchemaDefinition = SchemaDefinition;
</code></td></tr><tr><td id="L4371" class="css-a4x74f"><span>4371</span></td><td id="LC4371" class="css-1dcdqdg"><code>        exports.SetSchema = SetSchema;
</code></td></tr><tr><td id="L4372" class="css-a4x74f"><span>4372</span></td><td id="LC4372" class="css-1dcdqdg"><code>        exports.decode = decode;
</code></td></tr><tr><td id="L4373" class="css-a4x74f"><span>4373</span></td><td id="LC4373" class="css-1dcdqdg"><code>        exports.defineTypes = defineTypes;
</code></td></tr><tr><td id="L4374" class="css-a4x74f"><span>4374</span></td><td id="LC4374" class="css-1dcdqdg"><code>        exports.deprecated = deprecated;
</code></td></tr><tr><td id="L4375" class="css-a4x74f"><span>4375</span></td><td id="LC4375" class="css-1dcdqdg"><code>        exports.dumpChanges = dumpChanges;
</code></td></tr><tr><td id="L4376" class="css-a4x74f"><span>4376</span></td><td id="LC4376" class="css-1dcdqdg"><code>        exports.encode = encode;
</code></td></tr><tr><td id="L4377" class="css-a4x74f"><span>4377</span></td><td id="LC4377" class="css-1dcdqdg"><code>        exports.filter = filter;
</code></td></tr><tr><td id="L4378" class="css-a4x74f"><span>4378</span></td><td id="LC4378" class="css-1dcdqdg"><code>        exports.filterChildren = filterChildren;
</code></td></tr><tr><td id="L4379" class="css-a4x74f"><span>4379</span></td><td id="LC4379" class="css-1dcdqdg"><code>        exports.hasFilter = hasFilter;
</code></td></tr><tr><td id="L4380" class="css-a4x74f"><span>4380</span></td><td id="LC4380" class="css-1dcdqdg"><code>        exports.registerType = registerType;
</code></td></tr><tr><td id="L4381" class="css-a4x74f"><span>4381</span></td><td id="LC4381" class="css-1dcdqdg"><code>        exports.type = type;
</code></td></tr><tr><td id="L4382" class="css-a4x74f"><span>4382</span></td><td id="LC4382" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4383" class="css-a4x74f"><span>4383</span></td><td id="LC4383" class="css-1dcdqdg"><code>        <span class="code-built_in">Object</span>.defineProperty(exports, <span class="code-string">'__esModule'</span>, { <span class="code-attr">value</span>: <span class="code-literal">true</span> });
</code></td></tr><tr><td id="L4384" class="css-a4x74f"><span>4384</span></td><td id="LC4384" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4385" class="css-a4x74f"><span>4385</span></td><td id="LC4385" class="css-1dcdqdg"><code>    }));
</code></td></tr><tr><td id="L4386" class="css-a4x74f"><span>4386</span></td><td id="LC4386" class="css-1dcdqdg"><code>    });
</code></td></tr><tr><td id="L4387" class="css-a4x74f"><span>4387</span></td><td id="LC4387" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4388" class="css-a4x74f"><span>4388</span></td><td id="LC4388" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> Room = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4389" class="css-a4x74f"><span>4389</span></td><td id="LC4389" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">Room</span>(<span class="code-params">name, rootSchema</span>) </span>{
</code></td></tr><tr><td id="L4390" class="css-a4x74f"><span>4390</span></td><td id="LC4390" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L4391" class="css-a4x74f"><span>4391</span></td><td id="LC4391" class="css-1dcdqdg"><code>            <span class="code-comment">// Public signals</span>
</code></td></tr><tr><td id="L4392" class="css-a4x74f"><span>4392</span></td><td id="LC4392" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.onStateChange = createSignal();
</code></td></tr><tr><td id="L4393" class="css-a4x74f"><span>4393</span></td><td id="LC4393" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.onError = createSignal();
</code></td></tr><tr><td id="L4394" class="css-a4x74f"><span>4394</span></td><td id="LC4394" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.onLeave = createSignal();
</code></td></tr><tr><td id="L4395" class="css-a4x74f"><span>4395</span></td><td id="LC4395" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.onJoin = createSignal();
</code></td></tr><tr><td id="L4396" class="css-a4x74f"><span>4396</span></td><td id="LC4396" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.hasJoined = <span class="code-literal">false</span>;
</code></td></tr><tr><td id="L4397" class="css-a4x74f"><span>4397</span></td><td id="LC4397" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.onMessageHandlers = createNanoEvents();
</code></td></tr><tr><td id="L4398" class="css-a4x74f"><span>4398</span></td><td id="LC4398" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.roomId = <span class="code-literal">null</span>;
</code></td></tr><tr><td id="L4399" class="css-a4x74f"><span>4399</span></td><td id="LC4399" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.name = name;
</code></td></tr><tr><td id="L4400" class="css-a4x74f"><span>4400</span></td><td id="LC4400" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (rootSchema) {
</code></td></tr><tr><td id="L4401" class="css-a4x74f"><span>4401</span></td><td id="LC4401" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.serializer = <span class="code-keyword">new</span> (getSerializer(<span class="code-string">"schema"</span>));
</code></td></tr><tr><td id="L4402" class="css-a4x74f"><span>4402</span></td><td id="LC4402" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.rootSchema = rootSchema;
</code></td></tr><tr><td id="L4403" class="css-a4x74f"><span>4403</span></td><td id="LC4403" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.serializer.state = <span class="code-keyword">new</span> rootSchema();
</code></td></tr><tr><td id="L4404" class="css-a4x74f"><span>4404</span></td><td id="LC4404" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4405" class="css-a4x74f"><span>4405</span></td><td id="LC4405" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.onError(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">code, message</span>) </span>{ <span class="code-keyword">var</span> _a; <span class="code-keyword">return</span> (_a = <span class="code-built_in">console</span>.warn) === <span class="code-literal">null</span> || _a === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _a.call(<span class="code-built_in">console</span>, <span class="code-string">"colyseus.js - onError =&gt; ("</span>.concat(code, <span class="code-string">") "</span>).concat(message)); });
</code></td></tr><tr><td id="L4406" class="css-a4x74f"><span>4406</span></td><td id="LC4406" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.onLeave(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{ <span class="code-keyword">return</span> _this.removeAllListeners(); });
</code></td></tr><tr><td id="L4407" class="css-a4x74f"><span>4407</span></td><td id="LC4407" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L4408" class="css-a4x74f"><span>4408</span></td><td id="LC4408" class="css-1dcdqdg"><code>        <span class="code-built_in">Object</span>.defineProperty(Room.prototype, <span class="code-string">"id"</span>, {
</code></td></tr><tr><td id="L4409" class="css-a4x74f"><span>4409</span></td><td id="LC4409" class="css-1dcdqdg"><code>            <span class="code-comment">// <span class="code-doctag">TODO:</span> deprecate me on version 1.0</span>
</code></td></tr><tr><td id="L4410" class="css-a4x74f"><span>4410</span></td><td id="LC4410" class="css-1dcdqdg"><code>            <span class="code-keyword">get</span>: function () { <span class="code-keyword">return</span> <span class="code-keyword">this</span>.roomId; },
</code></td></tr><tr><td id="L4411" class="css-a4x74f"><span>4411</span></td><td id="LC4411" class="css-1dcdqdg"><code>            enumerable: <span class="code-literal">false</span>,
</code></td></tr><tr><td id="L4412" class="css-a4x74f"><span>4412</span></td><td id="LC4412" class="css-1dcdqdg"><code>            configurable: <span class="code-literal">true</span>
</code></td></tr><tr><td id="L4413" class="css-a4x74f"><span>4413</span></td><td id="LC4413" class="css-1dcdqdg"><code>        });
</code></td></tr><tr><td id="L4414" class="css-a4x74f"><span>4414</span></td><td id="LC4414" class="css-1dcdqdg"><code>        Room.prototype.connect = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">endpoint, devModeCloseCallback, room <span class="code-regexp">//</span> when reconnecting on devMode, re-use previous room intance for handling events.
</span></span></code></td></tr><tr><td id="L4415" class="css-a4x74f"><span>4415</span></td><td id="LC4415" class="css-1dcdqdg"><code><span class="code-function"><span class="code-params">        </span>) </span>{
</code></td></tr><tr><td id="L4416" class="css-a4x74f"><span>4416</span></td><td id="LC4416" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (room === <span class="code-keyword">void</span> <span class="code-number">0</span>) { room = <span class="code-keyword">this</span>; }
</code></td></tr><tr><td id="L4417" class="css-a4x74f"><span>4417</span></td><td id="LC4417" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> connection = <span class="code-keyword">new</span> Connection();
</code></td></tr><tr><td id="L4418" class="css-a4x74f"><span>4418</span></td><td id="LC4418" class="css-1dcdqdg"><code>            room.connection = connection;
</code></td></tr><tr><td id="L4419" class="css-a4x74f"><span>4419</span></td><td id="LC4419" class="css-1dcdqdg"><code>            connection.events.onmessage = Room.prototype.onMessageCallback.bind(room);
</code></td></tr><tr><td id="L4420" class="css-a4x74f"><span>4420</span></td><td id="LC4420" class="css-1dcdqdg"><code>            connection.events.onclose = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">e</span>) </span>{
</code></td></tr><tr><td id="L4421" class="css-a4x74f"><span>4421</span></td><td id="LC4421" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _a;
</code></td></tr><tr><td id="L4422" class="css-a4x74f"><span>4422</span></td><td id="LC4422" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (!room.hasJoined) {
</code></td></tr><tr><td id="L4423" class="css-a4x74f"><span>4423</span></td><td id="LC4423" class="css-1dcdqdg"><code>                    (_a = <span class="code-built_in">console</span>.warn) === <span class="code-literal">null</span> || _a === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _a.call(<span class="code-built_in">console</span>, <span class="code-string">"Room connection was closed unexpectedly ("</span>.concat(e.code, <span class="code-string">"): "</span>).concat(e.reason));
</code></td></tr><tr><td id="L4424" class="css-a4x74f"><span>4424</span></td><td id="LC4424" class="css-1dcdqdg"><code>                    room.onError.invoke(e.code, e.reason);
</code></td></tr><tr><td id="L4425" class="css-a4x74f"><span>4425</span></td><td id="LC4425" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span>;
</code></td></tr><tr><td id="L4426" class="css-a4x74f"><span>4426</span></td><td id="LC4426" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L4427" class="css-a4x74f"><span>4427</span></td><td id="LC4427" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (e.code === CloseCode.DEVMODE_RESTART &amp;&amp; devModeCloseCallback) {
</code></td></tr><tr><td id="L4428" class="css-a4x74f"><span>4428</span></td><td id="LC4428" class="css-1dcdqdg"><code>                    devModeCloseCallback();
</code></td></tr><tr><td id="L4429" class="css-a4x74f"><span>4429</span></td><td id="LC4429" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L4430" class="css-a4x74f"><span>4430</span></td><td id="LC4430" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L4431" class="css-a4x74f"><span>4431</span></td><td id="LC4431" class="css-1dcdqdg"><code>                    room.onLeave.invoke(e.code);
</code></td></tr><tr><td id="L4432" class="css-a4x74f"><span>4432</span></td><td id="LC4432" class="css-1dcdqdg"><code>                    room.destroy();
</code></td></tr><tr><td id="L4433" class="css-a4x74f"><span>4433</span></td><td id="LC4433" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L4434" class="css-a4x74f"><span>4434</span></td><td id="LC4434" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L4435" class="css-a4x74f"><span>4435</span></td><td id="LC4435" class="css-1dcdqdg"><code>            connection.events.onerror = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">e</span>) </span>{
</code></td></tr><tr><td id="L4436" class="css-a4x74f"><span>4436</span></td><td id="LC4436" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _a;
</code></td></tr><tr><td id="L4437" class="css-a4x74f"><span>4437</span></td><td id="LC4437" class="css-1dcdqdg"><code>                (_a = <span class="code-built_in">console</span>.warn) === <span class="code-literal">null</span> || _a === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _a.call(<span class="code-built_in">console</span>, <span class="code-string">"Room, onError ("</span>.concat(e.code, <span class="code-string">"): "</span>).concat(e.reason));
</code></td></tr><tr><td id="L4438" class="css-a4x74f"><span>4438</span></td><td id="LC4438" class="css-1dcdqdg"><code>                room.onError.invoke(e.code, e.reason);
</code></td></tr><tr><td id="L4439" class="css-a4x74f"><span>4439</span></td><td id="LC4439" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L4440" class="css-a4x74f"><span>4440</span></td><td id="LC4440" class="css-1dcdqdg"><code>            connection.connect(endpoint);
</code></td></tr><tr><td id="L4441" class="css-a4x74f"><span>4441</span></td><td id="LC4441" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4442" class="css-a4x74f"><span>4442</span></td><td id="LC4442" class="css-1dcdqdg"><code>        Room.prototype.leave = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">consented</span>) </span>{
</code></td></tr><tr><td id="L4443" class="css-a4x74f"><span>4443</span></td><td id="LC4443" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L4444" class="css-a4x74f"><span>4444</span></td><td id="LC4444" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (consented === <span class="code-keyword">void</span> <span class="code-number">0</span>) { consented = <span class="code-literal">true</span>; }
</code></td></tr><tr><td id="L4445" class="css-a4x74f"><span>4445</span></td><td id="LC4445" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> <span class="code-keyword">new</span> <span class="code-built_in">Promise</span>(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">resolve</span>) </span>{
</code></td></tr><tr><td id="L4446" class="css-a4x74f"><span>4446</span></td><td id="LC4446" class="css-1dcdqdg"><code>                _this.onLeave(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">code</span>) </span>{ <span class="code-keyword">return</span> resolve(code); });
</code></td></tr><tr><td id="L4447" class="css-a4x74f"><span>4447</span></td><td id="LC4447" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (_this.connection) {
</code></td></tr><tr><td id="L4448" class="css-a4x74f"><span>4448</span></td><td id="LC4448" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (consented) {
</code></td></tr><tr><td id="L4449" class="css-a4x74f"><span>4449</span></td><td id="LC4449" class="css-1dcdqdg"><code>                        _this.connection.send([exports.Protocol.LEAVE_ROOM]);
</code></td></tr><tr><td id="L4450" class="css-a4x74f"><span>4450</span></td><td id="LC4450" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L4451" class="css-a4x74f"><span>4451</span></td><td id="LC4451" class="css-1dcdqdg"><code>                    <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L4452" class="css-a4x74f"><span>4452</span></td><td id="LC4452" class="css-1dcdqdg"><code>                        _this.connection.close();
</code></td></tr><tr><td id="L4453" class="css-a4x74f"><span>4453</span></td><td id="LC4453" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L4454" class="css-a4x74f"><span>4454</span></td><td id="LC4454" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L4455" class="css-a4x74f"><span>4455</span></td><td id="LC4455" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L4456" class="css-a4x74f"><span>4456</span></td><td id="LC4456" class="css-1dcdqdg"><code>                    _this.onLeave.invoke(CloseCode.CONSENTED);
</code></td></tr><tr><td id="L4457" class="css-a4x74f"><span>4457</span></td><td id="LC4457" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L4458" class="css-a4x74f"><span>4458</span></td><td id="LC4458" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L4459" class="css-a4x74f"><span>4459</span></td><td id="LC4459" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4460" class="css-a4x74f"><span>4460</span></td><td id="LC4460" class="css-1dcdqdg"><code>        Room.prototype.onMessage = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">type, callback</span>) </span>{
</code></td></tr><tr><td id="L4461" class="css-a4x74f"><span>4461</span></td><td id="LC4461" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> <span class="code-keyword">this</span>.onMessageHandlers.on(<span class="code-keyword">this</span>.getMessageHandlerKey(type), callback);
</code></td></tr><tr><td id="L4462" class="css-a4x74f"><span>4462</span></td><td id="LC4462" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4463" class="css-a4x74f"><span>4463</span></td><td id="LC4463" class="css-1dcdqdg"><code>        Room.prototype.send = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">type, message</span>) </span>{
</code></td></tr><tr><td id="L4464" class="css-a4x74f"><span>4464</span></td><td id="LC4464" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> initialBytes = [exports.Protocol.ROOM_DATA];
</code></td></tr><tr><td id="L4465" class="css-a4x74f"><span>4465</span></td><td id="LC4465" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (type) === <span class="code-string">"string"</span>) {
</code></td></tr><tr><td id="L4466" class="css-a4x74f"><span>4466</span></td><td id="LC4466" class="css-1dcdqdg"><code>                umd.encode.string(initialBytes, type);
</code></td></tr><tr><td id="L4467" class="css-a4x74f"><span>4467</span></td><td id="LC4467" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4468" class="css-a4x74f"><span>4468</span></td><td id="LC4468" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L4469" class="css-a4x74f"><span>4469</span></td><td id="LC4469" class="css-1dcdqdg"><code>                umd.encode.number(initialBytes, type);
</code></td></tr><tr><td id="L4470" class="css-a4x74f"><span>4470</span></td><td id="LC4470" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4471" class="css-a4x74f"><span>4471</span></td><td id="LC4471" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> arr;
</code></td></tr><tr><td id="L4472" class="css-a4x74f"><span>4472</span></td><td id="LC4472" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (message !== <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L4473" class="css-a4x74f"><span>4473</span></td><td id="LC4473" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> encoded = encode(message);
</code></td></tr><tr><td id="L4474" class="css-a4x74f"><span>4474</span></td><td id="LC4474" class="css-1dcdqdg"><code>                arr = <span class="code-keyword">new</span> <span class="code-built_in">Uint8Array</span>(initialBytes.length + encoded.byteLength);
</code></td></tr><tr><td id="L4475" class="css-a4x74f"><span>4475</span></td><td id="LC4475" class="css-1dcdqdg"><code>                arr.set(<span class="code-keyword">new</span> <span class="code-built_in">Uint8Array</span>(initialBytes), <span class="code-number">0</span>);
</code></td></tr><tr><td id="L4476" class="css-a4x74f"><span>4476</span></td><td id="LC4476" class="css-1dcdqdg"><code>                arr.set(<span class="code-keyword">new</span> <span class="code-built_in">Uint8Array</span>(encoded), initialBytes.length);
</code></td></tr><tr><td id="L4477" class="css-a4x74f"><span>4477</span></td><td id="LC4477" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4478" class="css-a4x74f"><span>4478</span></td><td id="LC4478" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L4479" class="css-a4x74f"><span>4479</span></td><td id="LC4479" class="css-1dcdqdg"><code>                arr = <span class="code-keyword">new</span> <span class="code-built_in">Uint8Array</span>(initialBytes);
</code></td></tr><tr><td id="L4480" class="css-a4x74f"><span>4480</span></td><td id="LC4480" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4481" class="css-a4x74f"><span>4481</span></td><td id="LC4481" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.connection.send(arr.buffer);
</code></td></tr><tr><td id="L4482" class="css-a4x74f"><span>4482</span></td><td id="LC4482" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4483" class="css-a4x74f"><span>4483</span></td><td id="LC4483" class="css-1dcdqdg"><code>        Room.prototype.sendBytes = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">type, bytes</span>) </span>{
</code></td></tr><tr><td id="L4484" class="css-a4x74f"><span>4484</span></td><td id="LC4484" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> initialBytes = [exports.Protocol.ROOM_DATA_BYTES];
</code></td></tr><tr><td id="L4485" class="css-a4x74f"><span>4485</span></td><td id="LC4485" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (type) === <span class="code-string">"string"</span>) {
</code></td></tr><tr><td id="L4486" class="css-a4x74f"><span>4486</span></td><td id="LC4486" class="css-1dcdqdg"><code>                umd.encode.string(initialBytes, type);
</code></td></tr><tr><td id="L4487" class="css-a4x74f"><span>4487</span></td><td id="LC4487" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4488" class="css-a4x74f"><span>4488</span></td><td id="LC4488" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L4489" class="css-a4x74f"><span>4489</span></td><td id="LC4489" class="css-1dcdqdg"><code>                umd.encode.number(initialBytes, type);
</code></td></tr><tr><td id="L4490" class="css-a4x74f"><span>4490</span></td><td id="LC4490" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4491" class="css-a4x74f"><span>4491</span></td><td id="LC4491" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> arr;
</code></td></tr><tr><td id="L4492" class="css-a4x74f"><span>4492</span></td><td id="LC4492" class="css-1dcdqdg"><code>            arr = <span class="code-keyword">new</span> <span class="code-built_in">Uint8Array</span>(initialBytes.length + (bytes.byteLength || bytes.length));
</code></td></tr><tr><td id="L4493" class="css-a4x74f"><span>4493</span></td><td id="LC4493" class="css-1dcdqdg"><code>            arr.set(<span class="code-keyword">new</span> <span class="code-built_in">Uint8Array</span>(initialBytes), <span class="code-number">0</span>);
</code></td></tr><tr><td id="L4494" class="css-a4x74f"><span>4494</span></td><td id="LC4494" class="css-1dcdqdg"><code>            arr.set(<span class="code-keyword">new</span> <span class="code-built_in">Uint8Array</span>(bytes), initialBytes.length);
</code></td></tr><tr><td id="L4495" class="css-a4x74f"><span>4495</span></td><td id="LC4495" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.connection.send(arr.buffer);
</code></td></tr><tr><td id="L4496" class="css-a4x74f"><span>4496</span></td><td id="LC4496" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4497" class="css-a4x74f"><span>4497</span></td><td id="LC4497" class="css-1dcdqdg"><code>        <span class="code-built_in">Object</span>.defineProperty(Room.prototype, <span class="code-string">"state"</span>, {
</code></td></tr><tr><td id="L4498" class="css-a4x74f"><span>4498</span></td><td id="LC4498" class="css-1dcdqdg"><code>            <span class="code-keyword">get</span>: function () {
</code></td></tr><tr><td id="L4499" class="css-a4x74f"><span>4499</span></td><td id="LC4499" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.serializer.getState();
</code></td></tr><tr><td id="L4500" class="css-a4x74f"><span>4500</span></td><td id="LC4500" class="css-1dcdqdg"><code>            },
</code></td></tr><tr><td id="L4501" class="css-a4x74f"><span>4501</span></td><td id="LC4501" class="css-1dcdqdg"><code>            enumerable: <span class="code-literal">false</span>,
</code></td></tr><tr><td id="L4502" class="css-a4x74f"><span>4502</span></td><td id="LC4502" class="css-1dcdqdg"><code>            configurable: <span class="code-literal">true</span>
</code></td></tr><tr><td id="L4503" class="css-a4x74f"><span>4503</span></td><td id="LC4503" class="css-1dcdqdg"><code>        });
</code></td></tr><tr><td id="L4504" class="css-a4x74f"><span>4504</span></td><td id="LC4504" class="css-1dcdqdg"><code>        Room.prototype.removeAllListeners = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4505" class="css-a4x74f"><span>4505</span></td><td id="LC4505" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.onJoin.clear();
</code></td></tr><tr><td id="L4506" class="css-a4x74f"><span>4506</span></td><td id="LC4506" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.onStateChange.clear();
</code></td></tr><tr><td id="L4507" class="css-a4x74f"><span>4507</span></td><td id="LC4507" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.onError.clear();
</code></td></tr><tr><td id="L4508" class="css-a4x74f"><span>4508</span></td><td id="LC4508" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.onLeave.clear();
</code></td></tr><tr><td id="L4509" class="css-a4x74f"><span>4509</span></td><td id="LC4509" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.onMessageHandlers.events = {};
</code></td></tr><tr><td id="L4510" class="css-a4x74f"><span>4510</span></td><td id="LC4510" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4511" class="css-a4x74f"><span>4511</span></td><td id="LC4511" class="css-1dcdqdg"><code>        Room.prototype.onMessageCallback = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">event</span>) </span>{
</code></td></tr><tr><td id="L4512" class="css-a4x74f"><span>4512</span></td><td id="LC4512" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> bytes = <span class="code-built_in">Array</span>.from(<span class="code-keyword">new</span> <span class="code-built_in">Uint8Array</span>(event.data));
</code></td></tr><tr><td id="L4513" class="css-a4x74f"><span>4513</span></td><td id="LC4513" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> code = bytes[<span class="code-number">0</span>];
</code></td></tr><tr><td id="L4514" class="css-a4x74f"><span>4514</span></td><td id="LC4514" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (code === exports.Protocol.JOIN_ROOM) {
</code></td></tr><tr><td id="L4515" class="css-a4x74f"><span>4515</span></td><td id="LC4515" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> offset = <span class="code-number">1</span>;
</code></td></tr><tr><td id="L4516" class="css-a4x74f"><span>4516</span></td><td id="LC4516" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> reconnectionToken = utf8Read(bytes, offset);
</code></td></tr><tr><td id="L4517" class="css-a4x74f"><span>4517</span></td><td id="LC4517" class="css-1dcdqdg"><code>                offset += utf8Length(reconnectionToken);
</code></td></tr><tr><td id="L4518" class="css-a4x74f"><span>4518</span></td><td id="LC4518" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.serializerId = utf8Read(bytes, offset);
</code></td></tr><tr><td id="L4519" class="css-a4x74f"><span>4519</span></td><td id="LC4519" class="css-1dcdqdg"><code>                offset += utf8Length(<span class="code-keyword">this</span>.serializerId);
</code></td></tr><tr><td id="L4520" class="css-a4x74f"><span>4520</span></td><td id="LC4520" class="css-1dcdqdg"><code>                <span class="code-comment">// Instantiate serializer if not locally available.</span>
</code></td></tr><tr><td id="L4521" class="css-a4x74f"><span>4521</span></td><td id="LC4521" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (!<span class="code-keyword">this</span>.serializer) {
</code></td></tr><tr><td id="L4522" class="css-a4x74f"><span>4522</span></td><td id="LC4522" class="css-1dcdqdg"><code>                    <span class="code-keyword">var</span> serializer = getSerializer(<span class="code-keyword">this</span>.serializerId);
</code></td></tr><tr><td id="L4523" class="css-a4x74f"><span>4523</span></td><td id="LC4523" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.serializer = <span class="code-keyword">new</span> serializer();
</code></td></tr><tr><td id="L4524" class="css-a4x74f"><span>4524</span></td><td id="LC4524" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L4525" class="css-a4x74f"><span>4525</span></td><td id="LC4525" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (bytes.length &gt; offset &amp;&amp; <span class="code-keyword">this</span>.serializer.handshake) {
</code></td></tr><tr><td id="L4526" class="css-a4x74f"><span>4526</span></td><td id="LC4526" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.serializer.handshake(bytes, { <span class="code-attr">offset</span>: offset });
</code></td></tr><tr><td id="L4527" class="css-a4x74f"><span>4527</span></td><td id="LC4527" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L4528" class="css-a4x74f"><span>4528</span></td><td id="LC4528" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.reconnectionToken = <span class="code-string">""</span>.concat(<span class="code-keyword">this</span>.roomId, <span class="code-string">":"</span>).concat(reconnectionToken);
</code></td></tr><tr><td id="L4529" class="css-a4x74f"><span>4529</span></td><td id="LC4529" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.hasJoined = <span class="code-literal">true</span>;
</code></td></tr><tr><td id="L4530" class="css-a4x74f"><span>4530</span></td><td id="LC4530" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.onJoin.invoke();
</code></td></tr><tr><td id="L4531" class="css-a4x74f"><span>4531</span></td><td id="LC4531" class="css-1dcdqdg"><code>                <span class="code-comment">// acknowledge successfull JOIN_ROOM</span>
</code></td></tr><tr><td id="L4532" class="css-a4x74f"><span>4532</span></td><td id="LC4532" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.connection.send([exports.Protocol.JOIN_ROOM]);
</code></td></tr><tr><td id="L4533" class="css-a4x74f"><span>4533</span></td><td id="LC4533" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4534" class="css-a4x74f"><span>4534</span></td><td id="LC4534" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (code === exports.Protocol.ERROR) {
</code></td></tr><tr><td id="L4535" class="css-a4x74f"><span>4535</span></td><td id="LC4535" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> it_1 = { <span class="code-attr">offset</span>: <span class="code-number">1</span> };
</code></td></tr><tr><td id="L4536" class="css-a4x74f"><span>4536</span></td><td id="LC4536" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> code_1 = umd.decode.number(bytes, it_1);
</code></td></tr><tr><td id="L4537" class="css-a4x74f"><span>4537</span></td><td id="LC4537" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> message = umd.decode.string(bytes, it_1);
</code></td></tr><tr><td id="L4538" class="css-a4x74f"><span>4538</span></td><td id="LC4538" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.onError.invoke(code_1, message);
</code></td></tr><tr><td id="L4539" class="css-a4x74f"><span>4539</span></td><td id="LC4539" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4540" class="css-a4x74f"><span>4540</span></td><td id="LC4540" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (code === exports.Protocol.LEAVE_ROOM) {
</code></td></tr><tr><td id="L4541" class="css-a4x74f"><span>4541</span></td><td id="LC4541" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.leave();
</code></td></tr><tr><td id="L4542" class="css-a4x74f"><span>4542</span></td><td id="LC4542" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4543" class="css-a4x74f"><span>4543</span></td><td id="LC4543" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (code === exports.Protocol.ROOM_DATA_SCHEMA) {
</code></td></tr><tr><td id="L4544" class="css-a4x74f"><span>4544</span></td><td id="LC4544" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> it_2 = { <span class="code-attr">offset</span>: <span class="code-number">1</span> };
</code></td></tr><tr><td id="L4545" class="css-a4x74f"><span>4545</span></td><td id="LC4545" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> context_1 = <span class="code-keyword">this</span>.serializer.getState().constructor._context;
</code></td></tr><tr><td id="L4546" class="css-a4x74f"><span>4546</span></td><td id="LC4546" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> type = context_1.get(umd.decode.number(bytes, it_2));
</code></td></tr><tr><td id="L4547" class="css-a4x74f"><span>4547</span></td><td id="LC4547" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> message = <span class="code-keyword">new</span> type();
</code></td></tr><tr><td id="L4548" class="css-a4x74f"><span>4548</span></td><td id="LC4548" class="css-1dcdqdg"><code>                message.decode(bytes, it_2);
</code></td></tr><tr><td id="L4549" class="css-a4x74f"><span>4549</span></td><td id="LC4549" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.dispatchMessage(type, message);
</code></td></tr><tr><td id="L4550" class="css-a4x74f"><span>4550</span></td><td id="LC4550" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4551" class="css-a4x74f"><span>4551</span></td><td id="LC4551" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (code === exports.Protocol.ROOM_STATE) {
</code></td></tr><tr><td id="L4552" class="css-a4x74f"><span>4552</span></td><td id="LC4552" class="css-1dcdqdg"><code>                bytes.shift(); <span class="code-comment">// drop `code` byte</span>
</code></td></tr><tr><td id="L4553" class="css-a4x74f"><span>4553</span></td><td id="LC4553" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.setState(bytes);
</code></td></tr><tr><td id="L4554" class="css-a4x74f"><span>4554</span></td><td id="LC4554" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4555" class="css-a4x74f"><span>4555</span></td><td id="LC4555" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (code === exports.Protocol.ROOM_STATE_PATCH) {
</code></td></tr><tr><td id="L4556" class="css-a4x74f"><span>4556</span></td><td id="LC4556" class="css-1dcdqdg"><code>                bytes.shift(); <span class="code-comment">// drop `code` byte</span>
</code></td></tr><tr><td id="L4557" class="css-a4x74f"><span>4557</span></td><td id="LC4557" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.patch(bytes);
</code></td></tr><tr><td id="L4558" class="css-a4x74f"><span>4558</span></td><td id="LC4558" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4559" class="css-a4x74f"><span>4559</span></td><td id="LC4559" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (code === exports.Protocol.ROOM_DATA) {
</code></td></tr><tr><td id="L4560" class="css-a4x74f"><span>4560</span></td><td id="LC4560" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> it_3 = { <span class="code-attr">offset</span>: <span class="code-number">1</span> };
</code></td></tr><tr><td id="L4561" class="css-a4x74f"><span>4561</span></td><td id="LC4561" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> type = (umd.decode.stringCheck(bytes, it_3))
</code></td></tr><tr><td id="L4562" class="css-a4x74f"><span>4562</span></td><td id="LC4562" class="css-1dcdqdg"><code>                    ? umd.decode.string(bytes, it_3)
</code></td></tr><tr><td id="L4563" class="css-a4x74f"><span>4563</span></td><td id="LC4563" class="css-1dcdqdg"><code>                    : umd.decode.number(bytes, it_3);
</code></td></tr><tr><td id="L4564" class="css-a4x74f"><span>4564</span></td><td id="LC4564" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> message = (bytes.length &gt; it_3.offset)
</code></td></tr><tr><td id="L4565" class="css-a4x74f"><span>4565</span></td><td id="LC4565" class="css-1dcdqdg"><code>                    ? decode(event.data, it_3.offset)
</code></td></tr><tr><td id="L4566" class="css-a4x74f"><span>4566</span></td><td id="LC4566" class="css-1dcdqdg"><code>                    : <span class="code-literal">undefined</span>;
</code></td></tr><tr><td id="L4567" class="css-a4x74f"><span>4567</span></td><td id="LC4567" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.dispatchMessage(type, message);
</code></td></tr><tr><td id="L4568" class="css-a4x74f"><span>4568</span></td><td id="LC4568" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4569" class="css-a4x74f"><span>4569</span></td><td id="LC4569" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (code === exports.Protocol.ROOM_DATA_BYTES) {
</code></td></tr><tr><td id="L4570" class="css-a4x74f"><span>4570</span></td><td id="LC4570" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> it_4 = { <span class="code-attr">offset</span>: <span class="code-number">1</span> };
</code></td></tr><tr><td id="L4571" class="css-a4x74f"><span>4571</span></td><td id="LC4571" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> type = (umd.decode.stringCheck(bytes, it_4))
</code></td></tr><tr><td id="L4572" class="css-a4x74f"><span>4572</span></td><td id="LC4572" class="css-1dcdqdg"><code>                    ? umd.decode.string(bytes, it_4)
</code></td></tr><tr><td id="L4573" class="css-a4x74f"><span>4573</span></td><td id="LC4573" class="css-1dcdqdg"><code>                    : umd.decode.number(bytes, it_4);
</code></td></tr><tr><td id="L4574" class="css-a4x74f"><span>4574</span></td><td id="LC4574" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.dispatchMessage(type, <span class="code-keyword">new</span> <span class="code-built_in">Uint8Array</span>(bytes.slice(it_4.offset)));
</code></td></tr><tr><td id="L4575" class="css-a4x74f"><span>4575</span></td><td id="LC4575" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4576" class="css-a4x74f"><span>4576</span></td><td id="LC4576" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4577" class="css-a4x74f"><span>4577</span></td><td id="LC4577" class="css-1dcdqdg"><code>        Room.prototype.setState = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">encodedState</span>) </span>{
</code></td></tr><tr><td id="L4578" class="css-a4x74f"><span>4578</span></td><td id="LC4578" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.serializer.setState(encodedState);
</code></td></tr><tr><td id="L4579" class="css-a4x74f"><span>4579</span></td><td id="LC4579" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.onStateChange.invoke(<span class="code-keyword">this</span>.serializer.getState());
</code></td></tr><tr><td id="L4580" class="css-a4x74f"><span>4580</span></td><td id="LC4580" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4581" class="css-a4x74f"><span>4581</span></td><td id="LC4581" class="css-1dcdqdg"><code>        Room.prototype.patch = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">binaryPatch</span>) </span>{
</code></td></tr><tr><td id="L4582" class="css-a4x74f"><span>4582</span></td><td id="LC4582" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.serializer.patch(binaryPatch);
</code></td></tr><tr><td id="L4583" class="css-a4x74f"><span>4583</span></td><td id="LC4583" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.onStateChange.invoke(<span class="code-keyword">this</span>.serializer.getState());
</code></td></tr><tr><td id="L4584" class="css-a4x74f"><span>4584</span></td><td id="LC4584" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4585" class="css-a4x74f"><span>4585</span></td><td id="LC4585" class="css-1dcdqdg"><code>        Room.prototype.dispatchMessage = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">type, message</span>) </span>{
</code></td></tr><tr><td id="L4586" class="css-a4x74f"><span>4586</span></td><td id="LC4586" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> _a;
</code></td></tr><tr><td id="L4587" class="css-a4x74f"><span>4587</span></td><td id="LC4587" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> messageType = <span class="code-keyword">this</span>.getMessageHandlerKey(type);
</code></td></tr><tr><td id="L4588" class="css-a4x74f"><span>4588</span></td><td id="LC4588" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.onMessageHandlers.events[messageType]) {
</code></td></tr><tr><td id="L4589" class="css-a4x74f"><span>4589</span></td><td id="LC4589" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.onMessageHandlers.emit(messageType, message);
</code></td></tr><tr><td id="L4590" class="css-a4x74f"><span>4590</span></td><td id="LC4590" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4591" class="css-a4x74f"><span>4591</span></td><td id="LC4591" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.onMessageHandlers.events[<span class="code-string">'*'</span>]) {
</code></td></tr><tr><td id="L4592" class="css-a4x74f"><span>4592</span></td><td id="LC4592" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.onMessageHandlers.emit(<span class="code-string">'*'</span>, type, message);
</code></td></tr><tr><td id="L4593" class="css-a4x74f"><span>4593</span></td><td id="LC4593" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4594" class="css-a4x74f"><span>4594</span></td><td id="LC4594" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L4595" class="css-a4x74f"><span>4595</span></td><td id="LC4595" class="css-1dcdqdg"><code>                (_a = <span class="code-built_in">console</span>.warn) === <span class="code-literal">null</span> || _a === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _a.call(<span class="code-built_in">console</span>, <span class="code-string">"colyseus.js: onMessage() not registered for type '"</span>.concat(type, <span class="code-string">"'."</span>));
</code></td></tr><tr><td id="L4596" class="css-a4x74f"><span>4596</span></td><td id="LC4596" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4597" class="css-a4x74f"><span>4597</span></td><td id="LC4597" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4598" class="css-a4x74f"><span>4598</span></td><td id="LC4598" class="css-1dcdqdg"><code>        Room.prototype.destroy = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4599" class="css-a4x74f"><span>4599</span></td><td id="LC4599" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.serializer) {
</code></td></tr><tr><td id="L4600" class="css-a4x74f"><span>4600</span></td><td id="LC4600" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.serializer.teardown();
</code></td></tr><tr><td id="L4601" class="css-a4x74f"><span>4601</span></td><td id="LC4601" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4602" class="css-a4x74f"><span>4602</span></td><td id="LC4602" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4603" class="css-a4x74f"><span>4603</span></td><td id="LC4603" class="css-1dcdqdg"><code>        Room.prototype.getMessageHandlerKey = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">type</span>) </span>{
</code></td></tr><tr><td id="L4604" class="css-a4x74f"><span>4604</span></td><td id="LC4604" class="css-1dcdqdg"><code>            <span class="code-keyword">switch</span> (<span class="code-keyword">typeof</span> (type)) {
</code></td></tr><tr><td id="L4605" class="css-a4x74f"><span>4605</span></td><td id="LC4605" class="css-1dcdqdg"><code>                <span class="code-comment">// typeof Schema</span>
</code></td></tr><tr><td id="L4606" class="css-a4x74f"><span>4606</span></td><td id="LC4606" class="css-1dcdqdg"><code>                <span class="code-keyword">case</span> <span class="code-string">"function"</span>: <span class="code-keyword">return</span> <span class="code-string">"$"</span>.concat(type._typeid);
</code></td></tr><tr><td id="L4607" class="css-a4x74f"><span>4607</span></td><td id="LC4607" class="css-1dcdqdg"><code>                <span class="code-comment">// string</span>
</code></td></tr><tr><td id="L4608" class="css-a4x74f"><span>4608</span></td><td id="LC4608" class="css-1dcdqdg"><code>                <span class="code-keyword">case</span> <span class="code-string">"string"</span>: <span class="code-keyword">return</span> type;
</code></td></tr><tr><td id="L4609" class="css-a4x74f"><span>4609</span></td><td id="LC4609" class="css-1dcdqdg"><code>                <span class="code-comment">// number</span>
</code></td></tr><tr><td id="L4610" class="css-a4x74f"><span>4610</span></td><td id="LC4610" class="css-1dcdqdg"><code>                <span class="code-keyword">case</span> <span class="code-string">"number"</span>: <span class="code-keyword">return</span> <span class="code-string">"i"</span>.concat(type);
</code></td></tr><tr><td id="L4611" class="css-a4x74f"><span>4611</span></td><td id="LC4611" class="css-1dcdqdg"><code>                <span class="code-keyword">default</span>: <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">"invalid message type."</span>);
</code></td></tr><tr><td id="L4612" class="css-a4x74f"><span>4612</span></td><td id="LC4612" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4613" class="css-a4x74f"><span>4613</span></td><td id="LC4613" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4614" class="css-a4x74f"><span>4614</span></td><td id="LC4614" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> Room;
</code></td></tr><tr><td id="L4615" class="css-a4x74f"><span>4615</span></td><td id="LC4615" class="css-1dcdqdg"><code>    }());
</code></td></tr><tr><td id="L4616" class="css-a4x74f"><span>4616</span></td><td id="LC4616" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4617" class="css-a4x74f"><span>4617</span></td><td id="LC4617" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">apply</span>(<span class="code-params">src, tar</span>) </span>{
</code></td></tr><tr><td id="L4618" class="css-a4x74f"><span>4618</span></td><td id="LC4618" class="css-1dcdqdg"><code>    	tar.statusMessage = src.statusText;
</code></td></tr><tr><td id="L4619" class="css-a4x74f"><span>4619</span></td><td id="LC4619" class="css-1dcdqdg"><code>    	tar.statusCode = src.status;
</code></td></tr><tr><td id="L4620" class="css-a4x74f"><span>4620</span></td><td id="LC4620" class="css-1dcdqdg"><code>    	tar.data = src.body;
</code></td></tr><tr><td id="L4621" class="css-a4x74f"><span>4621</span></td><td id="LC4621" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L4622" class="css-a4x74f"><span>4622</span></td><td id="LC4622" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4623" class="css-a4x74f"><span>4623</span></td><td id="LC4623" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">send</span>(<span class="code-params">method, uri, opts</span>) </span>{
</code></td></tr><tr><td id="L4624" class="css-a4x74f"><span>4624</span></td><td id="LC4624" class="css-1dcdqdg"><code>    	opts = opts || {};
</code></td></tr><tr><td id="L4625" class="css-a4x74f"><span>4625</span></td><td id="LC4625" class="css-1dcdqdg"><code>    	<span class="code-keyword">var</span> timer, ctrl, tmp=opts.body;
</code></td></tr><tr><td id="L4626" class="css-a4x74f"><span>4626</span></td><td id="LC4626" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4627" class="css-a4x74f"><span>4627</span></td><td id="LC4627" class="css-1dcdqdg"><code>    	opts.method = method;
</code></td></tr><tr><td id="L4628" class="css-a4x74f"><span>4628</span></td><td id="LC4628" class="css-1dcdqdg"><code>    	opts.headers = opts.headers || {};
</code></td></tr><tr><td id="L4629" class="css-a4x74f"><span>4629</span></td><td id="LC4629" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4630" class="css-a4x74f"><span>4630</span></td><td id="LC4630" class="css-1dcdqdg"><code>    	<span class="code-keyword">if</span> (tmp <span class="code-keyword">instanceof</span> FormData) ; <span class="code-keyword">else</span> <span class="code-keyword">if</span> (tmp &amp;&amp; <span class="code-keyword">typeof</span> tmp == <span class="code-string">'object'</span>) {
</code></td></tr><tr><td id="L4631" class="css-a4x74f"><span>4631</span></td><td id="LC4631" class="css-1dcdqdg"><code>    		opts.headers[<span class="code-string">'content-type'</span>] = <span class="code-string">'application/json'</span>;
</code></td></tr><tr><td id="L4632" class="css-a4x74f"><span>4632</span></td><td id="LC4632" class="css-1dcdqdg"><code>    		opts.body = <span class="code-built_in">JSON</span>.stringify(tmp);
</code></td></tr><tr><td id="L4633" class="css-a4x74f"><span>4633</span></td><td id="LC4633" class="css-1dcdqdg"><code>    	}
</code></td></tr><tr><td id="L4634" class="css-a4x74f"><span>4634</span></td><td id="LC4634" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4635" class="css-a4x74f"><span>4635</span></td><td id="LC4635" class="css-1dcdqdg"><code>    	<span class="code-keyword">if</span> (opts.withCredentials) {
</code></td></tr><tr><td id="L4636" class="css-a4x74f"><span>4636</span></td><td id="LC4636" class="css-1dcdqdg"><code>    		opts.credentials = <span class="code-string">'include'</span>;
</code></td></tr><tr><td id="L4637" class="css-a4x74f"><span>4637</span></td><td id="LC4637" class="css-1dcdqdg"><code>    	}
</code></td></tr><tr><td id="L4638" class="css-a4x74f"><span>4638</span></td><td id="LC4638" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4639" class="css-a4x74f"><span>4639</span></td><td id="LC4639" class="css-1dcdqdg"><code>    	<span class="code-keyword">if</span> (opts.timeout) {
</code></td></tr><tr><td id="L4640" class="css-a4x74f"><span>4640</span></td><td id="LC4640" class="css-1dcdqdg"><code>    		ctrl = <span class="code-keyword">new</span> AbortController;
</code></td></tr><tr><td id="L4641" class="css-a4x74f"><span>4641</span></td><td id="LC4641" class="css-1dcdqdg"><code>    		opts.signal = ctrl.signal;
</code></td></tr><tr><td id="L4642" class="css-a4x74f"><span>4642</span></td><td id="LC4642" class="css-1dcdqdg"><code>    		timer = setTimeout(ctrl.abort, opts.timeout);
</code></td></tr><tr><td id="L4643" class="css-a4x74f"><span>4643</span></td><td id="LC4643" class="css-1dcdqdg"><code>    	}
</code></td></tr><tr><td id="L4644" class="css-a4x74f"><span>4644</span></td><td id="LC4644" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4645" class="css-a4x74f"><span>4645</span></td><td id="LC4645" class="css-1dcdqdg"><code>    	<span class="code-keyword">return</span> <span class="code-keyword">new</span> <span class="code-built_in">Promise</span>(<span class="code-function">(<span class="code-params">res, rej</span>) =&gt;</span> {
</code></td></tr><tr><td id="L4646" class="css-a4x74f"><span>4646</span></td><td id="LC4646" class="css-1dcdqdg"><code>    		fetch(uri, opts).then(<span class="code-function">(<span class="code-params">rr, reply</span>) =&gt;</span> {
</code></td></tr><tr><td id="L4647" class="css-a4x74f"><span>4647</span></td><td id="LC4647" class="css-1dcdqdg"><code>    			clearTimeout(timer);
</code></td></tr><tr><td id="L4648" class="css-a4x74f"><span>4648</span></td><td id="LC4648" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4649" class="css-a4x74f"><span>4649</span></td><td id="LC4649" class="css-1dcdqdg"><code>    			apply(rr, rr); <span class="code-comment">//=&gt; rr.headers</span>
</code></td></tr><tr><td id="L4650" class="css-a4x74f"><span>4650</span></td><td id="LC4650" class="css-1dcdqdg"><code>    			reply = rr.status &gt;= <span class="code-number">400</span> ? rej : res;
</code></td></tr><tr><td id="L4651" class="css-a4x74f"><span>4651</span></td><td id="LC4651" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4652" class="css-a4x74f"><span>4652</span></td><td id="LC4652" class="css-1dcdqdg"><code>    			tmp = rr.headers.get(<span class="code-string">'content-type'</span>);
</code></td></tr><tr><td id="L4653" class="css-a4x74f"><span>4653</span></td><td id="LC4653" class="css-1dcdqdg"><code>    			<span class="code-keyword">if</span> (!tmp || !~tmp.indexOf(<span class="code-string">'application/json'</span>)) {
</code></td></tr><tr><td id="L4654" class="css-a4x74f"><span>4654</span></td><td id="LC4654" class="css-1dcdqdg"><code>    				reply(rr);
</code></td></tr><tr><td id="L4655" class="css-a4x74f"><span>4655</span></td><td id="LC4655" class="css-1dcdqdg"><code>    			} <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L4656" class="css-a4x74f"><span>4656</span></td><td id="LC4656" class="css-1dcdqdg"><code>    				rr.text().then(<span class="code-function"><span class="code-params">str</span> =&gt;</span> {
</code></td></tr><tr><td id="L4657" class="css-a4x74f"><span>4657</span></td><td id="LC4657" class="css-1dcdqdg"><code>    					<span class="code-keyword">try</span> {
</code></td></tr><tr><td id="L4658" class="css-a4x74f"><span>4658</span></td><td id="LC4658" class="css-1dcdqdg"><code>    						rr.data = <span class="code-built_in">JSON</span>.parse(str, opts.reviver);
</code></td></tr><tr><td id="L4659" class="css-a4x74f"><span>4659</span></td><td id="LC4659" class="css-1dcdqdg"><code>    						reply(rr);
</code></td></tr><tr><td id="L4660" class="css-a4x74f"><span>4660</span></td><td id="LC4660" class="css-1dcdqdg"><code>    					} <span class="code-keyword">catch</span> (err) {
</code></td></tr><tr><td id="L4661" class="css-a4x74f"><span>4661</span></td><td id="LC4661" class="css-1dcdqdg"><code>    						err.headers = rr.headers;
</code></td></tr><tr><td id="L4662" class="css-a4x74f"><span>4662</span></td><td id="LC4662" class="css-1dcdqdg"><code>    						apply(rr, err);
</code></td></tr><tr><td id="L4663" class="css-a4x74f"><span>4663</span></td><td id="LC4663" class="css-1dcdqdg"><code>    						rej(err);
</code></td></tr><tr><td id="L4664" class="css-a4x74f"><span>4664</span></td><td id="LC4664" class="css-1dcdqdg"><code>    					}
</code></td></tr><tr><td id="L4665" class="css-a4x74f"><span>4665</span></td><td id="LC4665" class="css-1dcdqdg"><code>    				});
</code></td></tr><tr><td id="L4666" class="css-a4x74f"><span>4666</span></td><td id="LC4666" class="css-1dcdqdg"><code>    			}
</code></td></tr><tr><td id="L4667" class="css-a4x74f"><span>4667</span></td><td id="LC4667" class="css-1dcdqdg"><code>    		}).catch(<span class="code-function"><span class="code-params">err</span> =&gt;</span> {
</code></td></tr><tr><td id="L4668" class="css-a4x74f"><span>4668</span></td><td id="LC4668" class="css-1dcdqdg"><code>    			err.timeout = ctrl &amp;&amp; ctrl.signal.aborted;
</code></td></tr><tr><td id="L4669" class="css-a4x74f"><span>4669</span></td><td id="LC4669" class="css-1dcdqdg"><code>    			rej(err);
</code></td></tr><tr><td id="L4670" class="css-a4x74f"><span>4670</span></td><td id="LC4670" class="css-1dcdqdg"><code>    		});
</code></td></tr><tr><td id="L4671" class="css-a4x74f"><span>4671</span></td><td id="LC4671" class="css-1dcdqdg"><code>    	});
</code></td></tr><tr><td id="L4672" class="css-a4x74f"><span>4672</span></td><td id="LC4672" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L4673" class="css-a4x74f"><span>4673</span></td><td id="LC4673" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4674" class="css-a4x74f"><span>4674</span></td><td id="LC4674" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> <span class="code-keyword">get</span> = /*#__PURE__*/ send.bind(send, 'GET');
</code></td></tr><tr><td id="L4675" class="css-a4x74f"><span>4675</span></td><td id="LC4675" class="css-1dcdqdg"><code>    var post = /*#__PURE__*/ send.bind(send, 'POST');
</code></td></tr><tr><td id="L4676" class="css-a4x74f"><span>4676</span></td><td id="LC4676" class="css-1dcdqdg"><code>    var patch = /*#__PURE__*/ send.bind(send, 'PATCH');
</code></td></tr><tr><td id="L4677" class="css-a4x74f"><span>4677</span></td><td id="LC4677" class="css-1dcdqdg"><code>    var del = /*#__PURE__*/ send.bind(send, 'DELETE');
</code></td></tr><tr><td id="L4678" class="css-a4x74f"><span>4678</span></td><td id="LC4678" class="css-1dcdqdg"><code>    var put = /*#__PURE__*/ send.bind(send, 'PUT');
</code></td></tr><tr><td id="L4679" class="css-a4x74f"><span>4679</span></td><td id="LC4679" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4680" class="css-a4x74f"><span>4680</span></td><td id="LC4680" class="css-1dcdqdg"><code>    var del_1 = del;
</code></td></tr><tr><td id="L4681" class="css-a4x74f"><span>4681</span></td><td id="LC4681" class="css-1dcdqdg"><code>    var get_1 = <span class="code-keyword">get</span>;
</code></td></tr><tr><td id="L4682" class="css-a4x74f"><span>4682</span></td><td id="LC4682" class="css-1dcdqdg"><code>    var patch_1 = patch;
</code></td></tr><tr><td id="L4683" class="css-a4x74f"><span>4683</span></td><td id="LC4683" class="css-1dcdqdg"><code>    var post_1 = post;
</code></td></tr><tr><td id="L4684" class="css-a4x74f"><span>4684</span></td><td id="LC4684" class="css-1dcdqdg"><code>    var put_1 = put;
</code></td></tr><tr><td id="L4685" class="css-a4x74f"><span>4685</span></td><td id="LC4685" class="css-1dcdqdg"><code>    var send_1 = send;
</code></td></tr><tr><td id="L4686" class="css-a4x74f"><span>4686</span></td><td id="LC4686" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4687" class="css-a4x74f"><span>4687</span></td><td id="LC4687" class="css-1dcdqdg"><code>    var fetch_1 = {
</code></td></tr><tr><td id="L4688" class="css-a4x74f"><span>4688</span></td><td id="LC4688" class="css-1dcdqdg"><code>    	del: del_1,
</code></td></tr><tr><td id="L4689" class="css-a4x74f"><span>4689</span></td><td id="LC4689" class="css-1dcdqdg"><code>    	<span class="code-keyword">get</span>: get_1,
</code></td></tr><tr><td id="L4690" class="css-a4x74f"><span>4690</span></td><td id="LC4690" class="css-1dcdqdg"><code>    	patch: patch_1,
</code></td></tr><tr><td id="L4691" class="css-a4x74f"><span>4691</span></td><td id="LC4691" class="css-1dcdqdg"><code>    	post: post_1,
</code></td></tr><tr><td id="L4692" class="css-a4x74f"><span>4692</span></td><td id="LC4692" class="css-1dcdqdg"><code>    	put: put_1,
</code></td></tr><tr><td id="L4693" class="css-a4x74f"><span>4693</span></td><td id="LC4693" class="css-1dcdqdg"><code>    	send: send_1
</code></td></tr><tr><td id="L4694" class="css-a4x74f"><span>4694</span></td><td id="LC4694" class="css-1dcdqdg"><code>    };
</code></td></tr><tr><td id="L4695" class="css-a4x74f"><span>4695</span></td><td id="LC4695" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4696" class="css-a4x74f"><span>4696</span></td><td id="LC4696" class="css-1dcdqdg"><code>    var httpie = /*#__PURE__*/_mergeNamespaces({
</code></td></tr><tr><td id="L4697" class="css-a4x74f"><span>4697</span></td><td id="LC4697" class="css-1dcdqdg"><code>        __proto__: <span class="code-literal">null</span>,
</code></td></tr><tr><td id="L4698" class="css-a4x74f"><span>4698</span></td><td id="LC4698" class="css-1dcdqdg"><code>        <span class="code-string">'default'</span>: fetch_1,
</code></td></tr><tr><td id="L4699" class="css-a4x74f"><span>4699</span></td><td id="LC4699" class="css-1dcdqdg"><code>        del: del_1,
</code></td></tr><tr><td id="L4700" class="css-a4x74f"><span>4700</span></td><td id="LC4700" class="css-1dcdqdg"><code>        <span class="code-keyword">get</span>: get_1,
</code></td></tr><tr><td id="L4701" class="css-a4x74f"><span>4701</span></td><td id="LC4701" class="css-1dcdqdg"><code>        patch: patch_1,
</code></td></tr><tr><td id="L4702" class="css-a4x74f"><span>4702</span></td><td id="LC4702" class="css-1dcdqdg"><code>        post: post_1,
</code></td></tr><tr><td id="L4703" class="css-a4x74f"><span>4703</span></td><td id="LC4703" class="css-1dcdqdg"><code>        put: put_1,
</code></td></tr><tr><td id="L4704" class="css-a4x74f"><span>4704</span></td><td id="LC4704" class="css-1dcdqdg"><code>        send: send_1
</code></td></tr><tr><td id="L4705" class="css-a4x74f"><span>4705</span></td><td id="LC4705" class="css-1dcdqdg"><code>    }, [fetch_1]);
</code></td></tr><tr><td id="L4706" class="css-a4x74f"><span>4706</span></td><td id="LC4706" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4707" class="css-a4x74f"><span>4707</span></td><td id="LC4707" class="css-1dcdqdg"><code>    var HTTP = /** @class */ (function () {
</code></td></tr><tr><td id="L4708" class="css-a4x74f"><span>4708</span></td><td id="LC4708" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">HTTP</span>(<span class="code-params">client</span>) </span>{
</code></td></tr><tr><td id="L4709" class="css-a4x74f"><span>4709</span></td><td id="LC4709" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.client = client;
</code></td></tr><tr><td id="L4710" class="css-a4x74f"><span>4710</span></td><td id="LC4710" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L4711" class="css-a4x74f"><span>4711</span></td><td id="LC4711" class="css-1dcdqdg"><code>        HTTP.prototype.get = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">path, options</span>) </span>{
</code></td></tr><tr><td id="L4712" class="css-a4x74f"><span>4712</span></td><td id="LC4712" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (options === <span class="code-keyword">void</span> <span class="code-number">0</span>) { options = {}; }
</code></td></tr><tr><td id="L4713" class="css-a4x74f"><span>4713</span></td><td id="LC4713" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> <span class="code-keyword">this</span>.request(<span class="code-string">"get"</span>, path, options);
</code></td></tr><tr><td id="L4714" class="css-a4x74f"><span>4714</span></td><td id="LC4714" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4715" class="css-a4x74f"><span>4715</span></td><td id="LC4715" class="css-1dcdqdg"><code>        HTTP.prototype.post = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">path, options</span>) </span>{
</code></td></tr><tr><td id="L4716" class="css-a4x74f"><span>4716</span></td><td id="LC4716" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (options === <span class="code-keyword">void</span> <span class="code-number">0</span>) { options = {}; }
</code></td></tr><tr><td id="L4717" class="css-a4x74f"><span>4717</span></td><td id="LC4717" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> <span class="code-keyword">this</span>.request(<span class="code-string">"post"</span>, path, options);
</code></td></tr><tr><td id="L4718" class="css-a4x74f"><span>4718</span></td><td id="LC4718" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4719" class="css-a4x74f"><span>4719</span></td><td id="LC4719" class="css-1dcdqdg"><code>        HTTP.prototype.del = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">path, options</span>) </span>{
</code></td></tr><tr><td id="L4720" class="css-a4x74f"><span>4720</span></td><td id="LC4720" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (options === <span class="code-keyword">void</span> <span class="code-number">0</span>) { options = {}; }
</code></td></tr><tr><td id="L4721" class="css-a4x74f"><span>4721</span></td><td id="LC4721" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> <span class="code-keyword">this</span>.request(<span class="code-string">"del"</span>, path, options);
</code></td></tr><tr><td id="L4722" class="css-a4x74f"><span>4722</span></td><td id="LC4722" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4723" class="css-a4x74f"><span>4723</span></td><td id="LC4723" class="css-1dcdqdg"><code>        HTTP.prototype.put = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">path, options</span>) </span>{
</code></td></tr><tr><td id="L4724" class="css-a4x74f"><span>4724</span></td><td id="LC4724" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (options === <span class="code-keyword">void</span> <span class="code-number">0</span>) { options = {}; }
</code></td></tr><tr><td id="L4725" class="css-a4x74f"><span>4725</span></td><td id="LC4725" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> <span class="code-keyword">this</span>.request(<span class="code-string">"put"</span>, path, options);
</code></td></tr><tr><td id="L4726" class="css-a4x74f"><span>4726</span></td><td id="LC4726" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4727" class="css-a4x74f"><span>4727</span></td><td id="LC4727" class="css-1dcdqdg"><code>        HTTP.prototype.request = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">method, path, options</span>) </span>{
</code></td></tr><tr><td id="L4728" class="css-a4x74f"><span>4728</span></td><td id="LC4728" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (options === <span class="code-keyword">void</span> <span class="code-number">0</span>) { options = {}; }
</code></td></tr><tr><td id="L4729" class="css-a4x74f"><span>4729</span></td><td id="LC4729" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> httpie[method](<span class="code-keyword">this</span>.client[<span class="code-string">'getHttpEndpoint'</span>](path), <span class="code-keyword">this</span>.getOptions(options)).catch(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">e</span>) </span>{
</code></td></tr><tr><td id="L4730" class="css-a4x74f"><span>4730</span></td><td id="LC4730" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _a;
</code></td></tr><tr><td id="L4731" class="css-a4x74f"><span>4731</span></td><td id="LC4731" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> status = e.statusCode; <span class="code-comment">//  || -1</span>
</code></td></tr><tr><td id="L4732" class="css-a4x74f"><span>4732</span></td><td id="LC4732" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> message = ((_a = e.data) === <span class="code-literal">null</span> || _a === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _a.error) || e.statusMessage || e.message; <span class="code-comment">//  || "offline"</span>
</code></td></tr><tr><td id="L4733" class="css-a4x74f"><span>4733</span></td><td id="LC4733" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (!status &amp;&amp; !message) {
</code></td></tr><tr><td id="L4734" class="css-a4x74f"><span>4734</span></td><td id="LC4734" class="css-1dcdqdg"><code>                    <span class="code-keyword">throw</span> e;
</code></td></tr><tr><td id="L4735" class="css-a4x74f"><span>4735</span></td><td id="LC4735" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L4736" class="css-a4x74f"><span>4736</span></td><td id="LC4736" class="css-1dcdqdg"><code>                <span class="code-keyword">throw</span> <span class="code-keyword">new</span> ServerError(status, message);
</code></td></tr><tr><td id="L4737" class="css-a4x74f"><span>4737</span></td><td id="LC4737" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L4738" class="css-a4x74f"><span>4738</span></td><td id="LC4738" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4739" class="css-a4x74f"><span>4739</span></td><td id="LC4739" class="css-1dcdqdg"><code>        HTTP.prototype.getOptions = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">options</span>) </span>{
</code></td></tr><tr><td id="L4740" class="css-a4x74f"><span>4740</span></td><td id="LC4740" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.authToken) {
</code></td></tr><tr><td id="L4741" class="css-a4x74f"><span>4741</span></td><td id="LC4741" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (!options.headers) {
</code></td></tr><tr><td id="L4742" class="css-a4x74f"><span>4742</span></td><td id="LC4742" class="css-1dcdqdg"><code>                    options.headers = {};
</code></td></tr><tr><td id="L4743" class="css-a4x74f"><span>4743</span></td><td id="LC4743" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L4744" class="css-a4x74f"><span>4744</span></td><td id="LC4744" class="css-1dcdqdg"><code>                options.headers[<span class="code-string">'Authorization'</span>] = <span class="code-string">"Bearer "</span>.concat(<span class="code-keyword">this</span>.authToken);
</code></td></tr><tr><td id="L4745" class="css-a4x74f"><span>4745</span></td><td id="LC4745" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4746" class="css-a4x74f"><span>4746</span></td><td id="LC4746" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (cc) !== <span class="code-string">'undefined'</span> &amp;&amp; cc.sys &amp;&amp; cc.sys.isNative) ;
</code></td></tr><tr><td id="L4747" class="css-a4x74f"><span>4747</span></td><td id="LC4747" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L4748" class="css-a4x74f"><span>4748</span></td><td id="LC4748" class="css-1dcdqdg"><code>                <span class="code-comment">// always include credentials</span>
</code></td></tr><tr><td id="L4749" class="css-a4x74f"><span>4749</span></td><td id="LC4749" class="css-1dcdqdg"><code>                options.withCredentials = <span class="code-literal">true</span>;
</code></td></tr><tr><td id="L4750" class="css-a4x74f"><span>4750</span></td><td id="LC4750" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4751" class="css-a4x74f"><span>4751</span></td><td id="LC4751" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> options;
</code></td></tr><tr><td id="L4752" class="css-a4x74f"><span>4752</span></td><td id="LC4752" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4753" class="css-a4x74f"><span>4753</span></td><td id="LC4753" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> HTTP;
</code></td></tr><tr><td id="L4754" class="css-a4x74f"><span>4754</span></td><td id="LC4754" class="css-1dcdqdg"><code>    }());
</code></td></tr><tr><td id="L4755" class="css-a4x74f"><span>4755</span></td><td id="LC4755" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4756" class="css-a4x74f"><span>4756</span></td><td id="LC4756" class="css-1dcdqdg"><code>    <span class="code-comment">/// &lt;reference path="../typings/cocos-creator.d.ts" /&gt;</span>
</code></td></tr><tr><td id="L4757" class="css-a4x74f"><span>4757</span></td><td id="LC4757" class="css-1dcdqdg"><code>    <span class="code-comment">/**
</span></code></td></tr><tr><td id="L4758" class="css-a4x74f"><span>4758</span></td><td id="LC4758" class="css-1dcdqdg"><code><span class="code-comment">     * We do not assign 'storage' to window.localStorage immediatelly for React
</span></code></td></tr><tr><td id="L4759" class="css-a4x74f"><span>4759</span></td><td id="LC4759" class="css-1dcdqdg"><code><span class="code-comment">     * Native compatibility. window.localStorage is not present when this module is
</span></code></td></tr><tr><td id="L4760" class="css-a4x74f"><span>4760</span></td><td id="LC4760" class="css-1dcdqdg"><code><span class="code-comment">     * loaded.
</span></code></td></tr><tr><td id="L4761" class="css-a4x74f"><span>4761</span></td><td id="LC4761" class="css-1dcdqdg"><code><span class="code-comment">     */</span>
</code></td></tr><tr><td id="L4762" class="css-a4x74f"><span>4762</span></td><td id="LC4762" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> storage;
</code></td></tr><tr><td id="L4763" class="css-a4x74f"><span>4763</span></td><td id="LC4763" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">getStorage</span>(<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4764" class="css-a4x74f"><span>4764</span></td><td id="LC4764" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (!storage) {
</code></td></tr><tr><td id="L4765" class="css-a4x74f"><span>4765</span></td><td id="LC4765" class="css-1dcdqdg"><code>            <span class="code-keyword">try</span> {
</code></td></tr><tr><td id="L4766" class="css-a4x74f"><span>4766</span></td><td id="LC4766" class="css-1dcdqdg"><code>                storage = (<span class="code-keyword">typeof</span> (cc) !== <span class="code-string">'undefined'</span> &amp;&amp; cc.sys &amp;&amp; cc.sys.localStorage)
</code></td></tr><tr><td id="L4767" class="css-a4x74f"><span>4767</span></td><td id="LC4767" class="css-1dcdqdg"><code>                    ? cc.sys.localStorage <span class="code-comment">// compatibility with cocos creator</span>
</code></td></tr><tr><td id="L4768" class="css-a4x74f"><span>4768</span></td><td id="LC4768" class="css-1dcdqdg"><code>                    : <span class="code-built_in">window</span>.localStorage; <span class="code-comment">// RN does have window object at this point, but localStorage is not defined</span>
</code></td></tr><tr><td id="L4769" class="css-a4x74f"><span>4769</span></td><td id="LC4769" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4770" class="css-a4x74f"><span>4770</span></td><td id="LC4770" class="css-1dcdqdg"><code>            <span class="code-keyword">catch</span> (e) {
</code></td></tr><tr><td id="L4771" class="css-a4x74f"><span>4771</span></td><td id="LC4771" class="css-1dcdqdg"><code>                <span class="code-comment">// ignore error</span>
</code></td></tr><tr><td id="L4772" class="css-a4x74f"><span>4772</span></td><td id="LC4772" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4773" class="css-a4x74f"><span>4773</span></td><td id="LC4773" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L4774" class="css-a4x74f"><span>4774</span></td><td id="LC4774" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (!storage) {
</code></td></tr><tr><td id="L4775" class="css-a4x74f"><span>4775</span></td><td id="LC4775" class="css-1dcdqdg"><code>            <span class="code-comment">// mock localStorage if not available (Node.js or RN environment)</span>
</code></td></tr><tr><td id="L4776" class="css-a4x74f"><span>4776</span></td><td id="LC4776" class="css-1dcdqdg"><code>            storage = {
</code></td></tr><tr><td id="L4777" class="css-a4x74f"><span>4777</span></td><td id="LC4777" class="css-1dcdqdg"><code>                cache: {},
</code></td></tr><tr><td id="L4778" class="css-a4x74f"><span>4778</span></td><td id="LC4778" class="css-1dcdqdg"><code>                setItem: <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">key, value</span>) </span>{ <span class="code-keyword">this</span>.cache[key] = value; },
</code></td></tr><tr><td id="L4779" class="css-a4x74f"><span>4779</span></td><td id="LC4779" class="css-1dcdqdg"><code>                getItem: <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">key</span>) </span>{ <span class="code-keyword">this</span>.cache[key]; },
</code></td></tr><tr><td id="L4780" class="css-a4x74f"><span>4780</span></td><td id="LC4780" class="css-1dcdqdg"><code>                removeItem: <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">key</span>) </span>{ <span class="code-keyword">delete</span> <span class="code-keyword">this</span>.cache[key]; },
</code></td></tr><tr><td id="L4781" class="css-a4x74f"><span>4781</span></td><td id="LC4781" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L4782" class="css-a4x74f"><span>4782</span></td><td id="LC4782" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L4783" class="css-a4x74f"><span>4783</span></td><td id="LC4783" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> storage;
</code></td></tr><tr><td id="L4784" class="css-a4x74f"><span>4784</span></td><td id="LC4784" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L4785" class="css-a4x74f"><span>4785</span></td><td id="LC4785" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">setItem</span>(<span class="code-params">key, value</span>) </span>{
</code></td></tr><tr><td id="L4786" class="css-a4x74f"><span>4786</span></td><td id="LC4786" class="css-1dcdqdg"><code>        getStorage().setItem(key, value);
</code></td></tr><tr><td id="L4787" class="css-a4x74f"><span>4787</span></td><td id="LC4787" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L4788" class="css-a4x74f"><span>4788</span></td><td id="LC4788" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">removeItem</span>(<span class="code-params">key</span>) </span>{
</code></td></tr><tr><td id="L4789" class="css-a4x74f"><span>4789</span></td><td id="LC4789" class="css-1dcdqdg"><code>        getStorage().removeItem(key);
</code></td></tr><tr><td id="L4790" class="css-a4x74f"><span>4790</span></td><td id="LC4790" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L4791" class="css-a4x74f"><span>4791</span></td><td id="LC4791" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">getItem</span>(<span class="code-params">key, callback</span>) </span>{
</code></td></tr><tr><td id="L4792" class="css-a4x74f"><span>4792</span></td><td id="LC4792" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> value = getStorage().getItem(key);
</code></td></tr><tr><td id="L4793" class="css-a4x74f"><span>4793</span></td><td id="LC4793" class="css-1dcdqdg"><code>        <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (<span class="code-built_in">Promise</span>) === <span class="code-string">'undefined'</span> || <span class="code-comment">// old browsers</span>
</code></td></tr><tr><td id="L4794" class="css-a4x74f"><span>4794</span></td><td id="LC4794" class="css-1dcdqdg"><code>            !(value <span class="code-keyword">instanceof</span> <span class="code-built_in">Promise</span>)) {
</code></td></tr><tr><td id="L4795" class="css-a4x74f"><span>4795</span></td><td id="LC4795" class="css-1dcdqdg"><code>            <span class="code-comment">// browser has synchronous return</span>
</code></td></tr><tr><td id="L4796" class="css-a4x74f"><span>4796</span></td><td id="LC4796" class="css-1dcdqdg"><code>            callback(value);
</code></td></tr><tr><td id="L4797" class="css-a4x74f"><span>4797</span></td><td id="LC4797" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L4798" class="css-a4x74f"><span>4798</span></td><td id="LC4798" class="css-1dcdqdg"><code>        <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L4799" class="css-a4x74f"><span>4799</span></td><td id="LC4799" class="css-1dcdqdg"><code>            <span class="code-comment">// react-native is asynchronous</span>
</code></td></tr><tr><td id="L4800" class="css-a4x74f"><span>4800</span></td><td id="LC4800" class="css-1dcdqdg"><code>            value.then(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">id</span>) </span>{ <span class="code-keyword">return</span> callback(id); });
</code></td></tr><tr><td id="L4801" class="css-a4x74f"><span>4801</span></td><td id="LC4801" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L4802" class="css-a4x74f"><span>4802</span></td><td id="LC4802" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L4803" class="css-a4x74f"><span>4803</span></td><td id="LC4803" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4804" class="css-a4x74f"><span>4804</span></td><td id="LC4804" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> _Auth__initialized, _Auth__initializationPromise, _Auth__signInWindow, _Auth__events;
</code></td></tr><tr><td id="L4805" class="css-a4x74f"><span>4805</span></td><td id="LC4805" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> Auth = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4806" class="css-a4x74f"><span>4806</span></td><td id="LC4806" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">Auth</span>(<span class="code-params">http</span>) </span>{
</code></td></tr><tr><td id="L4807" class="css-a4x74f"><span>4807</span></td><td id="LC4807" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L4808" class="css-a4x74f"><span>4808</span></td><td id="LC4808" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.http = http;
</code></td></tr><tr><td id="L4809" class="css-a4x74f"><span>4809</span></td><td id="LC4809" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.settings = {
</code></td></tr><tr><td id="L4810" class="css-a4x74f"><span>4810</span></td><td id="LC4810" class="css-1dcdqdg"><code>                path: <span class="code-string">"/auth"</span>,
</code></td></tr><tr><td id="L4811" class="css-a4x74f"><span>4811</span></td><td id="LC4811" class="css-1dcdqdg"><code>                key: <span class="code-string">"colyseus-auth-token"</span>,
</code></td></tr><tr><td id="L4812" class="css-a4x74f"><span>4812</span></td><td id="LC4812" class="css-1dcdqdg"><code>            };
</code></td></tr><tr><td id="L4813" class="css-a4x74f"><span>4813</span></td><td id="LC4813" class="css-1dcdqdg"><code>            _Auth__initialized.set(<span class="code-keyword">this</span>, <span class="code-literal">false</span>);
</code></td></tr><tr><td id="L4814" class="css-a4x74f"><span>4814</span></td><td id="LC4814" class="css-1dcdqdg"><code>            _Auth__initializationPromise.set(<span class="code-keyword">this</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>);
</code></td></tr><tr><td id="L4815" class="css-a4x74f"><span>4815</span></td><td id="LC4815" class="css-1dcdqdg"><code>            _Auth__signInWindow.set(<span class="code-keyword">this</span>, <span class="code-literal">undefined</span>);
</code></td></tr><tr><td id="L4816" class="css-a4x74f"><span>4816</span></td><td id="LC4816" class="css-1dcdqdg"><code>            _Auth__events.set(<span class="code-keyword">this</span>, createNanoEvents());
</code></td></tr><tr><td id="L4817" class="css-a4x74f"><span>4817</span></td><td id="LC4817" class="css-1dcdqdg"><code>            getItem(<span class="code-keyword">this</span>.settings.key, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">token</span>) </span>{ <span class="code-keyword">return</span> _this.token = token; });
</code></td></tr><tr><td id="L4818" class="css-a4x74f"><span>4818</span></td><td id="LC4818" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L4819" class="css-a4x74f"><span>4819</span></td><td id="LC4819" class="css-1dcdqdg"><code>        <span class="code-built_in">Object</span>.defineProperty(Auth.prototype, <span class="code-string">"token"</span>, {
</code></td></tr><tr><td id="L4820" class="css-a4x74f"><span>4820</span></td><td id="LC4820" class="css-1dcdqdg"><code>            <span class="code-keyword">get</span>: function () {
</code></td></tr><tr><td id="L4821" class="css-a4x74f"><span>4821</span></td><td id="LC4821" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> <span class="code-keyword">this</span>.http.authToken;
</code></td></tr><tr><td id="L4822" class="css-a4x74f"><span>4822</span></td><td id="LC4822" class="css-1dcdqdg"><code>            },
</code></td></tr><tr><td id="L4823" class="css-a4x74f"><span>4823</span></td><td id="LC4823" class="css-1dcdqdg"><code>            <span class="code-keyword">set</span>: function (token) {
</code></td></tr><tr><td id="L4824" class="css-a4x74f"><span>4824</span></td><td id="LC4824" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.http.authToken = token;
</code></td></tr><tr><td id="L4825" class="css-a4x74f"><span>4825</span></td><td id="LC4825" class="css-1dcdqdg"><code>            },
</code></td></tr><tr><td id="L4826" class="css-a4x74f"><span>4826</span></td><td id="LC4826" class="css-1dcdqdg"><code>            enumerable: <span class="code-literal">false</span>,
</code></td></tr><tr><td id="L4827" class="css-a4x74f"><span>4827</span></td><td id="LC4827" class="css-1dcdqdg"><code>            configurable: <span class="code-literal">true</span>
</code></td></tr><tr><td id="L4828" class="css-a4x74f"><span>4828</span></td><td id="LC4828" class="css-1dcdqdg"><code>        });
</code></td></tr><tr><td id="L4829" class="css-a4x74f"><span>4829</span></td><td id="LC4829" class="css-1dcdqdg"><code>        Auth.prototype.onChange = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">callback</span>) </span>{
</code></td></tr><tr><td id="L4830" class="css-a4x74f"><span>4830</span></td><td id="LC4830" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L4831" class="css-a4x74f"><span>4831</span></td><td id="LC4831" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> unbindChange = __classPrivateFieldGet(<span class="code-keyword">this</span>, _Auth__events, <span class="code-string">"f"</span>).on(<span class="code-string">"change"</span>, callback);
</code></td></tr><tr><td id="L4832" class="css-a4x74f"><span>4832</span></td><td id="LC4832" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (!__classPrivateFieldGet(<span class="code-keyword">this</span>, _Auth__initialized, <span class="code-string">"f"</span>)) {
</code></td></tr><tr><td id="L4833" class="css-a4x74f"><span>4833</span></td><td id="LC4833" class="css-1dcdqdg"><code>                __classPrivateFieldSet(<span class="code-keyword">this</span>, _Auth__initializationPromise, <span class="code-keyword">new</span> <span class="code-built_in">Promise</span>(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">resolve, reject</span>) </span>{
</code></td></tr><tr><td id="L4834" class="css-a4x74f"><span>4834</span></td><td id="LC4834" class="css-1dcdqdg"><code>                    _this.getUserData().then(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">userData</span>) </span>{
</code></td></tr><tr><td id="L4835" class="css-a4x74f"><span>4835</span></td><td id="LC4835" class="css-1dcdqdg"><code>                        _this.emitChange(__assign(__assign({}, userData), { <span class="code-attr">token</span>: _this.token }));
</code></td></tr><tr><td id="L4836" class="css-a4x74f"><span>4836</span></td><td id="LC4836" class="css-1dcdqdg"><code>                    }).catch(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">e</span>) </span>{
</code></td></tr><tr><td id="L4837" class="css-a4x74f"><span>4837</span></td><td id="LC4837" class="css-1dcdqdg"><code>                        <span class="code-comment">// user is not logged in, or service is down</span>
</code></td></tr><tr><td id="L4838" class="css-a4x74f"><span>4838</span></td><td id="LC4838" class="css-1dcdqdg"><code>                        _this.emitChange({ <span class="code-attr">user</span>: <span class="code-literal">null</span>, <span class="code-attr">token</span>: <span class="code-literal">undefined</span> });
</code></td></tr><tr><td id="L4839" class="css-a4x74f"><span>4839</span></td><td id="LC4839" class="css-1dcdqdg"><code>                    }).finally(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4840" class="css-a4x74f"><span>4840</span></td><td id="LC4840" class="css-1dcdqdg"><code>                        resolve();
</code></td></tr><tr><td id="L4841" class="css-a4x74f"><span>4841</span></td><td id="LC4841" class="css-1dcdqdg"><code>                    });
</code></td></tr><tr><td id="L4842" class="css-a4x74f"><span>4842</span></td><td id="LC4842" class="css-1dcdqdg"><code>                }), <span class="code-string">"f"</span>);
</code></td></tr><tr><td id="L4843" class="css-a4x74f"><span>4843</span></td><td id="LC4843" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4844" class="css-a4x74f"><span>4844</span></td><td id="LC4844" class="css-1dcdqdg"><code>            __classPrivateFieldSet(<span class="code-keyword">this</span>, _Auth__initialized, <span class="code-literal">true</span>, <span class="code-string">"f"</span>);
</code></td></tr><tr><td id="L4845" class="css-a4x74f"><span>4845</span></td><td id="LC4845" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> unbindChange;
</code></td></tr><tr><td id="L4846" class="css-a4x74f"><span>4846</span></td><td id="LC4846" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4847" class="css-a4x74f"><span>4847</span></td><td id="LC4847" class="css-1dcdqdg"><code>        Auth.prototype.getUserData = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4848" class="css-a4x74f"><span>4848</span></td><td id="LC4848" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> __awaiter(<span class="code-keyword">this</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4849" class="css-a4x74f"><span>4849</span></td><td id="LC4849" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> __generator(<span class="code-keyword">this</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_a</span>) </span>{
</code></td></tr><tr><td id="L4850" class="css-a4x74f"><span>4850</span></td><td id="LC4850" class="css-1dcdqdg"><code>                    <span class="code-keyword">switch</span> (_a.label) {
</code></td></tr><tr><td id="L4851" class="css-a4x74f"><span>4851</span></td><td id="LC4851" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">0</span>:
</code></td></tr><tr><td id="L4852" class="css-a4x74f"><span>4852</span></td><td id="LC4852" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (!<span class="code-keyword">this</span>.token) <span class="code-keyword">return</span> [<span class="code-number">3</span> <span class="code-comment">/*break*/</span>, <span class="code-number">2</span>];
</code></td></tr><tr><td id="L4853" class="css-a4x74f"><span>4853</span></td><td id="LC4853" class="css-1dcdqdg"><code>                            <span class="code-keyword">return</span> [<span class="code-number">4</span> <span class="code-comment">/*yield*/</span>, <span class="code-keyword">this</span>.http.get(<span class="code-string">""</span>.concat(<span class="code-keyword">this</span>.settings.path, <span class="code-string">"/userdata"</span>))];
</code></td></tr><tr><td id="L4854" class="css-a4x74f"><span>4854</span></td><td id="LC4854" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">1</span>: <span class="code-keyword">return</span> [<span class="code-number">2</span> <span class="code-comment">/*return*/</span>, (_a.sent()).data];
</code></td></tr><tr><td id="L4855" class="css-a4x74f"><span>4855</span></td><td id="LC4855" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">2</span>: <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">"missing auth.token"</span>);
</code></td></tr><tr><td id="L4856" class="css-a4x74f"><span>4856</span></td><td id="LC4856" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L4857" class="css-a4x74f"><span>4857</span></td><td id="LC4857" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L4858" class="css-a4x74f"><span>4858</span></td><td id="LC4858" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L4859" class="css-a4x74f"><span>4859</span></td><td id="LC4859" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4860" class="css-a4x74f"><span>4860</span></td><td id="LC4860" class="css-1dcdqdg"><code>        Auth.prototype.registerWithEmailAndPassword = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">email, password, options</span>) </span>{
</code></td></tr><tr><td id="L4861" class="css-a4x74f"><span>4861</span></td><td id="LC4861" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> __awaiter(<span class="code-keyword">this</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4862" class="css-a4x74f"><span>4862</span></td><td id="LC4862" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> data;
</code></td></tr><tr><td id="L4863" class="css-a4x74f"><span>4863</span></td><td id="LC4863" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> __generator(<span class="code-keyword">this</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_a</span>) </span>{
</code></td></tr><tr><td id="L4864" class="css-a4x74f"><span>4864</span></td><td id="LC4864" class="css-1dcdqdg"><code>                    <span class="code-keyword">switch</span> (_a.label) {
</code></td></tr><tr><td id="L4865" class="css-a4x74f"><span>4865</span></td><td id="LC4865" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">0</span>: <span class="code-keyword">return</span> [<span class="code-number">4</span> <span class="code-comment">/*yield*/</span>, <span class="code-keyword">this</span>.http.post(<span class="code-string">""</span>.concat(<span class="code-keyword">this</span>.settings.path, <span class="code-string">"/register"</span>), {
</code></td></tr><tr><td id="L4866" class="css-a4x74f"><span>4866</span></td><td id="LC4866" class="css-1dcdqdg"><code>                                body: { <span class="code-attr">email</span>: email, <span class="code-attr">password</span>: password, <span class="code-attr">options</span>: options, },
</code></td></tr><tr><td id="L4867" class="css-a4x74f"><span>4867</span></td><td id="LC4867" class="css-1dcdqdg"><code>                            })];
</code></td></tr><tr><td id="L4868" class="css-a4x74f"><span>4868</span></td><td id="LC4868" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">1</span>:
</code></td></tr><tr><td id="L4869" class="css-a4x74f"><span>4869</span></td><td id="LC4869" class="css-1dcdqdg"><code>                            data = (_a.sent()).data;
</code></td></tr><tr><td id="L4870" class="css-a4x74f"><span>4870</span></td><td id="LC4870" class="css-1dcdqdg"><code>                            <span class="code-keyword">this</span>.emitChange(data);
</code></td></tr><tr><td id="L4871" class="css-a4x74f"><span>4871</span></td><td id="LC4871" class="css-1dcdqdg"><code>                            <span class="code-keyword">return</span> [<span class="code-number">2</span> <span class="code-comment">/*return*/</span>, data];
</code></td></tr><tr><td id="L4872" class="css-a4x74f"><span>4872</span></td><td id="LC4872" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L4873" class="css-a4x74f"><span>4873</span></td><td id="LC4873" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L4874" class="css-a4x74f"><span>4874</span></td><td id="LC4874" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L4875" class="css-a4x74f"><span>4875</span></td><td id="LC4875" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4876" class="css-a4x74f"><span>4876</span></td><td id="LC4876" class="css-1dcdqdg"><code>        Auth.prototype.signInWithEmailAndPassword = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">email, password</span>) </span>{
</code></td></tr><tr><td id="L4877" class="css-a4x74f"><span>4877</span></td><td id="LC4877" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> __awaiter(<span class="code-keyword">this</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4878" class="css-a4x74f"><span>4878</span></td><td id="LC4878" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> data;
</code></td></tr><tr><td id="L4879" class="css-a4x74f"><span>4879</span></td><td id="LC4879" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> __generator(<span class="code-keyword">this</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_a</span>) </span>{
</code></td></tr><tr><td id="L4880" class="css-a4x74f"><span>4880</span></td><td id="LC4880" class="css-1dcdqdg"><code>                    <span class="code-keyword">switch</span> (_a.label) {
</code></td></tr><tr><td id="L4881" class="css-a4x74f"><span>4881</span></td><td id="LC4881" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">0</span>: <span class="code-keyword">return</span> [<span class="code-number">4</span> <span class="code-comment">/*yield*/</span>, <span class="code-keyword">this</span>.http.post(<span class="code-string">""</span>.concat(<span class="code-keyword">this</span>.settings.path, <span class="code-string">"/login"</span>), {
</code></td></tr><tr><td id="L4882" class="css-a4x74f"><span>4882</span></td><td id="LC4882" class="css-1dcdqdg"><code>                                body: { <span class="code-attr">email</span>: email, <span class="code-attr">password</span>: password, },
</code></td></tr><tr><td id="L4883" class="css-a4x74f"><span>4883</span></td><td id="LC4883" class="css-1dcdqdg"><code>                            })];
</code></td></tr><tr><td id="L4884" class="css-a4x74f"><span>4884</span></td><td id="LC4884" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">1</span>:
</code></td></tr><tr><td id="L4885" class="css-a4x74f"><span>4885</span></td><td id="LC4885" class="css-1dcdqdg"><code>                            data = (_a.sent()).data;
</code></td></tr><tr><td id="L4886" class="css-a4x74f"><span>4886</span></td><td id="LC4886" class="css-1dcdqdg"><code>                            <span class="code-keyword">this</span>.emitChange(data);
</code></td></tr><tr><td id="L4887" class="css-a4x74f"><span>4887</span></td><td id="LC4887" class="css-1dcdqdg"><code>                            <span class="code-keyword">return</span> [<span class="code-number">2</span> <span class="code-comment">/*return*/</span>, data];
</code></td></tr><tr><td id="L4888" class="css-a4x74f"><span>4888</span></td><td id="LC4888" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L4889" class="css-a4x74f"><span>4889</span></td><td id="LC4889" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L4890" class="css-a4x74f"><span>4890</span></td><td id="LC4890" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L4891" class="css-a4x74f"><span>4891</span></td><td id="LC4891" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4892" class="css-a4x74f"><span>4892</span></td><td id="LC4892" class="css-1dcdqdg"><code>        Auth.prototype.signInAnonymously = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">options</span>) </span>{
</code></td></tr><tr><td id="L4893" class="css-a4x74f"><span>4893</span></td><td id="LC4893" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> __awaiter(<span class="code-keyword">this</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4894" class="css-a4x74f"><span>4894</span></td><td id="LC4894" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> data;
</code></td></tr><tr><td id="L4895" class="css-a4x74f"><span>4895</span></td><td id="LC4895" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> __generator(<span class="code-keyword">this</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_a</span>) </span>{
</code></td></tr><tr><td id="L4896" class="css-a4x74f"><span>4896</span></td><td id="LC4896" class="css-1dcdqdg"><code>                    <span class="code-keyword">switch</span> (_a.label) {
</code></td></tr><tr><td id="L4897" class="css-a4x74f"><span>4897</span></td><td id="LC4897" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">0</span>: <span class="code-keyword">return</span> [<span class="code-number">4</span> <span class="code-comment">/*yield*/</span>, <span class="code-keyword">this</span>.http.post(<span class="code-string">""</span>.concat(<span class="code-keyword">this</span>.settings.path, <span class="code-string">"/anonymous"</span>), {
</code></td></tr><tr><td id="L4898" class="css-a4x74f"><span>4898</span></td><td id="LC4898" class="css-1dcdqdg"><code>                                body: { <span class="code-attr">options</span>: options, }
</code></td></tr><tr><td id="L4899" class="css-a4x74f"><span>4899</span></td><td id="LC4899" class="css-1dcdqdg"><code>                            })];
</code></td></tr><tr><td id="L4900" class="css-a4x74f"><span>4900</span></td><td id="LC4900" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">1</span>:
</code></td></tr><tr><td id="L4901" class="css-a4x74f"><span>4901</span></td><td id="LC4901" class="css-1dcdqdg"><code>                            data = (_a.sent()).data;
</code></td></tr><tr><td id="L4902" class="css-a4x74f"><span>4902</span></td><td id="LC4902" class="css-1dcdqdg"><code>                            <span class="code-keyword">this</span>.emitChange(data);
</code></td></tr><tr><td id="L4903" class="css-a4x74f"><span>4903</span></td><td id="LC4903" class="css-1dcdqdg"><code>                            <span class="code-keyword">return</span> [<span class="code-number">2</span> <span class="code-comment">/*return*/</span>, data];
</code></td></tr><tr><td id="L4904" class="css-a4x74f"><span>4904</span></td><td id="LC4904" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L4905" class="css-a4x74f"><span>4905</span></td><td id="LC4905" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L4906" class="css-a4x74f"><span>4906</span></td><td id="LC4906" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L4907" class="css-a4x74f"><span>4907</span></td><td id="LC4907" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4908" class="css-a4x74f"><span>4908</span></td><td id="LC4908" class="css-1dcdqdg"><code>        Auth.prototype.sendPasswordResetEmail = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">email</span>) </span>{
</code></td></tr><tr><td id="L4909" class="css-a4x74f"><span>4909</span></td><td id="LC4909" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> __awaiter(<span class="code-keyword">this</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4910" class="css-a4x74f"><span>4910</span></td><td id="LC4910" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> __generator(<span class="code-keyword">this</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_a</span>) </span>{
</code></td></tr><tr><td id="L4911" class="css-a4x74f"><span>4911</span></td><td id="LC4911" class="css-1dcdqdg"><code>                    <span class="code-keyword">switch</span> (_a.label) {
</code></td></tr><tr><td id="L4912" class="css-a4x74f"><span>4912</span></td><td id="LC4912" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">0</span>: <span class="code-keyword">return</span> [<span class="code-number">4</span> <span class="code-comment">/*yield*/</span>, <span class="code-keyword">this</span>.http.post(<span class="code-string">""</span>.concat(<span class="code-keyword">this</span>.settings.path, <span class="code-string">"/forgot-password"</span>), {
</code></td></tr><tr><td id="L4913" class="css-a4x74f"><span>4913</span></td><td id="LC4913" class="css-1dcdqdg"><code>                                body: { <span class="code-attr">email</span>: email, }
</code></td></tr><tr><td id="L4914" class="css-a4x74f"><span>4914</span></td><td id="LC4914" class="css-1dcdqdg"><code>                            })];
</code></td></tr><tr><td id="L4915" class="css-a4x74f"><span>4915</span></td><td id="LC4915" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">1</span>: <span class="code-keyword">return</span> [<span class="code-number">2</span> <span class="code-comment">/*return*/</span>, (_a.sent()).data];
</code></td></tr><tr><td id="L4916" class="css-a4x74f"><span>4916</span></td><td id="LC4916" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L4917" class="css-a4x74f"><span>4917</span></td><td id="LC4917" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L4918" class="css-a4x74f"><span>4918</span></td><td id="LC4918" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L4919" class="css-a4x74f"><span>4919</span></td><td id="LC4919" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4920" class="css-a4x74f"><span>4920</span></td><td id="LC4920" class="css-1dcdqdg"><code>        Auth.prototype.signInWithProvider = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">providerName, settings</span>) </span>{
</code></td></tr><tr><td id="L4921" class="css-a4x74f"><span>4921</span></td><td id="LC4921" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (settings === <span class="code-keyword">void</span> <span class="code-number">0</span>) { settings = {}; }
</code></td></tr><tr><td id="L4922" class="css-a4x74f"><span>4922</span></td><td id="LC4922" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> __awaiter(<span class="code-keyword">this</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4923" class="css-a4x74f"><span>4923</span></td><td id="LC4923" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L4924" class="css-a4x74f"><span>4924</span></td><td id="LC4924" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> __generator(<span class="code-keyword">this</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_a</span>) </span>{
</code></td></tr><tr><td id="L4925" class="css-a4x74f"><span>4925</span></td><td id="LC4925" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> [<span class="code-number">2</span> <span class="code-comment">/*return*/</span>, <span class="code-keyword">new</span> <span class="code-built_in">Promise</span>(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">resolve, reject</span>) </span>{
</code></td></tr><tr><td id="L4926" class="css-a4x74f"><span>4926</span></td><td id="LC4926" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> w = settings.width || <span class="code-number">480</span>;
</code></td></tr><tr><td id="L4927" class="css-a4x74f"><span>4927</span></td><td id="LC4927" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> h = settings.height || <span class="code-number">768</span>;
</code></td></tr><tr><td id="L4928" class="css-a4x74f"><span>4928</span></td><td id="LC4928" class="css-1dcdqdg"><code>                            <span class="code-comment">// forward existing token for upgrading</span>
</code></td></tr><tr><td id="L4929" class="css-a4x74f"><span>4929</span></td><td id="LC4929" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> upgradingToken = _this.token ? <span class="code-string">"?token="</span>.concat(_this.token) : <span class="code-string">""</span>;
</code></td></tr><tr><td id="L4930" class="css-a4x74f"><span>4930</span></td><td id="LC4930" class="css-1dcdqdg"><code>                            <span class="code-comment">// Capitalize first letter of providerName</span>
</code></td></tr><tr><td id="L4931" class="css-a4x74f"><span>4931</span></td><td id="LC4931" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> title = <span class="code-string">"Login with "</span>.concat((providerName[<span class="code-number">0</span>].toUpperCase() + providerName.substring(<span class="code-number">1</span>)));
</code></td></tr><tr><td id="L4932" class="css-a4x74f"><span>4932</span></td><td id="LC4932" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> url = _this.http[<span class="code-string">'client'</span>][<span class="code-string">'getHttpEndpoint'</span>](<span class="code-string">""</span>.concat((settings.prefix || <span class="code-string">""</span>.concat(_this.settings.path, <span class="code-string">"/provider"</span>)), <span class="code-string">"/"</span>).concat(providerName).concat(upgradingToken));
</code></td></tr><tr><td id="L4933" class="css-a4x74f"><span>4933</span></td><td id="LC4933" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> left = (screen.width / <span class="code-number">2</span>) - (w / <span class="code-number">2</span>);
</code></td></tr><tr><td id="L4934" class="css-a4x74f"><span>4934</span></td><td id="LC4934" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> top = (screen.height / <span class="code-number">2</span>) - (h / <span class="code-number">2</span>);
</code></td></tr><tr><td id="L4935" class="css-a4x74f"><span>4935</span></td><td id="LC4935" class="css-1dcdqdg"><code>                            __classPrivateFieldSet(_this, _Auth__signInWindow, <span class="code-built_in">window</span>.open(url, title, <span class="code-string">'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width='</span> + w + <span class="code-string">', height='</span> + h + <span class="code-string">', top='</span> + top + <span class="code-string">', left='</span> + left), <span class="code-string">"f"</span>);
</code></td></tr><tr><td id="L4936" class="css-a4x74f"><span>4936</span></td><td id="LC4936" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> onMessage = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">event</span>) </span>{
</code></td></tr><tr><td id="L4937" class="css-a4x74f"><span>4937</span></td><td id="LC4937" class="css-1dcdqdg"><code>                                <span class="code-comment">// <span class="code-doctag">TODO:</span> it is a good idea to check if event.origin can be trusted!</span>
</code></td></tr><tr><td id="L4938" class="css-a4x74f"><span>4938</span></td><td id="LC4938" class="css-1dcdqdg"><code>                                <span class="code-comment">// if (event.origin.indexOf(window.location.hostname) === -1) { return; }</span>
</code></td></tr><tr><td id="L4939" class="css-a4x74f"><span>4939</span></td><td id="LC4939" class="css-1dcdqdg"><code>                                <span class="code-comment">// require 'user' and 'token' inside received data.</span>
</code></td></tr><tr><td id="L4940" class="css-a4x74f"><span>4940</span></td><td id="LC4940" class="css-1dcdqdg"><code>                                <span class="code-keyword">if</span> (event.data.user === <span class="code-literal">undefined</span> &amp;&amp; event.data.token === <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L4941" class="css-a4x74f"><span>4941</span></td><td id="LC4941" class="css-1dcdqdg"><code>                                    <span class="code-keyword">return</span>;
</code></td></tr><tr><td id="L4942" class="css-a4x74f"><span>4942</span></td><td id="LC4942" class="css-1dcdqdg"><code>                                }
</code></td></tr><tr><td id="L4943" class="css-a4x74f"><span>4943</span></td><td id="LC4943" class="css-1dcdqdg"><code>                                clearInterval(rejectionChecker);
</code></td></tr><tr><td id="L4944" class="css-a4x74f"><span>4944</span></td><td id="LC4944" class="css-1dcdqdg"><code>                                __classPrivateFieldGet(_this, _Auth__signInWindow, <span class="code-string">"f"</span>).close();
</code></td></tr><tr><td id="L4945" class="css-a4x74f"><span>4945</span></td><td id="LC4945" class="css-1dcdqdg"><code>                                __classPrivateFieldSet(_this, _Auth__signInWindow, <span class="code-literal">undefined</span>, <span class="code-string">"f"</span>);
</code></td></tr><tr><td id="L4946" class="css-a4x74f"><span>4946</span></td><td id="LC4946" class="css-1dcdqdg"><code>                                <span class="code-built_in">window</span>.removeEventListener(<span class="code-string">"message"</span>, onMessage);
</code></td></tr><tr><td id="L4947" class="css-a4x74f"><span>4947</span></td><td id="LC4947" class="css-1dcdqdg"><code>                                <span class="code-keyword">if</span> (event.data.error !== <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L4948" class="css-a4x74f"><span>4948</span></td><td id="LC4948" class="css-1dcdqdg"><code>                                    reject(event.data.error);
</code></td></tr><tr><td id="L4949" class="css-a4x74f"><span>4949</span></td><td id="LC4949" class="css-1dcdqdg"><code>                                }
</code></td></tr><tr><td id="L4950" class="css-a4x74f"><span>4950</span></td><td id="LC4950" class="css-1dcdqdg"><code>                                <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L4951" class="css-a4x74f"><span>4951</span></td><td id="LC4951" class="css-1dcdqdg"><code>                                    resolve(event.data);
</code></td></tr><tr><td id="L4952" class="css-a4x74f"><span>4952</span></td><td id="LC4952" class="css-1dcdqdg"><code>                                    _this.emitChange(event.data);
</code></td></tr><tr><td id="L4953" class="css-a4x74f"><span>4953</span></td><td id="LC4953" class="css-1dcdqdg"><code>                                }
</code></td></tr><tr><td id="L4954" class="css-a4x74f"><span>4954</span></td><td id="LC4954" class="css-1dcdqdg"><code>                            };
</code></td></tr><tr><td id="L4955" class="css-a4x74f"><span>4955</span></td><td id="LC4955" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> rejectionChecker = setInterval(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4956" class="css-a4x74f"><span>4956</span></td><td id="LC4956" class="css-1dcdqdg"><code>                                <span class="code-keyword">if</span> (!__classPrivateFieldGet(_this, _Auth__signInWindow, <span class="code-string">"f"</span>) || __classPrivateFieldGet(_this, _Auth__signInWindow, <span class="code-string">"f"</span>).closed) {
</code></td></tr><tr><td id="L4957" class="css-a4x74f"><span>4957</span></td><td id="LC4957" class="css-1dcdqdg"><code>                                    __classPrivateFieldSet(_this, _Auth__signInWindow, <span class="code-literal">undefined</span>, <span class="code-string">"f"</span>);
</code></td></tr><tr><td id="L4958" class="css-a4x74f"><span>4958</span></td><td id="LC4958" class="css-1dcdqdg"><code>                                    reject(<span class="code-string">"cancelled"</span>);
</code></td></tr><tr><td id="L4959" class="css-a4x74f"><span>4959</span></td><td id="LC4959" class="css-1dcdqdg"><code>                                    <span class="code-built_in">window</span>.removeEventListener(<span class="code-string">"message"</span>, onMessage);
</code></td></tr><tr><td id="L4960" class="css-a4x74f"><span>4960</span></td><td id="LC4960" class="css-1dcdqdg"><code>                                }
</code></td></tr><tr><td id="L4961" class="css-a4x74f"><span>4961</span></td><td id="LC4961" class="css-1dcdqdg"><code>                            }, <span class="code-number">200</span>);
</code></td></tr><tr><td id="L4962" class="css-a4x74f"><span>4962</span></td><td id="LC4962" class="css-1dcdqdg"><code>                            <span class="code-built_in">window</span>.addEventListener(<span class="code-string">"message"</span>, onMessage);
</code></td></tr><tr><td id="L4963" class="css-a4x74f"><span>4963</span></td><td id="LC4963" class="css-1dcdqdg"><code>                        })];
</code></td></tr><tr><td id="L4964" class="css-a4x74f"><span>4964</span></td><td id="LC4964" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L4965" class="css-a4x74f"><span>4965</span></td><td id="LC4965" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L4966" class="css-a4x74f"><span>4966</span></td><td id="LC4966" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4967" class="css-a4x74f"><span>4967</span></td><td id="LC4967" class="css-1dcdqdg"><code>        Auth.prototype.signOut = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4968" class="css-a4x74f"><span>4968</span></td><td id="LC4968" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> __awaiter(<span class="code-keyword">this</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L4969" class="css-a4x74f"><span>4969</span></td><td id="LC4969" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> __generator(<span class="code-keyword">this</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_a</span>) </span>{
</code></td></tr><tr><td id="L4970" class="css-a4x74f"><span>4970</span></td><td id="LC4970" class="css-1dcdqdg"><code>                    <span class="code-keyword">this</span>.emitChange({ <span class="code-attr">user</span>: <span class="code-literal">null</span>, <span class="code-attr">token</span>: <span class="code-literal">null</span> });
</code></td></tr><tr><td id="L4971" class="css-a4x74f"><span>4971</span></td><td id="LC4971" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> [<span class="code-number">2</span> <span class="code-comment">/*return*/</span>];
</code></td></tr><tr><td id="L4972" class="css-a4x74f"><span>4972</span></td><td id="LC4972" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L4973" class="css-a4x74f"><span>4973</span></td><td id="LC4973" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L4974" class="css-a4x74f"><span>4974</span></td><td id="LC4974" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4975" class="css-a4x74f"><span>4975</span></td><td id="LC4975" class="css-1dcdqdg"><code>        Auth.prototype.emitChange = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">authData</span>) </span>{
</code></td></tr><tr><td id="L4976" class="css-a4x74f"><span>4976</span></td><td id="LC4976" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (authData.token !== <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L4977" class="css-a4x74f"><span>4977</span></td><td id="LC4977" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.token = authData.token;
</code></td></tr><tr><td id="L4978" class="css-a4x74f"><span>4978</span></td><td id="LC4978" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (authData.token === <span class="code-literal">null</span>) {
</code></td></tr><tr><td id="L4979" class="css-a4x74f"><span>4979</span></td><td id="LC4979" class="css-1dcdqdg"><code>                    removeItem(<span class="code-keyword">this</span>.settings.key);
</code></td></tr><tr><td id="L4980" class="css-a4x74f"><span>4980</span></td><td id="LC4980" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L4981" class="css-a4x74f"><span>4981</span></td><td id="LC4981" class="css-1dcdqdg"><code>                <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L4982" class="css-a4x74f"><span>4982</span></td><td id="LC4982" class="css-1dcdqdg"><code>                    <span class="code-comment">// store key in localStorage</span>
</code></td></tr><tr><td id="L4983" class="css-a4x74f"><span>4983</span></td><td id="LC4983" class="css-1dcdqdg"><code>                    setItem(<span class="code-keyword">this</span>.settings.key, authData.token);
</code></td></tr><tr><td id="L4984" class="css-a4x74f"><span>4984</span></td><td id="LC4984" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L4985" class="css-a4x74f"><span>4985</span></td><td id="LC4985" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L4986" class="css-a4x74f"><span>4986</span></td><td id="LC4986" class="css-1dcdqdg"><code>            __classPrivateFieldGet(<span class="code-keyword">this</span>, _Auth__events, <span class="code-string">"f"</span>).emit(<span class="code-string">"change"</span>, authData);
</code></td></tr><tr><td id="L4987" class="css-a4x74f"><span>4987</span></td><td id="LC4987" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L4988" class="css-a4x74f"><span>4988</span></td><td id="LC4988" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> Auth;
</code></td></tr><tr><td id="L4989" class="css-a4x74f"><span>4989</span></td><td id="LC4989" class="css-1dcdqdg"><code>    }());
</code></td></tr><tr><td id="L4990" class="css-a4x74f"><span>4990</span></td><td id="LC4990" class="css-1dcdqdg"><code>    _Auth__initialized = <span class="code-keyword">new</span> <span class="code-built_in">WeakMap</span>(), _Auth__initializationPromise = <span class="code-keyword">new</span> <span class="code-built_in">WeakMap</span>(), _Auth__signInWindow = <span class="code-keyword">new</span> <span class="code-built_in">WeakMap</span>(), _Auth__events = <span class="code-keyword">new</span> <span class="code-built_in">WeakMap</span>();
</code></td></tr><tr><td id="L4991" class="css-a4x74f"><span>4991</span></td><td id="LC4991" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L4992" class="css-a4x74f"><span>4992</span></td><td id="LC4992" class="css-1dcdqdg"><code>    <span class="code-comment">/**
</span></code></td></tr><tr><td id="L4993" class="css-a4x74f"><span>4993</span></td><td id="LC4993" class="css-1dcdqdg"><code><span class="code-comment">     * Discord Embedded App SDK
</span></code></td></tr><tr><td id="L4994" class="css-a4x74f"><span>4994</span></td><td id="LC4994" class="css-1dcdqdg"><code><span class="code-comment">     * https://github.com/colyseus/colyseus/issues/707
</span></code></td></tr><tr><td id="L4995" class="css-a4x74f"><span>4995</span></td><td id="LC4995" class="css-1dcdqdg"><code><span class="code-comment">     *
</span></code></td></tr><tr><td id="L4996" class="css-a4x74f"><span>4996</span></td><td id="LC4996" class="css-1dcdqdg"><code><span class="code-comment">     * All URLs must go through the local proxy from
</span></code></td></tr><tr><td id="L4997" class="css-a4x74f"><span>4997</span></td><td id="LC4997" class="css-1dcdqdg"><code><span class="code-comment">     * https://&lt;app_id&gt;.discordsays.com/.proxy/&lt;mapped_url&gt;/...
</span></code></td></tr><tr><td id="L4998" class="css-a4x74f"><span>4998</span></td><td id="LC4998" class="css-1dcdqdg"><code><span class="code-comment">     *
</span></code></td></tr><tr><td id="L4999" class="css-a4x74f"><span>4999</span></td><td id="LC4999" class="css-1dcdqdg"><code><span class="code-comment">     * URL Mapping Examples:
</span></code></td></tr><tr><td id="L5000" class="css-a4x74f"><span>5000</span></td><td id="LC5000" class="css-1dcdqdg"><code><span class="code-comment">     *
</span></code></td></tr><tr><td id="L5001" class="css-a4x74f"><span>5001</span></td><td id="LC5001" class="css-1dcdqdg"><code><span class="code-comment">     * 1. Using Colyseus Cloud:
</span></code></td></tr><tr><td id="L5002" class="css-a4x74f"><span>5002</span></td><td id="LC5002" class="css-1dcdqdg"><code><span class="code-comment">     *   - /colyseus/{subdomain} -&gt; {subdomain}.colyseus.cloud
</span></code></td></tr><tr><td id="L5003" class="css-a4x74f"><span>5003</span></td><td id="LC5003" class="css-1dcdqdg"><code><span class="code-comment">     *
</span></code></td></tr><tr><td id="L5004" class="css-a4x74f"><span>5004</span></td><td id="LC5004" class="css-1dcdqdg"><code><span class="code-comment">     *   Example:
</span></code></td></tr><tr><td id="L5005" class="css-a4x74f"><span>5005</span></td><td id="LC5005" class="css-1dcdqdg"><code><span class="code-comment">     *     const client = new Client("https://xxxx.colyseus.cloud");
</span></code></td></tr><tr><td id="L5006" class="css-a4x74f"><span>5006</span></td><td id="LC5006" class="css-1dcdqdg"><code><span class="code-comment">     *
</span></code></td></tr><tr><td id="L5007" class="css-a4x74f"><span>5007</span></td><td id="LC5007" class="css-1dcdqdg"><code><span class="code-comment">     * -------------------------------------------------------------
</span></code></td></tr><tr><td id="L5008" class="css-a4x74f"><span>5008</span></td><td id="LC5008" class="css-1dcdqdg"><code><span class="code-comment">     *
</span></code></td></tr><tr><td id="L5009" class="css-a4x74f"><span>5009</span></td><td id="LC5009" class="css-1dcdqdg"><code><span class="code-comment">     * 2. Using `cloudflared` tunnel:
</span></code></td></tr><tr><td id="L5010" class="css-a4x74f"><span>5010</span></td><td id="LC5010" class="css-1dcdqdg"><code><span class="code-comment">     *   - /colyseus/ -&gt; &lt;your-cloudflared-url&gt;.trycloudflare.com
</span></code></td></tr><tr><td id="L5011" class="css-a4x74f"><span>5011</span></td><td id="LC5011" class="css-1dcdqdg"><code><span class="code-comment">     *
</span></code></td></tr><tr><td id="L5012" class="css-a4x74f"><span>5012</span></td><td id="LC5012" class="css-1dcdqdg"><code><span class="code-comment">     *   Example:
</span></code></td></tr><tr><td id="L5013" class="css-a4x74f"><span>5013</span></td><td id="LC5013" class="css-1dcdqdg"><code><span class="code-comment">     *     const client = new Client("https://&lt;your-cloudflared-url&gt;.trycloudflare.com");
</span></code></td></tr><tr><td id="L5014" class="css-a4x74f"><span>5014</span></td><td id="LC5014" class="css-1dcdqdg"><code><span class="code-comment">     *
</span></code></td></tr><tr><td id="L5015" class="css-a4x74f"><span>5015</span></td><td id="LC5015" class="css-1dcdqdg"><code><span class="code-comment">     * -------------------------------------------------------------
</span></code></td></tr><tr><td id="L5016" class="css-a4x74f"><span>5016</span></td><td id="LC5016" class="css-1dcdqdg"><code><span class="code-comment">     *
</span></code></td></tr><tr><td id="L5017" class="css-a4x74f"><span>5017</span></td><td id="LC5017" class="css-1dcdqdg"><code><span class="code-comment">     * 3. Providing a manual /.proxy/your-mapping:
</span></code></td></tr><tr><td id="L5018" class="css-a4x74f"><span>5018</span></td><td id="LC5018" class="css-1dcdqdg"><code><span class="code-comment">     *   - /your-mapping/ -&gt; your-endpoint.com
</span></code></td></tr><tr><td id="L5019" class="css-a4x74f"><span>5019</span></td><td id="LC5019" class="css-1dcdqdg"><code><span class="code-comment">     *
</span></code></td></tr><tr><td id="L5020" class="css-a4x74f"><span>5020</span></td><td id="LC5020" class="css-1dcdqdg"><code><span class="code-comment">     *   Example:
</span></code></td></tr><tr><td id="L5021" class="css-a4x74f"><span>5021</span></td><td id="LC5021" class="css-1dcdqdg"><code><span class="code-comment">     *     const client = new Client("/.proxy/your-mapping");
</span></code></td></tr><tr><td id="L5022" class="css-a4x74f"><span>5022</span></td><td id="LC5022" class="css-1dcdqdg"><code><span class="code-comment">     *
</span></code></td></tr><tr><td id="L5023" class="css-a4x74f"><span>5023</span></td><td id="LC5023" class="css-1dcdqdg"><code><span class="code-comment">     */</span>
</code></td></tr><tr><td id="L5024" class="css-a4x74f"><span>5024</span></td><td id="LC5024" class="css-1dcdqdg"><code>    <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">discordURLBuilder</span>(<span class="code-params">url</span>) </span>{
</code></td></tr><tr><td id="L5025" class="css-a4x74f"><span>5025</span></td><td id="LC5025" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> _a;
</code></td></tr><tr><td id="L5026" class="css-a4x74f"><span>5026</span></td><td id="LC5026" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> localHostname = ((_a = <span class="code-built_in">window</span> === <span class="code-literal">null</span> || <span class="code-built_in">window</span> === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : <span class="code-built_in">window</span>.location) === <span class="code-literal">null</span> || _a === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _a.hostname) || <span class="code-string">"localhost"</span>;
</code></td></tr><tr><td id="L5027" class="css-a4x74f"><span>5027</span></td><td id="LC5027" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> remoteHostnameSplitted = url.hostname.split(<span class="code-string">'.'</span>);
</code></td></tr><tr><td id="L5028" class="css-a4x74f"><span>5028</span></td><td id="LC5028" class="css-1dcdqdg"><code>        <span class="code-keyword">var</span> subdomain = (!url.hostname.includes(<span class="code-string">"trycloudflare.com"</span>) &amp;&amp; <span class="code-comment">// ignore cloudflared subdomains</span>
</code></td></tr><tr><td id="L5029" class="css-a4x74f"><span>5029</span></td><td id="LC5029" class="css-1dcdqdg"><code>            !url.hostname.includes(<span class="code-string">"discordsays.com"</span>) &amp;&amp; <span class="code-comment">// ignore discordsays.com subdomains</span>
</code></td></tr><tr><td id="L5030" class="css-a4x74f"><span>5030</span></td><td id="LC5030" class="css-1dcdqdg"><code>            remoteHostnameSplitted.length &gt; <span class="code-number">2</span>)
</code></td></tr><tr><td id="L5031" class="css-a4x74f"><span>5031</span></td><td id="LC5031" class="css-1dcdqdg"><code>            ? <span class="code-string">"/"</span>.concat(remoteHostnameSplitted[<span class="code-number">0</span>])
</code></td></tr><tr><td id="L5032" class="css-a4x74f"><span>5032</span></td><td id="LC5032" class="css-1dcdqdg"><code>            : <span class="code-string">''</span>;
</code></td></tr><tr><td id="L5033" class="css-a4x74f"><span>5033</span></td><td id="LC5033" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> (url.pathname.startsWith(<span class="code-string">"/.proxy"</span>))
</code></td></tr><tr><td id="L5034" class="css-a4x74f"><span>5034</span></td><td id="LC5034" class="css-1dcdqdg"><code>            ? <span class="code-string">""</span>.concat(url.protocol, <span class="code-string">"//"</span>).concat(localHostname).concat(subdomain).concat(url.pathname).concat(url.search)
</code></td></tr><tr><td id="L5035" class="css-a4x74f"><span>5035</span></td><td id="LC5035" class="css-1dcdqdg"><code>            : <span class="code-string">""</span>.concat(url.protocol, <span class="code-string">"//"</span>).concat(localHostname, <span class="code-string">"/.proxy/colyseus"</span>).concat(subdomain).concat(url.pathname).concat(url.search);
</code></td></tr><tr><td id="L5036" class="css-a4x74f"><span>5036</span></td><td id="LC5036" class="css-1dcdqdg"><code>    }
</code></td></tr><tr><td id="L5037" class="css-a4x74f"><span>5037</span></td><td id="LC5037" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L5038" class="css-a4x74f"><span>5038</span></td><td id="LC5038" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> _a;
</code></td></tr><tr><td id="L5039" class="css-a4x74f"><span>5039</span></td><td id="LC5039" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> MatchMakeError = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_super</span>) </span>{
</code></td></tr><tr><td id="L5040" class="css-a4x74f"><span>5040</span></td><td id="LC5040" class="css-1dcdqdg"><code>        __extends(MatchMakeError, _super);
</code></td></tr><tr><td id="L5041" class="css-a4x74f"><span>5041</span></td><td id="LC5041" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">MatchMakeError</span>(<span class="code-params">message, code</span>) </span>{
</code></td></tr><tr><td id="L5042" class="css-a4x74f"><span>5042</span></td><td id="LC5042" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> _this = _super.call(<span class="code-keyword">this</span>, message) || <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L5043" class="css-a4x74f"><span>5043</span></td><td id="LC5043" class="css-1dcdqdg"><code>            _this.code = code;
</code></td></tr><tr><td id="L5044" class="css-a4x74f"><span>5044</span></td><td id="LC5044" class="css-1dcdqdg"><code>            <span class="code-built_in">Object</span>.setPrototypeOf(_this, MatchMakeError.prototype);
</code></td></tr><tr><td id="L5045" class="css-a4x74f"><span>5045</span></td><td id="LC5045" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> _this;
</code></td></tr><tr><td id="L5046" class="css-a4x74f"><span>5046</span></td><td id="LC5046" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L5047" class="css-a4x74f"><span>5047</span></td><td id="LC5047" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> MatchMakeError;
</code></td></tr><tr><td id="L5048" class="css-a4x74f"><span>5048</span></td><td id="LC5048" class="css-1dcdqdg"><code>    }(<span class="code-built_in">Error</span>));
</code></td></tr><tr><td id="L5049" class="css-a4x74f"><span>5049</span></td><td id="LC5049" class="css-1dcdqdg"><code>    <span class="code-comment">// - React Native does not provide `window.location`</span>
</code></td></tr><tr><td id="L5050" class="css-a4x74f"><span>5050</span></td><td id="LC5050" class="css-1dcdqdg"><code>    <span class="code-comment">// - Cocos Creator (Native) does not provide `window.location.hostname`</span>
</code></td></tr><tr><td id="L5051" class="css-a4x74f"><span>5051</span></td><td id="LC5051" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> DEFAULT_ENDPOINT = (<span class="code-keyword">typeof</span> (<span class="code-built_in">window</span>) !== <span class="code-string">"undefined"</span> &amp;&amp; <span class="code-keyword">typeof</span> ((_a = <span class="code-built_in">window</span> === <span class="code-literal">null</span> || <span class="code-built_in">window</span> === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : <span class="code-built_in">window</span>.location) === <span class="code-literal">null</span> || _a === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _a.hostname) !== <span class="code-string">"undefined"</span>)
</code></td></tr><tr><td id="L5052" class="css-a4x74f"><span>5052</span></td><td id="LC5052" class="css-1dcdqdg"><code>        ? <span class="code-string">""</span>.concat(<span class="code-built_in">window</span>.location.protocol.replace(<span class="code-string">"http"</span>, <span class="code-string">"ws"</span>), <span class="code-string">"//"</span>).concat(<span class="code-built_in">window</span>.location.hostname).concat((<span class="code-built_in">window</span>.location.port &amp;&amp; <span class="code-string">":"</span>.concat(<span class="code-built_in">window</span>.location.port)))
</code></td></tr><tr><td id="L5053" class="css-a4x74f"><span>5053</span></td><td id="LC5053" class="css-1dcdqdg"><code>        : <span class="code-string">"ws://127.0.0.1:2567"</span>;
</code></td></tr><tr><td id="L5054" class="css-a4x74f"><span>5054</span></td><td id="LC5054" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> Client = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L5055" class="css-a4x74f"><span>5055</span></td><td id="LC5055" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">Client</span>(<span class="code-params">settings, customURLBuilder</span>) </span>{
</code></td></tr><tr><td id="L5056" class="css-a4x74f"><span>5056</span></td><td id="LC5056" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (settings === <span class="code-keyword">void</span> <span class="code-number">0</span>) { settings = DEFAULT_ENDPOINT; }
</code></td></tr><tr><td id="L5057" class="css-a4x74f"><span>5057</span></td><td id="LC5057" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> _a, _b;
</code></td></tr><tr><td id="L5058" class="css-a4x74f"><span>5058</span></td><td id="LC5058" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (settings) === <span class="code-string">"string"</span>) {
</code></td></tr><tr><td id="L5059" class="css-a4x74f"><span>5059</span></td><td id="LC5059" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L5060" class="css-a4x74f"><span>5060</span></td><td id="LC5060" class="css-1dcdqdg"><code>                <span class="code-comment">// endpoint by url</span>
</code></td></tr><tr><td id="L5061" class="css-a4x74f"><span>5061</span></td><td id="LC5061" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L5062" class="css-a4x74f"><span>5062</span></td><td id="LC5062" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> url = (settings.startsWith(<span class="code-string">"/"</span>))
</code></td></tr><tr><td id="L5063" class="css-a4x74f"><span>5063</span></td><td id="LC5063" class="css-1dcdqdg"><code>                    ? <span class="code-keyword">new</span> URL(settings, DEFAULT_ENDPOINT)
</code></td></tr><tr><td id="L5064" class="css-a4x74f"><span>5064</span></td><td id="LC5064" class="css-1dcdqdg"><code>                    : <span class="code-keyword">new</span> URL(settings);
</code></td></tr><tr><td id="L5065" class="css-a4x74f"><span>5065</span></td><td id="LC5065" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> secure = (url.protocol === <span class="code-string">"https:"</span> || url.protocol === <span class="code-string">"wss:"</span>);
</code></td></tr><tr><td id="L5066" class="css-a4x74f"><span>5066</span></td><td id="LC5066" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> port = <span class="code-built_in">Number</span>(url.port || (secure ? <span class="code-number">443</span> : <span class="code-number">80</span>));
</code></td></tr><tr><td id="L5067" class="css-a4x74f"><span>5067</span></td><td id="LC5067" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.settings = {
</code></td></tr><tr><td id="L5068" class="css-a4x74f"><span>5068</span></td><td id="LC5068" class="css-1dcdqdg"><code>                    hostname: url.hostname,
</code></td></tr><tr><td id="L5069" class="css-a4x74f"><span>5069</span></td><td id="LC5069" class="css-1dcdqdg"><code>                    pathname: url.pathname,
</code></td></tr><tr><td id="L5070" class="css-a4x74f"><span>5070</span></td><td id="LC5070" class="css-1dcdqdg"><code>                    port: port,
</code></td></tr><tr><td id="L5071" class="css-a4x74f"><span>5071</span></td><td id="LC5071" class="css-1dcdqdg"><code>                    secure: secure
</code></td></tr><tr><td id="L5072" class="css-a4x74f"><span>5072</span></td><td id="LC5072" class="css-1dcdqdg"><code>                };
</code></td></tr><tr><td id="L5073" class="css-a4x74f"><span>5073</span></td><td id="LC5073" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L5074" class="css-a4x74f"><span>5074</span></td><td id="LC5074" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L5075" class="css-a4x74f"><span>5075</span></td><td id="LC5075" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L5076" class="css-a4x74f"><span>5076</span></td><td id="LC5076" class="css-1dcdqdg"><code>                <span class="code-comment">// endpoint by settings</span>
</code></td></tr><tr><td id="L5077" class="css-a4x74f"><span>5077</span></td><td id="LC5077" class="css-1dcdqdg"><code>                <span class="code-comment">//</span>
</code></td></tr><tr><td id="L5078" class="css-a4x74f"><span>5078</span></td><td id="LC5078" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (settings.port === <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L5079" class="css-a4x74f"><span>5079</span></td><td id="LC5079" class="css-1dcdqdg"><code>                    settings.port = (settings.secure) ? <span class="code-number">443</span> : <span class="code-number">80</span>;
</code></td></tr><tr><td id="L5080" class="css-a4x74f"><span>5080</span></td><td id="LC5080" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L5081" class="css-a4x74f"><span>5081</span></td><td id="LC5081" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (settings.pathname === <span class="code-literal">undefined</span>) {
</code></td></tr><tr><td id="L5082" class="css-a4x74f"><span>5082</span></td><td id="LC5082" class="css-1dcdqdg"><code>                    settings.pathname = <span class="code-string">""</span>;
</code></td></tr><tr><td id="L5083" class="css-a4x74f"><span>5083</span></td><td id="LC5083" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L5084" class="css-a4x74f"><span>5084</span></td><td id="LC5084" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.settings = settings;
</code></td></tr><tr><td id="L5085" class="css-a4x74f"><span>5085</span></td><td id="LC5085" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L5086" class="css-a4x74f"><span>5086</span></td><td id="LC5086" class="css-1dcdqdg"><code>            <span class="code-comment">// make sure pathname does not end with "/"</span>
</code></td></tr><tr><td id="L5087" class="css-a4x74f"><span>5087</span></td><td id="LC5087" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.settings.pathname.endsWith(<span class="code-string">"/"</span>)) {
</code></td></tr><tr><td id="L5088" class="css-a4x74f"><span>5088</span></td><td id="LC5088" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.settings.pathname = <span class="code-keyword">this</span>.settings.pathname.slice(<span class="code-number">0</span>, <span class="code-number">-1</span>);
</code></td></tr><tr><td id="L5089" class="css-a4x74f"><span>5089</span></td><td id="LC5089" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L5090" class="css-a4x74f"><span>5090</span></td><td id="LC5090" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.http = <span class="code-keyword">new</span> HTTP(<span class="code-keyword">this</span>);
</code></td></tr><tr><td id="L5091" class="css-a4x74f"><span>5091</span></td><td id="LC5091" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.auth = <span class="code-keyword">new</span> Auth(<span class="code-keyword">this</span>.http);
</code></td></tr><tr><td id="L5092" class="css-a4x74f"><span>5092</span></td><td id="LC5092" class="css-1dcdqdg"><code>            <span class="code-keyword">this</span>.urlBuilder = customURLBuilder;
</code></td></tr><tr><td id="L5093" class="css-a4x74f"><span>5093</span></td><td id="LC5093" class="css-1dcdqdg"><code>            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L5094" class="css-a4x74f"><span>5094</span></td><td id="LC5094" class="css-1dcdqdg"><code>            <span class="code-comment">// Discord Embedded SDK requires a custom URL builder</span>
</code></td></tr><tr><td id="L5095" class="css-a4x74f"><span>5095</span></td><td id="LC5095" class="css-1dcdqdg"><code>            <span class="code-comment">//</span>
</code></td></tr><tr><td id="L5096" class="css-a4x74f"><span>5096</span></td><td id="LC5096" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (!<span class="code-keyword">this</span>.urlBuilder &amp;&amp;
</code></td></tr><tr><td id="L5097" class="css-a4x74f"><span>5097</span></td><td id="LC5097" class="css-1dcdqdg"><code>                <span class="code-keyword">typeof</span> (<span class="code-built_in">window</span>) !== <span class="code-string">"undefined"</span> &amp;&amp;
</code></td></tr><tr><td id="L5098" class="css-a4x74f"><span>5098</span></td><td id="LC5098" class="css-1dcdqdg"><code>                ((_b = (_a = <span class="code-built_in">window</span> === <span class="code-literal">null</span> || <span class="code-built_in">window</span> === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : <span class="code-built_in">window</span>.location) === <span class="code-literal">null</span> || _a === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _a.hostname) === <span class="code-literal">null</span> || _b === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _b.includes(<span class="code-string">"discordsays.com"</span>))) {
</code></td></tr><tr><td id="L5099" class="css-a4x74f"><span>5099</span></td><td id="LC5099" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.urlBuilder = discordURLBuilder;
</code></td></tr><tr><td id="L5100" class="css-a4x74f"><span>5100</span></td><td id="LC5100" class="css-1dcdqdg"><code>                <span class="code-built_in">console</span>.log(<span class="code-string">"Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."</span>);
</code></td></tr><tr><td id="L5101" class="css-a4x74f"><span>5101</span></td><td id="LC5101" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L5102" class="css-a4x74f"><span>5102</span></td><td id="LC5102" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L5103" class="css-a4x74f"><span>5103</span></td><td id="LC5103" class="css-1dcdqdg"><code>        Client.prototype.joinOrCreate = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">roomName, options, rootSchema</span>) </span>{
</code></td></tr><tr><td id="L5104" class="css-a4x74f"><span>5104</span></td><td id="LC5104" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (options === <span class="code-keyword">void</span> <span class="code-number">0</span>) { options = {}; }
</code></td></tr><tr><td id="L5105" class="css-a4x74f"><span>5105</span></td><td id="LC5105" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> __awaiter(<span class="code-keyword">this</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L5106" class="css-a4x74f"><span>5106</span></td><td id="LC5106" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> __generator(<span class="code-keyword">this</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_a</span>) </span>{
</code></td></tr><tr><td id="L5107" class="css-a4x74f"><span>5107</span></td><td id="LC5107" class="css-1dcdqdg"><code>                    <span class="code-keyword">switch</span> (_a.label) {
</code></td></tr><tr><td id="L5108" class="css-a4x74f"><span>5108</span></td><td id="LC5108" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">0</span>: <span class="code-keyword">return</span> [<span class="code-number">4</span> <span class="code-comment">/*yield*/</span>, <span class="code-keyword">this</span>.createMatchMakeRequest(<span class="code-string">'joinOrCreate'</span>, roomName, options, rootSchema)];
</code></td></tr><tr><td id="L5109" class="css-a4x74f"><span>5109</span></td><td id="LC5109" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">1</span>: <span class="code-keyword">return</span> [<span class="code-number">2</span> <span class="code-comment">/*return*/</span>, _a.sent()];
</code></td></tr><tr><td id="L5110" class="css-a4x74f"><span>5110</span></td><td id="LC5110" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L5111" class="css-a4x74f"><span>5111</span></td><td id="LC5111" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L5112" class="css-a4x74f"><span>5112</span></td><td id="LC5112" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L5113" class="css-a4x74f"><span>5113</span></td><td id="LC5113" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L5114" class="css-a4x74f"><span>5114</span></td><td id="LC5114" class="css-1dcdqdg"><code>        Client.prototype.create = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">roomName, options, rootSchema</span>) </span>{
</code></td></tr><tr><td id="L5115" class="css-a4x74f"><span>5115</span></td><td id="LC5115" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (options === <span class="code-keyword">void</span> <span class="code-number">0</span>) { options = {}; }
</code></td></tr><tr><td id="L5116" class="css-a4x74f"><span>5116</span></td><td id="LC5116" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> __awaiter(<span class="code-keyword">this</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L5117" class="css-a4x74f"><span>5117</span></td><td id="LC5117" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> __generator(<span class="code-keyword">this</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_a</span>) </span>{
</code></td></tr><tr><td id="L5118" class="css-a4x74f"><span>5118</span></td><td id="LC5118" class="css-1dcdqdg"><code>                    <span class="code-keyword">switch</span> (_a.label) {
</code></td></tr><tr><td id="L5119" class="css-a4x74f"><span>5119</span></td><td id="LC5119" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">0</span>: <span class="code-keyword">return</span> [<span class="code-number">4</span> <span class="code-comment">/*yield*/</span>, <span class="code-keyword">this</span>.createMatchMakeRequest(<span class="code-string">'create'</span>, roomName, options, rootSchema)];
</code></td></tr><tr><td id="L5120" class="css-a4x74f"><span>5120</span></td><td id="LC5120" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">1</span>: <span class="code-keyword">return</span> [<span class="code-number">2</span> <span class="code-comment">/*return*/</span>, _a.sent()];
</code></td></tr><tr><td id="L5121" class="css-a4x74f"><span>5121</span></td><td id="LC5121" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L5122" class="css-a4x74f"><span>5122</span></td><td id="LC5122" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L5123" class="css-a4x74f"><span>5123</span></td><td id="LC5123" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L5124" class="css-a4x74f"><span>5124</span></td><td id="LC5124" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L5125" class="css-a4x74f"><span>5125</span></td><td id="LC5125" class="css-1dcdqdg"><code>        Client.prototype.join = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">roomName, options, rootSchema</span>) </span>{
</code></td></tr><tr><td id="L5126" class="css-a4x74f"><span>5126</span></td><td id="LC5126" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (options === <span class="code-keyword">void</span> <span class="code-number">0</span>) { options = {}; }
</code></td></tr><tr><td id="L5127" class="css-a4x74f"><span>5127</span></td><td id="LC5127" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> __awaiter(<span class="code-keyword">this</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L5128" class="css-a4x74f"><span>5128</span></td><td id="LC5128" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> __generator(<span class="code-keyword">this</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_a</span>) </span>{
</code></td></tr><tr><td id="L5129" class="css-a4x74f"><span>5129</span></td><td id="LC5129" class="css-1dcdqdg"><code>                    <span class="code-keyword">switch</span> (_a.label) {
</code></td></tr><tr><td id="L5130" class="css-a4x74f"><span>5130</span></td><td id="LC5130" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">0</span>: <span class="code-keyword">return</span> [<span class="code-number">4</span> <span class="code-comment">/*yield*/</span>, <span class="code-keyword">this</span>.createMatchMakeRequest(<span class="code-string">'join'</span>, roomName, options, rootSchema)];
</code></td></tr><tr><td id="L5131" class="css-a4x74f"><span>5131</span></td><td id="LC5131" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">1</span>: <span class="code-keyword">return</span> [<span class="code-number">2</span> <span class="code-comment">/*return*/</span>, _a.sent()];
</code></td></tr><tr><td id="L5132" class="css-a4x74f"><span>5132</span></td><td id="LC5132" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L5133" class="css-a4x74f"><span>5133</span></td><td id="LC5133" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L5134" class="css-a4x74f"><span>5134</span></td><td id="LC5134" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L5135" class="css-a4x74f"><span>5135</span></td><td id="LC5135" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L5136" class="css-a4x74f"><span>5136</span></td><td id="LC5136" class="css-1dcdqdg"><code>        Client.prototype.joinById = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">roomId, options, rootSchema</span>) </span>{
</code></td></tr><tr><td id="L5137" class="css-a4x74f"><span>5137</span></td><td id="LC5137" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (options === <span class="code-keyword">void</span> <span class="code-number">0</span>) { options = {}; }
</code></td></tr><tr><td id="L5138" class="css-a4x74f"><span>5138</span></td><td id="LC5138" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> __awaiter(<span class="code-keyword">this</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L5139" class="css-a4x74f"><span>5139</span></td><td id="LC5139" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> __generator(<span class="code-keyword">this</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_a</span>) </span>{
</code></td></tr><tr><td id="L5140" class="css-a4x74f"><span>5140</span></td><td id="LC5140" class="css-1dcdqdg"><code>                    <span class="code-keyword">switch</span> (_a.label) {
</code></td></tr><tr><td id="L5141" class="css-a4x74f"><span>5141</span></td><td id="LC5141" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">0</span>: <span class="code-keyword">return</span> [<span class="code-number">4</span> <span class="code-comment">/*yield*/</span>, <span class="code-keyword">this</span>.createMatchMakeRequest(<span class="code-string">'joinById'</span>, roomId, options, rootSchema)];
</code></td></tr><tr><td id="L5142" class="css-a4x74f"><span>5142</span></td><td id="LC5142" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">1</span>: <span class="code-keyword">return</span> [<span class="code-number">2</span> <span class="code-comment">/*return*/</span>, _a.sent()];
</code></td></tr><tr><td id="L5143" class="css-a4x74f"><span>5143</span></td><td id="LC5143" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L5144" class="css-a4x74f"><span>5144</span></td><td id="LC5144" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L5145" class="css-a4x74f"><span>5145</span></td><td id="LC5145" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L5146" class="css-a4x74f"><span>5146</span></td><td id="LC5146" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L5147" class="css-a4x74f"><span>5147</span></td><td id="LC5147" class="css-1dcdqdg"><code>        <span class="code-comment">/**
</span></code></td></tr><tr><td id="L5148" class="css-a4x74f"><span>5148</span></td><td id="LC5148" class="css-1dcdqdg"><code><span class="code-comment">         * Re-establish connection with a room this client was previously connected to.
</span></code></td></tr><tr><td id="L5149" class="css-a4x74f"><span>5149</span></td><td id="LC5149" class="css-1dcdqdg"><code><span class="code-comment">         *
</span></code></td></tr><tr><td id="L5150" class="css-a4x74f"><span>5150</span></td><td id="LC5150" class="css-1dcdqdg"><code><span class="code-comment">         * @param reconnectionToken The `room.reconnectionToken` from previously connected room.
</span></code></td></tr><tr><td id="L5151" class="css-a4x74f"><span>5151</span></td><td id="LC5151" class="css-1dcdqdg"><code><span class="code-comment">         * @param rootSchema (optional) Concrete root schema definition
</span></code></td></tr><tr><td id="L5152" class="css-a4x74f"><span>5152</span></td><td id="LC5152" class="css-1dcdqdg"><code><span class="code-comment">         * @returns Promise&lt;Room&gt;
</span></code></td></tr><tr><td id="L5153" class="css-a4x74f"><span>5153</span></td><td id="LC5153" class="css-1dcdqdg"><code><span class="code-comment">         */</span>
</code></td></tr><tr><td id="L5154" class="css-a4x74f"><span>5154</span></td><td id="LC5154" class="css-1dcdqdg"><code>        Client.prototype.reconnect = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">reconnectionToken, rootSchema</span>) </span>{
</code></td></tr><tr><td id="L5155" class="css-a4x74f"><span>5155</span></td><td id="LC5155" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> __awaiter(<span class="code-keyword">this</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L5156" class="css-a4x74f"><span>5156</span></td><td id="LC5156" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _a, roomId, token;
</code></td></tr><tr><td id="L5157" class="css-a4x74f"><span>5157</span></td><td id="LC5157" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> __generator(<span class="code-keyword">this</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_b</span>) </span>{
</code></td></tr><tr><td id="L5158" class="css-a4x74f"><span>5158</span></td><td id="LC5158" class="css-1dcdqdg"><code>                    <span class="code-keyword">switch</span> (_b.label) {
</code></td></tr><tr><td id="L5159" class="css-a4x74f"><span>5159</span></td><td id="LC5159" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">0</span>:
</code></td></tr><tr><td id="L5160" class="css-a4x74f"><span>5160</span></td><td id="LC5160" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> (reconnectionToken) === <span class="code-string">"string"</span> &amp;&amp; <span class="code-keyword">typeof</span> (rootSchema) === <span class="code-string">"string"</span>) {
</code></td></tr><tr><td id="L5161" class="css-a4x74f"><span>5161</span></td><td id="LC5161" class="css-1dcdqdg"><code>                                <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">"DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`"</span>);
</code></td></tr><tr><td id="L5162" class="css-a4x74f"><span>5162</span></td><td id="LC5162" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L5163" class="css-a4x74f"><span>5163</span></td><td id="LC5163" class="css-1dcdqdg"><code>                            _a = reconnectionToken.split(<span class="code-string">":"</span>), roomId = _a[<span class="code-number">0</span>], token = _a[<span class="code-number">1</span>];
</code></td></tr><tr><td id="L5164" class="css-a4x74f"><span>5164</span></td><td id="LC5164" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (!roomId || !token) {
</code></td></tr><tr><td id="L5165" class="css-a4x74f"><span>5165</span></td><td id="LC5165" class="css-1dcdqdg"><code>                                <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">"Invalid reconnection token format.\nThe format should be roomId:reconnectionToken"</span>);
</code></td></tr><tr><td id="L5166" class="css-a4x74f"><span>5166</span></td><td id="LC5166" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L5167" class="css-a4x74f"><span>5167</span></td><td id="LC5167" class="css-1dcdqdg"><code>                            <span class="code-keyword">return</span> [<span class="code-number">4</span> <span class="code-comment">/*yield*/</span>, <span class="code-keyword">this</span>.createMatchMakeRequest(<span class="code-string">'reconnect'</span>, roomId, { <span class="code-attr">reconnectionToken</span>: token }, rootSchema)];
</code></td></tr><tr><td id="L5168" class="css-a4x74f"><span>5168</span></td><td id="LC5168" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">1</span>: <span class="code-keyword">return</span> [<span class="code-number">2</span> <span class="code-comment">/*return*/</span>, _b.sent()];
</code></td></tr><tr><td id="L5169" class="css-a4x74f"><span>5169</span></td><td id="LC5169" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L5170" class="css-a4x74f"><span>5170</span></td><td id="LC5170" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L5171" class="css-a4x74f"><span>5171</span></td><td id="LC5171" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L5172" class="css-a4x74f"><span>5172</span></td><td id="LC5172" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L5173" class="css-a4x74f"><span>5173</span></td><td id="LC5173" class="css-1dcdqdg"><code>        Client.prototype.getAvailableRooms = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">roomName</span>) </span>{
</code></td></tr><tr><td id="L5174" class="css-a4x74f"><span>5174</span></td><td id="LC5174" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (roomName === <span class="code-keyword">void</span> <span class="code-number">0</span>) { roomName = <span class="code-string">""</span>; }
</code></td></tr><tr><td id="L5175" class="css-a4x74f"><span>5175</span></td><td id="LC5175" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> __awaiter(<span class="code-keyword">this</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L5176" class="css-a4x74f"><span>5176</span></td><td id="LC5176" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> __generator(<span class="code-keyword">this</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_a</span>) </span>{
</code></td></tr><tr><td id="L5177" class="css-a4x74f"><span>5177</span></td><td id="LC5177" class="css-1dcdqdg"><code>                    <span class="code-keyword">switch</span> (_a.label) {
</code></td></tr><tr><td id="L5178" class="css-a4x74f"><span>5178</span></td><td id="LC5178" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">0</span>: <span class="code-keyword">return</span> [<span class="code-number">4</span> <span class="code-comment">/*yield*/</span>, <span class="code-keyword">this</span>.http.get(<span class="code-string">"matchmake/"</span>.concat(roomName), {
</code></td></tr><tr><td id="L5179" class="css-a4x74f"><span>5179</span></td><td id="LC5179" class="css-1dcdqdg"><code>                                headers: {
</code></td></tr><tr><td id="L5180" class="css-a4x74f"><span>5180</span></td><td id="LC5180" class="css-1dcdqdg"><code>                                    <span class="code-string">'Accept'</span>: <span class="code-string">'application/json'</span>
</code></td></tr><tr><td id="L5181" class="css-a4x74f"><span>5181</span></td><td id="LC5181" class="css-1dcdqdg"><code>                                }
</code></td></tr><tr><td id="L5182" class="css-a4x74f"><span>5182</span></td><td id="LC5182" class="css-1dcdqdg"><code>                            })];
</code></td></tr><tr><td id="L5183" class="css-a4x74f"><span>5183</span></td><td id="LC5183" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">1</span>: <span class="code-keyword">return</span> [<span class="code-number">2</span> <span class="code-comment">/*return*/</span>, (_a.sent()).data];
</code></td></tr><tr><td id="L5184" class="css-a4x74f"><span>5184</span></td><td id="LC5184" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L5185" class="css-a4x74f"><span>5185</span></td><td id="LC5185" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L5186" class="css-a4x74f"><span>5186</span></td><td id="LC5186" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L5187" class="css-a4x74f"><span>5187</span></td><td id="LC5187" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L5188" class="css-a4x74f"><span>5188</span></td><td id="LC5188" class="css-1dcdqdg"><code>        Client.prototype.consumeSeatReservation = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">response, rootSchema, reuseRoomInstance <span class="code-regexp">//</span> used in devMode
</span></span></code></td></tr><tr><td id="L5189" class="css-a4x74f"><span>5189</span></td><td id="LC5189" class="css-1dcdqdg"><code><span class="code-function"><span class="code-params">        </span>) </span>{
</code></td></tr><tr><td id="L5190" class="css-a4x74f"><span>5190</span></td><td id="LC5190" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> __awaiter(<span class="code-keyword">this</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L5191" class="css-a4x74f"><span>5191</span></td><td id="LC5191" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> room, options, targetRoom;
</code></td></tr><tr><td id="L5192" class="css-a4x74f"><span>5192</span></td><td id="LC5192" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L5193" class="css-a4x74f"><span>5193</span></td><td id="LC5193" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> __generator(<span class="code-keyword">this</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_a</span>) </span>{
</code></td></tr><tr><td id="L5194" class="css-a4x74f"><span>5194</span></td><td id="LC5194" class="css-1dcdqdg"><code>                    room = <span class="code-keyword">this</span>.createRoom(response.room.name, rootSchema);
</code></td></tr><tr><td id="L5195" class="css-a4x74f"><span>5195</span></td><td id="LC5195" class="css-1dcdqdg"><code>                    room.roomId = response.room.roomId;
</code></td></tr><tr><td id="L5196" class="css-a4x74f"><span>5196</span></td><td id="LC5196" class="css-1dcdqdg"><code>                    room.sessionId = response.sessionId;
</code></td></tr><tr><td id="L5197" class="css-a4x74f"><span>5197</span></td><td id="LC5197" class="css-1dcdqdg"><code>                    options = { <span class="code-attr">sessionId</span>: room.sessionId };
</code></td></tr><tr><td id="L5198" class="css-a4x74f"><span>5198</span></td><td id="LC5198" class="css-1dcdqdg"><code>                    <span class="code-comment">// forward "reconnection token" in case of reconnection.</span>
</code></td></tr><tr><td id="L5199" class="css-a4x74f"><span>5199</span></td><td id="LC5199" class="css-1dcdqdg"><code>                    <span class="code-keyword">if</span> (response.reconnectionToken) {
</code></td></tr><tr><td id="L5200" class="css-a4x74f"><span>5200</span></td><td id="LC5200" class="css-1dcdqdg"><code>                        options.reconnectionToken = response.reconnectionToken;
</code></td></tr><tr><td id="L5201" class="css-a4x74f"><span>5201</span></td><td id="LC5201" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L5202" class="css-a4x74f"><span>5202</span></td><td id="LC5202" class="css-1dcdqdg"><code>                    targetRoom = reuseRoomInstance || room;
</code></td></tr><tr><td id="L5203" class="css-a4x74f"><span>5203</span></td><td id="LC5203" class="css-1dcdqdg"><code>                    room.connect(<span class="code-keyword">this</span>.buildEndpoint(response.room, options), response.devMode &amp;&amp; (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{ <span class="code-keyword">return</span> __awaiter(_this, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L5204" class="css-a4x74f"><span>5204</span></td><td id="LC5204" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> retryCount, retryMaxRetries, retryReconnection;
</code></td></tr><tr><td id="L5205" class="css-a4x74f"><span>5205</span></td><td id="LC5205" class="css-1dcdqdg"><code>                        <span class="code-keyword">var</span> _this = <span class="code-keyword">this</span>;
</code></td></tr><tr><td id="L5206" class="css-a4x74f"><span>5206</span></td><td id="LC5206" class="css-1dcdqdg"><code>                        <span class="code-keyword">return</span> __generator(<span class="code-keyword">this</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_a</span>) </span>{
</code></td></tr><tr><td id="L5207" class="css-a4x74f"><span>5207</span></td><td id="LC5207" class="css-1dcdqdg"><code>                            <span class="code-built_in">console</span>.info(<span class="code-string">"[Colyseus devMode]: "</span>.concat(<span class="code-built_in">String</span>.fromCodePoint(<span class="code-number">0x1F504</span>), <span class="code-string">" Re-establishing connection with room id '"</span>).concat(room.roomId, <span class="code-string">"'..."</span>)); <span class="code-comment">// </span>
</code></td></tr><tr><td id="L5208" class="css-a4x74f"><span>5208</span></td><td id="LC5208" class="css-1dcdqdg"><code>                            retryCount = <span class="code-number">0</span>;
</code></td></tr><tr><td id="L5209" class="css-a4x74f"><span>5209</span></td><td id="LC5209" class="css-1dcdqdg"><code>                            retryMaxRetries = <span class="code-number">8</span>;
</code></td></tr><tr><td id="L5210" class="css-a4x74f"><span>5210</span></td><td id="LC5210" class="css-1dcdqdg"><code>                            retryReconnection = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{ <span class="code-keyword">return</span> __awaiter(_this, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L5211" class="css-a4x74f"><span>5211</span></td><td id="LC5211" class="css-1dcdqdg"><code>                                <span class="code-keyword">return</span> __generator(<span class="code-keyword">this</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_a</span>) </span>{
</code></td></tr><tr><td id="L5212" class="css-a4x74f"><span>5212</span></td><td id="LC5212" class="css-1dcdqdg"><code>                                    <span class="code-keyword">switch</span> (_a.label) {
</code></td></tr><tr><td id="L5213" class="css-a4x74f"><span>5213</span></td><td id="LC5213" class="css-1dcdqdg"><code>                                        <span class="code-keyword">case</span> <span class="code-number">0</span>:
</code></td></tr><tr><td id="L5214" class="css-a4x74f"><span>5214</span></td><td id="LC5214" class="css-1dcdqdg"><code>                                            retryCount++;
</code></td></tr><tr><td id="L5215" class="css-a4x74f"><span>5215</span></td><td id="LC5215" class="css-1dcdqdg"><code>                                            _a.label = <span class="code-number">1</span>;
</code></td></tr><tr><td id="L5216" class="css-a4x74f"><span>5216</span></td><td id="LC5216" class="css-1dcdqdg"><code>                                        <span class="code-keyword">case</span> <span class="code-number">1</span>:
</code></td></tr><tr><td id="L5217" class="css-a4x74f"><span>5217</span></td><td id="LC5217" class="css-1dcdqdg"><code>                                            _a.trys.push([<span class="code-number">1</span>, <span class="code-number">3</span>, , <span class="code-number">4</span>]);
</code></td></tr><tr><td id="L5218" class="css-a4x74f"><span>5218</span></td><td id="LC5218" class="css-1dcdqdg"><code>                                            <span class="code-keyword">return</span> [<span class="code-number">4</span> <span class="code-comment">/*yield*/</span>, <span class="code-keyword">this</span>.consumeSeatReservation(response, rootSchema, targetRoom)];
</code></td></tr><tr><td id="L5219" class="css-a4x74f"><span>5219</span></td><td id="LC5219" class="css-1dcdqdg"><code>                                        <span class="code-keyword">case</span> <span class="code-number">2</span>:
</code></td></tr><tr><td id="L5220" class="css-a4x74f"><span>5220</span></td><td id="LC5220" class="css-1dcdqdg"><code>                                            _a.sent();
</code></td></tr><tr><td id="L5221" class="css-a4x74f"><span>5221</span></td><td id="LC5221" class="css-1dcdqdg"><code>                                            <span class="code-built_in">console</span>.info(<span class="code-string">"[Colyseus devMode]: "</span>.concat(<span class="code-built_in">String</span>.fromCodePoint(<span class="code-number">0x2705</span>), <span class="code-string">" Successfully re-established connection with room '"</span>).concat(room.roomId, <span class="code-string">"'"</span>)); <span class="code-comment">// </span>
</code></td></tr><tr><td id="L5222" class="css-a4x74f"><span>5222</span></td><td id="LC5222" class="css-1dcdqdg"><code>                                            <span class="code-keyword">return</span> [<span class="code-number">3</span> <span class="code-comment">/*break*/</span>, <span class="code-number">4</span>];
</code></td></tr><tr><td id="L5223" class="css-a4x74f"><span>5223</span></td><td id="LC5223" class="css-1dcdqdg"><code>                                        <span class="code-keyword">case</span> <span class="code-number">3</span>:
</code></td></tr><tr><td id="L5224" class="css-a4x74f"><span>5224</span></td><td id="LC5224" class="css-1dcdqdg"><code>                                            _a.sent();
</code></td></tr><tr><td id="L5225" class="css-a4x74f"><span>5225</span></td><td id="LC5225" class="css-1dcdqdg"><code>                                            <span class="code-keyword">if</span> (retryCount &lt; retryMaxRetries) {
</code></td></tr><tr><td id="L5226" class="css-a4x74f"><span>5226</span></td><td id="LC5226" class="css-1dcdqdg"><code>                                                <span class="code-built_in">console</span>.info(<span class="code-string">"[Colyseus devMode]: "</span>.concat(<span class="code-built_in">String</span>.fromCodePoint(<span class="code-number">0x1F504</span>), <span class="code-string">" retrying... ("</span>).concat(retryCount, <span class="code-string">" out of "</span>).concat(retryMaxRetries, <span class="code-string">")"</span>)); <span class="code-comment">// </span>
</code></td></tr><tr><td id="L5227" class="css-a4x74f"><span>5227</span></td><td id="LC5227" class="css-1dcdqdg"><code>                                                setTimeout(retryReconnection, <span class="code-number">2000</span>);
</code></td></tr><tr><td id="L5228" class="css-a4x74f"><span>5228</span></td><td id="LC5228" class="css-1dcdqdg"><code>                                            }
</code></td></tr><tr><td id="L5229" class="css-a4x74f"><span>5229</span></td><td id="LC5229" class="css-1dcdqdg"><code>                                            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L5230" class="css-a4x74f"><span>5230</span></td><td id="LC5230" class="css-1dcdqdg"><code>                                                <span class="code-built_in">console</span>.info(<span class="code-string">"[Colyseus devMode]: "</span>.concat(<span class="code-built_in">String</span>.fromCodePoint(<span class="code-number">0x274C</span>), <span class="code-string">" Failed to reconnect. Is your server running? Please check server logs."</span>)); <span class="code-comment">// </span>
</code></td></tr><tr><td id="L5231" class="css-a4x74f"><span>5231</span></td><td id="LC5231" class="css-1dcdqdg"><code>                                            }
</code></td></tr><tr><td id="L5232" class="css-a4x74f"><span>5232</span></td><td id="LC5232" class="css-1dcdqdg"><code>                                            <span class="code-keyword">return</span> [<span class="code-number">3</span> <span class="code-comment">/*break*/</span>, <span class="code-number">4</span>];
</code></td></tr><tr><td id="L5233" class="css-a4x74f"><span>5233</span></td><td id="LC5233" class="css-1dcdqdg"><code>                                        <span class="code-keyword">case</span> <span class="code-number">4</span>: <span class="code-keyword">return</span> [<span class="code-number">2</span> <span class="code-comment">/*return*/</span>];
</code></td></tr><tr><td id="L5234" class="css-a4x74f"><span>5234</span></td><td id="LC5234" class="css-1dcdqdg"><code>                                    }
</code></td></tr><tr><td id="L5235" class="css-a4x74f"><span>5235</span></td><td id="LC5235" class="css-1dcdqdg"><code>                                });
</code></td></tr><tr><td id="L5236" class="css-a4x74f"><span>5236</span></td><td id="LC5236" class="css-1dcdqdg"><code>                            }); };
</code></td></tr><tr><td id="L5237" class="css-a4x74f"><span>5237</span></td><td id="LC5237" class="css-1dcdqdg"><code>                            setTimeout(retryReconnection, <span class="code-number">2000</span>);
</code></td></tr><tr><td id="L5238" class="css-a4x74f"><span>5238</span></td><td id="LC5238" class="css-1dcdqdg"><code>                            <span class="code-keyword">return</span> [<span class="code-number">2</span> <span class="code-comment">/*return*/</span>];
</code></td></tr><tr><td id="L5239" class="css-a4x74f"><span>5239</span></td><td id="LC5239" class="css-1dcdqdg"><code>                        });
</code></td></tr><tr><td id="L5240" class="css-a4x74f"><span>5240</span></td><td id="LC5240" class="css-1dcdqdg"><code>                    }); }), targetRoom);
</code></td></tr><tr><td id="L5241" class="css-a4x74f"><span>5241</span></td><td id="LC5241" class="css-1dcdqdg"><code>                    <span class="code-keyword">return</span> [<span class="code-number">2</span> <span class="code-comment">/*return*/</span>, <span class="code-keyword">new</span> <span class="code-built_in">Promise</span>(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">resolve, reject</span>) </span>{
</code></td></tr><tr><td id="L5242" class="css-a4x74f"><span>5242</span></td><td id="LC5242" class="css-1dcdqdg"><code>                            <span class="code-keyword">var</span> onError = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">code, message</span>) </span>{ <span class="code-keyword">return</span> reject(<span class="code-keyword">new</span> ServerError(code, message)); };
</code></td></tr><tr><td id="L5243" class="css-a4x74f"><span>5243</span></td><td id="LC5243" class="css-1dcdqdg"><code>                            targetRoom.onError.once(onError);
</code></td></tr><tr><td id="L5244" class="css-a4x74f"><span>5244</span></td><td id="LC5244" class="css-1dcdqdg"><code>                            targetRoom[<span class="code-string">'onJoin'</span>].once(<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L5245" class="css-a4x74f"><span>5245</span></td><td id="LC5245" class="css-1dcdqdg"><code>                                targetRoom.onError.remove(onError);
</code></td></tr><tr><td id="L5246" class="css-a4x74f"><span>5246</span></td><td id="LC5246" class="css-1dcdqdg"><code>                                resolve(targetRoom);
</code></td></tr><tr><td id="L5247" class="css-a4x74f"><span>5247</span></td><td id="LC5247" class="css-1dcdqdg"><code>                            });
</code></td></tr><tr><td id="L5248" class="css-a4x74f"><span>5248</span></td><td id="LC5248" class="css-1dcdqdg"><code>                        })];
</code></td></tr><tr><td id="L5249" class="css-a4x74f"><span>5249</span></td><td id="LC5249" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L5250" class="css-a4x74f"><span>5250</span></td><td id="LC5250" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L5251" class="css-a4x74f"><span>5251</span></td><td id="LC5251" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L5252" class="css-a4x74f"><span>5252</span></td><td id="LC5252" class="css-1dcdqdg"><code>        Client.prototype.createMatchMakeRequest = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">method, roomName, options, rootSchema, reuseRoomInstance</span>) </span>{
</code></td></tr><tr><td id="L5253" class="css-a4x74f"><span>5253</span></td><td id="LC5253" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (options === <span class="code-keyword">void</span> <span class="code-number">0</span>) { options = {}; }
</code></td></tr><tr><td id="L5254" class="css-a4x74f"><span>5254</span></td><td id="LC5254" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> __awaiter(<span class="code-keyword">this</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-keyword">void</span> <span class="code-number">0</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L5255" class="css-a4x74f"><span>5255</span></td><td id="LC5255" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> response;
</code></td></tr><tr><td id="L5256" class="css-a4x74f"><span>5256</span></td><td id="LC5256" class="css-1dcdqdg"><code>                <span class="code-keyword">return</span> __generator(<span class="code-keyword">this</span>, <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">_a</span>) </span>{
</code></td></tr><tr><td id="L5257" class="css-a4x74f"><span>5257</span></td><td id="LC5257" class="css-1dcdqdg"><code>                    <span class="code-keyword">switch</span> (_a.label) {
</code></td></tr><tr><td id="L5258" class="css-a4x74f"><span>5258</span></td><td id="LC5258" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">0</span>: <span class="code-keyword">return</span> [<span class="code-number">4</span> <span class="code-comment">/*yield*/</span>, <span class="code-keyword">this</span>.http.post(<span class="code-string">"matchmake/"</span>.concat(method, <span class="code-string">"/"</span>).concat(roomName), {
</code></td></tr><tr><td id="L5259" class="css-a4x74f"><span>5259</span></td><td id="LC5259" class="css-1dcdqdg"><code>                                headers: {
</code></td></tr><tr><td id="L5260" class="css-a4x74f"><span>5260</span></td><td id="LC5260" class="css-1dcdqdg"><code>                                    <span class="code-string">'Accept'</span>: <span class="code-string">'application/json'</span>,
</code></td></tr><tr><td id="L5261" class="css-a4x74f"><span>5261</span></td><td id="LC5261" class="css-1dcdqdg"><code>                                    <span class="code-string">'Content-Type'</span>: <span class="code-string">'application/json'</span>
</code></td></tr><tr><td id="L5262" class="css-a4x74f"><span>5262</span></td><td id="LC5262" class="css-1dcdqdg"><code>                                },
</code></td></tr><tr><td id="L5263" class="css-a4x74f"><span>5263</span></td><td id="LC5263" class="css-1dcdqdg"><code>                                body: <span class="code-built_in">JSON</span>.stringify(options)
</code></td></tr><tr><td id="L5264" class="css-a4x74f"><span>5264</span></td><td id="LC5264" class="css-1dcdqdg"><code>                            })];
</code></td></tr><tr><td id="L5265" class="css-a4x74f"><span>5265</span></td><td id="LC5265" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">1</span>:
</code></td></tr><tr><td id="L5266" class="css-a4x74f"><span>5266</span></td><td id="LC5266" class="css-1dcdqdg"><code>                            response = (_a.sent()).data;
</code></td></tr><tr><td id="L5267" class="css-a4x74f"><span>5267</span></td><td id="LC5267" class="css-1dcdqdg"><code>                            <span class="code-comment">// <span class="code-doctag">FIXME:</span> HTTP class is already handling this as ServerError.</span>
</code></td></tr><tr><td id="L5268" class="css-a4x74f"><span>5268</span></td><td id="LC5268" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (response.error) {
</code></td></tr><tr><td id="L5269" class="css-a4x74f"><span>5269</span></td><td id="LC5269" class="css-1dcdqdg"><code>                                <span class="code-keyword">throw</span> <span class="code-keyword">new</span> MatchMakeError(response.error, response.code);
</code></td></tr><tr><td id="L5270" class="css-a4x74f"><span>5270</span></td><td id="LC5270" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L5271" class="css-a4x74f"><span>5271</span></td><td id="LC5271" class="css-1dcdqdg"><code>                            <span class="code-comment">// forward reconnection token during "reconnect" methods.</span>
</code></td></tr><tr><td id="L5272" class="css-a4x74f"><span>5272</span></td><td id="LC5272" class="css-1dcdqdg"><code>                            <span class="code-keyword">if</span> (method === <span class="code-string">"reconnect"</span>) {
</code></td></tr><tr><td id="L5273" class="css-a4x74f"><span>5273</span></td><td id="LC5273" class="css-1dcdqdg"><code>                                response.reconnectionToken = options.reconnectionToken;
</code></td></tr><tr><td id="L5274" class="css-a4x74f"><span>5274</span></td><td id="LC5274" class="css-1dcdqdg"><code>                            }
</code></td></tr><tr><td id="L5275" class="css-a4x74f"><span>5275</span></td><td id="LC5275" class="css-1dcdqdg"><code>                            <span class="code-keyword">return</span> [<span class="code-number">4</span> <span class="code-comment">/*yield*/</span>, <span class="code-keyword">this</span>.consumeSeatReservation(response, rootSchema, reuseRoomInstance)];
</code></td></tr><tr><td id="L5276" class="css-a4x74f"><span>5276</span></td><td id="LC5276" class="css-1dcdqdg"><code>                        <span class="code-keyword">case</span> <span class="code-number">2</span>: <span class="code-keyword">return</span> [<span class="code-number">2</span> <span class="code-comment">/*return*/</span>, _a.sent()];
</code></td></tr><tr><td id="L5277" class="css-a4x74f"><span>5277</span></td><td id="LC5277" class="css-1dcdqdg"><code>                    }
</code></td></tr><tr><td id="L5278" class="css-a4x74f"><span>5278</span></td><td id="LC5278" class="css-1dcdqdg"><code>                });
</code></td></tr><tr><td id="L5279" class="css-a4x74f"><span>5279</span></td><td id="LC5279" class="css-1dcdqdg"><code>            });
</code></td></tr><tr><td id="L5280" class="css-a4x74f"><span>5280</span></td><td id="LC5280" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L5281" class="css-a4x74f"><span>5281</span></td><td id="LC5281" class="css-1dcdqdg"><code>        Client.prototype.createRoom = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">roomName, rootSchema</span>) </span>{
</code></td></tr><tr><td id="L5282" class="css-a4x74f"><span>5282</span></td><td id="LC5282" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> <span class="code-keyword">new</span> Room(roomName, rootSchema);
</code></td></tr><tr><td id="L5283" class="css-a4x74f"><span>5283</span></td><td id="LC5283" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L5284" class="css-a4x74f"><span>5284</span></td><td id="LC5284" class="css-1dcdqdg"><code>        Client.prototype.buildEndpoint = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">room, options</span>) </span>{
</code></td></tr><tr><td id="L5285" class="css-a4x74f"><span>5285</span></td><td id="LC5285" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (options === <span class="code-keyword">void</span> <span class="code-number">0</span>) { options = {}; }
</code></td></tr><tr><td id="L5286" class="css-a4x74f"><span>5286</span></td><td id="LC5286" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> params = [];
</code></td></tr><tr><td id="L5287" class="css-a4x74f"><span>5287</span></td><td id="LC5287" class="css-1dcdqdg"><code>            <span class="code-comment">// append provided options</span>
</code></td></tr><tr><td id="L5288" class="css-a4x74f"><span>5288</span></td><td id="LC5288" class="css-1dcdqdg"><code>            <span class="code-keyword">for</span> (<span class="code-keyword">var</span> name_1 <span class="code-keyword">in</span> options) {
</code></td></tr><tr><td id="L5289" class="css-a4x74f"><span>5289</span></td><td id="LC5289" class="css-1dcdqdg"><code>                <span class="code-keyword">if</span> (!options.hasOwnProperty(name_1)) {
</code></td></tr><tr><td id="L5290" class="css-a4x74f"><span>5290</span></td><td id="LC5290" class="css-1dcdqdg"><code>                    <span class="code-keyword">continue</span>;
</code></td></tr><tr><td id="L5291" class="css-a4x74f"><span>5291</span></td><td id="LC5291" class="css-1dcdqdg"><code>                }
</code></td></tr><tr><td id="L5292" class="css-a4x74f"><span>5292</span></td><td id="LC5292" class="css-1dcdqdg"><code>                params.push(<span class="code-string">""</span>.concat(name_1, <span class="code-string">"="</span>).concat(options[name_1]));
</code></td></tr><tr><td id="L5293" class="css-a4x74f"><span>5293</span></td><td id="LC5293" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L5294" class="css-a4x74f"><span>5294</span></td><td id="LC5294" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> endpoint = (<span class="code-keyword">this</span>.settings.secure)
</code></td></tr><tr><td id="L5295" class="css-a4x74f"><span>5295</span></td><td id="LC5295" class="css-1dcdqdg"><code>                ? <span class="code-string">"wss://"</span>
</code></td></tr><tr><td id="L5296" class="css-a4x74f"><span>5296</span></td><td id="LC5296" class="css-1dcdqdg"><code>                : <span class="code-string">"ws://"</span>;
</code></td></tr><tr><td id="L5297" class="css-a4x74f"><span>5297</span></td><td id="LC5297" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (room.publicAddress) {
</code></td></tr><tr><td id="L5298" class="css-a4x74f"><span>5298</span></td><td id="LC5298" class="css-1dcdqdg"><code>                endpoint += <span class="code-string">""</span>.concat(room.publicAddress);
</code></td></tr><tr><td id="L5299" class="css-a4x74f"><span>5299</span></td><td id="LC5299" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L5300" class="css-a4x74f"><span>5300</span></td><td id="LC5300" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L5301" class="css-a4x74f"><span>5301</span></td><td id="LC5301" class="css-1dcdqdg"><code>                endpoint += <span class="code-string">""</span>.concat(<span class="code-keyword">this</span>.settings.hostname).concat(<span class="code-keyword">this</span>.getEndpointPort()).concat(<span class="code-keyword">this</span>.settings.pathname);
</code></td></tr><tr><td id="L5302" class="css-a4x74f"><span>5302</span></td><td id="LC5302" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L5303" class="css-a4x74f"><span>5303</span></td><td id="LC5303" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> endpointURL = <span class="code-string">""</span>.concat(endpoint, <span class="code-string">"/"</span>).concat(room.processId, <span class="code-string">"/"</span>).concat(room.roomId, <span class="code-string">"?"</span>).concat(params.join(<span class="code-string">'&amp;'</span>));
</code></td></tr><tr><td id="L5304" class="css-a4x74f"><span>5304</span></td><td id="LC5304" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> (<span class="code-keyword">this</span>.urlBuilder)
</code></td></tr><tr><td id="L5305" class="css-a4x74f"><span>5305</span></td><td id="LC5305" class="css-1dcdqdg"><code>                ? <span class="code-keyword">this</span>.urlBuilder(<span class="code-keyword">new</span> URL(endpointURL))
</code></td></tr><tr><td id="L5306" class="css-a4x74f"><span>5306</span></td><td id="LC5306" class="css-1dcdqdg"><code>                : endpointURL;
</code></td></tr><tr><td id="L5307" class="css-a4x74f"><span>5307</span></td><td id="LC5307" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L5308" class="css-a4x74f"><span>5308</span></td><td id="LC5308" class="css-1dcdqdg"><code>        Client.prototype.getHttpEndpoint = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">segments</span>) </span>{
</code></td></tr><tr><td id="L5309" class="css-a4x74f"><span>5309</span></td><td id="LC5309" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (segments === <span class="code-keyword">void</span> <span class="code-number">0</span>) { segments = <span class="code-string">''</span>; }
</code></td></tr><tr><td id="L5310" class="css-a4x74f"><span>5310</span></td><td id="LC5310" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> path = segments.startsWith(<span class="code-string">"/"</span>) ? segments : <span class="code-string">"/"</span>.concat(segments);
</code></td></tr><tr><td id="L5311" class="css-a4x74f"><span>5311</span></td><td id="LC5311" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> endpointURL = <span class="code-string">""</span>.concat((<span class="code-keyword">this</span>.settings.secure) ? <span class="code-string">"https"</span> : <span class="code-string">"http"</span>, <span class="code-string">"://"</span>).concat(<span class="code-keyword">this</span>.settings.hostname).concat(<span class="code-keyword">this</span>.getEndpointPort()).concat(<span class="code-keyword">this</span>.settings.pathname).concat(path);
</code></td></tr><tr><td id="L5312" class="css-a4x74f"><span>5312</span></td><td id="LC5312" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> (<span class="code-keyword">this</span>.urlBuilder)
</code></td></tr><tr><td id="L5313" class="css-a4x74f"><span>5313</span></td><td id="LC5313" class="css-1dcdqdg"><code>                ? <span class="code-keyword">this</span>.urlBuilder(<span class="code-keyword">new</span> URL(endpointURL))
</code></td></tr><tr><td id="L5314" class="css-a4x74f"><span>5314</span></td><td id="LC5314" class="css-1dcdqdg"><code>                : endpointURL;
</code></td></tr><tr><td id="L5315" class="css-a4x74f"><span>5315</span></td><td id="LC5315" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L5316" class="css-a4x74f"><span>5316</span></td><td id="LC5316" class="css-1dcdqdg"><code>        Client.prototype.getEndpointPort = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L5317" class="css-a4x74f"><span>5317</span></td><td id="LC5317" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> (<span class="code-keyword">this</span>.settings.port !== <span class="code-number">80</span> &amp;&amp; <span class="code-keyword">this</span>.settings.port !== <span class="code-number">443</span>)
</code></td></tr><tr><td id="L5318" class="css-a4x74f"><span>5318</span></td><td id="LC5318" class="css-1dcdqdg"><code>                ? <span class="code-string">":"</span>.concat(<span class="code-keyword">this</span>.settings.port)
</code></td></tr><tr><td id="L5319" class="css-a4x74f"><span>5319</span></td><td id="LC5319" class="css-1dcdqdg"><code>                : <span class="code-string">""</span>;
</code></td></tr><tr><td id="L5320" class="css-a4x74f"><span>5320</span></td><td id="LC5320" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L5321" class="css-a4x74f"><span>5321</span></td><td id="LC5321" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> Client;
</code></td></tr><tr><td id="L5322" class="css-a4x74f"><span>5322</span></td><td id="LC5322" class="css-1dcdqdg"><code>    }());
</code></td></tr><tr><td id="L5323" class="css-a4x74f"><span>5323</span></td><td id="LC5323" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L5324" class="css-a4x74f"><span>5324</span></td><td id="LC5324" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> SchemaSerializer = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L5325" class="css-a4x74f"><span>5325</span></td><td id="LC5325" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">SchemaSerializer</span>(<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L5326" class="css-a4x74f"><span>5326</span></td><td id="LC5326" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L5327" class="css-a4x74f"><span>5327</span></td><td id="LC5327" class="css-1dcdqdg"><code>        SchemaSerializer.prototype.setState = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">rawState</span>) </span>{
</code></td></tr><tr><td id="L5328" class="css-a4x74f"><span>5328</span></td><td id="LC5328" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> <span class="code-keyword">this</span>.state.decode(rawState);
</code></td></tr><tr><td id="L5329" class="css-a4x74f"><span>5329</span></td><td id="LC5329" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L5330" class="css-a4x74f"><span>5330</span></td><td id="LC5330" class="css-1dcdqdg"><code>        SchemaSerializer.prototype.getState = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L5331" class="css-a4x74f"><span>5331</span></td><td id="LC5331" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> <span class="code-keyword">this</span>.state;
</code></td></tr><tr><td id="L5332" class="css-a4x74f"><span>5332</span></td><td id="LC5332" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L5333" class="css-a4x74f"><span>5333</span></td><td id="LC5333" class="css-1dcdqdg"><code>        SchemaSerializer.prototype.patch = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">patches</span>) </span>{
</code></td></tr><tr><td id="L5334" class="css-a4x74f"><span>5334</span></td><td id="LC5334" class="css-1dcdqdg"><code>            <span class="code-keyword">return</span> <span class="code-keyword">this</span>.state.decode(patches);
</code></td></tr><tr><td id="L5335" class="css-a4x74f"><span>5335</span></td><td id="LC5335" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L5336" class="css-a4x74f"><span>5336</span></td><td id="LC5336" class="css-1dcdqdg"><code>        SchemaSerializer.prototype.teardown = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L5337" class="css-a4x74f"><span>5337</span></td><td id="LC5337" class="css-1dcdqdg"><code>            <span class="code-keyword">var</span> _a, _b;
</code></td></tr><tr><td id="L5338" class="css-a4x74f"><span>5338</span></td><td id="LC5338" class="css-1dcdqdg"><code>            (_b = (_a = <span class="code-keyword">this</span>.state) === <span class="code-literal">null</span> || _a === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _a[<span class="code-string">'$changes'</span>]) === <span class="code-literal">null</span> || _b === <span class="code-keyword">void</span> <span class="code-number">0</span> ? <span class="code-keyword">void</span> <span class="code-number">0</span> : _b.root.clearRefs();
</code></td></tr><tr><td id="L5339" class="css-a4x74f"><span>5339</span></td><td id="LC5339" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L5340" class="css-a4x74f"><span>5340</span></td><td id="LC5340" class="css-1dcdqdg"><code>        SchemaSerializer.prototype.handshake = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">bytes, it</span>) </span>{
</code></td></tr><tr><td id="L5341" class="css-a4x74f"><span>5341</span></td><td id="LC5341" class="css-1dcdqdg"><code>            <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.state) {
</code></td></tr><tr><td id="L5342" class="css-a4x74f"><span>5342</span></td><td id="LC5342" class="css-1dcdqdg"><code>                <span class="code-comment">// <span class="code-doctag">TODO:</span> validate client/server definitinos</span>
</code></td></tr><tr><td id="L5343" class="css-a4x74f"><span>5343</span></td><td id="LC5343" class="css-1dcdqdg"><code>                <span class="code-keyword">var</span> reflection = <span class="code-keyword">new</span> umd.Reflection();
</code></td></tr><tr><td id="L5344" class="css-a4x74f"><span>5344</span></td><td id="LC5344" class="css-1dcdqdg"><code>                reflection.decode(bytes, it);
</code></td></tr><tr><td id="L5345" class="css-a4x74f"><span>5345</span></td><td id="LC5345" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L5346" class="css-a4x74f"><span>5346</span></td><td id="LC5346" class="css-1dcdqdg"><code>            <span class="code-keyword">else</span> {
</code></td></tr><tr><td id="L5347" class="css-a4x74f"><span>5347</span></td><td id="LC5347" class="css-1dcdqdg"><code>                <span class="code-comment">// initialize reflected state from server</span>
</code></td></tr><tr><td id="L5348" class="css-a4x74f"><span>5348</span></td><td id="LC5348" class="css-1dcdqdg"><code>                <span class="code-keyword">this</span>.state = umd.Reflection.decode(bytes, it);
</code></td></tr><tr><td id="L5349" class="css-a4x74f"><span>5349</span></td><td id="LC5349" class="css-1dcdqdg"><code>            }
</code></td></tr><tr><td id="L5350" class="css-a4x74f"><span>5350</span></td><td id="LC5350" class="css-1dcdqdg"><code>        };
</code></td></tr><tr><td id="L5351" class="css-a4x74f"><span>5351</span></td><td id="LC5351" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> SchemaSerializer;
</code></td></tr><tr><td id="L5352" class="css-a4x74f"><span>5352</span></td><td id="LC5352" class="css-1dcdqdg"><code>    }());
</code></td></tr><tr><td id="L5353" class="css-a4x74f"><span>5353</span></td><td id="LC5353" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L5354" class="css-a4x74f"><span>5354</span></td><td id="LC5354" class="css-1dcdqdg"><code>    <span class="code-keyword">var</span> NoneSerializer = <span class="code-comment">/** @class */</span> (<span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L5355" class="css-a4x74f"><span>5355</span></td><td id="LC5355" class="css-1dcdqdg"><code>        <span class="code-function"><span class="code-keyword">function</span> <span class="code-title">NoneSerializer</span>(<span class="code-params"></span>) </span>{
</code></td></tr><tr><td id="L5356" class="css-a4x74f"><span>5356</span></td><td id="LC5356" class="css-1dcdqdg"><code>        }
</code></td></tr><tr><td id="L5357" class="css-a4x74f"><span>5357</span></td><td id="LC5357" class="css-1dcdqdg"><code>        NoneSerializer.prototype.setState = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">rawState</span>) </span>{ };
</code></td></tr><tr><td id="L5358" class="css-a4x74f"><span>5358</span></td><td id="LC5358" class="css-1dcdqdg"><code>        NoneSerializer.prototype.getState = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{ <span class="code-keyword">return</span> <span class="code-literal">null</span>; };
</code></td></tr><tr><td id="L5359" class="css-a4x74f"><span>5359</span></td><td id="LC5359" class="css-1dcdqdg"><code>        NoneSerializer.prototype.patch = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">patches</span>) </span>{ };
</code></td></tr><tr><td id="L5360" class="css-a4x74f"><span>5360</span></td><td id="LC5360" class="css-1dcdqdg"><code>        NoneSerializer.prototype.teardown = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params"></span>) </span>{ };
</code></td></tr><tr><td id="L5361" class="css-a4x74f"><span>5361</span></td><td id="LC5361" class="css-1dcdqdg"><code>        NoneSerializer.prototype.handshake = <span class="code-function"><span class="code-keyword">function</span> (<span class="code-params">bytes</span>) </span>{ };
</code></td></tr><tr><td id="L5362" class="css-a4x74f"><span>5362</span></td><td id="LC5362" class="css-1dcdqdg"><code>        <span class="code-keyword">return</span> NoneSerializer;
</code></td></tr><tr><td id="L5363" class="css-a4x74f"><span>5363</span></td><td id="LC5363" class="css-1dcdqdg"><code>    }());
</code></td></tr><tr><td id="L5364" class="css-a4x74f"><span>5364</span></td><td id="LC5364" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L5365" class="css-a4x74f"><span>5365</span></td><td id="LC5365" class="css-1dcdqdg"><code>    registerSerializer(<span class="code-string">'schema'</span>, SchemaSerializer);
</code></td></tr><tr><td id="L5366" class="css-a4x74f"><span>5366</span></td><td id="LC5366" class="css-1dcdqdg"><code>    registerSerializer(<span class="code-string">'none'</span>, NoneSerializer);
</code></td></tr><tr><td id="L5367" class="css-a4x74f"><span>5367</span></td><td id="LC5367" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L5368" class="css-a4x74f"><span>5368</span></td><td id="LC5368" class="css-1dcdqdg"><code>    exports.Auth = Auth;
</code></td></tr><tr><td id="L5369" class="css-a4x74f"><span>5369</span></td><td id="LC5369" class="css-1dcdqdg"><code>    exports.Client = Client;
</code></td></tr><tr><td id="L5370" class="css-a4x74f"><span>5370</span></td><td id="LC5370" class="css-1dcdqdg"><code>    exports.Room = Room;
</code></td></tr><tr><td id="L5371" class="css-a4x74f"><span>5371</span></td><td id="LC5371" class="css-1dcdqdg"><code>    exports.SchemaSerializer = SchemaSerializer;
</code></td></tr><tr><td id="L5372" class="css-a4x74f"><span>5372</span></td><td id="LC5372" class="css-1dcdqdg"><code>    exports.registerSerializer = registerSerializer;
</code></td></tr><tr><td id="L5373" class="css-a4x74f"><span>5373</span></td><td id="LC5373" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L5374" class="css-a4x74f"><span>5374</span></td><td id="LC5374" class="css-1dcdqdg"><code>    <span class="code-built_in">Object</span>.defineProperty(exports, <span class="code-string">'__esModule'</span>, { <span class="code-attr">value</span>: <span class="code-literal">true</span> });
</code></td></tr><tr><td id="L5375" class="css-a4x74f"><span>5375</span></td><td id="LC5375" class="css-1dcdqdg"><code>
</code></td></tr><tr><td id="L5376" class="css-a4x74f"><span>5376</span></td><td id="LC5376" class="css-1dcdqdg"><code>}));
</code></td></tr><tr><td id="L5377" class="css-a4x74f"><span>5377</span></td><td id="LC5377" class="css-1dcdqdg"><code><span class="code-comment">//# sourceMappingURL=colyseus.js.map</span>
</code></td></tr></tbody></table></div></div></div></div><style data-emotion-css="1teho9j">.css-1teho9j{margin-top:5rem;background:black;color:#aaa;}</style><footer class="css-1teho9j"><style data-emotion-css="1ui8put">.css-1ui8put{max-width:940px;padding:10px 20px;margin:0 auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}</style><div class="css-1ui8put"><p><span>Build: <!-- -->a7ebffa</span></p><p><span> <!-- -->2024<!-- --> UNPKG</span></p><style data-emotion-css="la3nd4">.css-la3nd4{font-size:1.5rem;}</style><p class="css-la3nd4"><style data-emotion-css="bogekj">.css-bogekj{color:#aaa;display:inline-block;}.css-bogekj:hover{color:white;}</style><a href="https://twitter.com/unpkg" class="css-bogekj"><style data-emotion-css="i6dzq1">.css-i6dzq1{vertical-align:text-bottom;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="css-i6dzq1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><style data-emotion-css="3czw03">.css-3czw03{color:#aaa;display:inline-block;margin-left:1rem;}.css-3czw03:hover{color:white;}</style><a href="https://github.com/mjackson/unpkg" class="css-3czw03"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" class="css-i6dzq1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></p></div></footer></div><script src="/react@16.8.6/umd/react.production.min.js"></script><script src="/react-dom@16.8.6/umd/react-dom.production.min.js"></script><script src="/@emotion/core@10.0.6/dist/core.umd.min.js"></script><script>'use strict';(function(t,A,c){function w(){w=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var e=arguments[b],c;for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(a[c]=e[c])}return a};return w.apply(this,arguments)}function P(a,b){if(null==a)return{};var e={},c=Object.keys(a),d;for(d=0;d<c.length;d++){var h=c[d];0<=b.indexOf(h)||(e[h]=a[h])}return e}function Q(a,b){b||(b=a.slice(0));a.raw=b;return a}function R(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,
"default")?a["default"]:a}function D(a,b){return b={exports:{}},a(b,b.exports),b.exports}function J(a,b,e,c,d){for(var g in a)if(ua(a,g)){try{if("function"!==typeof a[g]){var r=Error((c||"React class")+": "+e+" type `"+g+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof a[g]+"`.");r.name="Invariant Violation";throw r;}var k=a[g](b,g,c,e,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(q){k=q}!k||k instanceof Error||K((c||"React class")+": type specification of "+
e+" `"+g+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof k+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).");if(k instanceof Error&&!(k.message in L)){L[k.message]=!0;var B=d?d():"";K("Failed "+e+" type: "+k.message+(null!=B?B:""))}}}function G(){return null}function S(a){var b,e=a.children;a=a.css;return c.jsx("div",{css:w((b={border:"1px solid #dfe2e5",
borderRadius:3},b["@media (max-width: 700px)"]={borderRightWidth:0,borderLeftWidth:0},b),a)},e)}function T(a){var b,e=a.children;a=a.css;return c.jsx("div",{css:w((b={padding:10,background:"#f6f8fa",color:"#424242",border:"1px solid #d1d5da",borderTopLeftRadius:3,borderTopRightRadius:3,margin:"-1px -1px 0",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},b["@media (max-width: 700px)"]={paddingRight:20,paddingLeft:20},b),a)},e)}function U(a){return a&&a.map(function(a,
c){return t.createElement(a.tag,z({key:c},a.attr),U(a.child))})}function E(a){return function(b){return t.createElement(va,z({attr:z({},a.attr)},b),U(a.child))}}function va(a){var b=function(b){var c=a.size||b.size||"1em";if(b.className)var e=b.className;a.className&&(e=(e?e+" ":"")+a.className);var h=a.attr,r=a.title,k=["attr","title"],B={},q;for(q in a)Object.prototype.hasOwnProperty.call(a,q)&&0>k.indexOf(q)&&(B[q]=a[q]);if(null!=a&&"function"===typeof Object.getOwnPropertySymbols){var p=0;for(q=
Object.getOwnPropertySymbols(a);p<q.length;p++)0>k.indexOf(q[p])&&(B[q[p]]=a[q[p]])}return t.createElement("svg",z({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},b.attr,h,B,{className:e,style:z({color:a.color||b.color},b.style,a.style),height:c,width:c,xmlns:"http://www.w3.org/2000/svg"}),r&&t.createElement("title",null,r),a.children)};return void 0!==V?t.createElement(V.Consumer,null,function(a){return b(a)}):b(W)}function F(a,b){var e=b.css;b=P(b,["css"]);return c.jsx(a,w({css:w({},
e,{verticalAlign:"text-bottom"})},b))}function wa(a){return F(X,a)}function xa(a){return F(Y,a)}function ya(a){return F(Z,a)}function za(a){return F(aa,a)}function Aa(a){return F(ba,a)}function ca(a){var b=a.path,e=a.details,g=Object.keys(e).reduce(function(a,b){var c=a.subdirs,g=a.files;b=e[b];"directory"===b.type?c.push(b):"file"===b.type&&g.push(b);return a},{subdirs:[],files:[]});a=g.subdirs;g=g.files;a.sort(da("path"));g.sort(da("path"));var d=[];"/"!==b&&d.push(c.jsx("tr",{key:".."},c.jsx("td",
{css:M}),c.jsx("td",{css:y},c.jsx("a",{title:"Parent directory",href:"../",css:N},"..")),c.jsx("td",{css:y}),c.jsx("td",{css:O})));a.forEach(function(a){a=a.path.substr(1<b.length?b.length+1:1);var e=a+"/";d.push(c.jsx("tr",{key:a},c.jsx("td",{css:M},c.jsx(ya,null)),c.jsx("td",{css:y},c.jsx("a",{title:a,href:e,css:N},a)),c.jsx("td",{css:y},"-"),c.jsx("td",{css:O},"-")))});g.forEach(function(a){var e=a.size,g=a.contentType;a=a.path.substr(1<b.length?b.length+1:1);d.push(c.jsx("tr",{key:a},c.jsx("td",
{css:M},"text/plain"===g||"text/markdown"===g?c.jsx(wa,null):c.jsx(xa,null)),c.jsx("td",{css:y},c.jsx("a",{title:a,href:a,css:N},a)),c.jsx("td",{css:y},ea(e)),c.jsx("td",{css:O},g)))});var h=[];0<g.length&&h.push(g.length+" file"+(1===g.length?"":"s"));0<a.length&&h.push(a.length+" folder"+(1===a.length?"":"s"));return c.jsx(S,null,c.jsx(T,null,c.jsx("span",null,h.join(", "))),c.jsx("table",{css:{width:"100%",borderCollapse:"collapse",borderRadius:2,background:"#fff","@media (max-width: 700px)":{"& th + th + th + th, & td + td + td + td":{display:"none"}},
"& tr:first-of-type td":{borderTop:0}}},c.jsx("thead",null,c.jsx("tr",null,c.jsx("th",null,c.jsx(H,null,"Icon")),c.jsx("th",null,c.jsx(H,null,"Name")),c.jsx("th",null,c.jsx(H,null,"Size")),c.jsx("th",null,c.jsx(H,null,"Content Type")))),c.jsx("tbody",null,d)))}function Ba(a){a=a.split("/");return a[a.length-1]}function Ca(a){var b=a.uri;return c.jsx("div",{css:{padding:20,textAlign:"center"}},c.jsx("img",{alt:Ba(a.path),src:b}))}function Da(a){a=a.highlights.slice(0);var b=a.length&&""===a[a.length-
1];b&&a.pop();return c.jsx("div",{className:"code-listing",css:{overflowX:"auto",overflowY:"hidden",paddingTop:5,paddingBottom:5}},c.jsx("table",{css:{border:"none",borderCollapse:"collapse",borderSpacing:0}},c.jsx("tbody",null,a.map(function(a,b){var e=b+1;return c.jsx("tr",{key:b},c.jsx("td",{id:"L"+e,css:{paddingLeft:10,paddingRight:10,color:"rgba(27,31,35,.3)",textAlign:"right",verticalAlign:"top",width:"1%",minWidth:50,userSelect:"none"}},c.jsx("span",null,e)),c.jsx("td",{id:"LC"+e,css:{paddingLeft:10,
paddingRight:10,color:"#24292e",whiteSpace:"pre"}},c.jsx("code",{dangerouslySetInnerHTML:{__html:a}})))}),!b&&c.jsx("tr",{key:"no-newline"},c.jsx("td",{css:{paddingLeft:10,paddingRight:10,color:"rgba(27,31,35,.3)",textAlign:"right",verticalAlign:"top",width:"1%",minWidth:50,userSelect:"none"}},"\\"),c.jsx("td",{css:{paddingLeft:10,color:"rgba(27,31,35,.3)",userSelect:"none"}},"No newline at end of file")))))}function Ea(){return c.jsx("div",{css:{padding:20}},c.jsx("p",{css:{textAlign:"center"}},
"No preview available."))}function fa(a){var b=a.packageName,e=a.packageVersion,g=a.path;a=a.details;var d=a.highlights,h=a.uri,r=a.language;return c.jsx(S,null,c.jsx(T,null,c.jsx("span",null,ea(a.size)),c.jsx("span",null,r),c.jsx("span",null,c.jsx("a",{href:"/"+b+"@"+e+g,css:{display:"inline-block",marginLeft:8,padding:"2px 8px",textDecoration:"none",fontWeight:600,fontSize:"0.9rem",color:"#24292e",backgroundColor:"#eff3f6",border:"1px solid rgba(27,31,35,.2)",borderRadius:3,":hover":{backgroundColor:"#e6ebf1",
borderColor:"rgba(27,31,35,.35)"},":active":{backgroundColor:"#e9ecef",borderColor:"rgba(27,31,35,.35)",boxShadow:"inset 0 0.15em 0.3em rgba(27,31,35,.15)"}}},"View Raw"))),d?c.jsx(Da,{highlights:d}):h?c.jsx(Ca,{path:g,uri:h}):c.jsx(Ea,null))}function ha(){var a=Q(["\n  .code-listing {\n    background: #fbfdff;\n    color: #383a42;\n  }\n  .code-comment,\n  .code-quote {\n    color: #a0a1a7;\n    font-style: italic;\n  }\n  .code-doctag,\n  .code-keyword,\n  .code-link,\n  .code-formula {\n    color: #a626a4;\n  }\n  .code-section,\n  .code-name,\n  .code-selector-tag,\n  .code-deletion,\n  .code-subst {\n    color: #e45649;\n  }\n  .code-literal {\n    color: #0184bb;\n  }\n  .code-string,\n  .code-regexp,\n  .code-addition,\n  .code-attribute,\n  .code-meta-string {\n    color: #50a14f;\n  }\n  .code-built_in,\n  .code-class .code-title {\n    color: #c18401;\n  }\n  .code-attr,\n  .code-variable,\n  .code-template-variable,\n  .code-type,\n  .code-selector-class,\n  .code-selector-attr,\n  .code-selector-pseudo,\n  .code-number {\n    color: #986801;\n  }\n  .code-symbol,\n  .code-bullet,\n  .code-meta,\n  .code-selector-id,\n  .code-title {\n    color: #4078f2;\n  }\n  .code-emphasis {\n    font-style: italic;\n  }\n  .code-strong {\n    font-weight: bold;\n  }\n"]);
ha=function(){return a};return a}function ia(){var a=Q(["\n  html {\n    box-sizing: border-box;\n  }\n  *,\n  *:before,\n  *:after {\n    box-sizing: inherit;\n  }\n\n  html,\n  body,\n  #root {\n    height: 100%;\n    margin: 0;\n  }\n\n  body {\n    ","\n    font-size: 16px;\n    line-height: 1.5;\n    overflow-wrap: break-word;\n    background: white;\n    color: black;\n  }\n\n  code {\n    ","\n  }\n\n  th,\n  td {\n    padding: 0;\n  }\n\n  select {\n    font-size: inherit;\n  }\n\n  #root {\n    display: flex;\n    flex-direction: column;\n  }\n"]);
ia=function(){return a};return a}function ja(a){var b=a.css;a=P(a,["css"]);return c.jsx("a",w({},a,{css:w({color:"#0076ff",textDecoration:"none",":hover":{textDecoration:"underline"}},b)}))}function Fa(){return c.jsx("header",{css:{marginTop:"2rem"}},c.jsx("h1",{css:{textAlign:"center",fontSize:"3rem",letterSpacing:"0.05em"}},c.jsx("a",{href:"/",css:{color:"#000",textDecoration:"none"}},"UNPKG")))}function Ga(a){var b=a.packageName,e=a.packageVersion,g=a.availableVersions;a=a.filename;var d=[];if("/"===
a)d.push(b);else{var h="/browse/"+b+"@"+e;d.push(c.jsx(ja,{href:h+"/"},b));b=a.replace(/^\/+/,"").replace(/\/+$/,"").split("/");a=b.pop();b.forEach(function(a){h+="/"+a;d.push(c.jsx(ja,{href:h+"/"},a))});d.push(a)}return c.jsx("header",{css:{display:"flex",flexDirection:"row",alignItems:"center","@media (max-width: 700px)":{flexDirection:"column-reverse",alignItems:"flex-start"}}},c.jsx("h1",{css:{fontSize:"1.5rem",fontWeight:"normal",flex:1,wordBreak:"break-all"}},c.jsx("nav",null,d.map(function(a,
b,e){return c.jsx(t.Fragment,{key:b},0!==b&&c.jsx("span",{css:{paddingLeft:5,paddingRight:5}},"/"),b===e.length-1?c.jsx("strong",null,a):a)}))),c.jsx(Ha,{packageVersion:e,availableVersions:g,onChange:function(a){window.location.href=window.location.href.replace("@"+e,"@"+a)}}))}function Ha(a){var b=a.onChange;return c.jsx("p",{css:{marginLeft:20,"@media (max-width: 700px)":{marginLeft:0,marginBottom:0}}},c.jsx("label",null,"Version:"," ",c.jsx("select",{name:"version",defaultValue:a.packageVersion,
onChange:function(a){b&&b(a.target.value)},css:{appearance:"none",cursor:"pointer",padding:"4px 24px 4px 8px",fontWeight:600,fontSize:"0.9em",color:"#24292e",border:"1px solid rgba(27,31,35,.2)",borderRadius:3,backgroundColor:"#eff3f6",backgroundImage:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAKCAYAAAC9vt6cAAAAAXNSR0IArs4c6QAAARFJREFUKBVjZAACNS39RhBNKrh17WI9o4quoT3Dn78HSNUMUs/CzOTI/O7Vi4dCYpJ3/jP+92BkYGAlyiBGhm8MjIxJt65e3MQM0vDu9YvLYmISILYZELOBxHABRkaGr0yMzF23r12YDFIDNgDEePv65SEhEXENBkYGFSAXuyGMjF8Z/jOsvX3tYiFIDwgwQSgIaaijnvj/P8M5IO8HsjiY/f//D4b//88A1SQhywG9jQr09PS4v/1mPAeUUPzP8B8cJowMjL+Bqu6xMQmaXL164AuyDgwDQJLa2qYSP//9vARkCoMVMzK8YeVkNbh+9uxzMB+JwGoASF5Vx0jz/98/18BqmZi171w9D2EjaaYKEwAEK00XQLdJuwAAAABJRU5ErkJggg==)",
backgroundPosition:"right 8px center",backgroundRepeat:"no-repeat",backgroundSize:"auto 25%",":hover":{backgroundColor:"#e6ebf1",borderColor:"rgba(27,31,35,.35)"},":active":{backgroundColor:"#e9ecef",borderColor:"rgba(27,31,35,.35)",boxShadow:"inset 0 0.15em 0.3em rgba(27,31,35,.15)"}}},a.availableVersions.map(function(a){return c.jsx("option",{key:a,value:a},a)}))))}function Ia(a){var b=a.packageName,e=a.packageVersion;a=a.target;return"directory"===a.type?c.jsx(ca,{path:a.path,details:a.details}):
"file"===a.type?c.jsx(fa,{packageName:b,packageVersion:e,path:a.path,details:a.details}):null}function ka(a){var b=a.packageName,e=a.packageVersion,g=a.availableVersions;g=void 0===g?[]:g;var d=a.filename;a=a.target;return c.jsx(t.Fragment,null,c.jsx(c.Global,{styles:Ja}),c.jsx(c.Global,{styles:Ka}),c.jsx("div",{css:{flex:"1 0 auto"}},c.jsx("div",{css:{maxWidth:940,padding:"0 20px",margin:"0 auto"}},c.jsx(Fa,null)),c.jsx("div",{css:{maxWidth:940,padding:"0 20px",margin:"0 auto"}},c.jsx(Ga,{packageName:b,
packageVersion:e,availableVersions:g,filename:d})),c.jsx("div",{css:{maxWidth:940,padding:"0 20px",margin:"0 auto","@media (max-width: 700px)":{padding:0,margin:0}}},c.jsx(Ia,{packageName:b,packageVersion:e,target:a}))),c.jsx("footer",{css:{marginTop:"5rem",background:"black",color:"#aaa"}},c.jsx("div",{css:{maxWidth:940,padding:"10px 20px",margin:"0 auto",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"}},c.jsx("p",null,c.jsx("span",null,"Build: ","a7ebffa")),
c.jsx("p",null,c.jsx("span",null,"\u00a9 ",(new Date).getFullYear()," UNPKG")),c.jsx("p",{css:{fontSize:"1.5rem"}},c.jsx("a",{href:"https://twitter.com/unpkg",css:{color:"#aaa",display:"inline-block",":hover":{color:"white"}}},c.jsx(za,null)),c.jsx("a",{href:"https://github.com/mjackson/unpkg",css:{color:"#aaa",display:"inline-block",":hover":{color:"white"},marginLeft:"1rem"}},c.jsx(Aa,null))))))}var la="default"in t?t["default"]:t;A=A&&A.hasOwnProperty("default")?A["default"]:A;var La="undefined"!==
typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},m=D(function(a,b){function c(a){if("object"===typeof a&&null!==a){var b=a.$$typeof;switch(b){case d:switch(a=a.type,a){case l:case f:case r:case m:case k:case v:return a;default:switch(a=a&&a.$$typeof,a){case p:case n:case q:return a;default:return b}}case x:case u:case h:return b}}}function g(a){return c(a)===f}Object.defineProperty(b,"__esModule",{value:!0});var d=
(a="function"===typeof Symbol&&Symbol.for)?Symbol.for("react.element"):60103,h=a?Symbol.for("react.portal"):60106,r=a?Symbol.for("react.fragment"):60107,k=a?Symbol.for("react.strict_mode"):60108,m=a?Symbol.for("react.profiler"):60114,q=a?Symbol.for("react.provider"):60109,p=a?Symbol.for("react.context"):60110,l=a?Symbol.for("react.async_mode"):60111,f=a?Symbol.for("react.concurrent_mode"):60111,n=a?Symbol.for("react.forward_ref"):60112,v=a?Symbol.for("react.suspense"):60113,u=a?Symbol.for("react.memo"):
60115,x=a?Symbol.for("react.lazy"):60116;b.typeOf=c;b.AsyncMode=l;b.ConcurrentMode=f;b.ContextConsumer=p;b.ContextProvider=q;b.Element=d;b.ForwardRef=n;b.Fragment=r;b.Lazy=x;b.Memo=u;b.Portal=h;b.Profiler=m;b.StrictMode=k;b.Suspense=v;b.isValidElementType=function(a){return"string"===typeof a||"function"===typeof a||a===r||a===f||a===m||a===k||a===v||"object"===typeof a&&null!==a&&(a.$$typeof===x||a.$$typeof===u||a.$$typeof===q||a.$$typeof===p||a.$$typeof===n)};b.isAsyncMode=function(a){return g(a)||
c(a)===l};b.isConcurrentMode=g;b.isContextConsumer=function(a){return c(a)===p};b.isContextProvider=function(a){return c(a)===q};b.isElement=function(a){return"object"===typeof a&&null!==a&&a.$$typeof===d};b.isForwardRef=function(a){return c(a)===n};b.isFragment=function(a){return c(a)===r};b.isLazy=function(a){return c(a)===x};b.isMemo=function(a){return c(a)===u};b.isPortal=function(a){return c(a)===h};b.isProfiler=function(a){return c(a)===m};b.isStrictMode=function(a){return c(a)===k};b.isSuspense=
function(a){return c(a)===v}});R(m);var na=D(function(a,b){(function(){function a(a){if("object"===typeof a&&null!==a){var b=a.$$typeof;switch(b){case h:switch(a=a.type,a){case f:case n:case k:case q:case m:case u:return a;default:switch(a=a&&a.$$typeof,a){case l:case v:case p:return a;default:return b}}case I:case x:case r:return b}}}function c(b){return a(b)===n}Object.defineProperty(b,"__esModule",{value:!0});var d="function"===typeof Symbol&&Symbol.for,h=d?Symbol.for("react.element"):60103,r=
d?Symbol.for("react.portal"):60106,k=d?Symbol.for("react.fragment"):60107,m=d?Symbol.for("react.strict_mode"):60108,q=d?Symbol.for("react.profiler"):60114,p=d?Symbol.for("react.provider"):60109,l=d?Symbol.for("react.context"):60110,f=d?Symbol.for("react.async_mode"):60111,n=d?Symbol.for("react.concurrent_mode"):60111,v=d?Symbol.for("react.forward_ref"):60112,u=d?Symbol.for("react.suspense"):60113,x=d?Symbol.for("react.memo"):60115,I=d?Symbol.for("react.lazy"):60116;d=function(){};var Ma=function(a){for(var b=
arguments.length,f=Array(1<b?b-1:0),c=1;c<b;c++)f[c-1]=arguments[c];var n=0;b="Warning: "+a.replace(/%s/g,function(){return f[n++]});"undefined"!==typeof console&&console.warn(b);try{throw Error(b);}catch(Xa){}},Na=d=function(a,b){if(void 0===b)throw Error("`lowPriorityWarning(condition, format, ...args)` requires a warning message argument");if(!a){for(var f=arguments.length,c=Array(2<f?f-2:0),n=2;n<f;n++)c[n-2]=arguments[n];Ma.apply(void 0,[b].concat(c))}},ma=!1;b.typeOf=a;b.AsyncMode=f;b.ConcurrentMode=
n;b.ContextConsumer=l;b.ContextProvider=p;b.Element=h;b.ForwardRef=v;b.Fragment=k;b.Lazy=I;b.Memo=x;b.Portal=r;b.Profiler=q;b.StrictMode=m;b.Suspense=u;b.isValidElementType=function(a){return"string"===typeof a||"function"===typeof a||a===k||a===n||a===q||a===m||a===u||"object"===typeof a&&null!==a&&(a.$$typeof===I||a.$$typeof===x||a.$$typeof===p||a.$$typeof===l||a.$$typeof===v)};b.isAsyncMode=function(b){ma||(ma=!0,Na(!1,"The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API."));
return c(b)||a(b)===f};b.isConcurrentMode=c;b.isContextConsumer=function(b){return a(b)===l};b.isContextProvider=function(b){return a(b)===p};b.isElement=function(a){return"object"===typeof a&&null!==a&&a.$$typeof===h};b.isForwardRef=function(b){return a(b)===v};b.isFragment=function(b){return a(b)===k};b.isLazy=function(b){return a(b)===I};b.isMemo=function(b){return a(b)===x};b.isPortal=function(b){return a(b)===r};b.isProfiler=function(b){return a(b)===q};b.isStrictMode=function(b){return a(b)===
m};b.isSuspense=function(b){return a(b)===u}})()});R(na);var oa=D(function(a){a.exports=na}),pa=Object.getOwnPropertySymbols,Oa=Object.prototype.hasOwnProperty,Pa=Object.prototype.propertyIsEnumerable,Qa=function(){try{if(!Object.assign)return!1;var a=new String("abc");a[5]="de";if("5"===Object.getOwnPropertyNames(a)[0])return!1;var b={};for(a=0;10>a;a++)b["_"+String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(b).map(function(a){return b[a]}).join(""))return!1;var c={};"abcdefghijklmnopqrst".split("").forEach(function(a){c[a]=
a});return"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},c)).join("")?!1:!0}catch(g){return!1}}()?Object.assign:function(a,b){if(null===a||void 0===a)throw new TypeError("Object.assign cannot be called with null or undefined");var c=Object(a);for(var g,d=1;d<arguments.length;d++){var h=Object(arguments[d]);for(var r in h)Oa.call(h,r)&&(c[r]=h[r]);if(pa){g=pa(h);for(var k=0;k<g.length;k++)Pa.call(h,g[k])&&(c[g[k]]=h[g[k]])}}return c},K=function(){},L={},ua=Function.call.bind(Object.prototype.hasOwnProperty);
K=function(a){a="Warning: "+a;"undefined"!==typeof console&&console.error(a);try{throw Error(a);}catch(b){}};J.resetWarningCache=function(){L={}};var Ra=Function.call.bind(Object.prototype.hasOwnProperty),C=function(){};C=function(a){a="Warning: "+a;"undefined"!==typeof console&&console.error(a);try{throw Error(a);}catch(b){}};var Sa=function(a,b){function c(a,b){return a===b?0!==a||1/a===1/b:a!==a&&b!==b}function g(a){this.message=a;this.stack=""}function d(a){function c(c,n,v,d,e,u,h){d=d||"<<anonymous>>";
u=u||v;if("SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"!==h){if(b)throw c=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types"),c.name="Invariant Violation",c;"undefined"!==typeof console&&(h=d+":"+v,!f[h]&&3>l&&(C("You are manually calling a React.PropTypes validation function for the `"+u+"` prop on `"+d+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),
f[h]=!0,l++))}return null==n[v]?c?null===n[v]?new g("The "+e+" `"+u+"` is marked as required "+("in `"+d+"`, but its value is `null`.")):new g("The "+e+" `"+u+"` is marked as required in "+("`"+d+"`, but its value is `undefined`.")):null:a(n,v,d,e,u)}var f={},l=0,d=c.bind(null,!1);d.isRequired=c.bind(null,!0);return d}function h(a){return d(function(b,c,f,d,l,e){b=b[c];return k(b)!==a?(b=m(b),new g("Invalid "+d+" `"+l+"` of type "+("`"+b+"` supplied to `"+f+"`, expected ")+("`"+a+"`."))):null})}function r(b){switch(typeof b){case "number":case "string":case "undefined":return!0;
case "boolean":return!b;case "object":if(Array.isArray(b))return b.every(r);if(null===b||a(b))return!0;var c=b&&(p&&b[p]||b["@@iterator"]);var f="function"===typeof c?c:void 0;if(f)if(c=f.call(b),f!==b.entries)for(;!(b=c.next()).done;){if(!r(b.value))return!1}else for(;!(b=c.next()).done;){if((b=b.value)&&!r(b[1]))return!1}else return!1;return!0;default:return!1}}function k(a){var b=typeof a;return Array.isArray(a)?"array":a instanceof RegExp?"object":"symbol"===b||a&&("Symbol"===a["@@toStringTag"]||
"function"===typeof Symbol&&a instanceof Symbol)?"symbol":b}function m(a){if("undefined"===typeof a||null===a)return""+a;var b=k(a);if("object"===b){if(a instanceof Date)return"date";if(a instanceof RegExp)return"regexp"}return b}function q(a){a=m(a);switch(a){case "array":case "object":return"an "+a;case "boolean":case "date":case "regexp":return"a "+a;default:return a}}var p="function"===typeof Symbol&&Symbol.iterator,l={array:h("array"),bool:h("boolean"),func:h("function"),number:h("number"),object:h("object"),
string:h("string"),symbol:h("symbol"),any:d(G),arrayOf:function(a){return d(function(b,c,f,d,l){if("function"!==typeof a)return new g("Property `"+l+"` of component `"+f+"` has invalid PropType notation inside arrayOf.");b=b[c];if(!Array.isArray(b))return b=k(b),new g("Invalid "+d+" `"+l+"` of type "+("`"+b+"` supplied to `"+f+"`, expected an array."));for(c=0;c<b.length;c++){var n=a(b,c,f,d,l+"["+c+"]","SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED");if(n instanceof Error)return n}return null})},
element:function(){return d(function(b,c,d,l,e){b=b[c];return a(b)?null:(b=k(b),new g("Invalid "+l+" `"+e+"` of type "+("`"+b+"` supplied to `"+d+"`, expected a single ReactElement.")))})}(),elementType:function(){return d(function(a,b,c,d,l){a=a[b];return oa.isValidElementType(a)?null:(a=k(a),new g("Invalid "+d+" `"+l+"` of type "+("`"+a+"` supplied to `"+c+"`, expected a single ReactElement type.")))})}(),instanceOf:function(a){return d(function(b,c,f,d,l){if(!(b[c]instanceof a)){var n=a.name||
"<<anonymous>>";b=b[c];b=b.constructor&&b.constructor.name?b.constructor.name:"<<anonymous>>";return new g("Invalid "+d+" `"+l+"` of type "+("`"+b+"` supplied to `"+f+"`, expected ")+("instance of `"+n+"`."))}return null})},node:function(){return d(function(a,b,c,d,l){return r(a[b])?null:new g("Invalid "+d+" `"+l+"` supplied to "+("`"+c+"`, expected a ReactNode."))})}(),objectOf:function(a){return d(function(b,c,f,d,l){if("function"!==typeof a)return new g("Property `"+l+"` of component `"+f+"` has invalid PropType notation inside objectOf.");
b=b[c];c=k(b);if("object"!==c)return new g("Invalid "+d+" `"+l+"` of type "+("`"+c+"` supplied to `"+f+"`, expected an object."));for(var n in b)if(Ra(b,n)&&(c=a(b,n,f,d,l+"."+n,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"),c instanceof Error))return c;return null})},oneOf:function(a){return Array.isArray(a)?d(function(b,f,d,l,e){b=b[f];for(f=0;f<a.length;f++)if(c(b,a[f]))return null;f=JSON.stringify(a,function(a,b){return"symbol"===m(b)?String(b):b});return new g("Invalid "+l+" `"+e+"` of value `"+
String(b)+"` "+("supplied to `"+d+"`, expected one of "+f+"."))}):(1<arguments.length?C("Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z])."):C("Invalid argument supplied to oneOf, expected an array."),G)},oneOfType:function(a){if(!Array.isArray(a))return C("Invalid argument supplied to oneOfType, expected an instance of array."),G;for(var b=0;b<a.length;b++){var c=a[b];if("function"!==
typeof c)return C("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+q(c)+" at index "+b+"."),G}return d(function(b,c,f,d,l){for(var e=0;e<a.length;e++)if(null==(0,a[e])(b,c,f,d,l,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"))return null;return new g("Invalid "+d+" `"+l+"` supplied to "+("`"+f+"`."))})},shape:function(a){return d(function(b,c,d,l,f){b=b[c];c=k(b);if("object"!==c)return new g("Invalid "+l+" `"+f+"` of type `"+c+"` "+("supplied to `"+d+"`, expected `object`."));
for(var e in a)if(c=a[e])if(c=c(b,e,d,l,f+"."+e,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"))return c;return null})},exact:function(a){return d(function(b,c,d,l,f){var e=b[c],n=k(e);if("object"!==n)return new g("Invalid "+l+" `"+f+"` of type `"+n+"` "+("supplied to `"+d+"`, expected `object`."));n=Qa({},b[c],a);for(var h in n){n=a[h];if(!n)return new g("Invalid "+l+" `"+f+"` key `"+h+"` supplied to `"+d+"`.\nBad object: "+JSON.stringify(b[c],null,"  ")+"\nValid keys: "+JSON.stringify(Object.keys(a),
null,"  "));if(n=n(e,h,d,l,f+"."+h,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"))return n}return null})}};g.prototype=Error.prototype;l.checkPropTypes=J;l.resetWarningCache=J.resetWarningCache;return l.PropTypes=l};m=D(function(a){a.exports=Sa(oa.isElement,!0)});var Ta=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b],g;for(g in c)Object.prototype.hasOwnProperty.call(c,g)&&(a[g]=c[g])}return a},Ua={border:0,clip:"rect(0 0 0 0)",height:"1px",width:"1px",margin:"-1px",
padding:0,overflow:"hidden",position:"absolute"},H=function(a){return la.createElement("div",Ta({style:Ua},a))},qa=D(function(a){(function(b,c){a.exports=c()})(La,function(){function a(a){if(!a)return!0;if(!d(a)||0!==a.length)for(var b in a)if(q.call(a,b))return!1;return!0}function c(a){return"number"===typeof a||"[object Number]"===t.call(a)}function g(a){return"string"===typeof a||"[object String]"===t.call(a)}function d(a){return"object"===typeof a&&"number"===typeof a.length&&"[object Array]"===
t.call(a)}function h(a){var b=parseInt(a);return b.toString()===a?b:a}function m(b,d,e,k){c(d)&&(d=[d]);if(a(d))return b;if(g(d))return m(b,d.split("."),e,k);var f=h(d[0]);if(1===d.length)return d=b[f],void 0!==d&&k||(b[f]=e),d;void 0===b[f]&&(c(f)?b[f]=[]:b[f]={});return m(b[f],d.slice(1),e,k)}function k(b,f){c(f)&&(f=[f]);if(!a(b)){if(a(f))return b;if(g(f))return k(b,f.split("."));var e=h(f[0]),l=b[e];if(1===f.length)void 0!==l&&(d(b)?b.splice(e,1):delete b[e]);else if(void 0!==b[e])return k(b[e],
f.slice(1));return b}}var t=Object.prototype.toString,q=Object.prototype.hasOwnProperty,p={ensureExists:function(a,b,c){return m(a,b,c,!0)},set:function(a,b,c,d){return m(a,b,c,d)},insert:function(a,b,c,e){var f=p.get(a,b);e=~~e;d(f)||(f=[],p.set(a,b,f));f.splice(e,0,c)},empty:function(b,f){if(a(f))return b;if(!a(b)){var e,h;if(!(e=p.get(b,f)))return b;if(g(e))return p.set(b,f,"");if("boolean"===typeof e||"[object Boolean]"===t.call(e))return p.set(b,f,!1);if(c(e))return p.set(b,f,0);if(d(e))e.length=
0;else if("object"===typeof e&&"[object Object]"===t.call(e))for(h in e)q.call(e,h)&&delete e[h];else return p.set(b,f,null)}},push:function(a,b){var c=p.get(a,b);d(c)||(c=[],p.set(a,b,c));c.push.apply(c,Array.prototype.slice.call(arguments,2))},coalesce:function(a,b,c){for(var d,e=0,f=b.length;e<f;e++)if(void 0!==(d=p.get(a,b[e])))return d;return c},get:function(b,d,e){c(d)&&(d=[d]);if(a(d))return b;if(a(b))return e;if(g(d))return p.get(b,d.split("."),e);var f=h(d[0]);return 1===d.length?void 0===
b[f]?e:b[f]:p.get(b[f],d.slice(1),e)},del:function(a,b){return k(a,b)}};return p})});var ra=function(a){return function(b){return typeof b===a}};var Va=function(a,b){var c=1,g=b||function(a,b){return b};"-"===a[0]&&(c=-1,a=a.substr(1));return function(b,e){var d;b=g(a,qa.get(b,a));e=g(a,qa.get(e,a));b<e&&(d=-1);b>e&&(d=1);b===e&&(d=0);return d*c}};var da=function(){var a=Array.prototype.slice.call(arguments),b=a.filter(ra("string")),c=a.filter(ra("function"))[0];return function(a,d){for(var e=b.length,
g=0,k=0;0===g&&k<e;)g=Va(b[k],c)(a,d),k++;return g}};let sa="B kB MB GB TB PB EB ZB YB".split(" "),ta=(a,b)=>{let c=a;"string"===typeof b?c=a.toLocaleString(b):!0===b&&(c=a.toLocaleString());return c};var ea=(a,b)=>{if(!Number.isFinite(a))throw new TypeError(`Expected a finite number, got ${typeof a}: ${a}`);b=Object.assign({},b);if(b.signed&&0===a)return" 0 B";var c=0>a;let g=c?"-":b.signed?"+":"";c&&(a=-a);if(1>a)return a=ta(a,b.locale),g+a+" B";c=Math.min(Math.floor(Math.log10(a)/3),sa.length-
1);a=Number((a/Math.pow(1E3,c)).toPrecision(3));a=ta(a,b.locale);return g+a+" "+sa[c]},W={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},V=t.createContext&&t.createContext(W),z=function(){z=Object.assign||function(a){for(var b,c=1,g=arguments.length;c<g;c++){b=arguments[c];for(var d in b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d])}return a};return z.apply(this,arguments)},Y=function(a){return E({tag:"svg",attr:{viewBox:"0 0 12 16"},child:[{tag:"path",attr:{fillRule:"evenodd",
d:"M8.5 1H1c-.55 0-1 .45-1 1v12c0 .55.45 1 1 1h10c.55 0 1-.45 1-1V4.5L8.5 1zM11 14H1V2h7l3 3v9zM5 6.98L3.5 8.5 5 10l-.5 1L2 8.5 4.5 6l.5.98zM7.5 6L10 8.5 7.5 11l-.5-.98L8.5 8.5 7 7l.5-1z"}}]})(a)};Y.displayName="GoFileCode";var Z=function(a){return E({tag:"svg",attr:{viewBox:"0 0 14 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"}}]})(a)};Z.displayName="GoFileDirectory";var X=function(a){return E({tag:"svg",
attr:{viewBox:"0 0 12 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"}}]})(a)};X.displayName="GoFile";var ba=function(a){return E({tag:"svg",attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"}}]})(a)};
ba.displayName="FaGithub";var aa=function(a){return E({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"}}]})(a)};
aa.displayName="FaTwitter";var N={color:"#0076ff",textDecoration:"none",":hover":{textDecoration:"underline"}},y={paddingTop:6,paddingRight:3,paddingBottom:6,paddingLeft:3,borderTop:"1px solid #eaecef"},M=w({},y,{color:"#424242",width:17,paddingRight:2,paddingLeft:10,"@media (max-width: 700px)":{paddingLeft:20}}),O=w({},y,{textAlign:"right",paddingRight:10,"@media (max-width: 700px)":{paddingRight:20}});ca.propTypes={path:m.string.isRequired,details:m.objectOf(m.shape({path:m.string.isRequired,type:m.oneOf(["directory",
"file"]).isRequired,contentType:m.string,integrity:m.string,size:m.number})).isRequired};fa.propTypes={path:m.string.isRequired,details:m.shape({contentType:m.string.isRequired,highlights:m.arrayOf(m.string),uri:m.string,integrity:m.string.isRequired,language:m.string.isRequired,size:m.number.isRequired}).isRequired};var Ja=c.css(ia(),'\nfont-family: -apple-system,\n  BlinkMacSystemFont,\n  "Segoe UI",\n  "Roboto",\n  "Oxygen",\n  "Ubuntu",\n  "Cantarell",\n  "Fira Sans",\n  "Droid Sans",\n  "Helvetica Neue",\n  sans-serif;\n',
"\nfont-family: Menlo,\n  Monaco,\n  Lucida Console,\n  Liberation Mono,\n  DejaVu Sans Mono,\n  Bitstream Vera Sans Mono,\n  Courier New,\n  monospace;\n"),Ka=c.css(ha()),Wa=m.shape({path:m.string.isRequired,type:m.oneOf(["directory","file"]).isRequired,details:m.object.isRequired});ka.propTypes={packageName:m.string.isRequired,packageVersion:m.string.isRequired,availableVersions:m.arrayOf(m.string),filename:m.string.isRequired,target:Wa.isRequired};A.hydrate(la.createElement(ka,window.__DATA__||
{}),document.getElementById("root"))})(React,ReactDOM,emotionCore);
</script></body></html>